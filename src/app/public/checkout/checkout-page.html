<div class="container mx-auto px-4 py-8 max-w-4xl">
    <h1 class="text-3xl font-bold mb-8 text-center">Checkout</h1>

    @if (orderSuccess()) {
    <div class="card bg-base-100 shadow-xl text-center p-10">
        <div class="card-body items-center">
            <div class="text-success text-6xl mb-4">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="card-title text-2xl">¡Orden Recibida!</h2>
            <p>Gracias por tu compra. Nos pondremos en contacto contigo pronto.</p>
            <div class="card-actions mt-6">
                <a routerLink="/" class="btn btn-primary">Volver al Inicio</a>
            </div>
        </div>
    </div>
    } @else {
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Cart Summary -->
        <div class="card bg-base-100 shadow-xl h-fit">
            <div class="card-body">
                <h2 class="card-title mb-4">Resumen del Carrito</h2>

                @if (cartService.cartItems().length === 0) {
                <p>Tu carrito está vacío.</p>
                <a routerLink="/" class="btn btn-link px-0">Ir a comprar</a>
                } @else {
                <div class="space-y-4">
                    @for (item of cartService.cartItems(); track item.product.id) {
                    <div class="flex gap-4 items-center">
                        <img [src]="item.product.image_url || item.product.gallery_urls?.[0] || 'assets/img/no-image.png'"
                            class="w-16 h-16 object-cover rounded-lg" />
                        <div class="flex-1">
                            <h3 class="font-bold">{{ item.product.name }}</h3>
                            <p class="text-sm text-gray-500">${{ item.product.price }} x {{ item.quantity }}</p>
                        </div>
                        <div class="font-bold">
                            ${{ (item.product.price * item.quantity).toFixed(2) }}
                        </div>
                    </div>
                    }
                </div>

                <div class="divider"></div>

                <div class="flex justify-between text-xl font-bold">
                    <span>Total</span>
                    <span>${{ cartService.totalPrice().toFixed(2) }}</span>
                </div>
                }
            </div>
        </div>

        <!-- Customer Form -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title mb-4">Datos del Cliente</h2>

                <form [formGroup]="checkoutForm" (ngSubmit)="placeOrder()" class="space-y-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Nombre Completo</span>
                        </label>
                        <input type="text" formControlName="name" class="input input-bordered"
                            [class.input-error]="checkoutForm.get('name')?.invalid && checkoutForm.get('name')?.touched" />
                        @if (checkoutForm.get('name')?.invalid && checkoutForm.get('name')?.touched) {
                        <span class="text-error text-xs mt-1">El nombre es requerido</span>
                        }
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Email</span>
                        </label>
                        <input type="email" formControlName="email" class="input input-bordered"
                            [class.input-error]="checkoutForm.get('email')?.invalid && checkoutForm.get('email')?.touched" />
                        @if (checkoutForm.get('email')?.invalid && checkoutForm.get('email')?.touched) {
                        <span class="text-error text-xs mt-1">Email inválido</span>
                        }
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Teléfono</span>
                        </label>
                        <input type="tel" formControlName="phone" class="input input-bordered"
                            [class.input-error]="checkoutForm.get('phone')?.invalid && checkoutForm.get('phone')?.touched" />
                        @if (checkoutForm.get('phone')?.invalid && checkoutForm.get('phone')?.touched) {
                        <span class="text-error text-xs mt-1">El teléfono es requerido</span>
                        }
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Dirección de Envío</span>
                        </label>
                        <textarea formControlName="address" class="textarea textarea-bordered h-24"
                            [class.textarea-error]="checkoutForm.get('address')?.invalid && checkoutForm.get('address')?.touched"></textarea>
                        @if (checkoutForm.get('address')?.invalid && checkoutForm.get('address')?.touched) {
                        <span class="text-error text-xs mt-1">La dirección es requerida</span>
                        }
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Notas (Opcional)</span>
                        </label>
                        <textarea formControlName="notes" class="textarea textarea-bordered"></textarea>
                    </div>

                    <div class="mt-6">
                        <button type="submit" class="btn btn-primary btn-block btn-lg"
                            [disabled]="checkoutForm.invalid || isProcessing() || cartService.cartItems().length === 0">
                            @if (isProcessing()) {
                            <span class="loading loading-spinner"></span>
                            }
                            Confirmar Pedido
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    }
</div>