<div
  class="fixed right-0 top-24 h-[calc(100vh-6rem)] w-80 bg-gray-950/95 backdrop-blur-lg border-l-2 border-brand-blue/30 transform transition-transform duration-300 z-2000 overflow-y-auto rounded-l-xl shadow-2xl"
  [class.translate-x-full]="!(preferencesService.sidebarOpen$ | async)"
>
  <!-- Sidebar Header -->
  <div class="sticky top-0 bg-gray-900/80 backdrop-blur border-b border-brand-blue/20 p-4">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-bold text-white flex items-center gap-2">
        <svg class="w-5 h-5 text-brand-blue" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
        </svg>
        {{ (preferencesService.language$ | async) === 'es' ? 'Accesibilidad' : 'Accessibility' }}
      </h3>
      <button
        (click)="preferencesService.closeSidebar()"
        class="p-2 hover:bg-white/10 rounded-lg transition-all"
        [attr.aria-label]="(preferencesService.language$ | async) === 'es' ? 'Cerrar' : 'Close'"
      >
        <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Sidebar Content -->
  <div class="p-4 space-y-6">
    <!-- Language Section -->
    <div class="space-y-3">
      <label class="text-sm font-semibold text-gray-300 block">
        {{ (preferencesService.language$ | async) === 'es' ? 'Idioma' : 'Language' }}
      </label>
      <div class="space-y-2">
        <button
          (click)="preferencesService.setLanguage('es')"
          [class.bg-brand-blue]="(preferencesService.language$ | async) === 'es'"
          class="w-full px-3 py-2 rounded-lg text-white text-sm transition-all hover:bg-brand-blue/80"
          [class.bg-gray-700]="(preferencesService.language$ | async) !== 'es'"
          [attr.aria-pressed]="(preferencesService.language$ | async) === 'es'"
        >
          游쀯릖 Espa침ol
        </button>
        <button
          (click)="preferencesService.setLanguage('en')"
          [class.bg-brand-blue]="(preferencesService.language$ | async) === 'en'"
          class="w-full px-3 py-2 rounded-lg text-white text-sm transition-all hover:bg-brand-blue/80"
          [class.bg-gray-700]="(preferencesService.language$ | async) !== 'en'"
          [attr.aria-pressed]="(preferencesService.language$ | async) === 'en'"
        >
          游쥟릖 English
        </button>
      </div>
    </div>

    <!-- Theme Section -->
    <div class="space-y-3">
      <label class="text-sm font-semibold text-gray-300 block">
        {{ (preferencesService.language$ | async) === 'es' ? 'Tema' : 'Theme' }}
      </label>
      <div class="grid grid-cols-2 gap-2">
        @for (bg of backgroundOptions; track bg) {
          <button
            (click)="preferencesService.setTheme(bg.id)"
            [class.ring-2]="(preferencesService.theme$ | async) === bg.id"
            class="p-3 rounded-lg transition-all hover:ring-2 ring-brand-blue group"
            [attr.title]="bg.name"
            [attr.aria-pressed]="(preferencesService.theme$ | async) === bg.id"
          >
            <div [ngClass]="bg.class" class="w-full h-8 rounded group-hover:shadow-lg transition-shadow"></div>
            <p class="text-xs text-gray-400 mt-1 text-center group-hover:text-gray-300">{{ bg.name }}</p>
          </button>
        }
      </div>
    </div>

    <!-- Font Size Section -->
    <div class="space-y-3">
      <label class="text-sm font-semibold text-gray-300 block">
        {{ (preferencesService.language$ | async) === 'es' ? 'Tama침o de Texto' : 'Text Size' }}
      </label>
      <div class="flex items-center justify-between gap-2">
        <button
          (click)="preferencesService.decreaseFontSize()"
          [disabled]="(preferencesService.fontSize$ | async)! <= 12"
          class="px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-white transition-all"
          [attr.aria-label]="(preferencesService.language$ | async) === 'es' ? 'Reducir tama침o' : 'Decrease size'"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 13H5v-2h14v2z"/>
          </svg>
        </button>

        <span class="text-sm font-semibold text-brand-blue px-3 py-2 bg-gray-800 rounded-lg min-w-12 text-center">
          {{ (preferencesService.fontSize$ | async) }}px
        </span>

        <button
          (click)="preferencesService.increaseFontSize()"
          [disabled]="(preferencesService.fontSize$ | async)! >= 24"
          class="px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-white transition-all"
          [attr.aria-label]="(preferencesService.language$ | async) === 'es' ? 'Aumentar tama침o' : 'Increase size'"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- High Contrast Section -->
    <div class="space-y-3">
      <label class="text-sm font-semibold text-gray-300 block">
        {{ (preferencesService.language$ | async) === 'es' ? 'Alto Contraste' : 'High Contrast' }}
      </label>
      <button
        (click)="preferencesService.toggleHighContrast()"
        [class.bg-brand-blue]="(preferencesService.highContrast$ | async)"
        [class.bg-gray-700]="!(preferencesService.highContrast$ | async)"
        class="w-full px-4 py-2 rounded-lg text-white transition-all hover:opacity-80 flex items-center justify-center gap-2"
        [attr.aria-pressed]="(preferencesService.highContrast$ | async)"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11z"/>
        </svg>
        {{ (preferencesService.highContrast$ | async) ? ((preferencesService.language$ | async) === 'es' ? 'Activado' : 'Enabled') : ((preferencesService.language$ | async) === 'es' ? 'Desactivado' : 'Disabled') }}
      </button>
    </div>
  </div>
</div>

<!-- Toggle Sidebar Button -->
<button
  (click)="preferencesService.toggleSidebar()"
  class="fixed right-0 top-32 z-2000 p-3 bg-brand-blue hover:bg-brand-dark-blue text-white rounded-l-lg transition-all shadow-lg"
  [class.hidden]="(preferencesService.sidebarOpen$ | async)"
  [attr.aria-label]="(preferencesService.language$ | async) === 'es' ? 'Abrir panel de accesibilidad' : 'Open accessibility panel'"
  title="Accessibility"
>
  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11z"/>
  </svg>
</button>
