<div class="max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Configuración de Empresa</h1>
    </div>

    <div class="card bg-base-100 shadow-lg">
        <div class="card-body p-6">
            @if (error()) {
            <div class="alert alert-error mb-4 shadow-sm">
                <i class="fas fa-exclamation-circle"></i>
                <span>{{ error() }}</span>
            </div>
            }
            @if (success()) {
            <div class="alert alert-success mb-4 shadow-sm">
                <i class="fas fa-check-circle"></i>
                <span>{{ success() }}</span>
            </div>
            }

            <form (ngSubmit)="save()" class="space-y-6">
                <!-- Basic Info -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Nombre de la Empresa</span>
                        </label>
                        <label class="input input-bordered flex items-center gap-2">
                            <i class="fas fa-building text-gray-400"></i>
                            <input type="text" [(ngModel)]="form().name" name="name" class="grow" required />
                        </label>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Propietario</span>
                        </label>
                        <label class="input input-bordered flex items-center gap-2">
                            <i class="fas fa-user text-gray-400"></i>
                            <input type="text" [(ngModel)]="form().owner_name" name="owner_name" class="grow" />
                        </label>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">RUC / CUIT</span>
                        </label>
                        <label class="input input-bordered flex items-center gap-2">
                            <i class="fas fa-id-card text-gray-400"></i>
                            <input type="text" [(ngModel)]="form().ruc" name="ruc" class="grow" />
                        </label>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Dirección</span>
                        </label>
                        <label class="input input-bordered flex items-center gap-2">
                            <i class="fas fa-map-marker-alt text-gray-400"></i>
                            <input type="text" [(ngModel)]="form().address" name="address" class="grow" />
                        </label>
                    </div>
                </div>

                <!-- Contact Info -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Email</span>
                        </label>
                        <label class="input input-bordered flex items-center gap-2">
                            <i class="fas fa-envelope text-gray-400"></i>
                            <input type="email" [(ngModel)]="form().email" name="email" class="grow" />
                        </label>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Teléfono</span>
                        </label>
                        <label class="input input-bordered flex items-center gap-2">
                            <i class="fas fa-phone text-gray-400"></i>
                            <input type="text" [(ngModel)]="form().phone" name="phone" class="grow" />
                        </label>
                    </div>
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium">Ubicación</span>
                    </label>
                    <label class="input input-bordered flex items-center gap-2">
                        <i class="fas fa-globe text-gray-400"></i>
                        <input type="text" [(ngModel)]="form().location" name="location" class="grow" 
                            placeholder="Ej: Buenos Aires, Argentina" />
                    </label>
                </div>

                <div class="divider text-sm font-medium text-gray-500">Configuración Fiscal</div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Porcentaje Impuesto (%)</span>
                        </label>
                        <label class="input input-bordered flex items-center gap-2">
                            <i class="fas fa-percent text-gray-400"></i>
                            <input type="number" [(ngModel)]="form().tax_percentage" name="tax_percentage" class="grow" />
                        </label>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Abreviatura Impuesto</span>
                        </label>
                        <label class="input input-bordered flex items-center gap-2">
                            <i class="fas fa-tag text-gray-400"></i>
                            <input type="text" [(ngModel)]="form().tax_abbreviation" name="tax_abbreviation" class="grow" 
                                placeholder="Ej: IVA" />
                        </label>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-medium">Moneda</span>
                        </label>
                        <select [(ngModel)]="form().currency" name="currency" class="select select-bordered w-full">
                            <option value="ARS">ARS (Peso Argentino)</option>
                            <option value="USD">USD (Dólar Estadounidense)</option>
                        </select>
                    </div>
                </div>

                <div class="divider text-sm font-medium text-gray-500">Branding</div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-medium">Logo de la Empresa</span>
                    </label>
                    <input type="file" (change)="onFileChange($event)" class="file-input file-input-bordered w-full"
                        accept="image/*">
                    @if (form().logo_url) {
                    <div class="mt-4 p-4 border rounded-lg bg-base-200 flex justify-center">
                        <img [src]="form().logo_url" alt="Logo preview" class="h-32 object-contain">
                    </div>
                    }
                </div>

                <div class="flex justify-end gap-4 mt-8 pt-4 border-t border-base-200">
                    <button type="submit" class="btn btn-primary px-8" [disabled]="saving()">
                        @if (saving()) {
                        <span class="loading loading-spinner"></span>
                        }
                        Guardar Configuración
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- SUCURSALES (Branches) MANAGEMENT -->
    <div class="card bg-base-100 shadow-lg mt-8">
        <div class="card-body p-6">
            <h2 class="text-xl font-bold mb-4">Gestión de Sucursales</h2>
            <p class="text-gray-500 mb-6 text-sm">Administra las ubicaciones físicas de tu negocio. Estas podrán ser asignadas a reparaciones o inventario.</p>

            <!-- Listado de Sucursales -->
            <div class="overflow-x-auto border rounded-xl mb-8">
                <table class="table table-zebra w-full">
                    <thead>
                        <tr class="bg-base-200">
                            <th>Nombre</th>
                            <th>Dirección</th>
                            <th>Estado</th>
                            <th class="text-right">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (branch of branches(); track branch.id) {
                        <tr>
                            <td class="font-medium">{{ branch.name }}</td>
                            <td>{{ branch.address || '--' }}</td>
                            <td>
                                <button class="badge cursor-pointer" 
                                    [class.badge-success]="branch.is_active" 
                                    [class.badge-ghost]="!branch.is_active"
                                    (click)="toggleBranchStatus(branch)">
                                    {{ branch.is_active ? 'Activa' : 'Inactiva' }}
                                </button>
                            </td>
                            <td class="text-right">
                                <button class="btn btn-ghost btn-sm text-error" (click)="deleteBranch(branch.id)" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        }
                        @if (branches().length === 0) {
                        <tr>
                            <td colspan="4" class="text-center py-4 text-gray-500">No hay sucursales registradas.</td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Formulario para agregar Nueva Sucursal -->
            <div class="bg-base-200 p-6 rounded-xl border border-base-300">
                <h3 class="font-bold text-lg mb-4"><i class="fas fa-plus-circle text-primary mr-2"></i>Agregar Nueva Sucursal</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                    <div class="form-control">
                        <label class="label"><span class="label-text">Nombre de la Sucursal</span></label>
                        <input type="text" [(ngModel)]="newBranch().name" class="input input-bordered w-full" placeholder="Ej: Zona Centro" />
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">Dirección (Opcional)</span></label>
                        <input type="text" [(ngModel)]="newBranch().address" class="input input-bordered w-full" placeholder="Ej: San Martin 123" />
                    </div>
                </div>
                <div class="mt-4 flex items-center justify-between">
                    <label class="cursor-pointer label flex gap-2">
                        <input type="checkbox" [(ngModel)]="newBranch().is_active" class="checkbox checkbox-primary" />
                        <span class="label-text">Sucursal Activa</span>
                    </label>
                    <button class="btn btn-primary" (click)="addBranch()" [disabled]="savingBranch() || !newBranch().name">
                        @if(savingBranch()) { <span class="loading loading-spinner"></span> }
                        Agregar Sucursal
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>