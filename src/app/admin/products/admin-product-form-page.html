<div class="max-w-4xl mx-auto text-gray-800 dark:text-white">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">{{ id ? 'Editar' : 'Nuevo' }} Producto</h2>
  </div>

  <form (ngSubmit)="save()" #f="ngForm">

    <!-- Basic Info Section -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 mb-6">
      <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white border-b dark:border-gray-700 pb-2">Información Básica</h3>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Nombre del Producto</label>
        <input type="text" [(ngModel)]="form().name" name="name" class="w-full bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 transition-all duration-200 ease-in-out shadow-sm hover:border-gray-400 dark:hover:border-gray-500"
          placeholder="Ej: iPhone 13 Pro Max" required />
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">SKU</label>
          <input type="text" [(ngModel)]="form().sku" name="sku" class="w-full bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 transition-all duration-200 ease-in-out shadow-sm hover:border-gray-400 dark:hover:border-gray-500" placeholder="Código interno">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Código de Barras</label>
          <div class="flex gap-2">
            <input type="text" [(ngModel)]="form().barcode" name="barcode" class="w-full bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 transition-all duration-200 ease-in-out shadow-sm hover:border-gray-400 dark:hover:border-gray-500"
              placeholder="EAN / UPC">
            <button type="button" class="btn btn-square btn-outline" (click)="generateBarcode()"
              title="Generar código aleatorio">
              <i class="fas fa-random"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Categorization Section -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 mb-6">
      <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white border-b dark:border-gray-700 pb-2">Categorización</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Marca</label>
          <select [(ngModel)]="form().brand_id" name="brand_id" class="w-full bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 transition-all duration-200 ease-in-out shadow-sm hover:border-gray-400 dark:hover:border-gray-500">
            <option value="">Seleccionar Marca</option>
            @for (brand of brands(); track brand.id) {
            <option [value]="brand.id">{{ brand.name }}</option>
            }
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Categoría</label>
          <select [(ngModel)]="form().category_id" name="category_id" class="w-full bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 transition-all duration-200 ease-in-out shadow-sm hover:border-gray-400 dark:hover:border-gray-500">
            <option value="">Seleccionar Categoría</option>
            @for (cat of categories(); track cat.id) {
            <option [value]="cat.id">{{ cat.name }}</option>
            }
          </select>
        </div>
      </div>
    </div>

    <!-- Details Section -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 mb-6">
      <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white border-b dark:border-gray-700 pb-2">Detalles</h3>
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Descripción</label>
        <textarea [(ngModel)]="form().description" name="description" class="w-full bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 transition-all duration-200 ease-in-out shadow-sm hover:border-gray-400 dark:hover:border-gray-500" rows="4"
          placeholder="Detalles técnicos, características..."></textarea>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Precio ($)</label>
          <input type="number" [(ngModel)]="form().price" name="price" class="w-full bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 transition-all duration-200 ease-in-out shadow-sm hover:border-gray-400 dark:hover:border-gray-500" required min="0" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Stock</label>
          <input type="number" [(ngModel)]="form().stock" name="stock" class="w-full bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 transition-all duration-200 ease-in-out shadow-sm hover:border-gray-400 dark:hover:border-gray-500" min="0" />
        </div>
      </div>
    </div>

    <!-- Status Section -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 mb-6">
      <label class="flex items-center gap-3 p-3 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors cursor-pointer w-fit">
        <input type="checkbox" [(ngModel)]="form().is_active" name="is_active"
          class="checkbox checkbox-primary h-5 w-5 rounded border-gray-300 dark:border-gray-500" />
        <span class="font-medium text-gray-700 dark:text-gray-300">Producto Activo</span>
      </label>
    </div>

    <!-- Images Section -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 mb-6">
      <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white border-b dark:border-gray-700 pb-2">Galería de Imágenes</h3>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Subir Imágenes</label>
        <input type="file" (change)="onFileChange($event)" accept="image/*"
          class="file-input file-input-bordered file-input-primary w-full bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300" multiple />
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Formatos soportados: JPG, PNG, WEBP.</p>
      </div>

      @if (form().images.length > 0) {
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
        @for (img of form().images; track img; let idx = $index) {
        <div class="relative group aspect-square">
          <img [src]="img" class="w-full h-full object-cover rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm" />
          <div
            class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center">
            <button type="button" (click)="removeImage(idx)" class="btn btn-circle btn-error btn-sm text-white">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          @if (idx === 0) {
          <span class="absolute bottom-2 left-2 badge badge-primary badge-sm shadow-md">Principal</span>
          }
        </div>
        }
      </div>
      }
    </div>

    @if (error) {
    <div class="alert alert-error mb-6">
      <i class="fas fa-exclamation-circle"></i>
      <span>{{ error }}</span>
    </div>
    }

    <div class="flex gap-4 justify-end">
      <a routerLink="/admin/products" class="btn btn-ghost text-gray-700 dark:text-gray-300">Cancelar</a>
      <button type="submit" class="btn btn-primary px-8" [disabled]="saving || uploading()">
        @if (uploading()) {
        <span class="loading loading-spinner loading-xs mr-2"></span> Subiendo...
        } @else if (saving) {
        <span class="loading loading-spinner loading-xs mr-2"></span> Guardando...
        } @else {
        Guardar Producto
        }
      </button>
    </div>
  </form>
</div>