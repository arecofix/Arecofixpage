<div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 md:gap-0">
  <h1 class="text-2xl font-bold text-gray-800 dark:text-green-400 self-start md:self-auto">Productos</h1>
  <div class="grid grid-cols-2 gap-2 w-full md:w-auto md:flex">
    <button (click)="exportProducts()" class="btn btn-outline btn-primary w-full md:w-auto">
      <i class="fas fa-file-export mr-2"></i> Exportar CSV
    </button>
    <button (click)="fileInput.click()" class="btn btn-outline btn-secondary w-full md:w-auto">
      <i class="fas fa-file-import mr-2"></i> Importar CSV
    </button>
    <input #fileInput type="file" accept=".csv" class="hidden" (change)="importProducts($event)" />
    <a routerLink="/admin/products/new" class="btn btn-primary col-span-2 w-full md:w-auto">
      <i class="fas fa-plus mr-2"></i> Nuevo Producto
    </a>
  </div>
</div>

<!-- Filters Bar -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
  <div class="form-control">
      <div class="input-group">
          <input type="text" [ngModel]="searchQuery()" (ngModelChange)="searchQuery.set($event)"
              placeholder="Buscar por nombre, SKU o cÃ³digo de barras..."
              class="input input-bordered w-full bg-base-100 text-base-content" />
          <button class="btn btn-square">
              <i class="fas fa-search"></i>
          </button>
      </div>
  </div>
  <div class="flex justify-end">
      <select [ngModel]="sortOrder()" (change)="updateSort($event)" class="select select-bordered bg-base-100 text-base-content max-w-xs">
          <option value="name_asc">Nombre (A-Z)</option>
          <option value="price_asc">Precio: Menor a Mayor</option>
          <option value="price_desc">Precio: Mayor a Menor</option>
          <option value="stock_asc">Stock: Menor a Mayor</option>
          <option value="stock_desc">Stock: Mayor a Menor</option>
      </select>
  </div>
</div>

@if (loading()) {
<div class="flex justify-center py-12">
  <span class="loading loading-spinner loading-lg"></span>
</div>
} @else if (error()) {
<div class="alert alert-error">
  <i class="fas fa-exclamation-circle"></i>
  <span>{{ error() }}</span>
</div>
} @else {
<div class="bg-white rounded-lg shadow overflow-hidden text-gray-800 dark:text-white dark:bg-gray-800">
      <!-- Mobile View (Cards) -->
      <div class="md:hidden">
        <div *ngFor="let product of paginatedProducts()" class="p-4 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
          <div class="flex items-start gap-3">
            <div class="h-12 w-12 shrink-0">
              <img [src]="product.image_url || 'assets/placeholder.png'" 
                   [alt]="product.name" 
                   class="h-12 w-12 rounded-lg object-cover border border-gray-200 dark:border-gray-700">
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex justify-between items-start">
                <div>
                  <div class="text-sm font-medium text-gray-900 dark:text-white line-clamp-1">{{ product.name }}</div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">SKU: {{ product.sku || 'N/A' }}</div>
                </div>
                <div class="text-sm font-bold text-indigo-600 dark:text-indigo-400 ml-2">{{ product.price | currency }}</div>
              </div>
              
              <div class="mt-2 flex flex-wrap gap-2 items-center text-xs">
                <span class="px-2 py-0.5 rounded-full"
                      [ngClass]="{
                        'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400': product.stock > 10,
                        'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400': product.stock <= 10 && product.stock > 0,
                        'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400': product.stock === 0
                      }">
                  {{ product.stock }} un.
                </span>
                <span class="px-2 py-0.5 rounded-full"
                      [ngClass]="product.is_active ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400' : 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400'">
                  {{ product.is_active ? 'Activo' : 'Inactivo' }}
                </span>
              </div>

              <div class="mt-3 flex justify-end">
                <a [routerLink]="['/admin/products', product.id]" 
                   class="btn btn-xs btn-ghost text-indigo-600 dark:text-indigo-400">
                  <i class="fas fa-edit mr-1"></i> Editar
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Desktop View (Table) -->
      <div class="hidden md:block overflow-x-auto">
        <table class="table w-full">
          <thead>
            <tr class="text-gray-800 dark:text-white">
              <th>Producto</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
           <tr *ngFor="let product of paginatedProducts()" class="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors border-b border-gray-100 dark:border-gray-800">
            <td class="px-6 py-4">
              <div class="flex items-center">
                <div class="h-10 w-10 shrink-0">
                  <img [src]="product.image_url || 'assets/placeholder.png'" 
                       [alt]="product.name" 
                       class="h-10 w-10 rounded-full object-cover border border-gray-200 dark:border-gray-700">
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-900 dark:text-white">{{ product.name }}</div>
                  <div class="text-sm text-gray-500 dark:text-gray-400">SKU: {{ product.sku || 'N/A' }}</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900 dark:text-white font-medium">{{ product.price | currency }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                    [ngClass]="{
                      'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400': product.stock > 10,
                      'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400': product.stock <= 10 && product.stock > 0,
                      'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400': product.stock === 0
                    }">
                {{ product.stock }} unidades
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                    [ngClass]="product.is_active ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400' : 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400'">
                {{ product.is_active ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <a [routerLink]="['/admin/products', product.id]" 
                 class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300 mr-4 transition-colors">
                <i class="fas fa-edit"></i>
              </a>
            </td>
          </tr>
          
          <!-- Empty State -->
          <tr *ngIf="paginatedProducts().length === 0">
            <td colspan="5" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
              <div class="flex flex-col items-center justify-center">
                <i class="fas fa-search text-4xl mb-4 text-gray-300 dark:text-gray-600"></i>
                <p class="text-lg">No se encontraron productos</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  <!-- Pagination -->
  <div class="p-4 border-t border-gray-200 dark:border-gray-800 flex justify-center" *ngIf="products().length > 0">
    <pagination [pages]="totalPages()" [currentPage]="currentPage()" />
  </div>
</div>
}