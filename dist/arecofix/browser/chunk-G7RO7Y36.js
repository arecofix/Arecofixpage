import{a as R}from"./chunk-MCSV4IA2.js";import{j as I}from"./chunk-BWQSVEWZ.js";import{C as x,S as _,W as j,X as w,o as q,p as y,u as P}from"./chunk-DPJIKM6M.js";import{a as h,b as S}from"./chunk-VOSPIT4N.js";var k=class r{constructor(i){this.authService=i;this.supabase=this.authService.getSupabaseClient()}supabase;logger=w(I);getData(i={}){let{_page:t=1,_per_page:a=10,category_id:o,description:p,featured:s,id:f,name:l,price:d,slug:m}=i,g=(t-1)*a,A=g+a-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return o!=null&&(e=e.eq("category_id",o)),p&&(e=e.ilike("description",`%${p}%`)),s!=null&&(e=e.eq("is_featured",s)),f&&(e=e.eq("id",f)),l&&(e=e.ilike("name",`%${l}%`)),d&&(e=e.eq("price",d)),m&&(e=e.eq("slug",m)),e=e.range(g,A),q(e).pipe(P(({data:c,count:C,error:v})=>{if(v)throw v;let b=C||0,u=Math.max(1,Math.ceil(b/a)),M=(c||[]).map(n=>S(h({},n),{featured:n?.featured??n?.is_featured??!1}));return{first:1,prev:t>1?t-1:null,next:t<u?t+1:null,last:u,pages:u,items:b,data:M||[]}}),x(c=>(this.logger.error("Supabase product query error",c),y({first:1,prev:null,next:null,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(t){return new(t||r)(j(R))};static \u0275prov=_({token:r,factory:r.\u0275fac,providedIn:"root"})};export{k as a};
