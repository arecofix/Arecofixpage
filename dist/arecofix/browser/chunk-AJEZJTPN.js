import{a as J}from"./chunk-W7SKTQBG.js";import{b as $,c as h,d as A,e as L,h as j,j as z,k as B,q as U,s as H}from"./chunk-TXZ4IKMM.js";import{a as R}from"./chunk-7YCDAOWI.js";import"./chunk-FDEIW4RV.js";import"./chunk-KXBHGC7O.js";import{d as G,e as M}from"./chunk-SJUHAIWY.js";import"./chunk-2IHNZNBZ.js";import{o as V}from"./chunk-NGBKTTVY.js";import{$ as F,Ca as P,Db as g,Fa as l,Fb as o,Gb as D,Hb as E,Ib as O,Ta as N,W as v,aa as y,eb as s,fb as p,ib as T,jb as I,kb as b,lb as t,ma as S,mb as e,nb as m,rb as q,vb as w,xb as k}from"./chunk-CVZCBU36.js";import"./chunk-VOSPIT4N.js";var Q=(i,a)=>a.product.id;function W(i,a){i&1&&(t(0,"div",2)(1,"div",4)(2,"div",5),m(3,"i",6),e(),t(4,"h2",7),o(5,"\xA1Orden Recibida!"),e(),t(6,"p"),o(7,"Gracias por tu compra. Nos pondremos en contacto contigo pronto."),e(),t(8,"div",8)(9,"a",9),o(10,"Volver al Inicio"),e()()()())}function X(i,a){i&1&&(t(0,"p"),o(1,"Tu carrito est\xE1 vac\xEDo."),e(),t(2,"a",27),o(3,"Ir a comprar"),e())}function Y(i,a){if(i&1&&(t(0,"div",29),m(1,"img",32),t(2,"div",33)(3,"h3",34),o(4),e(),t(5,"p",35),o(6),e()(),t(7,"div",34),o(8),e()()),i&2){let n=a.$implicit;l(),b("src",n.product.image_url||(n.product.gallery_urls==null?null:n.product.gallery_urls[0])||"assets/img/no-image.png",P),l(3),D(n.product.name),l(2),O("$",n.product.price," x ",n.quantity),l(2),E(" $",(n.product.price*n.quantity).toFixed(2)," ")}}function Z(i,a){if(i&1&&(t(0,"div",28),T(1,Y,9,5,"div",29,Q),e(),m(3,"div",30),t(4,"div",31)(5,"span"),o(6,"Total"),e(),t(7,"span"),o(8),e()()),i&2){let n=k(2);l(),I(n.cartService.cartItems()),l(7),E("$",n.cartService.totalPrice().toFixed(2))}}function ee(i,a){i&1&&(t(0,"span",19),o(1,"El nombre es requerido"),e())}function te(i,a){i&1&&(t(0,"span",19),o(1,"Email inv\xE1lido"),e())}function ie(i,a){i&1&&(t(0,"span",19),o(1,"El tel\xE9fono es requerido"),e())}function ne(i,a){i&1&&(t(0,"span",19),o(1,"La direcci\xF3n es requerida"),e())}function oe(i,a){i&1&&m(0,"span",26)}function re(i,a){if(i&1){let n=q();t(0,"div",3)(1,"div",10)(2,"div",11)(3,"h2",12),o(4,"Resumen del Carrito"),e(),s(5,X,4,0)(6,Z,9,1),e()(),t(7,"div",13)(8,"div",11)(9,"h2",12),o(10,"Datos del Cliente"),e(),t(11,"form",14),w("ngSubmit",function(){F(n);let u=k();return y(u.placeOrder())}),t(12,"div",15)(13,"label",16)(14,"span",17),o(15,"Nombre Completo"),e()(),m(16,"input",18),s(17,ee,2,0,"span",19),e(),t(18,"div",15)(19,"label",16)(20,"span",17),o(21,"Email"),e()(),m(22,"input",20),s(23,te,2,0,"span",19),e(),t(24,"div",15)(25,"label",16)(26,"span",17),o(27,"Tel\xE9fono"),e()(),m(28,"input",21),s(29,ie,2,0,"span",19),e(),t(30,"div",15)(31,"label",16)(32,"span",17),o(33,"Direcci\xF3n de Env\xEDo"),e()(),m(34,"textarea",22),s(35,ne,2,0,"span",19),e(),t(36,"div",15)(37,"label",16)(38,"span",17),o(39,"Notas (Opcional)"),e()(),m(40,"textarea",23),e(),t(41,"div",24)(42,"button",25),s(43,oe,1,0,"span",26),o(44," Confirmar Pedido "),e()()()()()()}if(i&2){let n,d,u,_,c,x,f,C,r=k();l(5),p(r.cartService.cartItems().length===0?5:6),l(6),b("formGroup",r.checkoutForm),l(5),g("input-error",((n=r.checkoutForm.get("name"))==null?null:n.invalid)&&((n=r.checkoutForm.get("name"))==null?null:n.touched)),l(),p((d=r.checkoutForm.get("name"))!=null&&d.invalid&&((d=r.checkoutForm.get("name"))!=null&&d.touched)?17:-1),l(5),g("input-error",((u=r.checkoutForm.get("email"))==null?null:u.invalid)&&((u=r.checkoutForm.get("email"))==null?null:u.touched)),l(),p((_=r.checkoutForm.get("email"))!=null&&_.invalid&&((_=r.checkoutForm.get("email"))!=null&&_.touched)?23:-1),l(5),g("input-error",((c=r.checkoutForm.get("phone"))==null?null:c.invalid)&&((c=r.checkoutForm.get("phone"))==null?null:c.touched)),l(),p((x=r.checkoutForm.get("phone"))!=null&&x.invalid&&((x=r.checkoutForm.get("phone"))!=null&&x.touched)?29:-1),l(5),g("textarea-error",((f=r.checkoutForm.get("address"))==null?null:f.invalid)&&((f=r.checkoutForm.get("address"))==null?null:f.touched)),l(),p((C=r.checkoutForm.get("address"))!=null&&C.invalid&&((C=r.checkoutForm.get("address"))!=null&&C.touched)?35:-1),l(7),b("disabled",r.checkoutForm.invalid||r.isProcessing()||r.cartService.cartItems().length===0),l(),p(r.isProcessing()?43:-1)}}var K=class i{cartService=v(R);orderService=v(J);fb=v(U);router=v(G);checkoutForm=this.fb.group({name:["",[h.required]],email:["",[h.required,h.email]],phone:["",[h.required]],address:["",[h.required]],notes:[""]});isProcessing=S(!1);orderSuccess=S(!1);async placeOrder(){if(this.checkoutForm.invalid){this.checkoutForm.markAllAsTouched();return}this.isProcessing.set(!0);let a=this.checkoutForm.value,n=this.cartService.cartItems(),d=this.cartService.totalPrice(),u={customer_name:a.name,customer_email:a.email,customer_phone:a.phone,customer_address:a.address,status:"pending",subtotal:d,tax:0,discount:0,total:d,notes:a.notes},_=n.map(c=>({product_name:c.product.name,product_id:c.product.id,quantity:c.quantity,unit_price:c.product.price,subtotal:c.product.price*c.quantity}));try{let{data:c,error:x}=await this.orderService.createOrder(u,_);if(x)throw x;this.orderSuccess.set(!0),this.cartService.clearCart()}catch(c){console.error("Checkout failed",c)}finally{this.isProcessing.set(!1)}}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=N({type:i,selectors:[["app-checkout-page"]],decls:5,vars:1,consts:[[1,"container","mx-auto","px-4","py-8","max-w-4xl"],[1,"text-3xl","font-bold","mb-8","text-center"],[1,"card","bg-base-100","shadow-xl","text-center","p-10"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"card-body","items-center"],[1,"text-success","text-6xl","mb-4"],[1,"fas","fa-check-circle"],[1,"card-title","text-2xl"],[1,"card-actions","mt-6"],["routerLink","/",1,"btn","btn-primary"],[1,"card","bg-base-100","shadow-xl","h-fit"],[1,"card-body"],[1,"card-title","mb-4"],[1,"card","bg-base-100","shadow-xl"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"form-control"],[1,"label"],[1,"label-text"],["type","text","formControlName","name",1,"input","input-bordered"],[1,"text-error","text-xs","mt-1"],["type","email","formControlName","email",1,"input","input-bordered"],["type","tel","formControlName","phone",1,"input","input-bordered"],["formControlName","address",1,"textarea","textarea-bordered","h-24"],["formControlName","notes",1,"textarea","textarea-bordered"],[1,"mt-6"],["type","submit",1,"btn","btn-primary","btn-block","btn-lg",3,"disabled"],[1,"loading","loading-spinner"],["routerLink","/",1,"btn","btn-link","px-0"],[1,"space-y-4"],[1,"flex","gap-4","items-center"],[1,"divider"],[1,"flex","justify-between","text-xl","font-bold"],[1,"w-16","h-16","object-cover","rounded-lg",3,"src"],[1,"flex-1"],[1,"font-bold"],[1,"text-sm","text-gray-500"]],template:function(n,d){n&1&&(t(0,"div",0)(1,"h1",1),o(2,"Checkout"),e(),s(3,W,11,0,"div",2)(4,re,45,16,"div",3),e()),n&2&&(l(3),p(d.orderSuccess()?3:4))},dependencies:[V,H,j,$,A,L,B,z,M],encapsulation:2})};export{K as CheckoutPage};
