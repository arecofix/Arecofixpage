import{k as U,l as z}from"./chunk-ECZXGVFH.js";import{a as N,b as D,d as I,e as L,f as k,g as q,h as B,m as V,n as j,o as O,q as R,t as G}from"./chunk-63CMMPDH.js";import"./chunk-P2JKZEUE.js";import"./chunk-XIH5YEDL.js";import"./chunk-M7RWEG4P.js";import{l as F,n as T,o as W}from"./chunk-YNFFGNY6.js";import"./chunk-Q44XB7TV.js";import{$b as u,Ab as t,Bb as n,Cb as _,Kb as E,Mb as y,Ua as s,Ub as P,Vb as o,W as p,Wb as x,Xb as A,Zb as m,_b as g,gb as S,ma as c,tb as f,ub as b,xb as w,yb as M,zb as h}from"./chunk-DX2LKEMG.js";import{a as v,b as C}from"./chunk-C6Q5SG76.js";var J=(r,l)=>l.id;function K(r,l){if(r&1&&(t(0,"div",7),_(1,"i",33),t(2,"span"),o(3),n()()),r&2){let a=y();s(3),x(a.error())}}function Q(r,l){if(r&1&&_(0,"i",34),r&2){let a=y();P(a.form().image_url)}}function X(r,l){r&1&&(t(0,"span",17),o(1,"N/A"),n())}function Y(r,l){if(r&1&&(t(0,"option",35),o(1),n()),r&2){let a=y().$implicit;h("value",a.id),s(),x(a.name)}}function Z(r,l){if(r&1&&f(0,Y,2,2,"option",35),r&2){let a=l.$implicit,e=y();b(a.id!==e.id?0:-1)}}function $(r,l){r&1&&_(0,"span",32)}var H=class r{route=p(F);router=p(T);auth=p(z);tenantService=p(U);id=null;categories=c([]);form=c({name:"",slug:"",description:"",image_url:"",type:"product",parent_id:"",is_active:!0});loading=c(!0);saving=c(!1);error=c(null);async ngOnInit(){this.id=this.route.snapshot.paramMap.get("id");let l=this.auth.getSupabaseClient(),{data:a}=await l.from("categories").select("id, name").eq("tenant_id",this.tenantService.getTenantId()).eq("is_active",!0).order("name");if(a&&this.categories.set(a),this.id){let{data:e,error:d}=await l.from("categories").select("*").eq("tenant_id",this.tenantService.getTenantId()).eq("id",this.id).single();e&&this.form.set({name:e.name,slug:e.slug,description:e.description||"",image_url:e.image_url||e.icon||"",type:e.type,parent_id:e.parent_id||null,is_active:e.is_active})}this.loading.set(!1)}async save(){this.saving.set(!0),this.error.set(null);let l=this.auth.getSupabaseClient(),a=v({},this.form());a.slug||(a.slug=this.slugify(a.name));try{if(this.id){let{error:e}=await l.from("categories").update(a).eq("id",this.id).eq("tenant_id",this.tenantService.getTenantId());if(e)throw e}else{let{error:e}=await l.from("categories").insert(C(v({},a),{tenant_id:this.tenantService.getTenantId()}));if(e)throw e}this.router.navigate(["/admin/categories"])}catch(e){this.error.set(e.message)}finally{this.saving.set(!1)}}slugify(l){return l.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}static \u0275fac=function(a){return new(a||r)};static \u0275cmp=S({type:r,selectors:[["app-admin-category-form-page"]],decls:62,vars:13,consts:[[1,"max-w-4xl","mx-auto","text-base-content"],[1,"flex","items-center","gap-4","mb-6"],["routerLink","/admin/categories",1,"btn","btn-circle","btn-ghost","text-base-content"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","text-green-600"],[3,"ngSubmit"],[1,"bg-base-100","p-6","rounded-xl","shadow-sm","border","border-base-200","mb-6","text-base-content"],[1,"alert","alert-error","mb-6"],[1,"mb-4"],[1,"block","text-sm","font-medium","text-base-content","mb-1.5"],["type","text","name","name","required","",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["type","text","name","slug","placeholder","Se genera autom\xE1ticamente si se deja vac\xEDo",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["name","description","rows","4",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],[1,"flex","gap-4"],["type","text","name","image_url","placeholder","Ej: fas fa-mobile-alt",1,"flex-1","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],[1,"w-12","h-10","flex","items-center","justify-center","bg-base-200","rounded-lg","border","border-base-300"],[1,"text-xl","text-primary",3,"class"],[1,"text-xs","text-base-content/50"],[1,"text-xs","text-base-content/60","mt-1"],["name","type",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["value","product"],["value","course"],["value","service"],["name","parent_id",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"mt-6"],[1,"flex","items-center","gap-3","p-3","bg-base-100","border","border-base-300","rounded-lg","hover:bg-base-200","transition-colors","cursor-pointer","w-fit"],["type","checkbox","name","is_active",1,"checkbox","checkbox-primary","h-5","w-5","rounded","border-base-300",3,"ngModelChange","ngModel"],[1,"font-medium","text-base-content"],[1,"flex","justify-end","gap-4","mt-6"],["routerLink","/admin/categories",1,"btn","btn-error","text-white"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner","loading-xs","mr-2"],[1,"fas","fa-exclamation-circle"],[1,"text-xl","text-primary"],[3,"value"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"div",1)(2,"a",2),_(3,"i",3),n(),t(4,"h1",4),o(5),n()(),t(6,"form",5),E("ngSubmit",function(){return e.save()}),t(7,"div",6),f(8,K,4,1,"div",7),t(9,"div",8)(10,"label",9),o(11,"Nombre"),n(),t(12,"input",10),u("ngModelChange",function(i){return g(e.form().name,i)||(e.form().name=i),i}),n()(),t(13,"div",8)(14,"label",9),o(15,"Slug (URL)"),n(),t(16,"input",11),u("ngModelChange",function(i){return g(e.form().slug,i)||(e.form().slug=i),i}),n()(),t(17,"div",8)(18,"label",9),o(19,"Descripci\xF3n"),n(),t(20,"textarea",12),u("ngModelChange",function(i){return g(e.form().description,i)||(e.form().description=i),i}),n()(),t(21,"div",8)(22,"label",9),o(23,"Icono (Font Awesome)"),n(),t(24,"div",13)(25,"input",14),u("ngModelChange",function(i){return g(e.form().image_url,i)||(e.form().image_url=i),i}),n(),t(26,"div",15),f(27,Q,1,2,"i",16)(28,X,2,0,"span",17),n()(),t(29,"p",18),o(30,"Usa clases de Font Awesome (ej: fas fa-mobile-alt, fas fa-laptop)"),n()(),t(31,"div",8)(32,"label",9),o(33,"Tipo"),n(),t(34,"select",19),u("ngModelChange",function(i){return g(e.form().type,i)||(e.form().type=i),i}),t(35,"option",20),o(36,"Producto"),n(),t(37,"option",21),o(38,"Curso"),n(),t(39,"option",22),o(40,"Servicio"),n()()(),t(41,"div",8)(42,"label",9),o(43,"Categor\xEDa Padre"),n(),t(44,"select",23),u("ngModelChange",function(i){return g(e.form().parent_id,i)||(e.form().parent_id=i),i}),t(45,"option",24),o(46,"Ninguna (Categor\xEDa Principal)"),n(),w(47,Z,1,1,null,null,J),n(),t(49,"p",18),o(50,"Selecciona una categor\xEDa padre para anidar esta categor\xEDa dentro de ella."),n()(),t(51,"div",25)(52,"label",26)(53,"input",27),u("ngModelChange",function(i){return g(e.form().is_active,i)||(e.form().is_active=i),i}),n(),t(54,"span",28),o(55,"Activo"),n()()()(),t(56,"div",29)(57,"a",30),o(58,"Cancelar"),n(),t(59,"button",31),f(60,$,1,0,"span",32),o(61," Guardar "),n()()()()),a&2&&(s(5),A("",e.id?"Editar":"Nueva"," Categor\xEDa"),s(3),b(e.error()?8:-1),s(4),m("ngModel",e.form().name),s(4),m("ngModel",e.form().slug),s(4),m("ngModel",e.form().description),s(5),m("ngModel",e.form().image_url),s(2),b(e.form().image_url?27:28),s(7),m("ngModel",e.form().type),s(10),m("ngModel",e.form().parent_id),s(),h("ngValue",null),s(2),M(e.categories()),s(6),m("ngModel",e.form().is_active),s(6),h("disabled",e.saving()),s(),b(e.saving()?60:-1))},dependencies:[G,B,j,O,D,N,V,I,L,R,q,k,W],encapsulation:2})};export{H as AdminCategoryFormPage};
