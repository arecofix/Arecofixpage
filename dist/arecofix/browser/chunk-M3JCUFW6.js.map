{
  "version": 3,
  "sources": ["src/app/core/services/courses.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\r\nimport { SupabaseClient, PostgrestSingleResponse, PostgrestResponse } from '@supabase/supabase-js';\r\nimport { from, Observable, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { AuthService } from './auth.service';\r\n\r\nexport interface Course {\r\n    id: string;\r\n    title: string;\r\n    slug: string;\r\n    description: string;\r\n    duration: string;\r\n    schedule: string;\r\n    level: string;\r\n    price: number;\r\n    sale_price?: number;\r\n    image_url: string;\r\n    instructor_name?: string;\r\n    rating?: number;\r\n    students?: number;\r\n    is_active?: boolean;\r\n    created_at?: string;\r\n}\r\n\r\nexport interface Module {\r\n    id: string;\r\n    course_id: string;\r\n    title: string;\r\n    description: string;\r\n    order: number;\r\n}\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class CoursesService {\r\n    private supabase: SupabaseClient;\r\n\r\n    // Centralized mock courses to be Single Source of Truth until DB is fully populated\r\n    private readonly mockCourses: Course[] = [\r\n        {\r\n            id: '1',\r\n            title: 'Reparación de Celulares - Nivel Básico',\r\n            slug: 'reparacion-celulares-basico',\r\n            description: 'Aprende los fundamentos de la reparación de smartphones. Incluye diagnóstico, cambio de pantallas y baterías. Ideal para quienes quieren iniciarse en el mundo de la tecnología móvil.',\r\n            duration: '3 meses',\r\n            schedule: 'Sábados 10:00-13:00',\r\n            price: 45000,\r\n            image_url: 'assets/img/cursos/alumno3.jpg',\r\n            level: 'Básico',\r\n            students: 120,\r\n            rating: 4.8\r\n        },\r\n        {\r\n            id: '2',\r\n            title: 'Microelectrónica Avanzada',\r\n            slug: 'curso-avanzado-microelectronica',\r\n            description: 'Domina la reparación de placas de iPhone y Android. Aprende reballing, esquema eléctrico, solución de fallas de encendido, carga e imagen.',\r\n            duration: '4 meses',\r\n            schedule: 'Miércoles 18:00-21:00',\r\n            price: 65000,\r\n            image_url: 'assets/img/cursos/alumno2.jpg',\r\n            level: 'Avanzado',\r\n            students: 85,\r\n            rating: 4.9\r\n        },\r\n        {\r\n            id: '3',\r\n            title: 'Electricidad Domiciliaria e Industrial',\r\n            slug: 'curso-electricidad',\r\n            description: 'Formación completa en instalaciones eléctricas. Aprende desde cero a realizar cableados, montaje de tableros, protecciones, iluminación y detección de fallas.',\r\n            duration: '5 meses',\r\n            schedule: 'Martes y Jueves 19:00-21:00',\r\n            price: 40000,\r\n            image_url: 'assets/img/cursos/electricity.jpg',\r\n            level: 'Principiante',\r\n            students: 40,\r\n            rating: 4.7\r\n        },\r\n        {\r\n            id: '4',\r\n            title: 'Aprendizaje 100% Práctico',\r\n            slug: 'aprendizaje-practico',\r\n            description: 'Modalidad intensiva de práctica en taller. Sin teoría, directo a la mesa de trabajo. Ideal para quienes ya tienen conocimientos teóricos y necesitan horas de vuelo.',\r\n            duration: 'A medida',\r\n            schedule: 'Consultar horarios',\r\n            price: 35000,\r\n            image_url: 'assets/img/cursos/aprendizaje-practico.jpg', \r\n            level: 'Práctico',\r\n            students: 50,\r\n            rating: 5.0\r\n        }\r\n    ];\r\n\r\n    private readonly mockModules: Module[] = [\r\n        // Curso 1: Basico\r\n        { \r\n            id: 'm1-1', course_id: '1', title: 'Módulo 1: Fundamentos y Herramientas', \r\n            description: 'Introducción a la electrónica, multímetro, estación de calor.', order: 1 \r\n        },\r\n        { \r\n            id: 'm1-2', course_id: '1', title: 'Módulo 2: Desarme y Reconocimiento', \r\n            description: 'Técnicas de apertura, identificación de partes y buses.', order: 2 \r\n        },\r\n        { \r\n            id: 'm1-3', course_id: '1', title: 'Módulo 3: Pantallas y Táctiles', \r\n            description: 'Diferencias OLED/LCD, cambio de glass vs módulo completo.', order: 3 \r\n        },\r\n        { \r\n            id: 'm1-4', course_id: '1', title: 'Módulo 4: Baterías y Carga', \r\n            description: 'Diagnóstico de baterías, pines de carga y consumo.', order: 4 \r\n        },\r\n        { \r\n            id: 'm1-5', course_id: '1', title: 'Módulo 5: Software Básico', \r\n            description: 'Hard reset, flasheo y cuentas Google.', order: 5 \r\n        },\r\n\r\n        // Curso 2: Microelectronica\r\n        { id: 'm2-1', course_id: '2', title: 'Módulo 1: Lectura de Planos', description: 'Schematics, boardview y seguimiento de líneas.', order: 1 },\r\n        { id: 'm2-2', course_id: '2', title: 'Módulo 2: Soldadura SMD', description: 'Manejo de componentes 0201, conectores FPC y blindajes.', order: 2 },\r\n        { id: 'm2-3', course_id: '2', title: 'Módulo 3: Reballing', description: 'Técnica de reballing para ICs de power, CPU y memoria.', order: 3 },\r\n        { id: 'm2-4', course_id: '2', title: 'Módulo 4: Fallas de Encendido', description: 'Consumos iniciales, secundarios y diagnóstico con fuente.', order: 4 },\r\n\r\n        // Curso 3: Electricidad\r\n        { id: 'm3-1', course_id: '3', title: 'Módulo 1: Conceptos Básicos', description: 'Ley de Ohm, corriente AC/DC, potencia y seguridad.', order: 1 },\r\n        { id: 'm3-2', course_id: '3', title: 'Módulo 2: Herramientas y Empalmes', description: 'Uso de pinzas, pelacables y tipos de uniones seguras.', order: 2 },\r\n        { id: 'm3-3', course_id: '3', title: 'Módulo 3: Tableros y Protecciones', description: 'Disyuntores, térmicas y puesta a tierra.', order: 3 },\r\n        { id: 'm3-4', course_id: '3', title: 'Módulo 4: Circuitos de Iluminación', description: 'Llaves combinadas, fotocélulas y sensores de movimiento.', order: 4 },\r\n        { id: 'm3-5', course_id: '3', title: 'Módulo 5: Tomacorrientes y Fuerza', description: 'Cálculo de secciones de cables y distribución de cargas.', order: 5 }\r\n    ];\r\n\r\n    constructor(private authService: AuthService) {\r\n        this.supabase = this.authService.getSupabaseClient();\r\n    }\r\n\r\n    getCourses(): Observable<PostgrestResponse<Course>> {\r\n        return from(\r\n            this.supabase\r\n                .from('courses')\r\n                .select('id, title, slug, price, sale_price, level, is_active, image_url, created_at, duration, schedule')\r\n                .order('created_at', { ascending: false })\r\n                .returns<Course[]>()\r\n        );\r\n    }\r\n\r\n    getCourseBySlug(slug: string): Observable<PostgrestSingleResponse<Course | null>> {\r\n        return from(\r\n            this.supabase\r\n                .from('courses')\r\n                .select('*')\r\n                .eq('slug', slug)\r\n                .single()\r\n        ).pipe(\r\n            map(({ data, error }) => {\r\n                if (error || !data) {\r\n                    // Fallback to mock data (Single Source of Truth)\r\n                    const mock = this.mockCourses.find(c => c.slug === slug);\r\n                    return { data: mock || null, error: null, count: null, status: 200, statusText: 'OK' } as PostgrestSingleResponse<Course | null>;\r\n                }\r\n                return { data, error, count: null, status: 200, statusText: 'OK' } as PostgrestSingleResponse<Course | null>;\r\n            }),\r\n            catchError(() => {\r\n                 const mock = this.mockCourses.find(c => c.slug === slug);\r\n                 return of({ data: mock || null, error: null, count: null, status: 200, statusText: 'OK' } as PostgrestSingleResponse<Course | null>);\r\n            })\r\n        );\r\n    }\r\n\r\n    getCourseById(id: string): Observable<PostgrestSingleResponse<Course | null>> {\r\n        return from(\r\n            this.supabase\r\n                .from('courses')\r\n                .select('*')\r\n                .eq('id', id)\r\n                .single()\r\n        ) as Observable<PostgrestSingleResponse<Course | null>>;\r\n    }\r\n\r\n    createCourse(course: Partial<Course>): Observable<PostgrestSingleResponse<Course | null>> {\r\n        return from(\r\n            this.supabase\r\n                .from('courses')\r\n                .insert(course)\r\n                .select()\r\n                .single()\r\n        ) as Observable<PostgrestSingleResponse<Course | null>>;\r\n    }\r\n\r\n    updateCourse(id: string, course: Partial<Course>): Observable<PostgrestSingleResponse<Course | null>> {\r\n        return from(\r\n            this.supabase\r\n                .from('courses')\r\n                .update(course)\r\n                .eq('id', id)\r\n                .select()\r\n                .single()\r\n        ) as Observable<PostgrestSingleResponse<Course | null>>;\r\n    }\r\n\r\n    deleteCourse(id: string): Observable<any> {\r\n        return from(\r\n            this.supabase\r\n                .from('courses')\r\n                .delete()\r\n                .eq('id', id)\r\n        );\r\n    }\r\n\r\n    getModulesByCourseId(courseId: string): Observable<{ data: Module[], error: any }> {\r\n         // TEMPORARY FIX: Return mock data immediately to prevent 404 network errors \r\n         // until the 'modules' table migration is applied by the user.\r\n         return of({ data: this.mockModules, error: null });\r\n\r\n         /* \r\n         // Original Implementation (Restore when table exists):\r\n         return from(\r\n             this.supabase\r\n                .from('modules')\r\n                .select('*')\r\n                .eq('course_id', courseId)\r\n                .order('order', { ascending: true })\r\n                .returns<Module[]>()\r\n         ).pipe(\r\n             map(({ data, error }) => {\r\n                 if (error || !data || data.length === 0) {\r\n                     return { data: this.mockModules, error: null };\r\n                 }\r\n                 return { data, error };\r\n             }),\r\n             catchError((err) => {\r\n                 return of({ data: this.mockModules, error: null });\r\n             })\r\n         );\r\n         */\r\n    }\r\n\r\n    async registerStudent(data: any): Promise<{ data: any, error: any }> {\r\n        // Handle mock course registration\r\n        if (data.course_id === '1') {\r\n            await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate network delay\r\n            return { \r\n                data: { ...data, id: 'mock-enrollment-id', status: 'pending' }, \r\n                error: null \r\n            };\r\n        }\r\n\r\n        try {\r\n            const { data: enrollment, error } = await this.supabase\r\n                .from('course_enrollments')\r\n                .insert([{\r\n                    course_id: data.course_id,\r\n                    full_name: data.full_name,\r\n                    email: data.email,\r\n                    phone: data.phone,\r\n                    status: 'pending', // Default status\r\n                    created_at: new Date().toISOString()\r\n                }])\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n\r\n            return { data: enrollment, error: null };\r\n        } catch (error: any) {\r\n            console.error('Error registering student:', error);\r\n            return { data: null, error };\r\n        }\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAmCM,IAAO,iBAAP,MAAO,gBAAc;EAgGH;EA/FZ;;EAGS,cAAwB;IACrC;MACI,IAAI;MACJ,OAAO;MACP,MAAM;MACN,aAAa;MACb,UAAU;MACV,UAAU;MACV,OAAO;MACP,WAAW;MACX,OAAO;MACP,UAAU;MACV,QAAQ;;IAEZ;MACI,IAAI;MACJ,OAAO;MACP,MAAM;MACN,aAAa;MACb,UAAU;MACV,UAAU;MACV,OAAO;MACP,WAAW;MACX,OAAO;MACP,UAAU;MACV,QAAQ;;IAEZ;MACI,IAAI;MACJ,OAAO;MACP,MAAM;MACN,aAAa;MACb,UAAU;MACV,UAAU;MACV,OAAO;MACP,WAAW;MACX,OAAO;MACP,UAAU;MACV,QAAQ;;IAEZ;MACI,IAAI;MACJ,OAAO;MACP,MAAM;MACN,aAAa;MACb,UAAU;MACV,UAAU;MACV,OAAO;MACP,WAAW;MACX,OAAO;MACP,UAAU;MACV,QAAQ;;;EAIC,cAAwB;;IAErC;MACI,IAAI;MAAQ,WAAW;MAAK,OAAO;MACnC,aAAa;MAAiE,OAAO;;IAEzF;MACI,IAAI;MAAQ,WAAW;MAAK,OAAO;MACnC,aAAa;MAA2D,OAAO;;IAEnF;MACI,IAAI;MAAQ,WAAW;MAAK,OAAO;MACnC,aAAa;MAA6D,OAAO;;IAErF;MACI,IAAI;MAAQ,WAAW;MAAK,OAAO;MACnC,aAAa;MAAsD,OAAO;;IAE9E;MACI,IAAI;MAAQ,WAAW;MAAK,OAAO;MACnC,aAAa;MAAyC,OAAO;;;IAIjE,EAAE,IAAI,QAAQ,WAAW,KAAK,OAAO,kCAA+B,aAAa,qDAAkD,OAAO,EAAC;IAC3I,EAAE,IAAI,QAAQ,WAAW,KAAK,OAAO,8BAA2B,aAAa,2DAA2D,OAAO,EAAC;IAChJ,EAAE,IAAI,QAAQ,WAAW,KAAK,OAAO,0BAAuB,aAAa,6DAA0D,OAAO,EAAC;IAC3I,EAAE,IAAI,QAAQ,WAAW,KAAK,OAAO,oCAAiC,aAAa,gEAA6D,OAAO,EAAC;;IAGxJ,EAAE,IAAI,QAAQ,WAAW,KAAK,OAAO,qCAA+B,aAAa,sDAAsD,OAAO,EAAC;IAC/I,EAAE,IAAI,QAAQ,WAAW,KAAK,OAAO,wCAAqC,aAAa,yDAAyD,OAAO,EAAC;IACxJ,EAAE,IAAI,QAAQ,WAAW,KAAK,OAAO,wCAAqC,aAAa,+CAA4C,OAAO,EAAC;IAC3I,EAAE,IAAI,QAAQ,WAAW,KAAK,OAAO,4CAAsC,aAAa,+DAA4D,OAAO,EAAC;IAC5J,EAAE,IAAI,QAAQ,WAAW,KAAK,OAAO,wCAAqC,aAAa,kEAA4D,OAAO,EAAC;;EAG/J,YAAoB,aAAwB;AAAxB,SAAA,cAAA;AAChB,SAAK,WAAW,KAAK,YAAY,kBAAiB;EACtD;EAEA,aAAU;AACN,WAAO,KACH,KAAK,SACA,KAAK,SAAS,EACd,OAAO,iGAAiG,EACxG,MAAM,cAAc,EAAE,WAAW,MAAK,CAAE,EACxC,QAAO,CAAY;EAEhC;EAEA,gBAAgB,MAAY;AACxB,WAAO,KACH,KAAK,SACA,KAAK,SAAS,EACd,OAAO,GAAG,EACV,GAAG,QAAQ,IAAI,EACf,OAAM,CAAE,EACf,KACE,IAAI,CAAC,EAAE,MAAM,MAAK,MAAM;AACpB,UAAI,SAAS,CAAC,MAAM;AAEhB,cAAM,OAAO,KAAK,YAAY,KAAK,OAAK,EAAE,SAAS,IAAI;AACvD,eAAO,EAAE,MAAM,QAAQ,MAAM,OAAO,MAAM,OAAO,MAAM,QAAQ,KAAK,YAAY,KAAI;MACxF;AACA,aAAO,EAAE,MAAM,OAAO,OAAO,MAAM,QAAQ,KAAK,YAAY,KAAI;IACpE,CAAC,GACD,WAAW,MAAK;AACX,YAAM,OAAO,KAAK,YAAY,KAAK,OAAK,EAAE,SAAS,IAAI;AACvD,aAAO,GAAG,EAAE,MAAM,QAAQ,MAAM,OAAO,MAAM,OAAO,MAAM,QAAQ,KAAK,YAAY,KAAI,CAA4C;IACxI,CAAC,CAAC;EAEV;EAEA,cAAc,IAAU;AACpB,WAAO,KACH,KAAK,SACA,KAAK,SAAS,EACd,OAAO,GAAG,EACV,GAAG,MAAM,EAAE,EACX,OAAM,CAAE;EAErB;EAEA,aAAa,QAAuB;AAChC,WAAO,KACH,KAAK,SACA,KAAK,SAAS,EACd,OAAO,MAAM,EACb,OAAM,EACN,OAAM,CAAE;EAErB;EAEA,aAAa,IAAY,QAAuB;AAC5C,WAAO,KACH,KAAK,SACA,KAAK,SAAS,EACd,OAAO,MAAM,EACb,GAAG,MAAM,EAAE,EACX,OAAM,EACN,OAAM,CAAE;EAErB;EAEA,aAAa,IAAU;AACnB,WAAO,KACH,KAAK,SACA,KAAK,SAAS,EACd,OAAM,EACN,GAAG,MAAM,EAAE,CAAC;EAEzB;EAEA,qBAAqB,UAAgB;AAGhC,WAAO,GAAG,EAAE,MAAM,KAAK,aAAa,OAAO,KAAI,CAAE;EAuBtD;EAEA,MAAM,gBAAgB,MAAS;AAE3B,QAAI,KAAK,cAAc,KAAK;AACxB,YAAM,IAAI,QAAQ,aAAW,WAAW,SAAS,GAAI,CAAC;AACtD,aAAO;QACH,MAAM,iCAAK,OAAL,EAAW,IAAI,sBAAsB,QAAQ,UAAS;QAC5D,OAAO;;IAEf;AAEA,QAAI;AACA,YAAM,EAAE,MAAM,YAAY,MAAK,IAAK,MAAM,KAAK,SAC1C,KAAK,oBAAoB,EACzB,OAAO,CAAC;QACL,WAAW,KAAK;QAChB,WAAW,KAAK;QAChB,OAAO,KAAK;QACZ,OAAO,KAAK;QACZ,QAAQ;;QACR,aAAY,oBAAI,KAAI,GAAG,YAAW;OACrC,CAAC,EACD,OAAM,EACN,OAAM;AAEX,UAAI;AAAO,cAAM;AAEjB,aAAO,EAAE,MAAM,YAAY,OAAO,KAAI;IAC1C,SAAS,OAAY;AACjB,cAAQ,MAAM,8BAA8B,KAAK;AACjD,aAAO,EAAE,MAAM,MAAM,MAAK;IAC9B;EACJ;;qCAxOS,iBAAc,mBAAA,WAAA,CAAA;EAAA;4EAAd,iBAAc,SAAd,gBAAc,WAAA,YAFX,OAAM,CAAA;;;sEAET,gBAAc,CAAA;UAH1B;WAAW;MACR,YAAY;KACf;;;",
  "names": []
}
