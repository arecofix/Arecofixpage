{
  "version": 3,
  "sources": ["src/app/app.routes.ts", "src/app/core/errors/global-error-handler.ts", "src/app/features/products/infrastructure/repositories/supabase-product.repository.ts", "src/app/core/repositories/base.repository.ts", "src/app/features/products/infrastructure/repositories/supabase-category.repository.ts", "src/app/features/products/infrastructure/repositories/supabase-brand.repository.ts", "src/app/features/repairs/infrastructure/repositories/supabase-repair.repository.ts", "src/app/features/analytics/infrastructure/repositories/supabase-analytics.repository.ts", "src/app/core/repositories/user-profile.repository.ts", "src/app/core/infrastructure/repositories/supabase-user-profile.repository.ts", "src/app/app.config.ts", "src/app/core/services/ai-agent.service.ts", "src/app/features/ai-assistant/ai-assistant.ts", "src/app/features/ai-assistant/ai-assistant.html", "src/app/shared/whatsapp-button/whatsapp-button.ts", "src/app/shared/whatsapp-button/whatsapp-button.html", "src/app/shared/components/toast/toast.component.ts", "src/app/app.ts", "src/app/app.html", "src/main.ts"],
  "sourcesContent": ["import { Routes } from '@angular/router';\r\n\r\nexport const routes: Routes = [\r\n    {\r\n        title: 'Home',\r\n        path: '',\r\n        loadChildren: () => import('@app/public/public.routes'),\r\n    },\r\n    {\r\n        title: 'Admin',\r\n        path: 'admin',\r\n        loadChildren: () => import('@app/admin/admin.routes'),\r\n    },\r\n    {\r\n        path: '**',\r\n        redirectTo: '',\r\n    }\r\n];\r\n", "import { ErrorHandler, Injectable, inject } from '@angular/core';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { LoggerService } from '../services/logger.service';\r\nimport { NotificationService } from '../services/notification.service';\r\nimport {\r\n    ApplicationError,\r\n    ValidationError,\r\n    AuthenticationError,\r\n    AuthorizationError,\r\n    NotFoundError,\r\n    DatabaseError,\r\n    NetworkError\r\n} from './application.error';\r\n\r\n/**\r\n * Global Error Handler\r\n * Catches all unhandled errors in the application\r\n */\r\n@Injectable()\r\nexport class GlobalErrorHandler implements ErrorHandler {\r\n    private logger = inject(LoggerService);\r\n    private notification = inject(NotificationService);\r\n\r\n    handleError(error: Error | HttpErrorResponse): void {\r\n        // Log the error\r\n        this.logger.error('Unhandled error occurred', error);\r\n\r\n        // Handle different error types\r\n        if (error instanceof HttpErrorResponse) {\r\n            this.handleHttpError(error);\r\n        } else if (error instanceof ApplicationError) {\r\n            this.handleApplicationError(error);\r\n        } else {\r\n            this.handleUnknownError(error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle HTTP errors\r\n     */\r\n    private handleHttpError(error: HttpErrorResponse): void {\r\n        let message: string;\r\n\r\n        switch (error.status) {\r\n            case 0:\r\n                message = 'No se pudo conectar al servidor. Verifica tu conexión a internet.';\r\n                break;\r\n            case 400:\r\n                message = 'Solicitud inválida. Por favor verifica los datos ingresados.';\r\n                break;\r\n            case 401:\r\n                message = 'Sesión expirada. Por favor inicia sesión nuevamente.';\r\n                break;\r\n            case 403:\r\n                message = 'No tienes permisos para realizar esta acción.';\r\n                break;\r\n            case 404:\r\n                message = 'El recurso solicitado no fue encontrado.';\r\n                break;\r\n            case 500:\r\n                message = 'Error del servidor. Por favor intenta nuevamente más tarde.';\r\n                break;\r\n            case 503:\r\n                message = 'Servicio no disponible. Por favor intenta más tarde.';\r\n                break;\r\n            default:\r\n                message = `Error inesperado (${error.status}). Por favor intenta nuevamente.`;\r\n        }\r\n\r\n        this.notification.showError(message);\r\n    }\r\n\r\n    /**\r\n     * Handle application-specific errors\r\n     */\r\n    private handleApplicationError(error: ApplicationError): void {\r\n        let message: string;\r\n\r\n        if (error instanceof ValidationError) {\r\n            message = error.message || 'Los datos ingresados no son válidos.';\r\n        } else if (error instanceof AuthenticationError) {\r\n            message = 'Error de autenticación. Por favor inicia sesión nuevamente.';\r\n        } else if (error instanceof AuthorizationError) {\r\n            message = 'No tienes permisos para realizar esta acción.';\r\n        } else if (error instanceof NotFoundError) {\r\n            message = error.message;\r\n        } else if (error instanceof DatabaseError) {\r\n            message = 'Error al acceder a la base de datos. Por favor intenta nuevamente.';\r\n        } else if (error instanceof NetworkError) {\r\n            message = 'Error de conexión. Verifica tu internet e intenta nuevamente.';\r\n        } else {\r\n            message = error.message || 'Ocurrió un error inesperado.';\r\n        }\r\n\r\n        this.notification.showError(message);\r\n    }\r\n\r\n    /**\r\n     * Handle unknown errors\r\n     */\r\n    private handleUnknownError(error: Error): void {\r\n        const message = 'Ocurrió un error inesperado. Por favor intenta nuevamente.';\r\n        this.notification.showError(message);\r\n    }\r\n}\r\n", "import { Injectable, inject } from '@angular/core';\r\nimport { Observable, from, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { SupabaseClient } from '@supabase/supabase-js';\r\nimport { AuthService } from '@app/core/services/auth.service';\r\nimport { LoggerService } from '@app/core/services/logger.service';\r\nimport { TenantService } from '@app/core/services/tenant.service';\r\nimport { ProductRepository, ImportProductSummary, BulkPriceUpdate } from '../../domain/repositories/product.repository';\r\nimport { Product } from '../../domain/entities/product.entity';\r\nimport { ProductsParams, ProductsResponse } from '@app/public/products/interfaces';\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SupabaseProductRepository extends ProductRepository {\r\n  private authService = inject(AuthService);\r\n  private logger = inject(LoggerService);\r\n  private tenantService = inject(TenantService);\r\n  private supabase: SupabaseClient = this.authService.getSupabaseClient();\r\n  \r\n  protected useSoftDeletes = true;\r\n\r\n  private applyTenantFilter(query: any) {\r\n      let enhancedQuery = query.eq('tenant_id', this.tenantService.getTenantId());\r\n      if (this.useSoftDeletes) {\r\n          enhancedQuery = enhancedQuery.is('deleted_at', null);\r\n      }\r\n      return enhancedQuery;\r\n  }\r\n\r\n  findWithFilters(params: ProductsParams = {}): Observable<ProductsResponse> {\r\n    const {\r\n      _page = 1,\r\n      _per_page = 10,\r\n      category_id,\r\n      brand_id,\r\n      description,\r\n      featured,\r\n      id,\r\n      name,\r\n      price,\r\n      slug,\r\n      min_price,\r\n      max_price,\r\n    } = params;\r\n\r\n    const start = (_page - 1) * _per_page;\r\n    const end = start + _per_page - 1;\r\n\r\n    let baseQuery = this.supabase\r\n      .from('products')\r\n      .select(`\r\n        id, name, slug, description, price, currency, image_url, gallery_urls, category_id, brand_id, \r\n        is_active, is_featured, sku, barcode, stock, created_at, updated_at,\r\n        branch_stock:product_stock_per_branch(quantity, branch_id, min_stock_alert)\r\n      `, { count: 'exact' });\r\n      \r\n    let query = this.applyTenantFilter(baseQuery);\r\n\r\n    if (params.is_active !== undefined) {\r\n      query = query.eq('is_active', params.is_active);\r\n    } else if (!params.include_inactive) {\r\n      query = query.eq('is_active', true);\r\n    }\r\n\r\n    if (params.category_ids && params.category_ids.length > 0) {\r\n      query = query.in('category_id', params.category_ids);\r\n    } else if (category_id) {\r\n      query = query.eq('category_id', category_id);\r\n    }\r\n    \r\n    if (brand_id) query = query.eq('brand_id', brand_id);\r\n    if (description) query = query.ilike('description', `%${description}%`);\r\n    if (featured !== null && featured !== undefined) query = query.eq('is_featured', featured);\r\n    if (id) query = query.eq('id', id);\r\n    if (params.ids && params.ids.length > 0) query = query.in('id', params.ids);\r\n    if (name) query = query.ilike('name', `%${name}%`);\r\n    if (price) query = query.eq('price', price);\r\n    if (slug) query = query.eq('slug', slug);\r\n    if (min_price !== undefined) query = query.gte('price', min_price);\r\n    if (max_price !== undefined) query = query.lte('price', max_price);\r\n    \r\n    if (params.q) {\r\n      query = query.or(`name.ilike.%${params.q}%,description.ilike.%${params.q}%`);\r\n    }\r\n\r\n    if (params._sort) {\r\n      query = query.order(params._sort, { ascending: params._order === 'asc' });\r\n    } else {\r\n      query = query.order('created_at', { ascending: false });\r\n    }\r\n\r\n    query = query.range(start, end);\r\n\r\n    return from(query as any).pipe(\r\n      map((res: any) => {\r\n        const { data, count, error } = res;\r\n        if (error) throw error;\r\n\r\n        const totalItems = count || 0;\r\n        const pages = Math.max(1, Math.ceil(totalItems / _per_page));\r\n\r\n        const products = (data || []).map((p: any) => this._mapToEntity(p));\r\n\r\n        return {\r\n          first: 1,\r\n          prev: _page > 1 ? _page - 1 : undefined,\r\n          next: _page < pages ? _page + 1 : undefined,\r\n          last: pages,\r\n          pages,\r\n          items: totalItems,\r\n          data: products,\r\n        } as unknown as ProductsResponse;\r\n      })\r\n    );\r\n  }\r\n\r\n  findLowStock(threshold: number = 5): Observable<Product[]> {\r\n    let query = this.supabase.from('products')\r\n        .select(`\r\n          id, name, slug, description, price, currency, image_url, gallery_urls, category_id, brand_id, \r\n          is_active, is_featured, sku, barcode, stock, created_at, updated_at,\r\n          branch_stock:product_stock_per_branch(quantity, branch_id)\r\n        `);\r\n\r\n    return from(this.applyTenantFilter(query) as any).pipe(\r\n      map((res: any) => {\r\n        const { data, error } = res;\r\n        if (error) throw error;\r\n        return (data || [])\r\n            .map((p: any) => this._mapToEntity(p))\r\n            .filter((p: Product) => p.stock < threshold);\r\n      })\r\n    );\r\n  }\r\n\r\n  findAvailable(): Observable<Product[]> {\r\n    const fetchAll = async (): Promise<Product[]> => {\r\n      let allData: Product[] = [];\r\n      let fromIdx = 0;\r\n      let hasMore = true;\r\n      const CHUNK = 1000;\r\n      const select = `\r\n        id, name, slug, description, price, currency, image_url, gallery_urls, category_id, brand_id, \r\n        is_active, is_featured, sku, barcode, stock, created_at, updated_at,\r\n        branch_stock:product_stock_per_branch(quantity, branch_id)\r\n      `;\r\n\r\n      while (hasMore) {\r\n        const query = this.applyTenantFilter(this.supabase.from('products').select(select))\r\n          .eq('is_active', true)\r\n          .order('name')\r\n          .range(fromIdx, fromIdx + CHUNK - 1);\r\n        \r\n        const { data, error } = await (query as any);\r\n        if (error) throw error;\r\n        \r\n        const products = (data || []).map((p: any) => this._mapToEntity(p));\r\n        allData = [...allData, ...products];\r\n        \r\n        if (products.length < CHUNK) {\r\n          hasMore = false;\r\n        } else {\r\n          fromIdx += CHUNK;\r\n        }\r\n      }\r\n      return allData;\r\n    };\r\n\r\n    return from(fetchAll());\r\n  }\r\n\r\n  getAll(branch_id?: string): Observable<Product[]> {\r\n    const fetchAll = async (): Promise<Product[]> => {\r\n      let allData: Product[] = [];\r\n      let fromIdx = 0;\r\n      let hasMore = true;\r\n      const CHUNK = 1000;\r\n      const select = `\r\n        id, name, slug, description, price, currency, image_url, gallery_urls, category_id, brand_id, \r\n        is_active, is_featured, sku, barcode, stock, created_at, updated_at,\r\n        branch_stock:product_stock_per_branch(quantity, branch_id)\r\n      `;\r\n\r\n      while (hasMore) {\r\n        let query = this.supabase.from('products').select(select);\r\n        query = this.applyTenantFilter(query);\r\n        // branch_id filter removed: column doesn't exist on 'products'. Mapping handles it.\r\n        \r\n        const { data, error } = await (query.order('created_at', { ascending: false }).range(fromIdx, fromIdx + CHUNK - 1) as any);\r\n        if (error) throw error;\r\n        \r\n        const products = (data || []).map((p: any) => this._mapToEntity(p, branch_id));\r\n        allData = [...allData, ...products];\r\n        \r\n        if (products.length < CHUNK) {\r\n          hasMore = false;\r\n        } else {\r\n          fromIdx += CHUNK;\r\n        }\r\n      }\r\n      return allData;\r\n    };\r\n\r\n    return from(fetchAll());\r\n  }\r\n\r\n\r\n\r\n  getById(id: string): Observable<Product> {\r\n    let query = this.supabase.from('products')\r\n        .select(`\r\n          id, name, slug, description, price, currency, image_url, gallery_urls, category_id, brand_id, \r\n          is_active, is_featured, sku, barcode, stock, created_at, updated_at,\r\n          branch_stock:product_stock_per_branch(quantity, branch_id, min_stock_alert)\r\n        `)\r\n        .eq('id', id);\r\n\r\n    let filteredQuery = this.applyTenantFilter(query).single();\r\n\r\n    return from(filteredQuery as any).pipe(\r\n      map((res: any) => {\r\n        const { data, error } = res;\r\n        if (error) throw error;\r\n        return this._mapToEntity(data);\r\n      })\r\n    );\r\n  }\r\n\r\n  /** Lean projection for import deduplication - fetches all products in batches to avoid limits */\r\n  getAllForImport(): Observable<ImportProductSummary[]> {\r\n    const fetchAll = async (): Promise<ImportProductSummary[]> => {\r\n      let allData: ImportProductSummary[] = [];\r\n      let fromIdx = 0;\r\n      let hasMore = true;\r\n      const CHUNK = 1000;\r\n\r\n      while (hasMore) {\r\n        const query = this.applyTenantFilter(\r\n          this.supabase.from('products').select(\r\n            'id, name, slug, sku, price, image_url, gallery_urls, description, category_id, brand_id'\r\n          )\r\n        ).range(fromIdx, fromIdx + CHUNK - 1);\r\n        \r\n        const { data, error } = await (query as any);\r\n        if (error) throw error;\r\n        \r\n        const products = data || [];\r\n        allData = [...allData, ...products];\r\n        \r\n        if (products.length < CHUNK) {\r\n          hasMore = false;\r\n        } else {\r\n          fromIdx += CHUNK;\r\n        }\r\n      }\r\n      return allData;\r\n    };\r\n\r\n    return from(fetchAll());\r\n  }\r\n\r\n  /**\r\n   * Safe bulk price update - only modifies `price` (and optionally `name` for repuesto items).\r\n   * Processes in batches of 50 to avoid overloading the DB.\r\n   */\r\n  bulkUpdatePrices(updates: BulkPriceUpdate[]): Observable<{ updated: number; errors: number }> {\r\n    const CHUNK_SIZE = 50;\r\n    const chunks: BulkPriceUpdate[][] = [];\r\n    for (let i = 0; i < updates.length; i += CHUNK_SIZE) {\r\n      chunks.push(updates.slice(i, i + CHUNK_SIZE));\r\n    }\r\n\r\n    const processChunks = async (): Promise<{ updated: number; errors: number }> => {\r\n      let updated = 0;\r\n      let errors = 0;\r\n\r\n      for (const chunk of chunks) {\r\n        const promises = chunk.map(async (item) => {\r\n          const payload: Record<string, any> = {\r\n            price: item.price,\r\n            updated_at: new Date().toISOString()\r\n          };\r\n          // Only update name if provided (i.e. was a 'repuesto' product needing renaming)\r\n          if (item.newName) {\r\n            payload['name'] = item.newName;\r\n          }\r\n\r\n          const { error } = await this.supabase\r\n            .from('products')\r\n            .update(payload)\r\n            .eq('id', item.id)\r\n            .eq('tenant_id', this.tenantService.getTenantId());\r\n\r\n          if (error) {\r\n            this.logger.error('bulkUpdatePrices', `Failed for product ${item.id}: ${error.message}`);\r\n            errors++;\r\n          } else {\r\n            updated++;\r\n          }\r\n        });\r\n        await Promise.all(promises);\r\n      }\r\n      return { updated, errors };\r\n    };\r\n\r\n    return from(processChunks());\r\n  }\r\n\r\n  async uploadImage(file: File): Promise<string> {\r\n    const filePath = `products/${Date.now()}-${file.name}`;\r\n    const { data, error } = await this.supabase.storage.from('public-assets').upload(filePath, file);\r\n\r\n    if (error) throw error;\r\n\r\n    const { data: publicUrl } = this.supabase.storage.from('public-assets').getPublicUrl(data.path);\r\n    return publicUrl.publicUrl;\r\n  }\r\n\r\n  private async syncBranchStock(productId: string, quantity: number): Promise<void> {\r\n    const user = this.authService.getCurrentUser();\r\n    if (!user) return;\r\n\r\n    const profile = await this.authService.getUserProfile(user.id);\r\n    if (!profile || !profile.branch_id) return;\r\n\r\n    await this.supabase\r\n        .from('product_stock_per_branch')\r\n        .upsert({\r\n            product_id: productId,\r\n            branch_id: profile.branch_id,\r\n            tenant_id: this.tenantService.getTenantId(),\r\n            quantity: quantity,\r\n            updated_at: new Date().toISOString()\r\n        }, { onConflict: 'product_id,branch_id' });\r\n  }\r\n\r\n  create(product: Product): Observable<Product> {\r\n    const { stock, ...productData } = product;\r\n    const payload = {\r\n      ...productData,\r\n      tenant_id: this.tenantService.getTenantId(),\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString()\r\n    };\r\n\r\n    return from(\r\n      (this.supabase\r\n        .from('products')\r\n        .insert(payload)\r\n        .select('*')\r\n        .single() as any)\r\n    ).pipe(\r\n      map((res: any) => {\r\n        const { data, error } = res;\r\n        if (error) throw error;\r\n        if (stock !== undefined) {\r\n            this.syncBranchStock(data.id, stock);\r\n        }\r\n        return this._mapToEntity(data);\r\n      })\r\n    );\r\n  }\r\n\r\n  update(id: string, product: Partial<Product>): Observable<Product> {\r\n    const { stock, ...productData } = product;\r\n    \r\n    // Evita error de modificación inmutable SQL\r\n    delete productData.tenant_id;\r\n    delete productData.id;\r\n\r\n    const payload = {\r\n      ...productData,\r\n      updated_at: new Date().toISOString()\r\n    };\r\n\r\n    let query = this.supabase.from('products').update(payload).eq('id', id);\r\n    let filteredQuery = this.applyTenantFilter(query).select('*').single();\r\n\r\n    return from(filteredQuery as any).pipe(\r\n      map((res: any) => {\r\n        const { data, error } = res;\r\n        if (error) throw error;\r\n        if (stock !== undefined) {\r\n            this.syncBranchStock(id, stock);\r\n        }\r\n        return this._mapToEntity(data);\r\n      })\r\n    );\r\n  }\r\n\r\n  delete(id: string): Observable<void> {\r\n    let query = this.supabase.from('products').delete().eq('id', id);\r\n    let filteredQuery = this.applyTenantFilter(query);\r\n\r\n    return from(filteredQuery as any).pipe(\r\n      map((res: any) => {\r\n        const { error } = res;\r\n        if (error) throw error;\r\n        return void 0;\r\n      })\r\n    );\r\n  }\r\n\r\n  upsertMany(products: Partial<Product>[]): Observable<Product[]> {\r\n    if (!products.length) return of([]);\r\n\r\n    const dataToUpsert = products.map(p => {\r\n        const { stock, ...rest } = p;\r\n        return {\r\n            ...rest,\r\n            tenant_id: this.tenantService.getTenantId(),\r\n            updated_at: new Date().toISOString()\r\n        };\r\n    });\r\n\r\n    return from(\r\n      (this.supabase.from('products').upsert(dataToUpsert).select() as any)\r\n    ).pipe(\r\n      map((res: any) => {\r\n        const { data, error } = res;\r\n        if (error) throw error;\r\n        return (data || []).map((p: any) => this._mapToEntity(p));\r\n      })\r\n    );\r\n  }\r\n\r\n  updateMany(products: Partial<Product>[]): Observable<void> {\r\n    if (!products.length) return of(void 0);\r\n\r\n    // Strip every field that is NOT a real DB column before sending\r\n    const DB_COLUMNS = new Set([\r\n      'id', 'name', 'slug', 'description', 'price', 'sale_price',\r\n      'stock', 'min_stock_alert', 'category_id', 'brand_id', 'model_id',\r\n      'image_url', 'gallery_urls', 'specifications', 'is_featured',\r\n      'is_active', 'sku', 'barcode', 'currency', 'is_global',\r\n      'created_at', 'updated_at', 'deleted_at', 'tenant_id'\r\n    ]);\r\n\r\n    const updates = products.map(p => {\r\n        if (!p.id) return Promise.resolve({ error: { message: 'Missing ID' } });\r\n        const { id, tenant_id, ...rest } = p as any;\r\n\r\n        // Keep only known DB columns\r\n        const cleanPayload: Record<string, any> = {};\r\n        for (const key of Object.keys(rest)) {\r\n          if (DB_COLUMNS.has(key)) cleanPayload[key] = (rest as any)[key];\r\n        }\r\n        cleanPayload['updated_at'] = new Date().toISOString();\r\n\r\n        let query = this.supabase.from('products').update(cleanPayload).eq('id', id);\r\n        return this.applyTenantFilter(query);\r\n    });\r\n\r\n    return from(Promise.all(updates)).pipe(\r\n      map((results) => {\r\n        const errors = results.filter((r: any) => r && r.error);\r\n        if (errors.length > 0) {\r\n             throw new Error(`Failed to update ${errors.length} products`);\r\n        }\r\n        return void 0;\r\n      })\r\n    );\r\n  }\r\n\r\n  /** Soft-delete multiple products at once (sets deleted_at timestamp) */\r\n  bulkDelete(ids: string[]): Observable<void> {\r\n    if (!ids.length) return of(void 0);\r\n    const CHUNK_SIZE = 100;\r\n    const chunks: string[][] = [];\r\n    for (let i = 0; i < ids.length; i += CHUNK_SIZE) {\r\n      chunks.push(ids.slice(i, i + CHUNK_SIZE));\r\n    }\r\n    const tenantId = this.tenantService.getTenantId();\r\n    const processChunks = async () => {\r\n      for (const chunk of chunks) {\r\n        const { error } = await (this.supabase\r\n          .from('products')\r\n          .update({ deleted_at: new Date().toISOString(), updated_at: new Date().toISOString() })\r\n          .in('id', chunk)\r\n          .eq('tenant_id', tenantId) as any);\r\n        if (error) throw error;\r\n      }\r\n    };\r\n    return from(processChunks()).pipe(map(() => void 0));\r\n  }\r\n\r\n  private _mapToEntity(p: any, branch_id?: string): Product {\r\n    const isFeatured = Boolean(p['featured'] ?? p['is_featured'] ?? false);\r\n    let displayedStock = 0;\r\n    const branchStockList = p.branch_stock && Array.isArray(p.branch_stock) ? p.branch_stock : [];\r\n    \r\n    if (branch_id) {\r\n       const specificBranch = branchStockList.find((b: any) => b.branch_id === branch_id);\r\n       displayedStock = specificBranch ? Number(specificBranch.quantity) : 0;\r\n    } else if (branchStockList.length > 0) {\r\n       displayedStock = branchStockList.reduce((acc: number, curr: any) => acc + (Number(curr.quantity) || 0), 0);\r\n    } else {\r\n       displayedStock = Number(p['stock'] || 0);\r\n    }\r\n\r\n    return {\r\n          id: p['id'] as string,\r\n          name: p['name'] as string,\r\n          slug: p['slug'] as string,\r\n          description: p['description'] as string,\r\n          price: Number(p['price']),\r\n          image_url: p['image_url'] as string,\r\n          gallery_urls: p['gallery_urls'] || (p['image_url'] ? [p['image_url']] : []),\r\n          category_id: p['category_id'] as string,\r\n          brand_id: p['brand_id'] as string,\r\n          stock: displayedStock,\r\n          is_active: Boolean(p['is_active']),\r\n          is_featured: isFeatured,\r\n          sku: p['sku'] as string || '',\r\n          barcode: p['barcode'] as string || '',\r\n          currency: p['currency'] as 'ARS' | 'USD' || 'ARS',\r\n          min_stock_alert: p['min_stock_alert'] ? Number(p['min_stock_alert']) : undefined,\r\n          created_at: p['created_at'] as string,\r\n          updated_at: p['updated_at'] as string,\r\n          branch_stock: p.branch_stock\r\n    };\r\n  }\r\n}\r\n", "import { SupabaseClient } from '@supabase/supabase-js';\r\nimport { inject } from '@angular/core';\r\nimport { DatabaseError } from '../errors/application.error';\r\nimport { LoggerService } from '../services/logger.service';\r\nimport { TenantService } from '../services/tenant.service';\r\nimport { Observable, from, map } from 'rxjs';\r\n\r\n/**\r\n * Base Repository (SaaS Architecture)\r\n * Proporciona métodos CRUD genéricos mutados. Automáticamente inyecta \r\n * y aísla métricas y datos por \"tenant_id\" sin que Frontend deba pensarlo.\r\n */\r\nexport abstract class BaseRepository<T extends { id?: string; tenant_id?: string }> {\r\n    protected abstract tableName: string;\r\n    \r\n    // Lista de tablas globales del sistema (Ejemplo). Para estas NO aplicamos Tenant Filter.\r\n    // Configura aquí si alguna tabla (ej. planes de precios base) es global para toda la app.\r\n    protected isGlobalTable: boolean = false;\r\n\r\n    // Define si la tabla utiliza la columna \"deleted_at\" para borrado lógico (Soft Deletes)\r\n    protected useSoftDeletes: boolean = false;\r\n\r\n    // Se inyecta al vuelo. Evita tener que pasarlo a mano en constructores hijos \r\n    protected tenantService = inject(TenantService);\r\n\r\n    constructor(\r\n        protected supabase: SupabaseClient,\r\n        protected logger: LoggerService\r\n    ) { }\r\n\r\n    /**\r\n     * Aplica el contexto SaaS automáticamente si la tabla no es global.\r\n     * También aplica el filtro de Soft Deletes si la tabla lo soporta.\r\n     */\r\n    protected applyTenantFilter(query: any) {\r\n        let enhancedQuery = query;\r\n\r\n        if (!this.isGlobalTable) {\r\n            const tenantId = this.tenantService.getTenantId();\r\n            enhancedQuery = enhancedQuery.eq('tenant_id', tenantId);\r\n        }\r\n\r\n        if (this.useSoftDeletes) {\r\n            enhancedQuery = enhancedQuery.is('deleted_at', null);\r\n        }\r\n\r\n        return enhancedQuery;\r\n    }\r\n\r\n    /**\r\n     * Find all records for the current Tenant\r\n     */\r\n    getAll(orderBy?: { column: string; ascending?: boolean }): Observable<T[]> {\r\n        const fetchAll = async (): Promise<T[]> => {\r\n            let allData: T[] = [];\r\n            let fromIdx = 0;\r\n            let hasMore = true;\r\n            const CHUNK = 1000;\r\n\r\n            while (hasMore) {\r\n                let query = this.supabase.from(this.tableName).select('*');\r\n                query = this.applyTenantFilter(query);\r\n\r\n                if (orderBy) {\r\n                    query = query.order(orderBy.column, { ascending: orderBy.ascending ?? true });\r\n                }\r\n\r\n                const { data, error } = await (query.range(fromIdx, fromIdx + CHUNK - 1) as any);\r\n\r\n                if (error) {\r\n                    this.logger.error(`Error fetching all ${this.tableName}`, error);\r\n                    throw new DatabaseError(error.message, error);\r\n                }\r\n\r\n                const batch = (data as T[]) || [];\r\n                allData = [...allData, ...batch];\r\n\r\n                if (batch.length < CHUNK) {\r\n                    hasMore = false;\r\n                } else {\r\n                    fromIdx += CHUNK;\r\n                }\r\n            }\r\n            return allData;\r\n        };\r\n\r\n        return from(fetchAll());\r\n    }\r\n\r\n    /**\r\n     * Find record by ID (safely isolated within current Tenant)\r\n     */\r\n    getById(id: string): Observable<T> {\r\n        let query = this.supabase.from(this.tableName).select('*').eq('id', id);\r\n        query = this.applyTenantFilter(query);\r\n\r\n        return from(query.single()).pipe(\r\n            map(({ data, error }) => {\r\n                if (error) {\r\n                    if (error.code === 'PGRST116') throw new Error('Not found'); // Simplificado para componente que usa catchError\r\n                    this.logger.error(`Error fetching ${this.tableName} by ID`, error);\r\n                    throw new DatabaseError(error.message, error);\r\n                }\r\n                return data as T;\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Create new record (Automáticamente empaca el Tenant ID)\r\n     */\r\n    create(item: Partial<T>): Observable<T> {\r\n        const payload = this.isGlobalTable \r\n            ? item \r\n            : { ...item, tenant_id: this.tenantService.getTenantId() };\r\n\r\n        return from(\r\n            this.supabase\r\n                .from(this.tableName)\r\n                .insert(payload as any)\r\n                .select()\r\n                .single()\r\n        ).pipe(\r\n            map(({ data, error }) => {\r\n                if (error) {\r\n                    this.logger.error(`Error creating ${this.tableName}`, error);\r\n                    throw new DatabaseError(error.message, error);\r\n                }\r\n                return data as T;\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update existing record (Safely within tenant isolation)\r\n     */\r\n    update(id: string, item: Partial<T>): Observable<T> {\r\n        // En una actualización, Supabase bloquea cambiar IDs seguros (no re-mandar tenant_id es buena práctica)\r\n        const payload = { ...item };\r\n        delete payload.tenant_id; // Evita error de modificación inmutable SQL\r\n        delete payload.id;\r\n\r\n        let query = this.supabase.from(this.tableName).update(payload).eq('id', id);\r\n        query = this.applyTenantFilter(query);\r\n\r\n        return from(query.select().single()).pipe(\r\n            map(({ data, error }) => {\r\n                if (error) {\r\n                     this.logger.error(`Error updating ${this.tableName}`, error);\r\n                     throw new DatabaseError(error.message, error);\r\n                }\r\n                return data as T;\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Delete record (Aislado fuertemente)\r\n     */\r\n    delete(id: string): Observable<void> {\r\n        let query = this.supabase.from(this.tableName).delete().eq('id', id);\r\n        query = this.applyTenantFilter(query);\r\n\r\n        return from(query).pipe(\r\n            map(({ error }) => {\r\n                if (error) {\r\n                    this.logger.error(`Error deleting ${this.tableName}`, error);\r\n                    throw new DatabaseError(error.message, error);\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Find records with custom filter (Aislado)\r\n     */\r\n    getWhere(\r\n        column: string,\r\n        value: string | number | boolean | null,\r\n        orderBy?: { column: string; ascending?: boolean }\r\n    ): Observable<T[]> {\r\n        let query = this.supabase\r\n            .from(this.tableName)\r\n            .select('*')\r\n            .eq(column, value);\r\n        \r\n        query = this.applyTenantFilter(query);\r\n\r\n        if (orderBy) {\r\n            query = query.order(orderBy.column, { ascending: orderBy.ascending ?? true });\r\n        }\r\n\r\n        return from(query).pipe(\r\n            map(({ data, error }) => {\r\n                if (error) {\r\n                    this.logger.error(`Error fetching ${this.tableName} with filter`, error);\r\n                    throw new DatabaseError(error.message, error);\r\n                }\r\n                return (data as T[]) || [];\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Count records natively at database level\r\n     */\r\n    count(): Observable<number> {\r\n        let query = this.supabase\r\n            .from(this.tableName)\r\n            .select('*', { count: 'exact', head: true });\r\n            \r\n        query = this.applyTenantFilter(query);\r\n\r\n        return from(query).pipe(\r\n            map(({ count, error }) => {\r\n                if (error) {\r\n                    this.logger.error(`Error counting ${this.tableName}`, error);\r\n                    throw new DatabaseError(error.message, error);\r\n                }\r\n                return count || 0;\r\n            })\r\n        );\r\n    }\r\n}\r\n", "import { Injectable, inject } from '@angular/core';\r\nimport { BaseRepository } from '@app/core/repositories/base.repository';\r\nimport { Category } from '../../domain/entities/category.entity';\r\nimport { CategoryRepository } from '../../domain/repositories/category.repository';\r\nimport { AuthService } from '@app/core/services/auth.service';\r\nimport { LoggerService } from '@app/core/services/logger.service';\r\n\r\n/**\r\n * Category Repository\r\n * Handles all database operations for categories\r\n */\r\n@Injectable({ providedIn: 'root' })\r\nexport class SupabaseCategoryRepository extends BaseRepository<Category> implements CategoryRepository {\r\n    protected tableName = 'categories';\r\n\r\n    constructor() {\r\n        const authService = inject(AuthService);\r\n        const logger = inject(LoggerService);\r\n        super(authService.getSupabaseClient(), logger);\r\n    }\r\n}\r\n", "import { Injectable, inject } from '@angular/core';\r\nimport { BaseRepository } from '@app/core/repositories/base.repository';\r\nimport { Brand } from '../../domain/entities/brand.entity';\r\nimport { BrandRepository } from '../../domain/repositories/brand.repository';\r\nimport { AuthService } from '@app/core/services/auth.service';\r\nimport { LoggerService } from '@app/core/services/logger.service';\r\n\r\n/**\r\n * Brand Repository\r\n * Handles all database operations for brands\r\n */\r\n@Injectable({ providedIn: 'root' })\r\nexport class SupabaseBrandRepository extends BaseRepository<Brand> implements BrandRepository {\r\n    protected tableName = 'brands';\r\n\r\n    constructor() {\r\n        const authService = inject(AuthService);\r\n        const logger = inject(LoggerService);\r\n        super(authService.getSupabaseClient(), logger);\r\n    }\r\n}\r\n", "import { Injectable, inject } from '@angular/core';\r\nimport { Observable, from } from 'rxjs';\r\nimport { map, switchMap } from 'rxjs/operators';\r\nimport { RepairRepository } from '../../domain/repositories/repair.repository';\r\nimport { Repair, CreateRepairDto, UpdateRepairDto, RepairPart } from '../../domain/entities/repair.entity';\r\nimport { AuthService } from '@app/core/services/auth.service';\r\nimport { TenantService } from '@app/core/services/tenant.service';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class SupabaseRepairRepository extends RepairRepository {\r\n    private auth = inject(AuthService);\r\n    private tenantService = inject(TenantService);\r\n    private supabase = this.auth.getSupabaseClient();\r\n    \r\n    protected useSoftDeletes = true;\r\n\r\n    private applyTenantFilter(query: any) {\r\n        let enhancedQuery = query.eq('tenant_id', this.tenantService.getTenantId());\r\n        if (this.useSoftDeletes) {\r\n            enhancedQuery = enhancedQuery.is('deleted_at', null);\r\n        }\r\n        return enhancedQuery;\r\n    }\r\n\r\n    getById(id: string): Observable<Repair> {\r\n        let query = this.supabase.from('repairs')\r\n            .select('*, parts:repair_parts_used(*), images:repair_images(image_url)')\r\n            .eq('id', id);\r\n\r\n        return from(this.applyTenantFilter(query).single() as any).pipe(\r\n            map((res: any) => {\r\n                const { data, error } = res;\r\n                if (error) throw error;\r\n                return this.mapFromDb(data);\r\n            })\r\n        );\r\n    }\r\n\r\n    getAll(limit: number = 50, offset: number = 0): Observable<Repair[]> {\r\n        let query = this.supabase\r\n            .from('repairs')\r\n            .select('*')\r\n            .range(offset, offset + limit - 1);\r\n            \r\n        let filteredQuery = this.applyTenantFilter(query).order('created_at', { ascending: false });\r\n\r\n        return from(filteredQuery as any).pipe(\r\n            map((res: any) => {\r\n                const { data, error } = res;\r\n                if (error) throw error;\r\n                return (data || []).map((item: any) => this.mapFromDb(item));\r\n            })\r\n        );\r\n    }\r\n\r\n    create(repair: CreateRepairDto): Observable<Repair> {\r\n        const { parts, images, ...baseRepair } = repair as any;\r\n        const payload = this.mapToDb(baseRepair);\r\n        payload.tenant_id = this.tenantService.getTenantId(); // Inyectar tenant forzoso\r\n        \r\n        return from(this.supabase.from('repairs').insert(payload).select().single() as any).pipe(\r\n            map((res: any) => {\r\n                const { data, error } = res;\r\n                if (error) throw error;\r\n                return data;\r\n            }),\r\n            switchMap(async (data: any) => {\r\n                if (parts && parts.length > 0) {\r\n                    await this.syncParts(data.id, parts);\r\n                }\r\n                if (images && images.length > 0) {\r\n                    await this.syncImages(data.id, images);\r\n                }\r\n                const repairWithParts = { ...data, parts: parts || [], images: images || [] };\r\n                return this.mapFromDb(repairWithParts);\r\n            })\r\n        );\r\n    }\r\n\r\n    update(id: string, repair: UpdateRepairDto): Observable<void> {\r\n        const { parts, images, ...baseRepair } = repair as any;\r\n        const payload = this.mapToDb(baseRepair);\r\n        \r\n        let query = this.supabase.from('repairs').update(payload).eq('id', id).select();\r\n\r\n        return from(this.applyTenantFilter(query) as any).pipe(\r\n            map((res: any) => {\r\n                const { error, data } = res;\r\n                if (error) throw error;\r\n                return data;\r\n            }),\r\n            switchMap(async () => {\r\n                if (parts) {\r\n                    await this.syncParts(id, parts);\r\n                }\r\n                if (images) {\r\n                    await this.syncImages(id, images);\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    private async syncParts(repairId: string, parts: RepairPart[]): Promise<void> {\r\n        const tenantId = this.tenantService.getTenantId();\r\n        await this.supabase.from('repair_parts_used').delete().eq('repair_id', repairId).eq('tenant_id', tenantId);\r\n        \r\n        if (parts.length > 0) {\r\n            const partsToInsert = parts.map(p => ({\r\n                repair_id: repairId,\r\n                product_id: p.product_id,\r\n                quantity: p.quantity,\r\n                unit_price_at_time: p.unit_price_at_time,\r\n                cost_at_time: p.cost_at_time,\r\n                tenant_id: tenantId\r\n            }));\r\n            await this.supabase.from('repair_parts_used').insert(partsToInsert);\r\n        }\r\n    }\r\n\r\n    private async syncImages(repairId: string, images: string[]): Promise<void> {\r\n        const tenantId = this.tenantService.getTenantId();\r\n        await this.supabase.from('repair_images').delete().eq('repair_id', repairId).eq('tenant_id', tenantId);\r\n        \r\n        if (images && images.length > 0) {\r\n            const imagesToInsert = images.map(img => ({\r\n                repair_id: repairId,\r\n                image_url: typeof img === 'string' ? img : (img as any).image_url,\r\n                tenant_id: tenantId\r\n            }));\r\n            await this.supabase.from('repair_images').insert(imagesToInsert);\r\n        }\r\n    }\r\n\r\n    delete(id: string): Observable<void> {\r\n        let query = this.supabase.from('repairs').delete().eq('id', id);\r\n        return from(this.applyTenantFilter(query) as any).pipe(\r\n            map((res: any) => {\r\n                const { error } = res;\r\n                if (error) throw error;\r\n            })\r\n        );\r\n    }\r\n\r\n    getByTrackingCode(code: string): Observable<Repair> {\r\n        // Since get_repair_by_tracking RPC might bypass RLS if using SECURITY DEFINER, or we aren't sending tenant id,\r\n        // it's better to query directly for the scope of the tenant to avoid leakage.\r\n        let query = this.supabase\r\n            .from('repairs')\r\n            .select('*, parts:repair_parts_used(*), images:repair_images(image_url)')\r\n            .eq('tracking_code', code);\r\n            \r\n        return from(this.applyTenantFilter(query).single() as any).pipe(\r\n            map((res: any) => {\r\n                const { data, error } = res;\r\n                if (error) throw error;\r\n                return this.mapFromDb(data);\r\n            })\r\n        );\r\n    }\r\n\r\n    async uploadImage(file: File): Promise<string> {\r\n        const fileExt = file.name.split('.').pop();\r\n        const tenantStr = this.tenantService.getTenantId();\r\n        const fileName = `${tenantStr}_${Math.random().toString(36).substring(2, 15)}_${Date.now()}.${fileExt}`;\r\n        const filePath = `${fileName}`;\r\n\r\n        const { error: uploadError } = await this.supabase.storage\r\n            .from('repair-images')\r\n            .upload(filePath, file);\r\n\r\n        if (uploadError) throw uploadError;\r\n\r\n        const { data: publicUrlData } = this.supabase.storage\r\n            .from('repair-images')\r\n            .getPublicUrl(filePath);\r\n\r\n        return publicUrlData.publicUrl;\r\n    }\r\n\r\n    getAdminList(params: { branch_id?: string; limit?: number; offset?: number }): Observable<Repair[]> {\r\n        const { branch_id, limit = 50, offset = 0 } = params;\r\n        \r\n        let query = this.supabase\r\n            .from('repairs')\r\n            .select('*')\r\n            .range(offset, offset + limit - 1);\r\n\r\n        if (branch_id) {\r\n            query = query.eq('branch_id', branch_id);\r\n        }\r\n\r\n        let filteredQuery = this.applyTenantFilter(query).order('received_at', { ascending: false });\r\n\r\n        return from(filteredQuery as any).pipe(\r\n            map((res: any) => {\r\n                const { data, error } = res;\r\n                if (error) throw error;\r\n                return (data || []).map((item: any) => this.mapFromDb(item));\r\n            })\r\n        );\r\n    }\r\n\r\n    private mapFromDb(data: any): Repair {\r\n        return {\r\n            ...data,\r\n            device_brand: data.device_brand || 'generic', \r\n            images: data.images ? data.images.map((img: any) => typeof img === 'string' ? img : img.image_url) : []\r\n        } as Repair;\r\n    }\r\n\r\n    private mapToDb(entity: Partial<UpdateRepairDto>): any {\r\n        const { device_brand, device_type, images, ...rest } = entity as any;\r\n        const payload: any = { ...rest };\r\n        \r\n        // Handle device_model concatenation if brand/type provided externally\r\n        if (device_brand || device_type) {\r\n            let model = payload.device_model || '';\r\n            if (device_brand && device_brand.toLowerCase() !== 'generic') {\r\n                model = `${device_brand} ${model}`;\r\n            }\r\n            if (device_type && device_type !== 'smartphone') {\r\n                model = `${model} (${device_type})`;\r\n            }\r\n            payload.device_model = model.trim();\r\n        }\r\n\r\n        return payload;\r\n    }\r\n}\r\n", "import { Injectable, inject } from '@angular/core';\r\nimport { AnalyticsRepository, DashboardStats } from '../../domain/repositories/analytics.repository';\r\nimport { Observable, from, map } from 'rxjs';\r\nimport { AuthService } from '@app/core/services/auth.service';\r\n\r\nimport { SUPABASE_CLIENT } from '@app/core/di/supabase-token';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SupabaseAnalyticsRepository implements AnalyticsRepository {\r\n  private supabase = inject(SUPABASE_CLIENT);\r\n\r\n  getDashboardStats(): Observable<DashboardStats> {\r\n    return from(this.supabase.rpc('get_dashboard_stats')).pipe(\r\n      map(({ data, error }) => {\r\n        if (error) throw error;\r\n        \r\n        return {\r\n          users: data?.users || 0,\r\n          products: data?.products || 0,\r\n          sales: data?.sales || 0,\r\n          revenue: data?.revenue || 0,\r\n          repairs_month: data?.repairs_month || 0,\r\n          repairs_revenue: data?.repairs_revenue || 0,\r\n          devices_fixed: data?.devices_fixed || 0,\r\n          sales_chart: data?.sales_chart || [],\r\n          products_chart: data?.products_chart || [],\r\n          category_chart: data?.category_chart || []\r\n        } as DashboardStats;\r\n      })\r\n    );\r\n  }\r\n}\r\n", "import { Observable } from 'rxjs';\r\nimport { UserProfile } from '@app/shared/interfaces/user.interface';\r\n\r\nexport abstract class UserProfileRepository {\r\n  abstract getProfile(id: string): Observable<UserProfile>;\r\n  abstract updateProfile(id: string, profile: Partial<UserProfile>): Observable<UserProfile>;\r\n}\r\n", "import { Injectable, inject } from '@angular/core';\r\nimport { UserProfileRepository } from '../../repositories/user-profile.repository';\r\nimport { BaseRepository } from '../../repositories/base.repository';\r\nimport { UserProfile } from '@app/shared/interfaces/user.interface';\r\nimport { LoggerService } from '../../services/logger.service';\r\nimport { Observable } from 'rxjs';\r\nimport { SUPABASE_CLIENT } from '@app/core/di/supabase-token';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SupabaseUserProfileRepository extends BaseRepository<UserProfile> implements UserProfileRepository {\r\n  protected tableName = 'profiles';\r\n  \r\n  constructor() {\r\n    const supabase = inject(SUPABASE_CLIENT);\r\n    const logger = inject(LoggerService);\r\n    super(supabase, logger);\r\n  }\r\n\r\n  getProfile(id: string): Observable<UserProfile> {\r\n    return this.getById(id);\r\n  }\r\n\r\n  updateProfile(id: string, profile: Partial<UserProfile>): Observable<UserProfile> {\r\n    return this.update(id, profile);\r\n  }\r\n}\r\n", "import {\r\n  ApplicationConfig,\r\n  ErrorHandler,\r\n  provideBrowserGlobalErrorListeners,\r\n  provideZonelessChangeDetection,\r\n} from '@angular/core';\r\nimport { provideClientHydration, withEventReplay } from '@angular/platform-browser';\r\nimport { provideRouter, withInMemoryScrolling } from '@angular/router';\r\nimport { provideHttpClient, withFetch } from '@angular/common/http';\r\nimport { routes } from './app.routes';\r\nimport { GlobalErrorHandler } from './core/errors/global-error-handler';\r\nimport { SupabaseService } from './core/services/supabase.service';\r\nimport { SUPABASE_CLIENT } from './core/di/supabase-token';\r\n\r\nimport { ProductRepository } from './features/products/domain/repositories/product.repository';\r\nimport { SupabaseProductRepository } from './features/products/infrastructure/repositories/supabase-product.repository';\r\nimport { CategoryRepository } from './features/products/domain/repositories/category.repository';\r\nimport { SupabaseCategoryRepository } from './features/products/infrastructure/repositories/supabase-category.repository';\r\nimport { BrandRepository } from './features/products/domain/repositories/brand.repository';\r\nimport { SupabaseBrandRepository } from './features/products/infrastructure/repositories/supabase-brand.repository';\r\nimport { RepairRepository } from './features/repairs/domain/repositories/repair.repository';\r\nimport { SupabaseRepairRepository } from './features/repairs/infrastructure/repositories/supabase-repair.repository';\r\nimport { AnalyticsRepository } from './features/analytics/domain/repositories/analytics.repository';\r\nimport { SupabaseAnalyticsRepository } from './features/analytics/infrastructure/repositories/supabase-analytics.repository';\r\nimport { UserProfileRepository } from './core/repositories/user-profile.repository';\r\nimport { SupabaseUserProfileRepository } from './core/infrastructure/repositories/supabase-user-profile.repository';\r\n\r\nexport const appConfig: ApplicationConfig = {\r\n  providers: [\r\n    // Global error handler\r\n    { provide: ErrorHandler, useClass: GlobalErrorHandler },\r\n    \r\n    // Supabase Client Provider via SupabaseService\r\n    { \r\n      provide: SUPABASE_CLIENT, \r\n      useFactory: (supabaseService: SupabaseService) => supabaseService.getClient(),\r\n      deps: [SupabaseService]\r\n    },\r\n\r\n    // Core Angular providers\r\n    provideBrowserGlobalErrorListeners(),\r\n    provideZonelessChangeDetection(),\r\n    provideClientHydration(withEventReplay()),\r\n    provideRouter(\r\n      routes,\r\n      withInMemoryScrolling({\r\n        anchorScrolling: 'enabled',\r\n        scrollPositionRestoration: 'enabled'\r\n      })\r\n    ),\r\n    provideHttpClient(withFetch()),\r\n\r\n    // Repositories\r\n    { provide: ProductRepository, useClass: SupabaseProductRepository },\r\n    { provide: CategoryRepository, useClass: SupabaseCategoryRepository },\r\n    { provide: BrandRepository, useClass: SupabaseBrandRepository },\r\n    { provide: RepairRepository, useClass: SupabaseRepairRepository },\r\n    { provide: AnalyticsRepository, useClass: SupabaseAnalyticsRepository },\r\n    { provide: UserProfileRepository, useClass: SupabaseUserProfileRepository },\r\n  ]\r\n};", "import { Injectable, signal, computed, inject, PLATFORM_ID } from '@angular/core';\r\nimport { isPlatformBrowser } from '@angular/common';\r\n// import { CreateMLCEngine, MLCEngine, InitProgressCallback } from \"@mlc-ai/web-llm\"; // Removed static import\r\n\r\nexport interface ChatMessage {\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AiAgentService {\r\n  private platformId = inject(PLATFORM_ID);\r\n  private engine: any | null = null; // Type 'any' because strict type is not available without static import\r\n  \r\n  // Signals for UI State\r\n  isLoadingModel = signal(false);\r\n  isGenerating = signal(false);\r\n  loadingProgress = signal('');\r\n  modelLoaded = signal(false);\r\n  \r\n  // Full conversation history (for LLM context)\r\n  messages = signal<ChatMessage[]>([]);\r\n\r\n  // Visible messages for UI (filters out system prompts and tool outputs)\r\n  visibleMessages = computed(() => \r\n    this.messages().filter(m => m.role !== 'system')\r\n  );\r\n\r\n  // Default model - Using Phi-3-mini-4k-instruct which is efficient for browser\r\n  private selectedModel = \"Phi-3-mini-4k-instruct-q4f16_1-MLC\"; \r\n\r\n  constructor() {}\r\n\r\n  async initModel() {\r\n    if (!isPlatformBrowser(this.platformId)) {\r\n        console.warn('AI Model cannot be initialized on server');\r\n        return;\r\n    }\r\n\r\n    if (this.modelLoaded()) return;\r\n\r\n    this.isLoadingModel.set(true);\r\n    \r\n    // Dynamic import to avoid SSR crashes\r\n    try {\r\n        // Check WebGPU availability first\r\n        if (!(navigator as any).gpu) {\r\n            throw new Error('WebGPU not supported in this browser');\r\n        }\r\n\r\n        const { CreateMLCEngine } = await import('@mlc-ai/web-llm');\r\n        \r\n        const initProgressCallback = (report: { text: string }) => {\r\n            this.loadingProgress.set(report.text);\r\n        };\r\n\r\n        this.engine = await CreateMLCEngine(\r\n            this.selectedModel,\r\n            { initProgressCallback }\r\n        );\r\n        this.modelLoaded.set(true);\r\n        this.isLoadingModel.set(false);\r\n        \r\n        this.initializeSystemPrompt();\r\n\r\n    } catch (error) {\r\n      console.error(\"Failed to load model\", error);\r\n      this.isLoadingModel.set(false);\r\n      \r\n      // Handle WebGPU-specific errors gracefully\r\n      if (error instanceof Error && error.message.includes('WebGPU')) {\r\n        this.loadingProgress.set(\"WebGPU no disponible. Usa Chrome/Edge para acceder a la IA.\");\r\n      } else {\r\n        this.loadingProgress.set(\"Error loading model: \" + error);\r\n      }\r\n    }\r\n  }\r\n\r\n  private initializeSystemPrompt() {\r\n      // System Prompt with MCP capabilities definition\r\n      this.messages.set([\r\n        { role: 'system', content: `You are Arecofix AI Assistant. You help users with IT support, phone repairs, and website quotes.\r\n        \r\n        You have access to the following tools (simulated MCP):\r\n        - get_repair_status(trackingId): Check repair status.\r\n        - list_services(): Show available services.\r\n        - book_appointment(serviceType, date): Schedule a repair.\r\n        \r\n        When a user asks something that requires a tool, reply with a JSON object strictly in this format:\r\n        {\"tool\": \"tool_name\", \"args\": { ... }}\r\n        \r\n        Answer normally if no tool is needed. Keep responses concise and helpful.` }\r\n      ]);\r\n  }\r\n\r\n  async sendMessage(text: string) {\r\n    if (!this.engine) {\r\n        await this.initModel();\r\n        if (!this.engine) {\r\n             this.messages.update(msgs => [...msgs, { role: 'assistant', content: \"Error crítico: El modelo IA no pudo cargarse. Verifica que tu navegador soporte WebGPU.\" }]);\r\n             return;\r\n        }\r\n    }\r\n\r\n    this.isGenerating.set(true);\r\n    \r\n    // Add user message\r\n    const userMsg: ChatMessage = { role: 'user', content: text };\r\n    this.messages.update(msgs => this.limitHistory([...msgs, userMsg]));\r\n\r\n    try {\r\n      const reply = await this.generateResponse();\r\n      const responseContent = reply.choices[0].message.content || \"\";\r\n      \r\n      this.handleResponse(responseContent);\r\n\r\n    } catch (error) {\r\n      console.error(\"Chat error\", error);\r\n      const errorMsg = error instanceof Error ? error.message : String(error);\r\n      this.messages.update(msgs => [...msgs, { role: 'assistant', content: `Lo siento, hubo un error técnico: ${errorMsg}. Por favor intenta de nuevo.` }]);\r\n    } finally {\r\n      this.isGenerating.set(false);\r\n    }\r\n  }\r\n\r\n  private async generateResponse() {\r\n    const history = this.messages().map(m => ({ role: m.role, content: m.content }));\r\n    return await this.engine!.chat.completions.create({\r\n        messages: history as any\r\n    });\r\n  }\r\n\r\n  private async handleResponse(content: string) {\r\n    // Check for tool usage\r\n    const toolCall = this.extractJson(content);\r\n    \r\n    if (toolCall && toolCall.tool) {\r\n         try {\r\n             await this.handleToolCall(toolCall);\r\n         } catch (e) {\r\n             console.error(\"Tool execution error\", e);\r\n             // Fallback if tool execution fails\r\n             this.messages.update(msgs => [...msgs, { role: 'assistant', content: content }]);\r\n         }\r\n    } else {\r\n         this.messages.update(msgs => [...msgs, { role: 'assistant', content: content }]);\r\n    }\r\n  }\r\n\r\n  private extractJson(content: string): any {\r\n      // 1. Try stripping markdown code blocks first\r\n      const cleanContent = content.replace(/```json\\s*|```/g, '').trim();\r\n      \r\n      // 2. Scan for the first '{' and try to find a valid JSON object\r\n      const startIndex = cleanContent.indexOf('{');\r\n      if (startIndex === -1) return null;\r\n\r\n      // Try parsing from the first open brace to the end, then shrinking if needed\r\n      // Naive approach: try to find the matching closing brace? \r\n      // Better approach: Try parsing increasingly longer substrings? \r\n      // Or just try to parse the whole thing from startIndex\r\n      \r\n      const potentialJson = cleanContent.substring(startIndex);\r\n      \r\n      try {\r\n        return JSON.parse(potentialJson);\r\n      } catch (e) {\r\n        // If full parse fails, it might have trailing text.\r\n        // Attempt to find the closing brace by counting balance\r\n        let balance = 0;\r\n        let endIndex = -1;\r\n        \r\n        for (let i = 0; i < potentialJson.length; i++) {\r\n            if (potentialJson[i] === '{') balance++;\r\n            else if (potentialJson[i] === '}') {\r\n                balance--;\r\n                if (balance === 0) {\r\n                    endIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        \r\n        if (endIndex !== -1) {\r\n            try {\r\n                return JSON.parse(potentialJson.substring(0, endIndex + 1));\r\n            } catch (err) { }\r\n        }\r\n      }\r\n      return null;\r\n  }\r\n\r\n  private async handleToolCall(toolCall: any) {\r\n      console.log(\"Executing Tool:\", toolCall);\r\n      let result = \"\";\r\n\r\n      // Simulate output\r\n      switch(toolCall.tool) {\r\n          case 'list_services':\r\n              result = \"Available Services: iPhone Screen Repair, Android Battery Replacement, PC Optimization, Custom Web Development, SEO Consulting.\";\r\n              break;\r\n          case 'get_repair_status':\r\n               const id = toolCall.args?.trackingId || 'Unknown';\r\n               result = `Repair ${id} is currently In Progress (Phase 2: Component Testing). ETA: 24hrs.`;\r\n               break;\r\n          case 'book_appointment':\r\n               result = `Appointment request received for ${toolCall.args?.serviceType} on ${toolCall.args?.date}. Please confirm via WhatsApp.`;\r\n               break;\r\n          default:\r\n               result = \"Tool not found or not supported.\";\r\n      }\r\n\r\n      // Add tool interaction context (hidden from user via visibleMessages)\r\n      this.messages.update(msgs => [\r\n          ...msgs, \r\n          { role: 'assistant', content: `Checking... (Tool: ${toolCall.tool})` },\r\n          { role: 'user', content: `[Tool Output]: ${result}` } // Changed to 'user' to be safer for LLM context\r\n      ]);\r\n      \r\n      // Trigger re-generation with tool output\r\n      const reply = await this.generateResponse();\r\n      const finalResponse = reply.choices[0].message.content || \"\";\r\n      \r\n      this.messages.update(msgs => [...msgs, { role: 'assistant', content: finalResponse }]);\r\n  }\r\n\r\n  private limitHistory(msgs: ChatMessage[]): ChatMessage[] {\r\n      const maxHistory = 20; // Keep roughly last 20 messages + system prompt\r\n      if (msgs.length <= maxHistory) return msgs;\r\n\r\n      // Always keep the first message (System Prompt)\r\n      const systemPrompt = msgs[0];\r\n      const recentMessages = msgs.slice(msgs.length - (maxHistory - 1));\r\n      \r\n      return [systemPrompt, ...recentMessages];\r\n  }\r\n}\r\n", "import { Component, inject, signal, ViewChild, ElementRef, AfterViewChecked } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { AiAgentService } from '../../core/services/ai-agent.service';\r\n\r\n@Component({\r\n  selector: 'app-ai-assistant',\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule],\r\n  templateUrl: './ai-assistant.html',\r\n  styleUrls: ['./ai-assistant.css'],\r\n})\r\nexport class AiAssistant implements AfterViewChecked {\r\n  aiService = inject(AiAgentService);\r\n  \r\n  isOpen = signal(false);\r\n  userInput = signal('');\r\n  \r\n  @ViewChild('scrollContainer') private scrollContainer!: ElementRef;\r\n\r\n  toggleChat() {\r\n    this.isOpen.update(v => !v);\r\n    if (this.isOpen() && !this.aiService.modelLoaded()) {\r\n      this.aiService.initModel();\r\n    }\r\n  }\r\n\r\n  sendMessage() {\r\n    const text = this.userInput().trim();\r\n    if (!text) return;\r\n    \r\n    this.aiService.sendMessage(text);\r\n    this.userInput.set('');\r\n  }\r\n\r\n  ngAfterViewChecked() {\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  private scrollToBottom(): void {\r\n    try {\r\n      if (typeof window !== 'undefined' && this.scrollContainer && this.scrollContainer.nativeElement) {\r\n        this.scrollContainer.nativeElement.scrollTop = this.scrollContainer.nativeElement.scrollHeight;\r\n      }\r\n    } catch(err) { }\r\n  }\r\n}\r\n", "\r\n<!-- Toggler Button -->\r\n<button (click)=\"toggleChat()\"\r\n  class=\"fixed bottom-6 left-6 z-9999 w-14 h-14 md:w-16 md:h-16 rounded-full bg-linear-to-r from-blue-600 to-purple-600 text-white shadow-lg shadow-purple-500/30 flex items-center justify-center hover:scale-110 transition-transform active:scale-95 group\"\r\n  [attr.aria-label]=\"isOpen() ? 'Cerrar asistente de IA' : 'Abrir asistente de IA'\"\r\n  aria-haspopup=\"dialog\">\r\n  @if (!isOpen()) {\r\n    <div class=\"absolute inset-0 rounded-full border border-white/20 animate-ping opacity-20\"></div>\r\n  }\r\n  <!-- AI Icon -->\r\n  @if (!isOpen()) {\r\n    <i class=\"fas fa-microchip text-2xl group-hover:rotate-12 transition-transform\"></i>\r\n  }\r\n  @if (isOpen()) {\r\n    <i class=\"fas fa-times text-xl\"></i>\r\n  }\r\n</button>\r\n\r\n<!-- Chat Window -->\r\n@if (isOpen()) {\r\n  <div\r\n    class=\"fixed bottom-0 right-0 md:bottom-24 md:right-6 w-full md:w-[400px] h-dvh md:h-[600px] md:max-h-[80vh] z-9999 md:rounded-2xl glass-panel border-t md:border border-white/10 shadow-2xl flex flex-col overflow-hidden animate-slide-up bg-surface-dark/95 backdrop-blur-xl\">\r\n    <!-- Header -->\r\n    <div class=\"p-4 border-b border-white/10 flex items-center justify-between bg-white/5 shrink-0\">\r\n      <div class=\"flex items-center gap-3\">\r\n        <div class=\"w-2 h-2 rounded-full\" [ngClass]=\"aiService.modelLoaded() ? 'bg-green-500 animate-pulse' : 'bg-yellow-500'\"></div>\r\n        <h3 class=\"font-bold text-white text-sm\">Arecofix AI @if (aiService.isLoadingModel()) {\r\n          <span class=\"text-xs font-normal text-gray-400 block\">Iniciando Motor...</span>\r\n        }</h3>\r\n      </div>\r\n      <div class=\"flex items-center gap-3\">\r\n        <div class=\"text-[10px] text-gray-500 font-mono hidden sm:block\">WebLLM / MCP</div>\r\n        <!-- Mobile Close Button -->\r\n        <button (click)=\"toggleChat()\" class=\"md:hidden w-8 h-8 flex items-center justify-center bg-white/10 rounded-full text-white\">\r\n          <i class=\"fas fa-times\"></i>\r\n        </button>\r\n      </div>\r\n    </div>\r\n    <!-- Progress Bar (Model Loading) -->\r\n    @if (aiService.isLoadingModel()) {\r\n      <div class=\"p-4 bg-blue-900/20 text-center shrink-0\">\r\n        <p class=\"text-xs text-blue-300 mb-2\">{{ aiService.loadingProgress() }}</p>\r\n        <div class=\"w-full h-1 bg-gray-700 rounded-full overflow-hidden\">\r\n          <div class=\"h-full bg-blue-500 animate-pulse-width\"></div>\r\n        </div>\r\n        <p class=\"text-[10px] text-gray-400 mt-2\">Descargando modelo IA (solo la primera vez)...</p>\r\n      </div>\r\n    }\r\n    <!-- Messages Area -->\r\n    <div class=\"grow overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-transparent\" #scrollContainer>\r\n      <!-- Welcome Message -->\r\n      <div class=\"flex gap-3\">\r\n        <div class=\"w-8 h-8 rounded-full bg-linear-to-br from-blue-500 to-purple-600 flex items-center justify-center shrink-0\">\r\n          <i class=\"fas fa-robot text-xs text-white\"></i>\r\n        </div>\r\n        <div class=\"bg-white/10 p-3 rounded-2xl rounded-tl-sm text-sm text-gray-200 shadow-md\">\r\n          Hola! Soy tu asistente de Arecofix potenciado con IA local (WebLLM). Puedo ayudarte a consultar reparaciones, servicios o agendar citas. ¿En qué te ayudo?\r\n        </div>\r\n      </div>\r\n      @for (msg of aiService.visibleMessages(); track $index) {\r\n        <div class=\"flex gap-3\" [ngClass]=\"{'flex-row-reverse': msg.role === 'user'}\">\r\n          <div class=\"w-8 h-8 rounded-full flex items-center justify-center shrink-0\"\r\n            [ngClass]=\"msg.role === 'user' ? 'bg-gray-700' : 'bg-linear-to-br from-blue-500 to-purple-600'\">\r\n            <i [class]=\"msg.role === 'user' ? 'fas fa-user' : 'fas fa-robot'\" class=\"text-xs text-white\"></i>\r\n          </div>\r\n          <div class=\"p-3 rounded-2xl text-sm max-w-[80%] shadow-md whitespace-pre-wrap\"\r\n            [ngClass]=\"msg.role === 'user' ? 'bg-blue-600 text-white rounded-tr-sm' : 'bg-white/10 text-gray-200 rounded-tl-sm'\">\r\n            {{ msg.content }}\r\n          </div>\r\n        </div>\r\n      }\r\n      <!-- Typing Indicator -->\r\n      @if (aiService.isGenerating()) {\r\n        <div class=\"flex gap-3\">\r\n          <div class=\"w-8 h-8 rounded-full bg-linear-to-br from-blue-500 to-purple-600 flex items-center justify-center shrink-0\">\r\n            <i class=\"fas fa-robot text-xs text-white\"></i>\r\n          </div>\r\n          <div class=\"bg-white/5 p-3 rounded-2xl rounded-tl-sm flex gap-1 items-center h-10\">\r\n            <span class=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></span>\r\n            <span class=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100\"></span>\r\n            <span class=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200\"></span>\r\n          </div>\r\n        </div>\r\n      }\r\n    </div>\r\n    <!-- Suggestions Chips -->\r\n    @if (aiService.messages().length < 2) {\r\n      <div class=\"px-4 py-2 flex gap-2 overflow-x-auto no-scrollbar shrink-0\">\r\n        <button (click)=\"userInput.set('Estado de mi reparación'); sendMessage()\" class=\"whitespace-nowrap px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs text-blue-300 hover:bg-white/10 transition-colors\">\r\n          🔧 Estado Reparación\r\n        </button>\r\n        <button (click)=\"userInput.set('Quiero un presupuesto web'); sendMessage()\" class=\"whitespace-nowrap px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs text-purple-300 hover:bg-white/10 transition-colors\">\r\n          💻 Presupuesto Web\r\n        </button>\r\n        <button (click)=\"userInput.set('Cambio de pantalla iPhone'); sendMessage()\" class=\"whitespace-nowrap px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs text-green-300 hover:bg-white/10 transition-colors\">\r\n          📱 Reparar Celular\r\n        </button>\r\n      </div>\r\n    }\r\n    <!-- Input Area -->\r\n    <div class=\"p-3 bg-white/5 border-t border-white/10 shrink-0 pb-6 md:pb-3\">\r\n      <form (submit)=\"sendMessage()\" class=\"relative\">\r\n        <input\r\n          type=\"text\"\r\n          [disabled]=\"aiService.isLoadingModel() || aiService.isGenerating()\"\r\n          [(ngModel)]=\"userInput\"\r\n          name=\"userInput\"\r\n          placeholder=\"Escribe tu mensaje...\"\r\n          class=\"w-full bg-black/30 border border-white/10 rounded-xl py-3 pl-4 pr-12 text-white placeholder-gray-500 focus:outline-hidden focus:border-blue-500/50 transition-colors disabled:opacity-50 text-sm\">\r\n          <button\r\n            type=\"submit\"\r\n            [disabled]=\"!userInput() || aiService.isLoadingModel()\"\r\n            class=\"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-blue-600 hover:bg-blue-500 rounded-lg flex items-center justify-center text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed\">\r\n            <i class=\"fas fa-paper-plane text-xs\"></i>\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  }\r\n", "import { Component, Input } from '@angular/core';\r\nimport { environment } from '../../../environments/environment';\r\n\r\n\r\n@Component({\r\n  selector: 'app-whatsapp-button',\r\n  standalone: true,\r\n  imports: [],\r\n  templateUrl: './whatsapp-button.html',\r\n  styleUrl: './whatsapp-button.css'\r\n})\r\nexport class WhatsappButton {\r\n  @Input() phoneNumber: string = environment.contact.whatsappNumber;\r\n  @Input() defaultMessage: string = 'Hola, necesito información';\r\n\r\n  get encodedMessage(): string {\r\n    return encodeURIComponent(this.defaultMessage);\r\n  }\r\n}", "<div class=\"whatsapp-btn-container\">\r\n    <a class=\"whatsapp-btn\" [href]=\"'https://wa.me/' + phoneNumber + '?text=' + encodedMessage\" target=\"_blank\"\r\n        rel=\"noopener noreferrer\" aria-label=\"Contactar por WhatsApp\">\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\r\n            <path\r\n                d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z\" />\r\n        </svg>\r\n    </a>\r\n    <span class=\"tooltip\">¡Escríbenos!</span>\r\n</div>", "import { Component, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ToastService, Toast } from '@app/shared/services/toast.service';\r\n\r\n@Component({\r\n  selector: 'app-toast',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  template: `\r\n    <div class=\"fixed top-20 right-2 z-9999 flex flex-col gap-2 pointer-events-none max-w-[85vw] sm:max-w-sm w-auto items-end\">\r\n      @for (toast of toastService.toasts(); track toast.id) {\r\n        <div class=\"pointer-events-auto transform transition-all duration-300 animate-slide-in-down cursor-pointer\"\r\n             (click)=\"onToastClick(toast)\">\r\n          <div class=\"flex items-center gap-2 px-3 py-2 rounded-lg shadow-lg border-l-4 overflow-hidden bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 ring-1 ring-black/5\"\r\n               [ngClass]=\"{\r\n                 'border-l-green-500': toast.type === 'success',\r\n                 'border-l-red-500': toast.type === 'error',\r\n                 'border-l-blue-500': toast.type === 'info'\r\n               }\">\r\n             \r\n             <!-- Icon -->\r\n             <div class=\"shrink-0\">\r\n               @if(toast.type === 'success') {\r\n                 <div class=\"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400\">\r\n                    <i class=\"fas fa-check text-sm\"></i>\r\n                 </div>\r\n               } @else if(toast.type === 'error') {\r\n                 <div class=\"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center text-red-600 dark:text-red-400\">\r\n                    <i class=\"fas fa-exclamation text-sm\"></i>\r\n                 </div>\r\n               } @else {\r\n                 <div class=\"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400\">\r\n                    <i class=\"fas fa-info text-sm\"></i>\r\n                 </div>\r\n               }\r\n             </div>\r\n\r\n             <!-- Message -->\r\n             <div class=\"flex flex-col flex-1 min-w-0\">\r\n               <span class=\"font-bold text-xs uppercase tracking-wider\" \r\n                 [ngClass]=\"{\r\n                   'text-green-700 dark:text-green-400': toast.type === 'success',\r\n                   'text-red-700 dark:text-red-400': toast.type === 'error',\r\n                   'text-blue-700 dark:text-blue-400': toast.type === 'info'\r\n                 }\">\r\n                 @if(toast.type === 'success') { Producto Agregado }\r\n                 @else if(toast.type === 'error') { Error }\r\n                 @else { Aviso }\r\n               </span>\r\n               <span class=\"text-sm font-medium text-gray-800 dark:text-gray-100 leading-tight\">{{ toast.message }}</span>\r\n             </div>\r\n\r\n             <!-- Close Button -->\r\n             <button class=\"shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors\">\r\n               <i class=\"fas fa-times text-sm\"></i>\r\n             </button>\r\n          </div>\r\n        </div>\r\n      }\r\n    </div>\r\n  `,\r\n  styles: [`\r\n    @keyframes slideInDown {\r\n      from { transform: translateY(-20px); opacity: 0; }\r\n      to { transform: translateY(0); opacity: 1; }\r\n    }\r\n    .animate-slide-in-down {\r\n      animation: slideInDown 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;\r\n    }\r\n  `]\r\n})\r\nexport class ToastComponent {\r\n  public toastService = inject(ToastService);\r\n\r\n  onToastClick(toast: Toast) {\r\n    if (toast.action) {\r\n      toast.action();\r\n    }\r\n    this.toastService.remove(toast.id);\r\n  }\r\n}\r\n", "import { Component, inject, OnInit, PLATFORM_ID, DOCUMENT } from '@angular/core';\r\nimport { AiAssistant } from './features/ai-assistant/ai-assistant';\r\nimport { RouterOutlet } from '@angular/router';\r\nimport { isPlatformBrowser } from '@angular/common';\r\nimport { WhatsappButton } from './shared/whatsapp-button/whatsapp-button';\r\nimport { ToastComponent } from './shared/components/toast/toast.component';\r\nimport { AnalyticsService } from './core/services/analytics.service';\r\nimport { LoggerService } from './core/services/logger.service';\r\nimport { SeoService } from './core/services/seo.service';\r\nimport { ThemeService } from './core/services/theme.service';\r\nimport { TenantService } from './core/services/tenant.service';\r\n\r\n@Component({\r\n\r\n  selector: 'app-root',\r\n  standalone: true,\r\n  imports: [\r\n    RouterOutlet,\r\n    WhatsappButton,\r\n    ToastComponent,\r\n    AiAssistant\r\n  ],\r\n  templateUrl: './app.html'\r\n})\r\nexport class App implements OnInit {\r\n  private analytics = inject(AnalyticsService);\r\n  private logger = inject(LoggerService);\r\n  private seoService = inject(SeoService);\r\n  private themeService = inject(ThemeService); // Ensures theme is applied before first paint\r\n  private tenantService = inject(TenantService); // Guardián del ecosistema SaaS\r\n  private platformId = inject(PLATFORM_ID);\r\n  private document = inject(DOCUMENT);\r\n\r\n  ngOnInit() {\r\n    this.seoService.initialize();\r\n\r\n    if (isPlatformBrowser(this.platformId)) {\r\n      // 1. Resolver Tenant Context SaaS basado en la URL antes que todo\r\n      const currentHost = this.document.location.hostname;\r\n      this.tenantService.resolveTenantByHostname(currentHost).then(tenant => {\r\n        if (!tenant) {\r\n          this.logger.warn('No SaaS Tenant context found for this domain!');\r\n        }\r\n      });\r\n\r\n      // 2. SEO Redirection Rule Heredada\r\n      if (currentHost === 'celulares.arecofix.com.ar') {\r\n        this.document.location.href = 'https://arecofix.com.ar/celular';\r\n        return;\r\n      }\r\n    }\r\n  }\r\n}", "\r\n<router-outlet />\r\n\r\n<app-whatsapp-button></app-whatsapp-button>\r\n<app-toast></app-toast>\r\n<app-ai-assistant></app-ai-assistant>\r\n", "import { bootstrapApplication } from '@angular/platform-browser';\r\nimport { appConfig } from './app/app.config';\r\nimport { App } from './app/app';\r\nimport { environment } from './environments/environment';\r\nimport { enableProdMode, mergeApplicationConfig, ApplicationConfig } from '@angular/core';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nimport { provideCharts, withDefaultRegisterables } from 'ng2-charts';\r\n\r\n// Browser-specific config (Charts breaks SSR)\r\nconst browserConfig: ApplicationConfig = {\r\n  providers: [\r\n    provideCharts(withDefaultRegisterables()),\r\n  ]\r\n};\r\n\r\n// Bootstrap the app\r\nbootstrapApplication(App, mergeApplicationConfig(appConfig, browserConfig))\r\n  .catch((err) => console.error(err));\r\n"],
  "mappings": "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",
  "names": ["_c0", "_c1"]
}
