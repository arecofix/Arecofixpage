import{a as J}from"./chunk-WOS6GAXU.js";import{a as K}from"./chunk-LR5ULJX7.js";import{b as $,c as v,d as A,e as L,h as j,j as z,k as B,q as H,s as U}from"./chunk-S3P5EQRU.js";import{a as R}from"./chunk-IFDVP5UV.js";import"./chunk-XUGVF5KJ.js";import{c as G,d as M}from"./chunk-A4BZPZBO.js";import"./chunk-KW5XLJRX.js";import"./chunk-6X4SCXZ6.js";import"./chunk-LAXSCOZR.js";import{Ab as _,Cb as o,Da as y,Db as D,Eb as E,Fb as O,Ha as l,Ta as w,X as f,aa as F,ba as P,bb as s,cb as p,fb as N,gb as T,hb as b,ib as t,jb as e,kb as m,na as k,qb as I,sb as q,ub as S,wc as V}from"./chunk-7J724YZS.js";import"./chunk-VOSPIT4N.js";var W=(i,a)=>a.product.id;function X(i,a){i&1&&(t(0,"div",2)(1,"div",4)(2,"div",5),m(3,"i",6),e(),t(4,"h2",7),o(5,"\xA1Orden Recibida!"),e(),t(6,"p"),o(7,"Gracias por tu compra. Nos pondremos en contacto contigo pronto."),e(),t(8,"div",8)(9,"a",9),o(10,"Volver al Inicio"),e()()()())}function Y(i,a){i&1&&(t(0,"p"),o(1,"Tu carrito est\xE1 vac\xEDo."),e(),t(2,"a",27),o(3,"Ir a comprar"),e())}function Z(i,a){if(i&1&&(t(0,"div",29),m(1,"img",32),t(2,"div",33)(3,"h3",34),o(4),e(),t(5,"p",35),o(6),e()(),t(7,"div",34),o(8),e()()),i&2){let n=a.$implicit;l(),b("src",n.product.image_url||(n.product.gallery_urls==null?null:n.product.gallery_urls[0])||"assets/img/no-image.png",y),l(3),D(n.product.name),l(2),O("$",n.product.price," x ",n.quantity),l(2),E(" $",(n.product.price*n.quantity).toFixed(2)," ")}}function ee(i,a){if(i&1&&(t(0,"div",28),N(1,Z,9,5,"div",29,W),e(),m(3,"div",30),t(4,"div",31)(5,"span"),o(6,"Total"),e(),t(7,"span"),o(8),e()()),i&2){let n=S(2);l(),T(n.cartService.cartItems()),l(7),E("$",n.cartService.totalPrice().toFixed(2))}}function te(i,a){i&1&&(t(0,"span",19),o(1,"El nombre es requerido"),e())}function ie(i,a){i&1&&(t(0,"span",19),o(1,"Email inv\xE1lido"),e())}function ne(i,a){i&1&&(t(0,"span",19),o(1,"El tel\xE9fono es requerido"),e())}function oe(i,a){i&1&&(t(0,"span",19),o(1,"La direcci\xF3n es requerida"),e())}function re(i,a){i&1&&m(0,"span",26)}function ae(i,a){if(i&1){let n=I();t(0,"div",3)(1,"div",10)(2,"div",11)(3,"h2",12),o(4,"Resumen del Carrito"),e(),s(5,Y,4,0)(6,ee,9,1),e()(),t(7,"div",13)(8,"div",11)(9,"h2",12),o(10,"Datos del Cliente"),e(),t(11,"form",14),q("ngSubmit",function(){F(n);let u=S();return P(u.placeOrder())}),t(12,"div",15)(13,"label",16)(14,"span",17),o(15,"Nombre Completo"),e()(),m(16,"input",18),s(17,te,2,0,"span",19),e(),t(18,"div",15)(19,"label",16)(20,"span",17),o(21,"Email"),e()(),m(22,"input",20),s(23,ie,2,0,"span",19),e(),t(24,"div",15)(25,"label",16)(26,"span",17),o(27,"Tel\xE9fono"),e()(),m(28,"input",21),s(29,ne,2,0,"span",19),e(),t(30,"div",15)(31,"label",16)(32,"span",17),o(33,"Direcci\xF3n de Env\xEDo"),e()(),m(34,"textarea",22),s(35,oe,2,0,"span",19),e(),t(36,"div",15)(37,"label",16)(38,"span",17),o(39,"Notas (Opcional)"),e()(),m(40,"textarea",23),e(),t(41,"div",24)(42,"button",25),s(43,re,1,0,"span",26),o(44," Confirmar Pedido "),e()()()()()()}if(i&2){let n,d,u,x,c,h,g,C,r=S();l(5),p(r.cartService.cartItems().length===0?5:6),l(6),b("formGroup",r.checkoutForm),l(5),_("input-error",((n=r.checkoutForm.get("name"))==null?null:n.invalid)&&((n=r.checkoutForm.get("name"))==null?null:n.touched)),l(),p((d=r.checkoutForm.get("name"))!=null&&d.invalid&&((d=r.checkoutForm.get("name"))!=null&&d.touched)?17:-1),l(5),_("input-error",((u=r.checkoutForm.get("email"))==null?null:u.invalid)&&((u=r.checkoutForm.get("email"))==null?null:u.touched)),l(),p((x=r.checkoutForm.get("email"))!=null&&x.invalid&&((x=r.checkoutForm.get("email"))!=null&&x.touched)?23:-1),l(5),_("input-error",((c=r.checkoutForm.get("phone"))==null?null:c.invalid)&&((c=r.checkoutForm.get("phone"))==null?null:c.touched)),l(),p((h=r.checkoutForm.get("phone"))!=null&&h.invalid&&((h=r.checkoutForm.get("phone"))!=null&&h.touched)?29:-1),l(5),_("textarea-error",((g=r.checkoutForm.get("address"))==null?null:g.invalid)&&((g=r.checkoutForm.get("address"))==null?null:g.touched)),l(),p((C=r.checkoutForm.get("address"))!=null&&C.invalid&&((C=r.checkoutForm.get("address"))!=null&&C.touched)?35:-1),l(7),b("disabled",r.checkoutForm.invalid||r.isProcessing()||r.cartService.cartItems().length===0),l(),p(r.isProcessing()?43:-1)}}var Q=class i{cartService=f(R);orderService=f(J);fb=f(H);router=f(G);notificationService=f(K);checkoutForm=this.fb.group({name:["",[v.required]],email:["",[v.required,v.email]],phone:["",[v.required]],address:["",[v.required]],notes:[""]});isProcessing=k(!1);orderSuccess=k(!1);async placeOrder(){if(this.checkoutForm.invalid){this.checkoutForm.markAllAsTouched(),this.notificationService.showError("Por favor, completa todos los campos requeridos.");return}this.isProcessing.set(!0);let a=this.checkoutForm.getRawValue(),n=this.cartService.cartItems(),d=this.cartService.totalPrice(),u={customer_name:a.name,customer_email:a.email,customer_phone:a.phone,customer_address:a.address,status:"pending",subtotal:d,tax:0,discount:0,total:d,notes:a.notes},x=n.map(c=>({product_name:c.product.name,product_id:c.product.id,quantity:c.quantity,unit_price:c.product.price,subtotal:c.product.price*c.quantity}));try{let{data:c,error:h}=await this.orderService.createOrder(u,x);if(h)throw h;this.orderSuccess.set(!0),this.cartService.clearCart(),this.notificationService.showSuccess("\xA1Orden creada exitosamente!")}catch(c){console.error("Checkout failed",c),this.notificationService.showError("Hubo un error al procesar tu orden. Por favor intenta nuevamente.")}finally{this.isProcessing.set(!1)}}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=w({type:i,selectors:[["app-checkout-page"]],decls:5,vars:1,consts:[[1,"container","mx-auto","px-4","py-8","max-w-4xl"],[1,"text-3xl","font-bold","mb-8","text-center"],[1,"card","bg-base-100","shadow-xl","text-center","p-10"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"card-body","items-center"],[1,"text-success","text-6xl","mb-4"],[1,"fas","fa-check-circle"],[1,"card-title","text-2xl"],[1,"card-actions","mt-6"],["routerLink","/",1,"btn","btn-primary"],[1,"card","bg-base-100","shadow-xl","h-fit"],[1,"card-body"],[1,"card-title","mb-4"],[1,"card","bg-base-100","shadow-xl"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"form-control","w-full"],[1,"label"],[1,"label-text"],["type","text","formControlName","name",1,"input","input-bordered","w-full"],[1,"text-error","text-xs","mt-1"],["type","email","formControlName","email",1,"input","input-bordered","w-full"],["type","tel","formControlName","phone",1,"input","input-bordered","w-full"],["formControlName","address",1,"textarea","textarea-bordered","h-24","w-full"],["formControlName","notes",1,"textarea","textarea-bordered","w-full"],[1,"mt-6"],["type","submit",1,"btn","btn-primary","btn-block","btn-lg",3,"disabled"],[1,"loading","loading-spinner"],["routerLink","/",1,"btn","btn-link","px-0"],[1,"space-y-4"],[1,"flex","gap-4","items-center"],[1,"divider"],[1,"flex","justify-between","text-xl","font-bold"],[1,"w-16","h-16","object-cover","rounded-lg",3,"src"],[1,"flex-1"],[1,"font-bold"],[1,"text-sm","text-gray-500"]],template:function(n,d){n&1&&(t(0,"div",0)(1,"h1",1),o(2,"Checkout"),e(),s(3,X,11,0,"div",2)(4,ae,45,16,"div",3),e()),n&2&&(l(3),p(d.orderSuccess()?3:4))},dependencies:[V,U,j,$,A,L,B,z,M],encapsulation:2})};export{Q as CheckoutPage};
