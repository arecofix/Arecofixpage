import{a as k}from"./chunk-V2I26IUK.js";import{i as R}from"./chunk-AICXNJUB.js";import{C as x,S as j,W as w,X as I,o as y,p as P,u as _}from"./chunk-UMWLAP3G.js";import{a as S,b as q}from"./chunk-VOSPIT4N.js";var A=class r{constructor(i){this.authService=i;this.supabase=this.authService.getSupabaseClient()}supabase;logger=I(R);getData(i={}){let{_page:t=1,_per_page:a=10,category_id:o,brand_id:p,description:f,featured:s,id:d,name:l,price:m,slug:g}=i,b=(t-1)*a,C=b+a-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return o!=null&&(e=e.eq("category_id",o)),p&&(e=e.eq("brand_id",p)),f&&(e=e.ilike("description",`%${f}%`)),s!=null&&(e=e.eq("is_featured",s)),d&&(e=e.eq("id",d)),l&&(e=e.ilike("name",`%${l}%`)),m&&(e=e.eq("price",m)),g&&(e=e.eq("slug",g)),e=e.range(b,C),y(e).pipe(_(({data:c,count:M,error:v})=>{if(v)throw v;let h=M||0,n=Math.max(1,Math.ceil(h/a)),O=(c||[]).map(u=>q(S({},u),{featured:u?.featured??u?.is_featured??!1}));return{first:1,prev:t>1?t-1:null,next:t<n?t+1:null,last:n,pages:n,items:h,data:O||[]}}),x(c=>(this.logger.error("Supabase product query error",c),P({first:1,prev:null,next:null,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(t){return new(t||r)(w(k))};static \u0275prov=j({token:r,factory:r.\u0275fac,providedIn:"root"})};export{A as a};
