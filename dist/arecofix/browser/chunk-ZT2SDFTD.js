import{a as k}from"./chunk-5GJFSCEY.js";import{i as R}from"./chunk-ZUCCYXWI.js";import{C as x,S as j,W as w,X as I,o as y,p as P,u as _}from"./chunk-JAGY3XSL.js";import{a as S,b as q}from"./chunk-VOSPIT4N.js";var A=class r{constructor(i){this.authService=i;this.supabase=this.authService.getSupabaseClient()}supabase;logger=I(R);getData(i={}){let{_page:t=1,_per_page:a=10,category_id:o,brand_id:d,description:p,featured:s,id:f,name:m,price:l,slug:g}=i,b=(t-1)*a,C=b+a-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return o!=null&&(e=e.eq("category_id",o)),d&&(e=e.eq("brand_id",d)),p&&(e=e.ilike("description",`%${p}%`)),s!=null&&(e=e.eq("is_featured",s)),f&&(e=e.eq("id",f)),m&&(e=e.ilike("name",`%${m}%`)),l&&(e=e.eq("price",l)),g&&(e=e.eq("slug",g)),e=e.range(b,C),y(e).pipe(_(({data:n,count:M,error:v})=>{if(v)throw v;let h=M||0,c=Math.max(1,Math.ceil(h/a)),O=(n||[]).map(u=>q(S({},u),{featured:u?.featured??u?.is_featured??!1}));return{first:1,prev:t>1?t-1:void 0,next:t<c?t+1:void 0,last:c,pages:c,items:h,data:O||[]}}),x(n=>(this.logger.error("Supabase product query error",n),P({first:1,prev:void 0,next:void 0,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(t){return new(t||r)(w(k))};static \u0275prov=j({token:r,factory:r.\u0275fac,providedIn:"root"})};export{A as a};
