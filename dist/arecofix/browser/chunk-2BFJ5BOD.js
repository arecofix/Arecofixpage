import{a as $}from"./chunk-PMGCCAW2.js";import{a as G,b as j,d as q,e as O,f as R,g as U,h as z,i as J,l as K,m as H,n as Q,o as X,p as Y,r as Z}from"./chunk-S3P5EQRU.js";import"./chunk-XUGVF5KJ.js";import{a as B,c as I,d as L}from"./chunk-A4BZPZBO.js";import"./chunk-KW5XLJRX.js";import"./chunk-6X4SCXZ6.js";import"./chunk-LAXSCOZR.js";import{Cb as o,Da as V,Db as E,Eb as T,Gb as u,Ha as l,Hb as p,Ib as y,Ta as A,X as f,aa as s,ba as m,bb as _,cb as w,eb as W,ec as N,fb as C,gb as S,hb as v,ib as r,jb as i,kb as b,na as h,qb as F,sb as k,ub as M,wc as D}from"./chunk-7J724YZS.js";import{a as x,b as P}from"./chunk-VOSPIT4N.js";var ee=(d,t)=>t.id;function re(d,t){if(d&1&&(r(0,"option",18),o(1),i()),d&2){let n=t.$implicit;v("value",n.id),l(),E(n.name)}}function ie(d,t){if(d&1&&(r(0,"option",18),o(1),i()),d&2){let n=t.$implicit;v("value",n.id),l(),E(n.name)}}function ae(d,t){d&1&&(r(0,"span",38),o(1,"Principal"),i())}function ne(d,t){if(d&1){let n=F();r(0,"div",33),b(1,"img",34),r(2,"div",35)(3,"button",36),k("click",function(){let g=s(n).$index,c=M(2);return m(c.removeImage(g))}),b(4,"i",37),i()(),_(5,ae,2,0,"span",38),i()}if(d&2){let n=t.$implicit,e=t.$index;l(),v("src",n,V),l(4),w(e===0?5:-1)}}function oe(d,t){if(d&1&&(r(0,"div",28),C(1,ne,6,2,"div",33,W),i()),d&2){let n=M();l(),S(n.form().images)}}function de(d,t){if(d&1&&(r(0,"div",29),b(1,"i",39),r(2,"span"),o(3),i()()),d&2){let n=M();l(3),E(n.error)}}function le(d,t){d&1&&(b(0,"span",40),o(1," Subiendo... "))}function ge(d,t){d&1&&(b(0,"span",40),o(1," Guardando... "))}function se(d,t){d&1&&o(0," Guardar Producto ")}var te=class d{route=f(B);router=f(I);productService=f($);cdr=f(N);id=null;form=h({sku:"",barcode:"",name:"",slug:"",description:"",price:0,stock:0,brand_id:"",category_id:"",is_active:!0,images:[]});brands=h([]);categories=h([]);loading=!0;saving=!1;uploading=h(!1);error=null;async ngOnInit(){try{let[t,n]=await Promise.all([this.productService.getBrands(),this.productService.getCategories()]);if(this.brands.set(t),this.categories.set(n),this.id=this.route.snapshot.paramMap.get("id"),this.id){let e=await this.productService.getProduct(this.id);e&&this.form.set({sku:e.sku||"",barcode:e.barcode||"",name:e.name||"",slug:e.slug||"",description:e.description||"",price:e.price||0,stock:e.stock||0,brand_id:e.brand_id||"",category_id:e.category_id||"",is_active:e.is_active??!0,images:e.gallery_urls||(e.image_url?[e.image_url]:[])})}}catch(t){this.error=t.message||"Error al cargar datos"}finally{this.loading=!1,this.cdr.markForCheck()}}async onFileChange(t){let n=t.target.files?.[0];if(n){this.uploading.set(!0);try{let e=await this.productService.uploadImage(n);this.form.update(g=>P(x({},g),{images:[...g.images,e]}))}catch(e){this.error=e.message}finally{this.uploading.set(!1),this.cdr.markForCheck()}}}removeImage(t){this.form.update(n=>P(x({},n),{images:n.images.filter((e,g)=>g!==t)})),this.cdr.markForCheck()}generateBarcode(){let t=this.form().sku,n=t||`GEN-${Date.now()}`;this.form.update(e=>P(x({},e),{barcode:n}))}async save(){this.saving=!0,this.error=null;let t=this.form(),n=t.slug;n||(n=this.productService.slugify(t.name));let e={sku:t.sku,barcode:t.barcode,name:t.name,slug:n,description:t.description,price:t.price,stock:t.stock,brand_id:t.brand_id||null,category_id:t.category_id||null,is_active:t.is_active,gallery_urls:Array.isArray(t.images)?t.images:[],image_url:t.images.length>0?t.images[0]:null};try{this.id?await this.productService.updateProduct(this.id,e):await this.productService.createProduct(e),this.router.navigate(["/admin/products"])}catch(g){this.error=g.message||"Error al guardar producto"}finally{this.saving=!1,this.cdr.markForCheck()}}static \u0275fac=function(n){return new(n||d)};static \u0275cmp=A({type:d,selectors:[["app-admin-product-form-page"]],decls:84,vars:14,consts:[["f","ngForm"],[1,"max-w-4xl","mx-auto","text-gray-800","dark:text-white"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white"],[3,"ngSubmit"],[1,"bg-white","dark:bg-gray-800","p-6","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","mb-6"],[1,"text-lg","font-semibold","mb-4","text-gray-800","dark:text-white","border-b","dark:border-gray-700","pb-2"],[1,"mb-4"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1.5"],["type","text","name","name","placeholder","Ej: iPhone 13 Pro Max","required","",1,"w-full","bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","border","border-gray-300","dark:border-gray-600","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400","dark:hover:border-gray-500",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["type","text","name","sku","placeholder","C\xF3digo interno",1,"w-full","bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","border","border-gray-300","dark:border-gray-600","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400","dark:hover:border-gray-500",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],["type","text","name","barcode","placeholder","EAN / UPC",1,"w-full","bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","border","border-gray-300","dark:border-gray-600","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400","dark:hover:border-gray-500",3,"ngModelChange","ngModel"],["type","button","title","Generar c\xF3digo aleatorio",1,"btn","btn-square","btn-outline",3,"click"],[1,"fas","fa-random"],["name","brand_id",1,"w-full","bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","border","border-gray-300","dark:border-gray-600","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400","dark:hover:border-gray-500",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["name","category_id",1,"w-full","bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","border","border-gray-300","dark:border-gray-600","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400","dark:hover:border-gray-500",3,"ngModelChange","ngModel"],["name","description","rows","4","placeholder","Detalles t\xE9cnicos, caracter\xEDsticas...",1,"w-full","bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","border","border-gray-300","dark:border-gray-600","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400","dark:hover:border-gray-500",3,"ngModelChange","ngModel"],["type","number","name","price","required","","min","0",1,"w-full","bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","border","border-gray-300","dark:border-gray-600","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400","dark:hover:border-gray-500",3,"ngModelChange","ngModel"],["type","number","name","stock","min","0",1,"w-full","bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","border","border-gray-300","dark:border-gray-600","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400","dark:hover:border-gray-500",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-3","p-3","bg-white","dark:bg-gray-700","border","border-gray-200","dark:border-gray-600","rounded-lg","hover:bg-gray-50","dark:hover:bg-gray-600","transition-colors","cursor-pointer","w-fit"],["type","checkbox","name","is_active",1,"checkbox","checkbox-primary","h-5","w-5","rounded","border-gray-300","dark:border-gray-500",3,"ngModelChange","ngModel"],[1,"font-medium","text-gray-700","dark:text-gray-300"],["type","file","accept","image/*","multiple","",1,"file-input","file-input-bordered","file-input-primary","w-full","bg-white","dark:bg-gray-700","text-gray-700","dark:text-gray-300",3,"change"],[1,"text-sm","text-gray-500","dark:text-gray-400","mt-2"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mt-6"],[1,"alert","alert-error","mb-6"],[1,"flex","gap-4","justify-end"],["routerLink","/admin/products",1,"btn","btn-ghost","text-gray-700","dark:text-gray-300"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"relative","group","aspect-square"],[1,"w-full","h-full","object-cover","rounded-lg","border","border-gray-200","dark:border-gray-600","shadow-sm",3,"src"],[1,"absolute","inset-0","bg-black/40","opacity-0","group-hover:opacity-100","transition-opacity","rounded-lg","flex","items-center","justify-center"],["type","button",1,"btn","btn-circle","btn-error","btn-sm","text-white",3,"click"],[1,"fas","fa-trash"],[1,"absolute","bottom-2","left-2","badge","badge-primary","badge-sm","shadow-md"],[1,"fas","fa-exclamation-circle"],[1,"loading","loading-spinner","loading-xs","mr-2"]],template:function(n,e){if(n&1){let g=F();r(0,"div",1)(1,"div",2)(2,"h2",3),o(3),i()(),r(4,"form",4,0),k("ngSubmit",function(){return s(g),m(e.save())}),r(6,"div",5)(7,"h3",6),o(8,"Informaci\xF3n B\xE1sica"),i(),r(9,"div",7)(10,"label",8),o(11,"Nombre del Producto"),i(),r(12,"input",9),y("ngModelChange",function(a){return s(g),p(e.form().name,a)||(e.form().name=a),m(a)}),i()(),r(13,"div",10)(14,"div")(15,"label",8),o(16,"SKU"),i(),r(17,"input",11),y("ngModelChange",function(a){return s(g),p(e.form().sku,a)||(e.form().sku=a),m(a)}),i()(),r(18,"div")(19,"label",8),o(20,"C\xF3digo de Barras"),i(),r(21,"div",12)(22,"input",13),y("ngModelChange",function(a){return s(g),p(e.form().barcode,a)||(e.form().barcode=a),m(a)}),i(),r(23,"button",14),k("click",function(){return s(g),m(e.generateBarcode())}),b(24,"i",15),i()()()()(),r(25,"div",5)(26,"h3",6),o(27,"Categorizaci\xF3n"),i(),r(28,"div",10)(29,"div")(30,"label",8),o(31,"Marca"),i(),r(32,"select",16),y("ngModelChange",function(a){return s(g),p(e.form().brand_id,a)||(e.form().brand_id=a),m(a)}),r(33,"option",17),o(34,"Seleccionar Marca"),i(),C(35,re,2,2,"option",18,ee),i()(),r(37,"div")(38,"label",8),o(39,"Categor\xEDa"),i(),r(40,"select",19),y("ngModelChange",function(a){return s(g),p(e.form().category_id,a)||(e.form().category_id=a),m(a)}),r(41,"option",17),o(42,"Seleccionar Categor\xEDa"),i(),C(43,ie,2,2,"option",18,ee),i()()()(),r(45,"div",5)(46,"h3",6),o(47,"Detalles"),i(),r(48,"div",7)(49,"label",8),o(50,"Descripci\xF3n"),i(),r(51,"textarea",20),y("ngModelChange",function(a){return s(g),p(e.form().description,a)||(e.form().description=a),m(a)}),i()(),r(52,"div",10)(53,"div")(54,"label",8),o(55,"Precio ($)"),i(),r(56,"input",21),y("ngModelChange",function(a){return s(g),p(e.form().price,a)||(e.form().price=a),m(a)}),i()(),r(57,"div")(58,"label",8),o(59,"Stock"),i(),r(60,"input",22),y("ngModelChange",function(a){return s(g),p(e.form().stock,a)||(e.form().stock=a),m(a)}),i()()()(),r(61,"div",5)(62,"label",23)(63,"input",24),y("ngModelChange",function(a){return s(g),p(e.form().is_active,a)||(e.form().is_active=a),m(a)}),i(),r(64,"span",25),o(65,"Producto Activo"),i()()(),r(66,"div",5)(67,"h3",6),o(68,"Galer\xEDa de Im\xE1genes"),i(),r(69,"div",7)(70,"label",8),o(71,"Subir Im\xE1genes"),i(),r(72,"input",26),k("change",function(a){return s(g),m(e.onFileChange(a))}),i(),r(73,"p",27),o(74,"Formatos soportados: JPG, PNG, WEBP."),i()(),_(75,oe,3,0,"div",28),i(),_(76,de,4,1,"div",29),r(77,"div",30)(78,"a",31),o(79,"Cancelar"),i(),r(80,"button",32),_(81,le,2,0)(82,ge,2,0)(83,se,1,0),i()()()()}n&2&&(l(3),T("",e.id?"Editar":"Nuevo"," Producto"),l(9),u("ngModel",e.form().name),l(5),u("ngModel",e.form().sku),l(5),u("ngModel",e.form().barcode),l(10),u("ngModel",e.form().brand_id),l(3),S(e.brands()),l(5),u("ngModel",e.form().category_id),l(3),S(e.categories()),l(8),u("ngModel",e.form().description),l(5),u("ngModel",e.form().price),l(4),u("ngModel",e.form().stock),l(3),u("ngModel",e.form().is_active),l(12),w(e.form().images.length>0?75:-1),l(),w(e.error?76:-1),l(4),v("disabled",e.saving||e.uploading()),l(),w(e.uploading()?81:e.saving?82:83))},dependencies:[D,Z,z,H,Q,j,J,G,K,q,O,Y,X,U,R,L],encapsulation:2,changeDetection:0})};export{te as AdminProductFormPage};
