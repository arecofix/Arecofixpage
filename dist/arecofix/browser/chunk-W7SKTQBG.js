import{a as b}from"./chunk-FDEIW4RV.js";import{C as d,R as p,V as l,o as i,u as n}from"./chunk-CVZCBU36.js";import{a as s,b as o}from"./chunk-VOSPIT4N.js";var f=class a{constructor(r){this.authService=r;this.supabase=this.authService.getSupabaseClient()}supabase;getOrders(){return i(this.supabase.from("orders").select("*").order("created_at",{ascending:!1})).pipe(n(({data:r,error:e})=>{if(e)throw e;return r||[]}),d(r=>{throw console.error("Error fetching orders:",r),r}))}getOrderById(r){return i(Promise.all([this.supabase.from("orders").select("*").eq("id",r).single(),this.supabase.from("order_items").select("*").eq("order_id",r)])).pipe(n(([e,t])=>{if(e.error)throw e.error;if(t.error)throw t.error;return o(s({},e.data),{items:t.data||[]})}),d(e=>{throw console.error("Error fetching order:",e),e}))}async createOrder(r,e){try{let t=`ORD-${Date.now()}`,{data:c,error:u}=await this.supabase.from("orders").insert(o(s({},r),{order_number:t,total_amount:r.total,customer_address:r.customer_address})).select().single();if(u)throw u;let g=e.map(h=>o(s({},h),{order_id:c.id})),{error:m}=await this.supabase.from("order_items").insert(g);if(m)throw m;return{data:c,error:null}}catch(t){return console.error("Error creating order:",t),{data:null,error:t}}}async updateOrderStatus(r,e){let{error:t}=await this.supabase.from("orders").update({status:e,updated_at:new Date().toISOString()}).eq("id",r);return{error:t}}async deleteOrder(r){let{error:e}=await this.supabase.from("orders").delete().eq("id",r);return{error:e}}static \u0275fac=function(e){return new(e||a)(l(b))};static \u0275prov=p({token:a,factory:a.\u0275fac,providedIn:"root"})};export{f as a};
