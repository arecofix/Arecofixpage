import{a as ae}from"./chunk-CT2O6UG6.js";import{a as re}from"./chunk-L2EDD4XH.js";import"./chunk-JYOT3LNB.js";import{b as X,d as Y,g as Z,l as ee,m as te,n as ie,s as ne}from"./chunk-7KJYGRRN.js";import{a as U}from"./chunk-F5WBDNED.js";import"./chunk-F4YL3ILH.js";import{B as K,c as q,e as H,h as z,j as G,l as J}from"./chunk-RVT6AV4G.js";import{$ as M,Ab as t,Bb as i,Cb as s,Fc as W,Ib as A,Mb as _,Ob as g,Ua as a,Vb as R,W as S,Xb as d,Yb as p,Zb as u,aa as T,gb as V,jb as C,jc as k,lb as $,ma as f,nc as x,oc as h,pc as I,rc as Q,tb as b,ub as v,xb as E,xc as y,yb as P,zb as c}from"./chunk-G4WDTWI7.js";import{a as L,b as B}from"./chunk-7CGTOI24.js";var O=class r{transform(n){return n?{pending:"A Pagar",processing:"Abonado",completed:"Completado",cancelled:"Cancelado"}[n]||n:""}static \u0275fac=function(e){return new(e||r)};static \u0275pipe=C({name:"orderStatus",type:r,pure:!0})};var w=class r{transform(n){return n&&{pending:"badge-error",processing:"badge-success",completed:"badge-success",cancelled:"badge-error",deleted:"badge-ghost"}[n]||"badge-ghost"}static \u0275fac=function(e){return new(e||r)};static \u0275pipe=C({name:"statusColor",type:r,pure:!0})};var le=r=>["/admin/orders",r],se=r=>["/admin/orders",r,"edit"],D=(r,n)=>n.id;function ce(r,n){r&1&&(t(0,"div",40),s(1,"span",42),i())}function me(r,n){if(r&1&&(t(0,"div",41),s(1,"i",43),t(2,"span"),d(3),i()()),r&2){let e=g();a(3),p(e.error())}}function pe(r,n){if(r&1&&(t(0,"span",67),d(1),i()),r&2){let e=g(2).$implicit;a(),u("+",e.items.length-1," m\xE1s")}}function ge(r,n){if(r&1&&(t(0,"span",66),d(1),i(),d(2),b(3,pe,2,1,"span",67)),r&2){let e=g().$implicit;a(),u("",e.items[0].quantity,"x"),a(),u(" ",e.items[0].product_name," "),a(),v(e.items.length>1?3:-1)}}function ue(r,n){r&1&&(t(0,"span",58),d(1,"Sin items"),i())}function xe(r,n){if(r&1){let e=A();t(0,"button",68),_("click",function(){M(e);let m=g().$implicit,l=g(2);return T(l.toggleOrderStatus(m))}),s(1,"i",69),i()}}function fe(r,n){if(r&1&&(t(0,"tr",49)(1,"td",54),d(2),i(),t(3,"td")(4,"div",55),d(5),i(),t(6,"div",56),d(7),i()(),t(8,"td")(9,"div",57),b(10,ge,4,3)(11,ue,2,0,"span",58),i()(),t(12,"td",55),d(13),x(14,"currency"),i(),t(15,"td")(16,"span",59),x(17,"statusColor"),d(18),x(19,"orderStatus"),i()(),t(20,"td",56),d(21),x(22,"date"),i(),t(23,"td",48)(24,"div",60),b(25,xe,2,0,"button",61),t(26,"a",62),s(27,"i",63),i(),t(28,"a",64),s(29,"i",65),i()()()()),r&2){let e=n.$implicit;a(2),p(e.order_number),a(3),p(e.customer_name),a(2),p(e.customer_email),a(3),v(e.items&&e.items.length>0?10:11),a(3),u(" ",h(14,11,e.total)," "),a(3),c("ngClass",h(17,13,e.status)),a(2),u(" ",h(19,15,e.status)," "),a(3),u(" ",I(22,17,e.created_at,"dd MMM yyyy, HH:mm")," "),a(4),v(e.status==="pending"?25:-1),a(),c("routerLink",k(20,le,e.id)),a(2),c("routerLink",k(22,se,e.id))}}function _e(r,n){if(r&1&&(t(0,"li",78)(1,"span",85)(2,"span",66),d(3),i(),d(4),i()()),r&2){let e=n.$implicit;a(3),u("",e.quantity,"x"),a(),u(" ",e.product_name)}}function be(r,n){if(r&1&&(t(0,"li",79),d(1),i()),r&2){let e=g().$implicit;a(),u("+",e.items.length-2," productos m\xE1s...")}}function ve(r,n){if(r&1){let e=A();t(0,"button",86),_("click",function(){M(e);let m=g().$implicit,l=g(2);return T(l.toggleOrderStatus(m))}),s(1,"i",87),i()}}function he(r,n){if(r&1&&(t(0,"div",51)(1,"div",70)(2,"div",71)(3,"div",72)(4,"span",73),d(5),i(),t(6,"span",74),d(7),x(8,"date"),i()(),t(9,"div",75),x(10,"statusColor"),d(11),x(12,"orderStatus"),i()(),t(13,"h3",55),d(14),i(),t(15,"div",76)(16,"ul",77),E(17,_e,5,2,"li",78,D),b(19,be,2,1,"li",79),i()(),t(20,"div",80)(21,"span",81),d(22),x(23,"currency"),i(),t(24,"div",82)(25,"a",83),d(26,"Ver"),i(),b(27,ve,2,0,"button",84),i()()()()),r&2){let e=n.$implicit;a(5),p(e.order_number),a(2),p(I(8,9,e.created_at,"short")),a(2),c("ngClass",h(10,12,e.status)),a(2),u(" ",h(12,14,e.status)," "),a(3),p(e.customer_name),a(3),P(e.items.slice(0,2)),a(2),v(e.items&&e.items.length>2?19:-1),a(3),p(h(23,16,e.total)),a(3),c("routerLink",k(18,le,e.id)),a(2),v(e.status==="pending"?27:-1)}}function ye(r,n){if(r&1&&(t(0,"div",88),s(1,"pagination",89),i()),r&2){let e=g(2);a(),c("pages",e.totalPages())("currentPage",e.currentPage())}}function Se(r,n){r&1&&(t(0,"div",53),s(1,"i",90),t(2,"p"),d(3,"No se encontraron pedidos."),i()())}function Ce(r,n){if(r&1&&(t(0,"div",44)(1,"table",45)(2,"thead",46)(3,"tr",47)(4,"th"),d(5,"Pedido"),i(),t(6,"th"),d(7,"Cliente"),i(),t(8,"th"),d(9,"Productos"),i(),t(10,"th"),d(11,"Total"),i(),t(12,"th"),d(13,"Estado"),i(),t(14,"th"),d(15,"Fecha"),i(),t(16,"th",48),d(17,"Acciones"),i()()(),t(18,"tbody"),E(19,fe,30,24,"tr",49,D),i()()(),t(21,"div",50),E(22,he,28,20,"div",51,D),i(),$(24,ye,2,2,"div",52),b(25,Se,4,0,"div",53)),r&2){let e=g();a(19),P(e.paginatedOrders()),a(3),P(e.paginatedOrders()),a(2),c("ngIf",e.filteredOrders().length>0),a(),v(e.filteredOrders().length===0?25:-1)}}var oe=class r{orderService=S(ae);logger=S(U);cdr=S(W);orders=f([]);loading=f(!0);error=f(null);searchQuery=f("");filterStatus=f("all");sortOrder=f("date_desc");currentPage=f(1);itemsPerPage=f(10);filteredOrders=y(()=>{let n=this.orders(),e=this.searchQuery().toLowerCase(),o=this.filterStatus();o!=="all"&&(n=n.filter(l=>l.status===o)),e&&(n=n.filter(l=>l.order_number?.toLowerCase().includes(e)||l.customer_name?.toLowerCase().includes(e)||l.customer_email?.toLowerCase().includes(e)));let m=this.sortOrder();return n.sort((l,F)=>{let N=new Date(l.created_at||0).getTime(),j=new Date(F.created_at||0).getTime();switch(m){case"date_asc":return N-j;case"date_desc":return j-N;case"total_desc":return(F.total||0)-(l.total||0);default:return 0}})});paginatedOrders=y(()=>{let n=this.filteredOrders(),e=(this.currentPage()-1)*this.itemsPerPage();return n.slice(e,e+this.itemsPerPage())});totalPages=y(()=>Math.ceil(this.filteredOrders().length/this.itemsPerPage()));stats=y(()=>{let n=this.orders();return{total:n.length,pending:n.filter(e=>e.status==="pending").length,completed:n.filter(e=>e.status==="completed").length,revenue:n.filter(e=>e.status!=="cancelled").reduce((e,o)=>e+(o.total||0),0)}});async ngOnInit(){this.loadOrders()}loadOrders(){this.loading.set(!0),this.orderService.getOrders().subscribe({next:n=>{this.orders.set(n),this.loading.set(!1)},error:n=>{this.error.set(n.message||"Error al cargar pedidos"),this.loading.set(!1)}})}async toggleOrderStatus(n){if(n.status!=="pending"&&n.status!=="processing")return;let e=n.status==="pending"?"processing":"pending";try{let{error:o}=await this.orderService.updateOrderStatus(n.id,e);if(o)throw o;this.orders.update(m=>m.map(l=>l.id===n.id?B(L({},l),{status:e}):l))}catch(o){this.logger.error("Error updating status:",o),alert("Error al actualizar el estado del pedido")}}updateSort(n){let e=n.target.value;this.sortOrder.set(e)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=V({type:r,selectors:[["app-admin-orders-page"]],decls:66,vars:18,consts:[[1,"max-w-7xl","mx-auto","pb-20","p-4"],[1,"flex","flex-col","md:flex-row","justify-between","items-start","md:items-center","py-6","gap-4","border-b","border-gray-200","dark:border-gray-800","mb-6"],[1,"text-3xl","font-bold","text-gray-800","dark:text-white","flex","items-center","gap-3"],[1,"fas","fa-shopping-bag","text-green-500"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["routerLink","/admin/orders/new",1,"btn","btn-primary","shadow-lg","shadow-green-500/20"],[1,"fas","fa-plus","mr-2"],[1,"grid","grid-cols-2","lg:grid-cols-4","gap-4","mb-8"],[1,"stats","shadow","bg-white","dark:bg-gray-800","border","border-gray-100","dark:border-gray-700"],[1,"stat"],[1,"stat-figure","text-primary"],[1,"fas","fa-list-alt","text-3xl","opacity-50"],[1,"stat-title","text-xs","uppercase","tracking-wider"],[1,"stat-value","text-primary"],[1,"stat-figure","text-warning"],[1,"fas","fa-clock","text-3xl","opacity-50"],[1,"stat-title","text-xs","uppercase","tracking-wider","text-warning"],[1,"stat-value","text-warning"],[1,"stat-figure","text-success"],[1,"fas","fa-check-circle","text-3xl","opacity-50"],[1,"stat-title","text-xs","uppercase","tracking-wider","text-success"],[1,"stat-value","text-success"],[1,"stat-figure","text-info"],[1,"fas","fa-dollar-sign","text-3xl","opacity-50"],[1,"stat-value","text-info","text-2xl","overflow-hidden","text-ellipsis"],[1,"flex","flex-col","lg:flex-row","gap-4","mb-6","bg-white","dark:bg-gray-800","p-4","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700"],[1,"flex-1"],[1,"relative"],[1,"fas","fa-search","absolute","left-4","top-1/2","-translate-y-1/2","text-gray-400"],["type","text","placeholder","Buscar cliente, n\xFAmero de pedido...",1,"input","input-bordered","w-full","pl-10",3,"ngModelChange","ngModel"],[1,"overflow-x-auto","pb-2","lg:pb-0"],[1,"join"],["type","radio","name","status","aria-label","Todos",1,"join-item","btn",3,"click","checked"],["type","radio","name","status","aria-label","Pendientes",1,"join-item","btn",3,"click","checked"],["type","radio","name","status","aria-label","Procesando",1,"join-item","btn",3,"click","checked"],["type","radio","name","status","aria-label","Completados",1,"join-item","btn",3,"click","checked"],[1,"select","select-bordered","w-full","lg:w-auto",3,"change","ngModel"],["value","date_desc"],["value","date_asc"],["value","total_desc"],[1,"flex","justify-center","p-12"],[1,"alert","alert-error"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"fas","fa-exclamation-triangle"],[1,"hidden","md:block","bg-white","dark:bg-gray-800","rounded-xl","shadow-lg","overflow-hidden","border","border-gray-100","dark:border-gray-700"],[1,"table","w-full"],[1,"bg-gray-50","dark:bg-gray-700/50"],[1,"text-gray-600","dark:text-gray-300","font-bold","uppercase","text-xs","tracking-wider"],[1,"text-right"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/30","transition-colors"],[1,"md:hidden","grid","grid-cols-1","gap-4"],[1,"card","bg-white","dark:bg-gray-800","shadow-sm","border","border-gray-100","dark:border-gray-700"],["class","mt-8 flex justify-center pb-8",4,"ngIf"],[1,"text-center","py-20","opacity-50"],[1,"font-mono","font-bold","text-primary"],[1,"font-bold","text-gray-900","dark:text-white"],[1,"text-xs","text-gray-500"],[1,"text-sm","max-w-xs","truncate"],[1,"italic","text-gray-400"],[1,"badge","badge-sm","font-semibold","border-0",3,"ngClass"],[1,"flex","justify-end","gap-2"],["data-tip","Marcar Pagado",1,"btn","btn-sm","btn-ghost","text-green-500","tooltip"],["data-tip","Ver Detalle",1,"btn","btn-sm","btn-ghost","text-gray-500","tooltip",3,"routerLink"],[1,"fas","fa-eye"],["data-tip","Editar",1,"btn","btn-sm","btn-ghost","text-indigo-500","tooltip",3,"routerLink"],[1,"fas","fa-pen"],[1,"font-bold"],[1,"badge","badge-xs","badge-ghost"],["data-tip","Marcar Pagado",1,"btn","btn-sm","btn-ghost","text-green-500","tooltip",3,"click"],[1,"fas","fa-check-dollar"],[1,"card-body","p-4"],[1,"flex","justify-between","items-start","mb-2"],[1,"flex","flex-col"],[1,"font-mono","text-xs","font-bold","text-primary"],[1,"text-xs","text-gray-400"],[1,"badge","badge-sm","border-0","font-bold",3,"ngClass"],[1,"py-2","border-y","border-dashed","border-gray-200","dark:border-gray-700","my-2"],[1,"text-sm","space-y-1"],[1,"flex","justify-between"],[1,"text-xs","text-gray-400","italic"],[1,"flex","justify-between","items-center","mt-2"],[1,"text-xl","font-bold","text-gray-900","dark:text-white"],[1,"flex","gap-2"],[1,"btn","btn-sm","btn-outline","btn-ghost",3,"routerLink"],[1,"btn","btn-sm","btn-success","text-white","px-4"],[1,"truncate","pr-2"],[1,"btn","btn-sm","btn-success","text-white","px-4",3,"click"],[1,"fas","fa-check"],[1,"mt-8","flex","justify-center","pb-8"],[3,"pages","currentPage"],[1,"fas","fa-shopping-bag","text-4xl","mb-3"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),s(4,"i",3),d(5," Pedidos "),i(),t(6,"p",4),d(7,"Gestiona las \xF3rdenes de compra de tus clientes."),i()(),t(8,"a",5),s(9,"i",6),d(10," Nuevo Pedido "),i()(),t(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),s(15,"i",11),i(),t(16,"div",12),d(17,"Total Pedidos"),i(),t(18,"div",13),d(19),i()()(),t(20,"div",8)(21,"div",9)(22,"div",14),s(23,"i",15),i(),t(24,"div",16),d(25,"Pendientes"),i(),t(26,"div",17),d(27),i()()(),t(28,"div",8)(29,"div",9)(30,"div",18),s(31,"i",19),i(),t(32,"div",20),d(33,"Completados"),i(),t(34,"div",21),d(35),i()()(),t(36,"div",8)(37,"div",9)(38,"div",22),s(39,"i",23),i(),t(40,"div",12),d(41,"Ingresos Totales"),i(),t(42,"div",24),d(43),x(44,"currency"),i()()()(),t(45,"div",25)(46,"div",26)(47,"div",27),s(48,"i",28),t(49,"input",29),_("ngModelChange",function(l){return o.searchQuery.set(l)}),i()()(),t(50,"div",30)(51,"div",31)(52,"input",32),_("click",function(){return o.filterStatus.set("all")}),i(),t(53,"input",33),_("click",function(){return o.filterStatus.set("pending")}),i(),t(54,"input",34),_("click",function(){return o.filterStatus.set("processing")}),i(),t(55,"input",35),_("click",function(){return o.filterStatus.set("completed")}),i()()(),t(56,"select",36),_("change",function(l){return o.updateSort(l)}),t(57,"option",37),d(58,"M\xE1s Recientes"),i(),t(59,"option",38),d(60,"M\xE1s Antiguos"),i(),t(61,"option",39),d(62,"Mayor Monto"),i()()(),b(63,ce,2,0,"div",40)(64,me,4,1,"div",41)(65,Ce,26,2),i()),e&2&&(a(19),p(o.stats().total),a(),R("border-warning",o.stats().pending>0),a(7),p(o.stats().pending),a(8),p(o.stats().completed),a(8),p(Q(44,13,o.stats().revenue,"ARS","symbol","1.0-0")),a(6),c("ngModel",o.searchQuery()),a(3),c("checked",o.filterStatus()==="all"),a(),c("checked",o.filterStatus()==="pending"),a(),c("checked",o.filterStatus()==="processing"),a(),c("checked",o.filterStatus()==="completed"),a(),c("ngModel",o.sortOrder()),a(7),v(o.loading()?63:o.error()?64:65))},dependencies:[K,J,q,H,re,ne,te,ie,X,ee,Y,Z,G,z,O,w],encapsulation:2,changeDetection:0})};export{oe as AdminOrdersPage};
