import{a as L}from"./chunk-ATCUCWKC.js";import{a as P,b as k,c as l,d as q,e as D,h as T,i as j,j as R,k as V,l as M,m as O,n as U,r as B,t as G}from"./chunk-LSPUXVBI.js";import{a as I}from"./chunk-4HXPTVC3.js";import"./chunk-773BQMTG.js";import"./chunk-NIOBXWFE.js";import{b as N,d as w,e as A}from"./chunk-755N3HP6.js";import{o as F}from"./chunk-P77MY6VE.js";import{Bb as b,Cb as t,Db as e,Eb as o,Ec as y,Ob as h,Qb as _,Ra as E,Wa as m,Y as c,Yb as i,_b as v,ib as S,vb as g,wb as f}from"./chunk-OOA6GWW3.js";import"./chunk-7CGTOI24.js";function J(s,r){s&1&&(t(0,"span",15),i(1,"El t\xEDtulo es requerido"),e())}function K(s,r){if(s&1&&(t(0,"div",37),o(1,"img",43),e()),s&2){let a,n=_();m(),b("src",n.getImageSrc((a=n.form.get("image_url"))==null?null:a.value),E)}}function Q(s,r){s&1&&o(0,"span",42)}var z=class s{fb=c(B);coursesService=c(L);router=c(w);route=c(N);auth=c(I);cdr=c(y);form;isEditing=!1;courseId=null;saving=!1;constructor(){this.form=this.fb.group({title:["",l.required],slug:["",l.required],description:["",l.required],price:[0,[l.required,l.min(0)]],sale_price:[null],level:["B\xE1sico",l.required],duration:["",l.required],schedule:["",l.required],image_url:["",l.required],is_active:[!0]})}ngOnInit(){this.courseId=this.route.snapshot.paramMap.get("id"),this.courseId&&(this.isEditing=!0,this.loadCourse(this.courseId))}getImageSrc(r){return r?r.startsWith("http")||r.startsWith("/")?r:"/"+r:""}async onFileChange(r){let a=r.target.files?.[0];if(!a)return;this.saving=!0,this.cdr.markForCheck();let n=this.auth.getSupabaseClient(),d=a.name.split(".").pop(),x=`courses/${`${Date.now()}_${Math.random().toString(36).substring(2)}.${d}`}`;try{let p=new Promise((Y,H)=>setTimeout(()=>H(new Error("Tiempo de espera agotado al subir la imagen")),15e3)),$=n.storage.from("public-assets").upload(x,a),{data:X,error:C}=await Promise.race([$,p]);if(C)throw C;let{data:W}=n.storage.from("public-assets").getPublicUrl(x);this.form.patchValue({image_url:W.publicUrl}),this.cdr.markForCheck()}catch(p){console.error("Error uploading image:",p),alert("Error al subir la imagen: "+(p.message||p))}finally{this.saving=!1,this.cdr.markForCheck(),r.target&&(r.target.value="")}}loadCourse(r){this.coursesService.getCourseById(r).subscribe({next:a=>{a.data&&this.form.patchValue(a.data)},error:a=>console.error("Error loading course",a)})}save(){if(this.form.invalid){this.form.markAllAsTouched(),alert("Por favor completa todos los campos requeridos");return}this.saving=!0;let r=this.form.value;(this.isEditing&&this.courseId?this.coursesService.updateCourse(this.courseId,r):this.coursesService.createCourse(r)).subscribe({next:()=>{this.saving=!1,this.router.navigate(["/admin/courses"])},error:n=>{console.error("Error saving course",n),alert("Error al guardar: "+n.message),this.saving=!1}})}static \u0275fac=function(a){return new(a||s)};static \u0275cmp=S({type:s,selectors:[["app-admin-course-form-page"]],decls:101,vars:7,consts:[[1,"max-w-4xl","mx-auto"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-base-content"],["routerLink","/admin/courses",1,"btn","btn-ghost","text-base-content"],[1,"fas","fa-arrow-left","mr-2"],[1,"card","bg-base-100","shadow-xl","border","border-base-200"],[1,"card-body","p-8"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"form-control"],[1,"label"],[1,"label-text","font-medium","text-base-content/80"],[1,"input","input-bordered","flex","items-center","gap-2","bg-base-100","text-base-content"],[1,"fas","fa-heading","text-base-content/50"],["type","text","formControlName","title","placeholder","Ej: Reparaci\xF3n de iPhone",1,"grow","placeholder:text-base-content/30"],[1,"text-error","text-xs","mt-1"],[1,"fas","fa-link","text-base-content/50"],["type","text","formControlName","slug","placeholder","ej: reparacion-iphone",1,"grow","placeholder:text-base-content/30"],[1,"label-text-alt","text-xs","text-base-content/50"],["formControlName","description","placeholder","Breve resumen del curso...",1,"textarea","textarea-bordered","h-24","leading-relaxed","bg-base-100","text-base-content","placeholder:text-base-content/30"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"fas","fa-dollar-sign","text-base-content/50"],["type","number","formControlName","price",1,"grow","placeholder:text-base-content/30"],[1,"fas","fa-tag","text-base-content/50"],["type","number","formControlName","sale_price",1,"grow","placeholder:text-base-content/30"],["formControlName","level",1,"select","select-bordered","w-full","bg-base-100","text-base-content"],["value","B\xE1sico"],["value","Intermedio"],["value","Avanzado"],["value","Todos los niveles"],[1,"fas","fa-clock","text-base-content/50"],["type","text","formControlName","duration","placeholder","Ej: 3 meses",1,"grow","placeholder:text-base-content/30"],[1,"fas","fa-calendar-alt","text-base-content/50"],["type","text","formControlName","schedule","placeholder","Ej: Lunes 18hs",1,"grow","placeholder:text-base-content/30"],[1,"flex","flex-col","gap-4"],["type","text","formControlName","image_url","placeholder","https://...",1,"grow","placeholder:text-base-content/30"],["type","file","accept","image/*",1,"file-input","file-input-bordered","w-full","bg-base-100","text-base-content",3,"change"],[1,"mt-4","p-4","border","rounded-lg","bg-base-200","flex","justify-center","relative","group"],[1,"label","cursor-pointer","justify-start","gap-4","p-0"],["type","checkbox","formControlName","is_active",1,"toggle","toggle-success"],[1,"flex","justify-end","gap-4","pt-6","border-t","border-base-200"],["type","submit",1,"btn","btn-primary","px-8","text-white",3,"disabled"],[1,"loading","loading-spinner"],["alt","Preview","onerror","this.style.display='none'",1,"h-48","rounded","object-cover","shadow-sm",3,"src"]],template:function(a,n){if(a&1&&(t(0,"div",0)(1,"div",1)(2,"h2",2),i(3),e(),t(4,"a",3),o(5,"i",4),i(6," Volver "),e()(),t(7,"div",5)(8,"div",6)(9,"form",7),h("ngSubmit",function(){return n.save()}),t(10,"div",8)(11,"div",9)(12,"label",10)(13,"span",11),i(14,"T\xEDtulo"),e()(),t(15,"label",12),o(16,"i",13)(17,"input",14),e(),g(18,J,2,0,"span",15),e(),t(19,"div",9)(20,"label",10)(21,"span",11),i(22,"Slug (URL)"),e()(),t(23,"label",12),o(24,"i",16)(25,"input",17),e(),t(26,"label",10)(27,"span",18),i(28,"Identificador \xFAnico para la URL"),e()()()(),t(29,"div",9)(30,"label",10)(31,"span",11),i(32,"Descripci\xF3n Corta"),e()(),o(33,"textarea",19),e(),t(34,"div",20)(35,"div",9)(36,"label",10)(37,"span",11),i(38,"Precio"),e()(),t(39,"label",12),o(40,"i",21)(41,"input",22),e()(),t(42,"div",9)(43,"label",10)(44,"span",11),i(45,"Precio Oferta (Opcional)"),e()(),t(46,"label",12),o(47,"i",23)(48,"input",24),e()(),t(49,"div",9)(50,"label",10)(51,"span",11),i(52,"Nivel"),e()(),t(53,"select",25)(54,"option",26),i(55,"B\xE1sico"),e(),t(56,"option",27),i(57,"Intermedio"),e(),t(58,"option",28),i(59,"Avanzado"),e(),t(60,"option",29),i(61,"Todos los niveles"),e()()()(),t(62,"div",8)(63,"div",9)(64,"label",10)(65,"span",11),i(66,"Duraci\xF3n"),e()(),t(67,"label",12),o(68,"i",30)(69,"input",31),e()(),t(70,"div",9)(71,"label",10)(72,"span",11),i(73,"Horario"),e()(),t(74,"label",12),o(75,"i",32)(76,"input",33),e()()(),t(77,"div",9)(78,"label",10)(79,"span",11),i(80,"Imagen del Curso"),e()(),t(81,"div",34)(82,"label",12),o(83,"i",16)(84,"input",35),e(),t(85,"input",36),h("change",function(u){return n.onFileChange(u)}),e(),t(86,"label",10)(87,"span",18),i(88,"Sube una imagen o pega una URL"),e()()(),g(89,K,2,1,"div",37),e(),t(90,"div",9)(91,"label",38)(92,"span",11),i(93,"Curso Activo"),e(),o(94,"input",39),e()(),t(95,"div",40)(96,"a",3),i(97,"Cancelar"),e(),t(98,"button",41),g(99,Q,1,0,"span",42),i(100),e()()()()()()),a&2){let d,u;m(3),v(" ",n.isEditing?"Editar Curso":"Nuevo Curso"," "),m(6),b("formGroup",n.form),m(9),f((d=n.form.get("title"))!=null&&d.invalid&&((d=n.form.get("title"))!=null&&d.touched)?18:-1),m(71),f((u=n.form.get("image_url"))!=null&&u.value?89:-1),m(9),b("disabled",n.saving),m(),f(n.saving?99:-1),m(),v(" ",n.isEditing?"Actualizar":"Crear Curso"," ")}},dependencies:[F,G,T,O,U,k,j,P,M,q,D,V,R,A],encapsulation:2})};export{z as AdminCourseFormPage};
