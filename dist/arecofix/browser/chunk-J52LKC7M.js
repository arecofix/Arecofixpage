import{$b as w,N as d,V as b,Zb as D,ac as x,c as p,ca as m,ea as v,la as l,ma as y}from"./chunk-VQO264VU.js";import{a as f,b as g}from"./chunk-VOSPIT4N.js";function N(r,e){let o=!e?.manualCleanup?e?.injector?.get(v)??b(v):null,c=h(e?.equal),t;e?.requireSync?t=l({kind:0},{equal:c}):t=l({kind:1,value:e?.initialValue},{equal:c});let s,i=r.subscribe({next:n=>t.set({kind:1,value:n}),error:n=>{t.set({kind:2,error:n}),s?.()},complete:()=>{s?.()}});if(e?.requireSync&&t().kind===0)throw new d(601,!1);return s=o?.onDestroy(i.unsubscribe.bind(i)),D(()=>{let n=t();switch(n.kind){case 1:return n.value;case 2:throw n.error;case 0:throw new d(601,!1)}},{equal:e?.equal})}function h(r=Object.is){return(e,u)=>e.kind===1&&u.kind===1&&r(e.value,u.value)}function E(r){r===void 0&&(r=b(m));let e=r.get(y);return u=>new p(o=>{let c=e.add(),t=!1;function s(){t||(c(),t=!0)}let i=u.subscribe({next:n=>{o.next(n),s()},complete:()=>{o.complete(),s()},error:n=>{o.error(n),s()}});return i.add(()=>{o.unsubscribe(),s()}),i})}function U(r){return w(g(f({},r),{loader:void 0,stream:e=>{let u,o=()=>u?.unsubscribe();e.abortSignal.addEventListener("abort",o);let c=l({value:void 0}),t,s=new Promise(a=>t=a);function i(a){c.set(a),t?.(c),t=void 0}let n=r.stream??r.loader;if(n===void 0)throw new d(990,!1);return u=n(e).subscribe({next:a=>i({value:a}),error:a=>{i({error:x(a)}),e.abortSignal.removeEventListener("abort",o)},complete:()=>{t&&i({error:new d(991,!1)}),e.abortSignal.removeEventListener("abort",o)}}),s}}))}export{N as a,E as b,U as c};
