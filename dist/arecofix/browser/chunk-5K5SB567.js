import{a as Z}from"./chunk-KZFIC67K.js";import{a as X}from"./chunk-6HGBGN4M.js";import{a as Y}from"./chunk-ZW5YXDBP.js";import{a as z}from"./chunk-BEDAP6MF.js";import{a as G}from"./chunk-H4TJPEID.js";import"./chunk-SY4JJUGQ.js";import{b as R,c as v,d as L,e as B,h as H,j as J,k as K,r as Q,t as W}from"./chunk-T33GMKOB.js";import"./chunk-FLAEXP3O.js";import"./chunk-T7ROU62R.js";import{A as j,l as M,z as U}from"./chunk-T7HZBI4H.js";import{$ as k,Ab as e,Bb as s,Hb as P,Lb as N,Nb as _,Oa as y,Ta as l,Tb as E,Vb as i,W as b,Wb as V,Xb as $,Yb as A,aa as F,fb as I,ma as w,sb as f,tb as g,wb as q,xb as O,yb as S,zb as t}from"./chunk-NLTFPZ75.js";import"./chunk-7CGTOI24.js";var te=(r,n)=>n.product.id;function ie(r,n){if(r&1&&(t(0,"div",2)(1,"div",4)(2,"div",5),s(3,"i",6),e(),t(4,"h2",7),i(5,"\xA1Orden Recibida!"),e(),t(6,"p",8),i(7,"Gracias por tu compra. Para procesar el env\xEDo, por favor realiza el pago:"),e(),t(8,"div",9)(9,"p",10),i(10,"Datos Bancarios:"),e(),t(11,"div",11)(12,"p",12)(13,"span"),i(14,"Alias:"),e(),t(15,"span",13),i(16,"areco.fix"),e()(),t(17,"p",12)(18,"span"),i(19,"CBU:"),e(),t(20,"span",13),i(21,"0000003100084531456958"),e()()()(),t(22,"p",14),i(23," Una vez realizado el pago, env\xEDa el comprobante al: "),s(24,"br"),t(25,"strong",15),i(26,"+54 9 11 2596-0900"),e()(),t(27,"div",16)(28,"a",17),s(29,"i",18),i(30," Enviar Comprobante "),e(),t(31,"a",19),i(32,"Volver al Inicio"),e()()()()),r&2){let o,d=_();l(28),S("href","https://wa.me/5491125960900?text=Hola,%20hice%20un%20pedido%20a%20nombre%20de%20"+((o=d.checkoutForm.get("name"))==null?null:o.value)+".%20Adjunto%20comprobante.",y)}}function ne(r,n){r&1&&(t(0,"p",37),i(1,"Tu carrito est\xE1 vac\xEDo."),e(),t(2,"a",38),i(3,"Ir a comprar"),e())}function oe(r,n){if(r&1){let o=P();t(0,"div",40),s(1,"img",43),t(2,"div",44)(3,"h3",45),i(4),e(),t(5,"p",46),i(6),e()(),t(7,"div",47)(8,"span",45),i(9),e(),t(10,"button",48),N("click",function(){let m=k(o).$implicit,p=_(3);return F(p.cartService.removeFromCart(m.product.id))}),s(11,"i",49),e()()()}if(r&2){let o=n.$implicit;l(),S("src",o.product.image_url||(o.product.gallery_urls==null?null:o.product.gallery_urls[0])||"assets/img/no-image.png",y),l(3),V(o.product.name),l(2),A("$",o.product.price," x ",o.quantity),l(3),$(" $",(o.product.price*o.quantity).toFixed(2)," ")}}function re(r,n){if(r&1&&(t(0,"div",39),q(1,oe,12,5,"div",40,te),e(),s(3,"div",41),t(4,"div",42)(5,"span"),i(6,"Total"),e(),t(7,"span"),i(8),e()()),r&2){let o=_(2);l(),O(o.cartService.cartItems()),l(7),$("$",o.cartService.totalPrice().toFixed(2))}}function ae(r,n){r&1&&(t(0,"span",29),i(1,"El nombre es requerido"),e())}function le(r,n){r&1&&(t(0,"span",29),i(1,"Email inv\xE1lido"),e())}function ce(r,n){r&1&&(t(0,"span",29),i(1,"El tel\xE9fono es requerido"),e())}function de(r,n){r&1&&(t(0,"span",29),i(1,"La direcci\xF3n es requerida"),e())}function se(r,n){r&1&&s(0,"span",36)}function me(r,n){if(r&1){let o=P();t(0,"div",3)(1,"div",20)(2,"div",21)(3,"h2",22),i(4,"Resumen del Carrito"),e(),f(5,ne,4,0)(6,re,9,1),e()(),t(7,"div",23)(8,"div",21)(9,"h2",22),i(10,"Datos del Cliente"),e(),t(11,"form",24),N("ngSubmit",function(){k(o);let m=_();return F(m.placeOrder())}),t(12,"div",25)(13,"label",26)(14,"span",27),i(15,"Nombre Completo"),e()(),s(16,"input",28),f(17,ae,2,0,"span",29),e(),t(18,"div",25)(19,"label",26)(20,"span",27),i(21,"Email"),e()(),s(22,"input",30),f(23,le,2,0,"span",29),e(),t(24,"div",25)(25,"label",26)(26,"span",27),i(27,"Tel\xE9fono"),e()(),s(28,"input",31),f(29,ce,2,0,"span",29),e(),t(30,"div",25)(31,"label",26)(32,"span",27),i(33,"Direcci\xF3n de Env\xEDo"),e()(),s(34,"textarea",32),f(35,de,2,0,"span",29),e(),t(36,"div",25)(37,"label",26)(38,"span",27),i(39,"Notas (Opcional)"),e()(),s(40,"textarea",33),e(),t(41,"div",34)(42,"button",35),f(43,se,1,0,"span",36),i(44," Finalizar Compra "),e()()()()()()}if(r&2){let o,d,m,p,c,u,x,h,a=_();l(5),g(a.cartService.cartItems().length===0?5:6),l(6),S("formGroup",a.checkoutForm),l(5),E("input-error",((o=a.checkoutForm.get("name"))==null?null:o.invalid)&&((o=a.checkoutForm.get("name"))==null?null:o.touched)),l(),g((d=a.checkoutForm.get("name"))!=null&&d.invalid&&((d=a.checkoutForm.get("name"))!=null&&d.touched)?17:-1),l(5),E("input-error",((m=a.checkoutForm.get("email"))==null?null:m.invalid)&&((m=a.checkoutForm.get("email"))==null?null:m.touched)),l(),g((p=a.checkoutForm.get("email"))!=null&&p.invalid&&((p=a.checkoutForm.get("email"))!=null&&p.touched)?23:-1),l(5),E("input-error",((c=a.checkoutForm.get("phone"))==null?null:c.invalid)&&((c=a.checkoutForm.get("phone"))==null?null:c.touched)),l(),g((u=a.checkoutForm.get("phone"))!=null&&u.invalid&&((u=a.checkoutForm.get("phone"))!=null&&u.touched)?29:-1),l(5),E("textarea-error",((x=a.checkoutForm.get("address"))==null?null:x.invalid)&&((x=a.checkoutForm.get("address"))==null?null:x.touched)),l(),g((h=a.checkoutForm.get("address"))!=null&&h.invalid&&((h=a.checkoutForm.get("address"))!=null&&h.touched)?35:-1),l(7),S("disabled",a.isProcessing()||a.cartService.cartItems().length===0),l(),g(a.isProcessing()?43:-1)}}var ee=class r{cartService=b(G);orderService=b(Z);authService=b(z);contactService=b(X);fb=b(Q);router=b(U);notificationService=b(Y);checkoutForm=this.fb.group({name:["",[v.required]],email:["",[v.required,v.email]],phone:["",[v.required]],address:["",[v.required]],notes:[""]});isProcessing=w(!1);orderSuccess=w(!1);async placeOrder(){if(this.checkoutForm.invalid){this.checkoutForm.markAllAsTouched(),this.notificationService.showError("Por favor, completa todos los campos requeridos.");return}this.isProcessing.set(!0);let n=this.checkoutForm.getRawValue(),o=this.cartService.cartItems(),d=this.cartService.totalPrice(),m={customer_name:n.name,customer_email:n.email,customer_phone:n.phone,customer_address:n.address,status:"pending",subtotal:d,tax:0,discount:0,total:d,notes:n.notes,customer_id:this.authService.getCurrentUser()?.id},p=o.map(c=>({product_name:c.product.name,product_id:c.product.id,quantity:c.quantity,unit_price:c.product.price,subtotal:c.product.price*c.quantity}));try{let{data:c,error:u}=await this.orderService.createOrder(m,p);if(u)throw console.error("Order creation error:",u),u;let x=o.map(C=>`- ${C.product.name} (x${C.quantity}) - $${(C.product.price*C.quantity).toFixed(2)}`).join(`
`),h=`Nuevo Pedido #${c?.order_number||"N/A"}
      
Detalles del Cliente:
Nombre: ${n.name}
Email: ${n.email}
Tel\xE9fono: ${n.phone}
Direcci\xF3n: ${n.address}

Productos:
${x}

Total: $${d.toFixed(2)}

Notas Adicionales:
${n.notes||"Ninguna"}`,a={name:n.name,email:n.email,phone:n.phone,subject:`[NUEVO PEDIDO] #${c?.order_number} - ${n.name} - $${d.toFixed(2)}`,message:h},{error:D}=await this.contactService.createMessage(a);D&&console.error("Message creation error (non-fatal):",D);let T=this.authService.getCurrentUser();T&&await this.authService.getSupabaseClient().from("profiles").update({phone:n.phone,address:n.address,updated_at:new Date().toISOString()}).eq("id",T.id).maybeSingle(),this.orderSuccess.set(!0),this.cartService.clearCart(),this.notificationService.showSuccess("\xA1Orden creada exitosamente!")}catch(c){console.error("Checkout failed full error:",JSON.stringify(c,null,2));let u=c?.message||"Error desconocido",x=c?.code||"N/A";this.notificationService.showError(`Hubo un error al procesar tu orden: ${u} (C\xF3digo: ${x})`)}finally{this.isProcessing.set(!1)}}static \u0275fac=function(o){return new(o||r)};static \u0275cmp=I({type:r,selectors:[["app-checkout-page"]],decls:5,vars:1,consts:[[1,"container","mx-auto","px-4","py-8","max-w-4xl"],[1,"text-3xl","font-bold","mb-8","text-center","text-primary"],[1,"card","bg-base-100","shadow-xl","text-center","p-10","border","border-base-200"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"card-body","items-center"],[1,"text-success","text-6xl","mb-4"],[1,"fas","fa-check-circle"],[1,"card-title","text-2xl","text-base-content","mb-2"],[1,"text-base-content/80","mb-6"],[1,"bg-base-200","p-6","rounded-xl","w-full","max-w-md","mb-6","text-left","border","border-base-300"],[1,"font-bold","text-base-content","mb-2","border-b","border-base-content/10","pb-2"],[1,"space-y-2"],[1,"text-base-content/70","flex","justify-between"],[1,"font-mono","font-bold","text-base-content","select-all","bg-base-100","px-2","rounded"],[1,"text-sm","mb-4","text-base-content/80"],[1,"text-lg","text-primary"],[1,"card-actions","flex","flex-col","gap-3","w-full","max-w-md"],["target","_blank",1,"btn","btn-success","text-white","w-full","btn-lg",3,"href"],[1,"fab","fa-whatsapp","text-xl","mr-2"],["routerLink","/",1,"btn","btn-ghost","w-full"],[1,"card","bg-base-100","shadow-xl","h-fit","border","border-base-200"],[1,"card-body"],[1,"card-title","mb-4","text-base-content"],[1,"card","bg-base-100","shadow-xl","border","border-base-200"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"form-control","w-full"],[1,"label"],[1,"label-text","text-base-content"],["type","text","formControlName","name",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],[1,"text-error","text-xs","mt-1"],["type","email","formControlName","email",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["type","tel","formControlName","phone",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["formControlName","address",1,"textarea","textarea-bordered","h-24","w-full","bg-base-100","text-base-content"],["formControlName","notes",1,"textarea","textarea-bordered","w-full","bg-base-100","text-base-content"],[1,"mt-6"],["type","submit",1,"btn","btn-primary","btn-block","btn-lg",3,"disabled"],[1,"loading","loading-spinner"],[1,"text-base-content"],["routerLink","/products/featured",1,"btn","btn-link","px-0"],[1,"space-y-4"],[1,"flex","gap-4","items-center","p-2","hover:bg-base-200","rounded-lg","transition-colors"],[1,"divider"],[1,"flex","justify-between","text-xl","font-bold","text-base-content"],[1,"w-16","h-16","object-cover","rounded-lg","border","border-base-300",3,"src"],[1,"flex-1"],[1,"font-bold","text-base-content"],[1,"text-sm","text-base-content/70"],[1,"flex","flex-col","items-end","gap-1"],["aria-label","Eliminar",1,"btn","btn-ghost","btn-xs","text-error",3,"click"],[1,"fas","fa-trash-alt"]],template:function(o,d){o&1&&(t(0,"div",0)(1,"h1",1),i(2,"Finalizar Compra"),e(),f(3,ie,33,1,"div",2)(4,me,45,16,"div",3),e()),o&2&&(l(3),g(d.orderSuccess()?3:4))},dependencies:[M,W,H,R,L,B,K,J,j],encapsulation:2})};export{ee as CheckoutPage};
