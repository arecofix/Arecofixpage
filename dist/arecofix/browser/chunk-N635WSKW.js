import{h as R}from"./chunk-BGHZUC77.js";import{d as V}from"./chunk-6WWONRBM.js";import{b as P,d as A,e as W,f as T,g as I,h as N,i as D,m as F,n as L,o as B,q as U,t as j}from"./chunk-63CMMPDH.js";import"./chunk-6MFU4D2Y.js";import"./chunk-YTQUIG7T.js";import"./chunk-QBOH7QZY.js";import"./chunk-Q44XB7TV.js";import{$b as c,Ab as n,Bb as a,Cb as m,Kb as C,Mb as y,Pa as x,Ua as l,Vb as o,W as b,Wb as v,Zb as g,_b as p,gb as E,ma as u,tb as f,ub as _,zb as h}from"./chunk-DX2LKEMG.js";import{a as S,b as M}from"./chunk-C6Q5SG76.js";function k(d,s){if(d&1&&(n(0,"div",5),m(1,"i",41),n(2,"span"),o(3),a()()),d&2){let i=y();l(3),v(i.error())}}function z(d,s){if(d&1&&(n(0,"div",6),m(1,"i",42),n(2,"span"),o(3),a()()),d&2){let i=y();l(3),v(i.success())}}function H(d,s){if(d&1&&(n(0,"div",37),m(1,"img",43),a()),d&2){let i=y();l(),h("src",i.form().logo_url,x)}}function J(d,s){d&1&&m(0,"span",40)}var O=class d{auth=b(V);tenantService=b(R);form=u({id:"",name:"",owner_name:"",ruc:"",address:"",tax_percentage:21,tax_abbreviation:"IVA",email:"",phone:"",location:"",currency:"ARS",logo_url:""});loading=u(!0);saving=u(!1);error=u(null);success=u(null);async ngOnInit(){await this.loadSettings()}async loadSettings(){this.loading.set(!0);let s=this.auth.getSupabaseClient(),i=this.tenantService.getTenantId(),{data:e,error:r}=await s.from("tenants").select("*").eq("id",i).single();e?this.form.set({id:e.id,name:e.name,owner_name:"",ruc:e.tax_id_name||"CUIT/CUIL",address:e.location||"",tax_percentage:e.tax_percentage||21,tax_abbreviation:e.tax_abbreviation||"IVA",email:e.contact_email||"",phone:e.contact_phone||"",location:e.location||"",currency:e.currency||"ARS",logo_url:e.branding_settings?.logo_url||""}):r&&r.code!=="PGRST116"&&this.error.set(r.message),this.loading.set(!1)}async onFileChange(s){let i=s.target.files?.[0];if(!i)return;let e=this.auth.getSupabaseClient(),r=`company/${Date.now()}-${i.name}`,{data:t,error:w}=await e.storage.from("public-assets").upload(r,i);if(w){this.error.set(w.message);return}let{data:q}=e.storage.from("public-assets").getPublicUrl(t.path);this.form.update(G=>M(S({},G),{logo_url:q.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null),this.success.set(null);let s=this.auth.getSupabaseClient(),i=S({},this.form()),e=this.tenantService.getTenantId(),r={name:i.name,tax_id_name:i.ruc,location:i.address||i.location,tax_percentage:i.tax_percentage,tax_abbreviation:i.tax_abbreviation,contact_email:i.email,contact_phone:i.phone,currency:i.currency,branding_settings:{logo_url:i.logo_url,primary_color:"#3b82f6"},updated_at:new Date().toISOString()};try{let{error:t}=await s.from("tenants").update(r).eq("id",e);if(t)throw t;this.success.set("Configuraci\xF3n de la empresa guardada correctamente"),await this.loadSettings()}catch(t){this.error.set(t.message)}finally{this.saving.set(!1)}}static \u0275fac=function(i){return new(i||d)};static \u0275cmp=E({type:d,selectors:[["app-admin-company-settings-page"]],decls:99,vars:15,consts:[[1,"max-w-4xl","mx-auto"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold"],[1,"card","bg-base-100","shadow-lg"],[1,"card-body","p-6"],[1,"alert","alert-error","mb-4","shadow-sm"],[1,"alert","alert-success","mb-4","shadow-sm"],[1,"space-y-6",3,"ngSubmit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"form-control"],[1,"label"],[1,"label-text","font-medium"],[1,"input","input-bordered","flex","items-center","gap-2"],[1,"fas","fa-building","text-gray-400"],["type","text","name","name","required","",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-user","text-gray-400"],["type","text","name","owner_name",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-id-card","text-gray-400"],["type","text","name","ruc",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-map-marker-alt","text-gray-400"],["type","text","name","address",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-envelope","text-gray-400"],["type","email","name","email",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-phone","text-gray-400"],["type","text","name","phone",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-globe","text-gray-400"],["type","text","name","location","placeholder","Ej: Buenos Aires, Argentina",1,"grow",3,"ngModelChange","ngModel"],[1,"divider","text-sm","font-medium","text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"fas","fa-percent","text-gray-400"],["type","number","name","tax_percentage",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-tag","text-gray-400"],["type","text","name","tax_abbreviation","placeholder","Ej: IVA",1,"grow",3,"ngModelChange","ngModel"],["name","currency",1,"select","select-bordered","w-full",3,"ngModelChange","ngModel"],["value","ARS"],["value","USD"],["type","file","accept","image/*",1,"file-input","file-input-bordered","w-full",3,"change"],[1,"mt-4","p-4","border","rounded-lg","bg-base-200","flex","justify-center"],[1,"flex","justify-end","gap-4","mt-8","pt-4","border-t","border-base-200"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-check-circle"],["alt","Logo preview",1,"h-32","object-contain",3,"src"]],template:function(i,e){i&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3,"Configuraci\xF3n de Empresa"),a()(),n(4,"div",3)(5,"div",4),f(6,k,4,1,"div",5),f(7,z,4,1,"div",6),n(8,"form",7),C("ngSubmit",function(){return e.save()}),n(9,"div",8)(10,"div",9)(11,"label",10)(12,"span",11),o(13,"Nombre de la Empresa"),a()(),n(14,"label",12),m(15,"i",13),n(16,"input",14),c("ngModelChange",function(t){return p(e.form().name,t)||(e.form().name=t),t}),a()()(),n(17,"div",9)(18,"label",10)(19,"span",11),o(20,"Propietario"),a()(),n(21,"label",12),m(22,"i",15),n(23,"input",16),c("ngModelChange",function(t){return p(e.form().owner_name,t)||(e.form().owner_name=t),t}),a()()()(),n(24,"div",8)(25,"div",9)(26,"label",10)(27,"span",11),o(28,"RUC / CUIT"),a()(),n(29,"label",12),m(30,"i",17),n(31,"input",18),c("ngModelChange",function(t){return p(e.form().ruc,t)||(e.form().ruc=t),t}),a()()(),n(32,"div",9)(33,"label",10)(34,"span",11),o(35,"Direcci\xF3n"),a()(),n(36,"label",12),m(37,"i",19),n(38,"input",20),c("ngModelChange",function(t){return p(e.form().address,t)||(e.form().address=t),t}),a()()()(),n(39,"div",8)(40,"div",9)(41,"label",10)(42,"span",11),o(43,"Email"),a()(),n(44,"label",12),m(45,"i",21),n(46,"input",22),c("ngModelChange",function(t){return p(e.form().email,t)||(e.form().email=t),t}),a()()(),n(47,"div",9)(48,"label",10)(49,"span",11),o(50,"Tel\xE9fono"),a()(),n(51,"label",12),m(52,"i",23),n(53,"input",24),c("ngModelChange",function(t){return p(e.form().phone,t)||(e.form().phone=t),t}),a()()()(),n(54,"div",9)(55,"label",10)(56,"span",11),o(57,"Ubicaci\xF3n"),a()(),n(58,"label",12),m(59,"i",25),n(60,"input",26),c("ngModelChange",function(t){return p(e.form().location,t)||(e.form().location=t),t}),a()()(),n(61,"div",27),o(62,"Configuraci\xF3n Fiscal"),a(),n(63,"div",28)(64,"div",9)(65,"label",10)(66,"span",11),o(67,"Porcentaje Impuesto (%)"),a()(),n(68,"label",12),m(69,"i",29),n(70,"input",30),c("ngModelChange",function(t){return p(e.form().tax_percentage,t)||(e.form().tax_percentage=t),t}),a()()(),n(71,"div",9)(72,"label",10)(73,"span",11),o(74,"Abreviatura Impuesto"),a()(),n(75,"label",12),m(76,"i",31),n(77,"input",32),c("ngModelChange",function(t){return p(e.form().tax_abbreviation,t)||(e.form().tax_abbreviation=t),t}),a()()(),n(78,"div",9)(79,"label",10)(80,"span",11),o(81,"Moneda"),a()(),n(82,"select",33),c("ngModelChange",function(t){return p(e.form().currency,t)||(e.form().currency=t),t}),n(83,"option",34),o(84,"ARS (Peso Argentino)"),a(),n(85,"option",35),o(86,"USD (D\xF3lar Estadounidense)"),a()()()(),n(87,"div",27),o(88,"Branding"),a(),n(89,"div",9)(90,"label",10)(91,"span",11),o(92,"Logo de la Empresa"),a()(),n(93,"input",36),C("change",function(t){return e.onFileChange(t)}),a(),f(94,H,2,1,"div",37),a(),n(95,"div",38)(96,"button",39),f(97,J,1,0,"span",40),o(98," Guardar Configuraci\xF3n "),a()()()()()()),i&2&&(l(6),_(e.error()?6:-1),l(),_(e.success()?7:-1),l(9),g("ngModel",e.form().name),l(7),g("ngModel",e.form().owner_name),l(8),g("ngModel",e.form().ruc),l(7),g("ngModel",e.form().address),l(8),g("ngModel",e.form().email),l(7),g("ngModel",e.form().phone),l(7),g("ngModel",e.form().location),l(10),g("ngModel",e.form().tax_percentage),l(7),g("ngModel",e.form().tax_abbreviation),l(5),g("ngModel",e.form().currency),l(12),_(e.form().logo_url?94:-1),l(2),h("disabled",e.saving()),l(),_(e.saving()?97:-1))},dependencies:[j,N,L,B,P,D,F,A,W,U,I,T],encapsulation:2})};export{O as AdminCompanySettingsPage};
