import{b as V,c as m,d as N,e as k,h as I,j as L,k as T,q as D,s as F}from"./chunk-3J4IWN72.js";import{a as w}from"./chunk-MCSV4IA2.js";import{c as S,d as P}from"./chunk-BWQSVEWZ.js";import"./chunk-44RGWP63.js";import"./chunk-4CQ4C23O.js";import"./chunk-XV34LPXM.js";import{Db as a,Eb as b,Fa as o,Fb as C,Sa as E,X as h,aa as g,ba as _,cb as c,d as y,db as u,ib as s,jb as n,kb as t,lb as f,pb as x,tb as v,vb as d}from"./chunk-DPJIKM6M.js";import"./chunk-VOSPIT4N.js";function G(r,i){r&1&&(n(0,"div",1),a(1,"Cargando perfil..."),t())}function O(r,i){r&1&&(n(0,"div",2)(1,"h1",3),a(2,"No est\xE1s logueado"),t(),n(3,"p",4),a(4,"Para ver tu perfil, por favor inicia sesi\xF3n o reg\xEDstrate."),t(),n(5,"div",5)(6,"a",6),a(7,"Iniciar sesion"),t(),n(8,"a",7),a(9,"Registrarse"),t()()())}function M(r,i){if(r&1&&(n(0,"div",9),a(1),t()),r&2){let e=d(2);o(),b(e.error)}}function R(r,i){if(r&1&&(n(0,"div",10),a(1),t()),r&2){let e=d(2);o(),b(e.success)}}function z(r,i){if(r&1){let e=x();n(0,"button",26),v("click",function(){g(e);let p=d(2);return _(p.toggleEditMode())}),a(1),t()}if(r&2){let e=d(2);o(),C(" ",e.isEditing?"Cancelar":"Editar perfil"," ")}}function A(r,i){if(r&1){let e=x();n(0,"button",27),v("click",function(){g(e);let p=d(2);return _(p.handleLogout())}),a(1,"Cerrar sesi\xF3n"),t()}}function $(r,i){if(r&1){let e=x();n(0,"h1",8),a(1,"Mi Perfil"),t(),c(2,M,2,1,"div",9),c(3,R,2,1,"div",10),n(4,"form",11),v("ngSubmit",function(){g(e);let p=d();return _(p.updateProfile())}),n(5,"div",12)(6,"div")(7,"label",13),a(8,"Nombre"),t(),f(9,"input",14),t(),n(10,"div")(11,"label",13),a(12,"Apellido"),t(),f(13,"input",15),t(),n(14,"div")(15,"label",13),a(16,"Email"),t(),f(17,"input",16),t(),n(18,"div")(19,"label",13),a(20,"Tel\xE9fono"),t(),f(21,"input",17),t(),n(22,"div",18)(23,"label",13),a(24,"Biograf\xEDa"),t(),f(25,"textarea",19),t(),n(26,"div",18)(27,"label",13),a(28,"Avatar URL"),t(),f(29,"input",20),t()(),n(30,"div",21),c(31,z,2,1,"button",22),n(32,"button",23),a(33),t(),n(34,"button",24),v("click",function(){g(e);let p=d();return _(p.resetForm())}),a(35,"Resetear"),t(),c(36,A,2,0,"button",25),t()()}if(r&2){let e=d();o(2),u(e.error?2:-1),o(),u(e.success?3:-1),o(),s("formGroup",e.form),o(5),s("readonly",!e.isEditing),o(4),s("readonly",!e.isEditing),o(8),s("readonly",!e.isEditing),o(4),s("readonly",!e.isEditing),o(4),s("readonly",!e.isEditing),o(2),u(e.saving?-1:31),o(),s("disabled",e.saving||!e.isEditing),o(),C(" ",e.saving?"Guardando...":"Guardar cambios"," "),o(),s("disabled",e.saving||!e.isEditing),o(2),u(e.saving?-1:36)}}var U=class r{form;user=null;loading=!1;saving=!1;error="";success="";isEditing=!1;isLoggedIn=!1;authService=h(w);router=h(S);fb=h(D);destroy$=new y;constructor(){this.form=this.fb.group({first_name:["",[m.required,m.minLength(2)]],last_name:["",[m.required,m.minLength(2)]],email:[{value:"",disabled:!0},[m.required,m.email]],phone:["",[m.pattern(/^[0-9\-\+\s\(\)]*$/)]],bio:["",[m.maxLength(500)]],avatar_url:[""]})}async ngOnInit(){this.loading=!0;try{let i=await this.authService.getUser();if(this.isLoggedIn=!!i,!i){this.user=null;return}let e=await this.authService.getUserProfile(i.id);e&&(this.user=e,this.form.patchValue(e))}catch(i){this.error="Error al cargar el perfil.",console.error("Profile load error:",i)}finally{this.loading=!1}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}async handleLogout(){let i=await this.authService.signOut();if(i){this.error=i;return}this.router.navigate(["/login"])}async updateProfile(){if(this.error="",this.success="",this.form.invalid){this.error="Por favor completa correctamente los campos.";return}this.saving=!0;try{let i=await this.authService.getUser();if(!i){this.saving=!1,this.error="Necesitas iniciar sesi\xF3n para actualizar tu perfil.";return}let e={first_name:this.form.get("first_name")?.value,last_name:this.form.get("last_name")?.value,phone:this.form.get("phone")?.value,bio:this.form.get("bio")?.value,avatar_url:this.form.get("avatar_url")?.value},l=await this.authService.updateUserProfile(i.id,e);this.saving=!1,l?(this.user=l,this.success="Perfil actualizado exitosamente.",this.isEditing=!1):this.error="Error al actualizar el perfil."}catch(i){this.saving=!1,this.error="Error al actualizar el perfil.",console.error("Profile update error:",i)}}toggleEditMode(){this.isEditing=!this.isEditing,!this.isEditing&&this.user&&this.form.patchValue(this.user)}resetForm(){this.user&&(this.form.patchValue(this.user),this.isEditing=!1)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=E({type:r,selectors:[["app-profile"]],decls:4,vars:3,consts:[[1,"container","mx-auto","p-6"],[1,"alert","alert-info"],[1,"text-center","space-y-4"],[1,"text-2xl","font-bold"],[1,"text-gray-600"],[1,"flex","gap-4","justify-center"],["routerLink","/login",1,"btn","btn-primary"],["routerLink","/register",1,"btn","btn-secondary"],[1,"text-2xl","font-bold","mb-4"],[1,"alert","alert-error","mb-4"],[1,"alert","alert-success","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium"],["type","text","formControlName","first_name",1,"input","input-bordered","w-full",3,"readonly"],["type","text","formControlName","last_name",1,"input","input-bordered","w-full",3,"readonly"],["type","email","formControlName","email","readonly","",1,"input","input-bordered","w-full"],["type","text","formControlName","phone",1,"input","input-bordered","w-full",3,"readonly"],[1,"md:col-span-2"],["formControlName","bio","rows","4",1,"textarea","textarea-bordered","w-full",3,"readonly"],["type","text","formControlName","avatar_url",1,"input","input-bordered","w-full",3,"readonly"],[1,"flex","gap-3","mt-4"],["type","button",1,"btn"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-ghost",3,"click","disabled"],["type","button",1,"btn","btn-outline"],["type","button",1,"btn",3,"click"],["type","button",1,"btn","btn-outline",3,"click"]],template:function(e,l){e&1&&(n(0,"div",0),c(1,G,2,0,"div",1),c(2,O,10,0,"div",2),c(3,$,37,13),t()),e&2&&(o(),u(l.loading?1:-1),o(),u(!l.loading&&!l.isLoggedIn?2:-1),o(),u(!l.loading&&l.isLoggedIn?3:-1))},dependencies:[F,I,V,N,k,T,L,P],encapsulation:2})};export{U as ProfileComponent};
