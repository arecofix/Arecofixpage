import{a as L,b as T,d as W,e as I,f as j,g as k,h as R,p as U,r as q}from"./chunk-ENL3VNME.js";import{a as D}from"./chunk-4FNFMYN4.js";import{a as A,c as B,d as N}from"./chunk-4WX2KV2B.js";import"./chunk-QBWIJBVM.js";import"./chunk-BCXBSHNT.js";import{o as P}from"./chunk-YHPCNF66.js";import{Ca as w,Fa as o,Fb as s,Gb as E,Hb as F,Jb as f,Kb as b,Lb as h,Ta as x,W as u,eb as p,fb as c,kb as _,lb as i,ma as m,mb as n,nb as g,vb as y,xb as C}from"./chunk-YBYZLFPG.js";import{a as v,b as M}from"./chunk-VOSPIT4N.js";function z(l,r){if(l&1&&(i(0,"div",6),g(1,"i",21),i(2,"span"),s(3),n()()),l&2){let t=C();o(3),E(t.error())}}function H(l,r){if(l&1&&(i(0,"div",13),g(1,"img",22),n()),l&2){let t=C();o(),_("src",t.form().logo_url,w)}}function J(l,r){l&1&&g(0,"span",20)}var V=class l{route=u(A);router=u(B);auth=u(D);id=null;form=m({name:"",slug:"",logo_url:"",is_active:!0},{});loading=m(!0,{});saving=m(!1,{});error=m(null,{});async ngOnInit(){if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let r=this.auth.getSupabaseClient(),{data:t,error:e}=await r.from("brands").select("*").eq("id",this.id).single();t&&this.form.set({name:t.name,slug:t.slug,logo_url:t.logo_url||"",is_active:t.is_active})}this.loading.set(!1)}async onFileChange(r){let t=r.target.files?.[0];if(!t)return;let e=this.auth.getSupabaseClient(),d=`brands/${Date.now()}-${t.name}`,{data:a,error:S}=await e.storage.from("public-assets").upload(d,t);if(S){this.error.set(S.message);return}let{data:O}=e.storage.from("public-assets").getPublicUrl(a.path);this.form.update(G=>M(v({},G),{logo_url:O.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null);let r=this.auth.getSupabaseClient(),t=v({},this.form());t.slug||(t.slug=this.slugify(t.name));try{if(this.id){let{error:e}=await r.from("brands").update(t).eq("id",this.id);if(e)throw e}else{let{error:e}=await r.from("brands").insert(t);if(e)throw e}this.router.navigate(["/admin/brands"])}catch(e){this.error.set(e.message)}finally{this.saving.set(!1)}}slugify(r){return r.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=x({type:l,selectors:[["app-admin-brand-form-page"]],decls:33,vars:8,consts:[[1,"max-w-2xl","mx-auto"],[1,"flex","items-center","gap-4","mb-6"],["routerLink","/admin/brands",1,"btn","btn-circle","btn-ghost"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","text-gray-800"],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"alert","alert-error","mb-4"],[1,"space-y-4",3,"ngSubmit"],[1,"form-control"],[1,"label"],["type","text","name","name","required","",1,"input","input-bordered",3,"ngModelChange","ngModel"],["type","text","name","slug","placeholder","Se genera autom\xE1ticamente si se deja vac\xEDo",1,"input","input-bordered",3,"ngModelChange","ngModel"],["type","file","accept","image/*",1,"file-input","file-input-bordered","w-full",3,"change"],[1,"mt-2"],[1,"label","cursor-pointer","justify-start","gap-4"],[1,"label-text"],["type","checkbox","name","is_active",1,"toggle","toggle-primary",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-4","mt-6"],["routerLink","/admin/brands",1,"btn","btn-ghost"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"loading","loading-spinner"],[1,"fas","fa-exclamation-circle"],["alt","Logo preview",1,"h-20","object-contain","border","rounded","p-2",3,"src"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(3,"i",3),n(),i(4,"h1",4),s(5),n()(),i(6,"div",5),p(7,z,4,1,"div",6),i(8,"form",7),y("ngSubmit",function(){return e.save()}),i(9,"div",8)(10,"label",9),s(11,"Nombre"),n(),i(12,"input",10),h("ngModelChange",function(a){return b(e.form().name,a)||(e.form().name=a),a}),n()(),i(13,"div",8)(14,"label",9),s(15,"Slug (URL)"),n(),i(16,"input",11),h("ngModelChange",function(a){return b(e.form().slug,a)||(e.form().slug=a),a}),n()(),i(17,"div",8)(18,"label",9),s(19,"Logo"),n(),i(20,"input",12),y("change",function(a){return e.onFileChange(a)}),n(),p(21,H,2,1,"div",13),n(),i(22,"div",8)(23,"label",14)(24,"span",15),s(25,"Activo"),n(),i(26,"input",16),h("ngModelChange",function(a){return b(e.form().is_active,a)||(e.form().is_active=a),a}),n()()(),i(27,"div",17)(28,"a",18),s(29,"Cancelar"),n(),i(30,"button",19),p(31,J,1,0,"span",20),s(32," Guardar "),n()()()()()),t&2&&(o(5),F("",e.id?"Editar":"Nueva"," Marca"),o(2),c(e.error()?7:-1),o(5),f("ngModel",e.form().name),o(4),f("ngModel",e.form().slug),o(5),c(e.form().logo_url?21:-1),o(5),f("ngModel",e.form().is_active),o(4),_("disabled",e.saving()),o(),c(e.saving()?31:-1))},dependencies:[P,q,R,T,L,W,I,U,k,j,N],encapsulation:2})};export{V as AdminBrandFormPage};
