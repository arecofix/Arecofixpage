import{Q as d,Y as l,c as y,f as D,fa as f,ha as b,oa as v,pa as w,qa as x,ra as g,vc as h,xc as j,yc as M}from"./chunk-SISNN44B.js";import{a as p,b as m}from"./chunk-VOSPIT4N.js";function N(o,e){let i=e?.injector??l(f),n=new D(1),u=x(()=>{let t;try{t=o()}catch(s){g(()=>n.error(s));return}g(()=>n.next(t))},{injector:i,manualCleanup:!0});return i.get(b).onDestroy(()=>{u.destroy(),n.complete()}),n.asObservable()}function E(o,e){let n=!e?.manualCleanup?e?.injector?.get(b)??l(b):null,u=k(e?.equal),t;e?.requireSync?t=v({kind:0},{equal:u}):t=v({kind:1,value:e?.initialValue},{equal:u});let s,c=o.subscribe({next:r=>t.set({kind:1,value:r}),error:r=>{t.set({kind:2,error:r}),s?.()},complete:()=>{s?.()}});if(e?.requireSync&&t().kind===0)throw new d(601,!1);return s=n?.onDestroy(c.unsubscribe.bind(c)),h(()=>{let r=t();switch(r.kind){case 1:return r.value;case 2:throw r.error;case 0:throw new d(601,!1)}},{equal:e?.equal})}function k(o=Object.is){return(e,i)=>e.kind===1&&i.kind===1&&o(e.value,i.value)}function U(o){o===void 0&&(o=l(f));let e=o.get(w);return i=>new y(n=>{let u=e.add(),t=!1;function s(){t||(u(),t=!0)}let c=i.subscribe({next:r=>{n.next(r),s()},complete:()=>{n.complete(),s()},error:r=>{n.error(r),s()}});return c.add(()=>{n.unsubscribe(),s()}),c})}function T(o){return j(m(p({},o),{loader:void 0,stream:e=>{let i,n=()=>i?.unsubscribe();e.abortSignal.addEventListener("abort",n);let u=v({value:void 0}),t,s=new Promise(a=>t=a);function c(a){u.set(a),t?.(u),t=void 0}let r=o.stream??o.loader;if(r===void 0)throw new d(990,!1);return i=r(e).subscribe({next:a=>c({value:a}),error:a=>{c({error:M(a)}),e.abortSignal.removeEventListener("abort",n)},complete:()=>{t&&c({error:new d(991,!1)}),e.abortSignal.removeEventListener("abort",n)}}),s}}))}export{N as a,E as b,U as c,T as d};
