import{a as V}from"./chunk-EWVJVUFG.js";import"./chunk-HVYNZZQK.js";import"./chunk-M7RWEG4P.js";import{A as j,h as N,l as k,x as $}from"./chunk-T7HZBI4H.js";import{$ as E,Ab as t,Bb as b,Hb as A,Lb as T,Nb as g,Oa as I,Ta as a,Vb as i,W as y,Wb as d,Xb as p,aa as S,fb as C,lc as M,ma as s,nc as F,sb as _,tb as f,wb as D,xb as w,yb as P,zb as e}from"./chunk-NLTFPZ75.js";import"./chunk-7CGTOI24.js";var L=(o,m)=>m.id;function O(o,m){o&1&&(e(0,"div",1),i(1,"Cargando..."),t())}function U(o,m){if(o&1&&b(0,"img",7),o&2){let n=g(2);P("src",n.company().logo_url,I)}}function B(o,m){if(o&1&&(e(0,"p",9),i(1),t()),o&2){let n,r=g(2);a(),p("CUIT: ",(n=r.company())==null?null:n.ruc)}}function R(o,m){if(o&1&&(e(0,"tr",17)(1,"td",24),i(2),t(),e(3,"td",15),i(4),t(),e(5,"td",16),i(6),t(),e(7,"td",16),i(8),t()()),o&2){let n=m.$implicit;a(2),d((n.products==null?null:n.products.name)||"Producto eliminado"),a(2),d(n.quantity),a(2),p("$",n.unit_price),a(2),p("$",n.subtotal)}}function z(o,m){if(o&1){let n=A();e(0,"div",2)(1,"div",3)(2,"div")(3,"h1",4),i(4,"Factura"),t(),e(5,"p",5),i(6),t()(),e(7,"div",6),_(8,U,1,1,"img",7),e(9,"div",8),i(10),t(),e(11,"p",9),i(12),t(),e(13,"p",9),i(14),t(),e(15,"p",9),i(16),t(),e(17,"p",9),i(18),t(),_(19,B,2,1,"p",9),t()(),e(20,"div",10)(21,"div")(22,"h3",11),i(23,"Facturar a:"),t(),e(24,"p"),i(25),t(),e(26,"p",9),i(27),t(),e(28,"p",9),i(29),t()(),e(30,"div",6)(31,"h3",11),i(32,"Detalles:"),t(),e(33,"p"),i(34),M(35,"date"),t(),e(36,"p"),i(37),t()()(),e(38,"table",12)(39,"thead")(40,"tr",13)(41,"th",14),i(42,"Descripci\xF3n"),t(),e(43,"th",15),i(44,"Cant."),t(),e(45,"th",16),i(46,"Precio Unit."),t(),e(47,"th",16),i(48,"Subtotal"),t()()(),e(49,"tbody"),D(50,R,9,4,"tr",17,L),t(),e(52,"tfoot")(53,"tr")(54,"td",18),i(55,"Total"),t(),e(56,"td",19),i(57),t()()()(),e(58,"div",20)(59,"a",21),i(60,"Volver"),t(),e(61,"button",22),T("click",function(){E(n);let c=g();return S(c.print())}),b(62,"i",23),i(63," Imprimir "),t()()()}if(o&2){let n,r,c,x,u,v,h,l=g();a(6),p("#",l.invoice().invoice_number||"Borrador"),a(2),f((n=l.company())!=null&&n.logo_url?8:-1),a(2),d(((r=l.company())==null?null:r.name)||"Arecofix"),a(2),d(((c=l.company())==null?null:c.location)||"Servicios Integrales"),a(2),d((x=l.company())==null?null:x.address),a(2),d((u=l.company())==null?null:u.phone),a(2),d((v=l.company())==null?null:v.email),a(),f((h=l.company())!=null&&h.ruc?19:-1),a(6),d(l.invoice().customer_name||"Consumidor Final"),a(2),d(l.invoice().customer_address),a(2),d(l.invoice().customer_dni_cuit),a(5),p("Fecha: ",F(35,14,l.invoice().issued_at,"shortDate")),a(3),p("Tipo: ",l.invoice().type),a(13),w(l.items()),a(7),p("$",l.invoice().total_amount)}}function G(o,m){o&1&&(e(0,"div",1),i(1,"Factura no encontrada"),t())}var q=class o{route=y($);auth=y(V);invoice=s(null);items=s([]);company=s(null);loading=s(!0);error=s("");async ngOnInit(){let m=this.route.snapshot.paramMap.get("id"),n=this.auth.getSupabaseClient();try{let{data:r}=await n.from("company_settings").select("*").maybeSingle();if(r&&this.company.set(r),m){let{data:c,error:x}=await n.from("invoices").select("*, sales(*)").eq("id",m).single();if(x)throw x;if(c&&(this.invoice.set(c),c.sales?.id)){let{data:u,error:v}=await n.from("sale_items").select("*, products(name)").eq("sale_id",c.sales.id);v?console.error("Error fetching items:",v):u&&this.items.set(u)}}}catch(r){console.error("Error loading invoice:",r),this.error.set(r.message||"Error al cargar la factura")}finally{this.loading.set(!1)}}print(){window.print()}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=C({type:o,selectors:[["app-admin-invoice-detail-page"]],decls:4,vars:1,consts:[[1,"print-container","max-w-3xl","mx-auto","bg-white","shadow-lg","rounded-lg","overflow-hidden","my-8","print:shadow-none","print:max-w-none","print:w-full","print:m-0","print:rounded-none","text-gray-800"],[1,"p-8","text-center"],[1,"p-8"],[1,"flex","justify-between","items-start","mb-8"],[1,"text-3xl","font-bold","text-gray-800"],[1,"text-gray-500","mt-1"],[1,"text-right"],["alt","Logo",1,"h-16","mb-2","ml-auto","object-contain",3,"src"],[1,"font-bold","text-xl","text-indigo-600"],[1,"text-sm","text-gray-500"],[1,"grid","grid-cols-2","gap-8","mb-8"],[1,"font-bold","text-gray-700","mb-2"],[1,"w-full","mb-8"],[1,"border-b-2","border-gray-200","text-gray-800"],[1,"text-left","py-3"],[1,"text-center","py-3"],[1,"text-right","py-3"],[1,"border-b","border-gray-100"],["colspan","3",1,"text-right","py-4","font-bold"],[1,"text-right","py-4","font-bold","text-xl"],[1,"flex","justify-end","gap-4","print:hidden"],["routerLink","/admin/invoices",1,"btn","btn-ghost"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-print","mr-2"],[1,"py-3"]],template:function(n,r){n&1&&(e(0,"div",0),_(1,O,2,0,"div",1)(2,z,64,17,"div",2)(3,G,2,0,"div",1),t()),n&2&&(a(),f(r.loading()?1:r.invoice()?2:3))},dependencies:[k,j,N],encapsulation:2})};export{q as AdminInvoiceDetailPage};
