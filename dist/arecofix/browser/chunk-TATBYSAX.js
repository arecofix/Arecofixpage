import{a as $}from"./chunk-JYOT3LNB.js";import{a as L}from"./chunk-F5WBDNED.js";import{a as A}from"./chunk-F4YL3ILH.js";import{B,h as j,l as N,y as D}from"./chunk-RVT6AV4G.js";import{$ as E,Ab as t,Bb as i,Cb as u,Ib as P,Mb as M,Ob as s,Pa as f,R as y,Ua as o,W as c,Wb as R,Xb as n,Yb as d,Zb as p,aa as C,gb as k,gc as F,ma as v,nc as S,pc as h,tb as m,ub as g,wb as w,xb as I,yb as T,zb as _}from"./chunk-G4WDTWI7.js";import"./chunk-7CGTOI24.js";var b=class a{auth=c($);async getRepairByCode(r){return await this.auth.getSupabaseClient().rpc("get_repair_by_tracking",{code:r})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=y({token:a,factory:a.\u0275fac,providedIn:"root"})};function q(a,r){a&1&&(t(0,"div",6),u(1,"span",7),t(2,"p",8),n(3,"Buscando reparaci\xF3n..."),i()())}function z(a,r){if(a&1&&(t(0,"div",9),u(1,"i",10),t(2,"span"),n(3),i()(),t(4,"div",11)(5,"a",12),n(6,"Volver al Inicio"),i()()),a&2){let e=s();o(3),d(e.error())}}function G(a,r){if(a&1&&(t(0,"div",15)(1,"span",16),n(2,"Fecha Completado"),i(),t(3,"span",18),n(4),S(5,"date"),i()()),a&2){let e=s();o(4),d(h(5,1,e.completed_at,"dd/MM/yyyy"))}}function H(a,r){if(a&1&&(t(0,"div",19)(1,"span",20),n(2,"Diagn\xF3stico / Soluci\xF3n"),i(),t(3,"p",33),n(4),i()()),a&2){let e=s();o(4),p(" ",e.technician_notes," ")}}function J(a,r){if(a&1){let e=P();t(0,"div",36)(1,"img",37),M("click",function(){let x=E(e).$implicit,V=s(3);return C(V.openImage(x))}),i()()}if(a&2){let e=r.$implicit;o(),_("src",e,f)}}function K(a,r){if(a&1&&(t(0,"div",19)(1,"span",34),n(2,"Im\xE1genes del Estado"),i(),t(3,"div",35),I(4,J,2,1,"div",36,w),i()()),a&2){let e=s();o(4),T(e.images)}}function Q(a,r){if(a&1&&(t(0,"div",13)(1,"div"),n(2),i()(),t(3,"div",14)(4,"div",15)(5,"span",16),n(6,"C\xF3digo de Seguimiento"),i(),t(7,"span",17),n(8),i()(),t(9,"div",15)(10,"span",16),n(11,"Dispositivo"),i(),t(12,"span",18),n(13),i()(),t(14,"div",15)(15,"span",16),n(16,"IMEI / Serie"),i(),t(17,"span",18),n(18),i()(),t(19,"div",15)(20,"span",16),n(21,"Cliente"),i(),t(22,"span",18),n(23),i()(),t(24,"div",15)(25,"span",16),n(26,"Fecha Ingreso"),i(),t(27,"span",18),n(28),S(29,"date"),i()(),m(30,G,6,4,"div",15),t(31,"div",19)(32,"span",20),n(33,"Problema Reportado"),i(),t(34,"p",21),n(35),i()(),m(36,H,5,1,"div",19),m(37,K,6,0,"div",19),t(38,"div",22)(39,"div",23)(40,"span",24),n(41,"Presupuesto"),i(),t(42,"span",18),n(43),i()(),t(44,"div",25)(45,"span",26),n(46,"Se\xF1a"),i(),t(47,"span",27),n(48),i()(),u(49,"div",28),t(50,"div",29)(51,"span",18),n(52,"Total a Pagar"),i(),t(53,"span",17),n(54),i()()()(),t(55,"div",30)(56,"a",31),u(57,"i",32),n(58," Consultar "),i()()),a&2){let e=r,l=s();o(),R(F("badge ",l.getStatusColor(e.status)," badge-lg p-4 font-bold uppercase")),o(),p(" ",l.getStatusLabel(e.status)," "),o(6),d(e.tracking_code),o(5),d(e.device_model),o(5),d(e.imei||"N/A"),o(5),d(e.customer_name),o(5),d(h(29,17,e.received_at||e.created_at,"dd/MM/yyyy")),o(2),g(e.completed_at?30:-1),o(5),d(e.issue_description),o(),g(e.technician_notes&&(e.status==="completed"||e.status==="delivered")?36:-1),o(),g(e.images&&e.images.length>0?37:-1),o(6),p("$",e.estimated_cost),o(5),p("-$",e.deposit_amount),o(6),p("$",(e.final_cost||e.estimated_cost||0)-(e.deposit_amount||0)),o(2),_("href","https://wa.me/"+l.whatsappNumber,f)}}var O=class a{route=c(D);trackingService=c(b);logger=c(L);whatsappNumber=A.contact.whatsappNumber;code=null;repair=v(null);loading=v(!0);error=v(null);async ngOnInit(){this.code=this.route.snapshot.paramMap.get("code"),this.code?await this.loadRepair():(this.error.set("C\xF3digo de seguimiento no v\xE1lido."),this.loading.set(!1))}async loadRepair(){let r=this.code;if(r)try{let{data:e,error:l}=await this.trackingService.getRepairByCode(r);l?(this.logger.error("Error fetching repair:",l),this.error.set("Error al buscar la reparaci\xF3n. Por favor intente nuevamente.")):e&&Array.isArray(e)&&e.length>0?this.repair.set(e[0]):this.error.set("No se encontr\xF3 ninguna reparaci\xF3n con este c\xF3digo.")}catch(e){this.logger.error("TrackingPage: Unexpected error:",e),this.error.set("Ocurri\xF3 un error inesperado al procesar su solicitud.")}finally{this.loading.set(!1)}}getStatusLabel(r){return{pending:"Pendiente",in_progress:"En Progreso",completed:"Completado",delivered:"Entregado",cancelled:"Cancelado"}[r]||r}getStatusColor(r){return{pending:"badge-warning",in_progress:"badge-info",completed:"badge-success",delivered:"badge-success",cancelled:"badge-error"}[r]||"badge-ghost"}openImage(r){window.open(r,"_blank")}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-tracking-page"]],decls:11,vars:1,consts:[[1,"py-10","px-4"],[1,"max-w-md","mx-auto","bg-base-100","rounded-xl","shadow-xl","overflow-hidden","text-base-content"],[1,"bg-primary","p-6","text-center"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-primary-content","opacity-80","text-sm"],[1,"p-6"],[1,"flex","flex-col","items-center","justify-center","py-8"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"mt-4","text-base-content/70"],[1,"alert","alert-error"],[1,"fas","fa-exclamation-circle"],[1,"mt-6","text-center"],["routerLink","/",1,"btn","btn-outline","btn-sm"],[1,"flex","justify-center","mb-6"],[1,"space-y-4"],[1,"flex","justify-between","border-b","border-base-200","pb-2"],[1,"font-semibold","text-base-content/70"],[1,"font-bold","text-primary"],[1,"font-bold","text-base-content"],[1,"py-2"],[1,"block","font-semibold","text-base-content/70","mb-1"],[1,"text-sm","bg-base-200","p-3","rounded-lg","text-base-content"],[1,"bg-base-200","p-4","rounded-lg","mt-4"],[1,"flex","justify-between","mb-1"],[1,"text-sm","text-base-content/70"],[1,"flex","justify-between","mb-1","text-green-600","dark:text-green-400"],[1,"text-sm"],[1,"font-bold"],[1,"divider","my-1"],[1,"flex","justify-between","text-lg"],[1,"mt-8","text-center"],["target","_blank",1,"btn","btn-success","btn-wide","text-white",3,"href"],[1,"fab","fa-whatsapp","mr-2"],[1,"text-sm","bg-green-50","p-3","rounded-lg","border","border-green-100","text-green-800"],[1,"block","font-semibold","text-base-content/70","mb-2"],[1,"grid","grid-cols-2","gap-2"],[1,"aspect-square","bg-base-200","rounded-lg","overflow-hidden","border","border-base-300"],["alt","Estado del equipo",1,"w-full","h-full","object-cover","cursor-pointer","hover:opacity-90","transition-opacity",3,"click","src"]],template:function(e,l){if(e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),n(4,"Estado de Reparaci\xF3n"),i(),t(5,"p",4),n(6,"Seguimiento en tiempo real"),i()(),t(7,"div",5),m(8,q,4,0,"div",6)(9,z,7,1)(10,Q,59,20),i()()()),e&2){let x;o(8),g(l.loading()?8:l.error()?9:(x=l.repair())?10:-1,x)}},dependencies:[N,B,j],encapsulation:2})};export{O as TrackingPage};
