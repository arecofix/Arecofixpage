import{a as G}from"./chunk-E4L524TD.js";import{a as A,b as I,c as o,d as P,e as j,h as q,i as D,j as V,k as R,l as T,m as O,n as U,r as k,t as B}from"./chunk-ROKQGBVC.js";import{a as w}from"./chunk-RZKRXCEK.js";import"./chunk-XFT2X3PC.js";import{a as _,c as N,d as F}from"./chunk-CYIQDGHK.js";import"./chunk-BVKNO7TK.js";import"./chunk-RZVF5N6E.js";import"./chunk-T7AXESXA.js";import"./chunk-BKULT56L.js";import{Cb as v,Eb as y,Ha as C,La as s,Mb as i,Ob as b,Y as u,Za as S,jb as g,kb as f,pb as c,qb as t,rb as e,sb as n}from"./chunk-YATSW66L.js";import"./chunk-VOSPIT4N.js";function z(m,l){if(m&1&&(t(0,"div",36),n(1,"img",42),e()),m&2){let r,a=y();s(),c("src",(r=a.form.get("image_url"))==null?null:r.value,C)}}function $(m,l){m&1&&n(0,"span",41)}var L=class m{fb=u(k);coursesService=u(G);router=u(N);route=u(_);auth=u(w);form;isEditing=!1;courseId=null;saving=!1;constructor(){this.form=this.fb.group({title:["",o.required],slug:["",o.required],description:["",o.required],price:[0,[o.required,o.min(0)]],sale_price:[null],level:["B\xE1sico",o.required],duration:["",o.required],schedule:["",o.required],image_url:["",o.required],is_active:[!0]})}ngOnInit(){this.courseId=this.route.snapshot.paramMap.get("id"),this.courseId&&(this.isEditing=!0,this.loadCourse(this.courseId))}async onFileChange(l){let r=l.target.files?.[0];if(!r)return;this.saving=!0;let a=this.auth.getSupabaseClient(),d=r.name.split(".").pop(),x=`courses/${`${Date.now()}.${d}`}`;try{let{data:p,error:E}=await a.storage.from("public-assets").upload(x,r);if(E)throw E;let{data:M}=a.storage.from("public-assets").getPublicUrl(x);this.form.patchValue({image_url:M.publicUrl})}catch(p){console.error("Error uploading image:",p),alert("Error al subir la imagen: "+p.message)}finally{this.saving=!1}}loadCourse(l){this.coursesService.getCourseById(l).subscribe({next:r=>{r.data&&this.form.patchValue(r.data)},error:r=>console.error("Error loading course",r)})}save(){if(this.form.invalid)return;this.saving=!0;let l=this.form.value;(this.isEditing&&this.courseId?this.coursesService.updateCourse(this.courseId,l):this.coursesService.createCourse(l)).subscribe({next:()=>{this.saving=!1,this.router.navigate(["/admin/courses"])},error:a=>{console.error("Error saving course",a),alert("Error al guardar: "+a.message),this.saving=!1}})}static \u0275fac=function(r){return new(r||m)};static \u0275cmp=S({type:m,selectors:[["app-admin-course-form-page"]],decls:100,vars:6,consts:[[1,"max-w-4xl","mx-auto"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold"],["routerLink","/admin/courses",1,"btn","btn-ghost"],[1,"fas","fa-arrow-left","mr-2"],[1,"card","bg-base-100","shadow-lg"],[1,"card-body","p-6"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"form-control"],[1,"label"],[1,"label-text","font-medium"],[1,"input","input-bordered","flex","items-center","gap-2"],[1,"fas","fa-heading","text-gray-400"],["type","text","formControlName","title","placeholder","Ej: Reparaci\xF3n de iPhone",1,"grow"],[1,"fas","fa-link","text-gray-400"],["type","text","formControlName","slug","placeholder","ej: reparacion-iphone",1,"grow"],[1,"label-text-alt","text-xs","text-gray-500"],["formControlName","description","placeholder","Breve resumen del curso...",1,"textarea","textarea-bordered","h-24","leading-relaxed"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"fas","fa-dollar-sign","text-gray-400"],["type","number","formControlName","price",1,"grow"],[1,"fas","fa-tag","text-gray-400"],["type","number","formControlName","sale_price",1,"grow"],["formControlName","level",1,"select","select-bordered","w-full"],["value","B\xE1sico"],["value","Intermedio"],["value","Avanzado"],["value","Todos los niveles"],[1,"fas","fa-clock","text-gray-400"],["type","text","formControlName","duration","placeholder","Ej: 3 meses",1,"grow"],[1,"fas","fa-calendar-alt","text-gray-400"],["type","text","formControlName","schedule","placeholder","Ej: Lunes 18hs",1,"grow"],[1,"flex","flex-col","gap-4"],["type","text","formControlName","image_url","placeholder","https://...",1,"grow"],["type","file","accept","image/*",1,"file-input","file-input-bordered","w-full",3,"change"],[1,"mt-4","p-4","border","rounded-lg","bg-base-200","flex","justify-center","relative","group"],[1,"label","cursor-pointer","justify-start","gap-4","p-0"],["type","checkbox","formControlName","is_active",1,"toggle","toggle-success"],[1,"flex","justify-end","gap-4","pt-6","border-t","border-base-200"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner"],["alt","Preview","onerror","this.style.display='none'",1,"h-48","rounded","object-cover","shadow-sm",3,"src"]],template:function(r,a){if(r&1&&(t(0,"div",0)(1,"div",1)(2,"h2",2),i(3),e(),t(4,"a",3),n(5,"i",4),i(6," Volver "),e()(),t(7,"div",5)(8,"div",6)(9,"form",7),v("ngSubmit",function(){return a.save()}),t(10,"div",8)(11,"div",9)(12,"label",10)(13,"span",11),i(14,"T\xEDtulo"),e()(),t(15,"label",12),n(16,"i",13)(17,"input",14),e()(),t(18,"div",9)(19,"label",10)(20,"span",11),i(21,"Slug (URL)"),e()(),t(22,"label",12),n(23,"i",15)(24,"input",16),e(),t(25,"label",10)(26,"span",17),i(27,"Identificador \xFAnico para la URL"),e()()()(),t(28,"div",9)(29,"label",10)(30,"span",11),i(31,"Descripci\xF3n Corta"),e()(),n(32,"textarea",18),e(),t(33,"div",19)(34,"div",9)(35,"label",10)(36,"span",11),i(37,"Precio"),e()(),t(38,"label",12),n(39,"i",20)(40,"input",21),e()(),t(41,"div",9)(42,"label",10)(43,"span",11),i(44,"Precio Oferta (Opcional)"),e()(),t(45,"label",12),n(46,"i",22)(47,"input",23),e()(),t(48,"div",9)(49,"label",10)(50,"span",11),i(51,"Nivel"),e()(),t(52,"select",24)(53,"option",25),i(54,"B\xE1sico"),e(),t(55,"option",26),i(56,"Intermedio"),e(),t(57,"option",27),i(58,"Avanzado"),e(),t(59,"option",28),i(60,"Todos los niveles"),e()()()(),t(61,"div",8)(62,"div",9)(63,"label",10)(64,"span",11),i(65,"Duraci\xF3n"),e()(),t(66,"label",12),n(67,"i",29)(68,"input",30),e()(),t(69,"div",9)(70,"label",10)(71,"span",11),i(72,"Horario"),e()(),t(73,"label",12),n(74,"i",31)(75,"input",32),e()()(),t(76,"div",9)(77,"label",10)(78,"span",11),i(79,"Imagen del Curso"),e()(),t(80,"div",33)(81,"label",12),n(82,"i",15)(83,"input",34),e(),t(84,"input",35),v("change",function(h){return a.onFileChange(h)}),e(),t(85,"label",10)(86,"span",17),i(87,"Sube una imagen o pega una URL"),e()()(),g(88,z,2,1,"div",36),e(),t(89,"div",9)(90,"label",37)(91,"span",11),i(92,"Curso Activo"),e(),n(93,"input",38),e()(),t(94,"div",39)(95,"a",3),i(96,"Cancelar"),e(),t(97,"button",40),g(98,$,1,0,"span",41),i(99),e()()()()()()),r&2){let d;s(3),b(" ",a.isEditing?"Editar Curso":"Nuevo Curso"," "),s(6),c("formGroup",a.form),s(79),f((d=a.form.get("image_url"))!=null&&d.value?88:-1),s(9),c("disabled",a.form.invalid||a.saving),s(),f(a.saving?98:-1),s(),b(" ",a.isEditing?"Actualizar":"Crear Curso"," ")}},dependencies:[B,q,O,U,I,D,A,T,P,j,R,V,F],encapsulation:2})};export{L as AdminCourseFormPage};
