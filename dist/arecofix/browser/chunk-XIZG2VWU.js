import{a as oe}from"./chunk-MMX2KHFQ.js";import"./chunk-BGHZUC77.js";import{d as ie}from"./chunk-6WWONRBM.js";import{a as re}from"./chunk-MQUL3GSM.js";import{b as U,d as z,e as G,f as H,g as Q,h as J,i as K,m as X,n as Y,o as Z,p as ee,q as te,t as ne}from"./chunk-63CMMPDH.js";import"./chunk-6MFU4D2Y.js";import"./chunk-YTQUIG7T.js";import"./chunk-QBOH7QZY.js";import{l as R,n as $,o as j}from"./chunk-YNFFGNY6.js";import"./chunk-Q44XB7TV.js";import{$ as u,$b as b,Ab as i,Bb as r,Cb as x,Ec as B,Gb as A,Kb as _,Mb as y,R as T,Rb as L,Ua as l,Vb as d,W as h,Wb as D,Xb as w,Yb as q,Zb as p,_b as g,aa as c,gb as W,ma as O,sb as I,tb as M,ub as E,vb as N,xb as V,yb as k,zb as f}from"./chunk-DX2LKEMG.js";import{a as C,b as S}from"./chunk-C6Q5SG76.js";var P=class m{statusTranslations={pending:"Pendiente",processing:"Procesando env\xEDo/retiro",completed:"Completado",cancelled:"Cancelado"};getStatusLabel(t){return this.statusTranslations[t]||t}generateWhatsAppLink(t,n,e,a,s){if(!t)return null;let o=t.replace(/\D/g,"");o.length===10&&(o="549"+o),o.startsWith("0")&&(o=o.substring(1),o.length===10&&(o="549"+o));let v="";if(e==="completed")v=`Hola ${n}, te contactamos de Arecofix. Tu pedido #${a} por [${s}] ya ha llegado y est\xE1 listo. \xA1Muchas gracias por tu compra!`;else{let se=this.getStatusLabel(e);v=`Hola ${n}, te contactamos de Arecofix. 

El estado de tu compra (Pedido #${a}) se ha actualizado a: *${se}*. 

Cualquier consulta estamos a tu disposici\xF3n.`}let F=encodeURIComponent(v);return`https://wa.me/${o}?text=${F}`}static \u0275fac=function(n){return new(n||m)};static \u0275prov=T({token:m,factory:m.\u0275fac,providedIn:"root"})};var le=(m,t)=>t.id;function me(m,t){m&1&&(i(0,"div",26),x(1,"i",45),i(2,"p"),d(3,"No hay productos agregados"),r()())}function ue(m,t){if(m&1&&(i(0,"option",56),d(1),r()),m&2){let n=t.$implicit;f("value",n.name),l(),q("",n.sku," - $",n.price)}}function ce(m,t){if(m&1){let n=A();i(0,"tr",52)(1,"td",53)(2,"input",54),_("ngModelChange",function(a){let s=u(n).$index,o=y(2);return c(o.onSearchProduct(s,a))}),r(),i(3,"datalist",55),V(4,ue,2,3,"option",56,le),r()(),i(6,"td")(7,"input",57),b("ngModelChange",function(a){let s=u(n).$implicit;return g(s.quantity,a)||(s.quantity=a),c(a)}),_("ngModelChange",function(){let a=u(n).$index,s=y(2);return c(s.onQuantityChange(a))}),r()(),i(8,"td",58)(9,"input",59),b("ngModelChange",function(a){let s=u(n).$implicit;return g(s.unit_price,a)||(s.unit_price=a),c(a)}),_("ngModelChange",function(){let a=u(n).$index,s=y(2);return c(s.onUnitPriceChange(a))}),r()(),i(10,"td",60),d(11),r(),i(12,"td",61)(13,"button",62),_("click",function(){let a=u(n).$index,s=y(2);return c(s.removeItem(a))}),x(14,"i",63),r()()()}if(m&2){let n=t.$implicit,e=t.$index,a=y(2);l(2),f("ngModel",n.product_name)("name","product_"+e),I("list","products-list-"+e),l(),f("id","products-list-"+e),l(),k(a.products),l(3),p("ngModel",n.quantity),f("name","quantity_"+e),l(2),p("ngModel",n.unit_price),f("name","price_"+e),l(2),w("$",n.subtotal.toFixed(2)," ")}}function pe(m,t){if(m&1&&(i(0,"div",27)(1,"table",46)(2,"thead")(3,"tr",47)(4,"th",48),d(5,"Producto"),r(),i(6,"th",49),d(7,"Cantidad"),r(),i(8,"th",50),d(9,"Precio Unit."),r(),i(10,"th",50),d(11,"Subtotal"),r(),x(12,"th",51),r()(),i(13,"tbody"),V(14,ce,15,9,"tr",52,N),r()()()),m&2){let n=y();l(14),k(n.items())}}function ge(m,t){if(m&1&&(i(0,"div",40),x(1,"i",64),i(2,"span"),d(3),r()()),m&2){let n=y();l(3),D(n.error)}}function be(m,t){m&1&&x(0,"span",44)}var ae=class m{route=h(R);router=h($);orderService=h(oe);authService=h(ie);orderNotificationService=h(P);productRepository=h(re);cdr=h(B);id=null;loading=!0;saving=!1;error=null;originalStatus=null;products=[];form=O({customer_name:"",customer_email:"",customer_phone:"",shipping_address:{street:"",number:"",city:"Marcos Paz",neighborhood:""},status:"pending",subtotal:0,tax:0,discount:0,total:0,notes:""});items=O([]);async ngOnInit(){this.id=this.route.snapshot.paramMap.get("id"),await this.loadProducts(),this.id&&await this.loadOrder(),this.loading=!1,this.cdr.markForCheck()}async loadProducts(){this.productRepository.findAvailable().subscribe({next:t=>{this.products=t.map(n=>({id:n.id,name:n.name,sku:n.sku||"",price:n.price,stock:n.stock||0})),this.cdr.markForCheck()},error:t=>console.error("Error loading products",t)})}async loadOrder(){this.id&&this.orderService.getOrderById(this.id).subscribe({next:t=>{let n=t.shipping_address;typeof n=="string"&&(n={street:n,number:"",city:"Marcos Paz",neighborhood:""}),this.form.set({customer_name:t.customer_name,customer_email:t.customer_email,customer_phone:t.customer_phone,shipping_address:n||{street:"",number:"",city:"",neighborhood:""},status:t.status,subtotal:t.subtotal,tax:t.tax,discount:t.discount,total:t.total,notes:t.notes}),this.items.set(t.items),this.originalStatus=t.status,this.cdr.markForCheck()},error:t=>{this.error=t.message||"Error desconocido",this.cdr.markForCheck()}})}addItem(){this.items.update(t=>[...t,{product_name:"",quantity:1,unit_price:0,subtotal:0}]),this.cdr.markForCheck()}removeItem(t){this.items.update(n=>n.filter((e,a)=>a!==t)),this.calculateTotals()}onSearchProduct(t,n){let e=this.products.find(a=>a.name===n);this.items.update(a=>{let s=[...a];return e?s[t]=S(C({},s[t]),{product_id:e.id,product_name:e.name,product_sku:e.sku,unit_price:e.price,subtotal:e.price*s[t].quantity}):s[t]=S(C({},s[t]),{product_id:void 0,product_name:n,product_sku:void 0}),s}),this.calculateTotals()}onUnitPriceChange(t){this.items.update(n=>{let e=[...n];return e[t].subtotal=e[t].unit_price*e[t].quantity,e}),this.calculateTotals()}onQuantityChange(t){this.items.update(n=>{let e=[...n];return e[t].subtotal=e[t].unit_price*e[t].quantity,e}),this.calculateTotals()}calculateTotals(){let t=this.items().reduce((v,F)=>v+F.subtotal,0),n=this.form().discount||0,e=.21,a=t-n,s=a*e,o=a+s;this.form.update(v=>S(C({},v),{subtotal:t,tax:s,total:o})),this.cdr.markForCheck()}updateStatus(t){this.form.update(n=>S(C({},n),{status:t})),this.cdr.markForCheck()}async save(){if(this.items().length===0){this.error="Debes agregar al menos un producto",this.cdr.markForCheck();return}this.saving=!0,this.error=null;try{let t;this.id?t=await this.orderService.updateOrder(this.id,this.form(),this.items()):t=await this.orderService.createOrder(this.form(),this.items());let{error:n}=t;if(n)throw n;if(this.id&&this.originalStatus&&this.form().status!==this.originalStatus){let e=this.form(),a=this.items().map(o=>`${o.quantity}x ${o.product_name}`).join(", "),s=this.orderNotificationService.generateWhatsAppLink(e.customer_phone||"",e.customer_name,e.status,t.data?.order_number||this.id.substring(0,8).toUpperCase(),a);s&&window.open(s,"_blank")}this.router.navigate(["/admin/orders"])}catch(t){this.error=t.message||"Error al guardar pedido",this.saving=!1,this.cdr.markForCheck()}}static \u0275fac=function(n){return new(n||m)};static \u0275cmp=W({type:m,selectors:[["app-admin-order-form-page"]],decls:100,vars:19,consts:[["f","ngForm"],[1,"max-w-4xl","mx-auto","text-base-content"],[1,"text-2xl","font-bold","mb-6","text-green-600"],[3,"ngSubmit"],[1,"bg-base-100","p-6","rounded-xl","shadow-sm","border","border-base-200","mb-6","text-base-content"],[1,"text-lg","font-semibold","mb-4","text-base-content","border-b","border-base-200","pb-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-base-content","mb-1.5"],["type","text","name","customer_name","required","",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["type","email","name","customer_email","required","",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["type","tel","name","customer_phone",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],[1,"md:col-span-2","grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"md:col-span-2"],["type","text","name","address_street",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["type","text","name","address_number",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["type","text","name","address_city",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["name","status",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["value","pending"],["value","paid"],["value","shipped"],["value","completed"],["value","cancelled"],[1,"flex","justify-between","items-center","mb-4","border-b","border-base-200","pb-2"],[1,"text-lg","font-semibold","text-base-content"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"fas","fa-plus","mr-2"],[1,"text-center","py-8","text-gray-500","bg-gray-50","rounded-lg","border","border-dashed","border-gray-300"],[1,"overflow-x-auto"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-8"],[1,"space-y-4"],["type","number","name","discount","min","0","step","0.01",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["name","notes","rows","3",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],[1,"bg-base-200","p-6","rounded-xl","border","border-base-300","h-fit"],[1,"space-y-3"],[1,"flex","justify-between","text-base-content/80"],[1,"font-mono","font-medium"],[1,"font-mono","font-medium","text-error"],[1,"divider","my-2"],[1,"flex","justify-between","text-xl","font-bold","text-base-content"],[1,"font-mono","text-primary"],[1,"alert","alert-error","mb-6"],[1,"flex","gap-4","justify-end","mb-8"],["routerLink","/admin/orders",1,"btn","btn-error","text-white"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner","loading-xs","mr-2"],[1,"fas","fa-box-open","text-4xl","mb-2","text-gray-400"],[1,"table","w-full"],[1,"text-base-content","border-b-2","border-base-200"],[1,"font-semibold"],[1,"font-semibold","w-24"],[1,"font-semibold","text-right"],[1,"w-10"],[1,"border-b","border-base-200","hover:bg-base-200/50"],[1,"min-w-[200px]"],["type","text","placeholder","Buscar producto o escribir uno...","required","","autocomplete","off",1,"input","input-bordered","input-sm","w-full","bg-base-100","text-base-content","border-base-300",3,"ngModelChange","ngModel","name"],[3,"id"],[3,"value"],["type","number","min","1",1,"input","input-bordered","input-sm","w-full","bg-base-100","text-base-content","border-base-300",3,"ngModelChange","ngModel","name"],[1,"font-mono","text-right","text-base-content/80"],["type","number","min","0","step","0.01",1,"input","input-bordered","input-sm","w-full","bg-base-100","text-base-content","border-base-300","text-right",3,"ngModelChange","ngModel","name"],[1,"font-mono","font-semibold","text-right","text-base-content"],[1,"text-right"],["type","button",1,"btn","btn-ghost","btn-sm","btn-circle","text-error","hover:bg-red-50",3,"click"],[1,"fas","fa-trash"],[1,"fas","fa-exclamation-circle"]],template:function(n,e){if(n&1){let a=A();i(0,"div",1)(1,"h2",2),d(2),r(),i(3,"form",3,0),_("ngSubmit",function(){return u(a),c(e.save())}),i(5,"div",4)(6,"h3",5),d(7,"Informaci\xF3n del Cliente"),r(),i(8,"div",6)(9,"div")(10,"label",7),d(11,"Nombre *"),r(),i(12,"input",8),b("ngModelChange",function(o){return u(a),g(e.form().customer_name,o)||(e.form().customer_name=o),c(o)}),r()(),i(13,"div")(14,"label",7),d(15,"Email *"),r(),i(16,"input",9),b("ngModelChange",function(o){return u(a),g(e.form().customer_email,o)||(e.form().customer_email=o),c(o)}),r()(),i(17,"div")(18,"label",7),d(19,"Tel\xE9fono"),r(),i(20,"input",10),b("ngModelChange",function(o){return u(a),g(e.form().customer_phone,o)||(e.form().customer_phone=o),c(o)}),r()(),i(21,"div",11)(22,"div",12)(23,"label",7),d(24,"Calle"),r(),i(25,"input",13),b("ngModelChange",function(o){return u(a),g(e.form().shipping_address.street,o)||(e.form().shipping_address.street=o),c(o)}),r()(),i(26,"div")(27,"label",7),d(28,"Nro"),r(),i(29,"input",14),b("ngModelChange",function(o){return u(a),g(e.form().shipping_address.number,o)||(e.form().shipping_address.number=o),c(o)}),r()(),i(30,"div")(31,"label",7),d(32,"Ciudad"),r(),i(33,"input",15),b("ngModelChange",function(o){return u(a),g(e.form().shipping_address.city,o)||(e.form().shipping_address.city=o),c(o)}),r()()(),i(34,"div",12)(35,"label",7),d(36,"Estado"),r(),i(37,"select",16),_("ngModelChange",function(o){return u(a),c(e.updateStatus(o))}),i(38,"option",17),d(39,"Pendiente"),r(),i(40,"option",18),d(41,"Pagado"),r(),i(42,"option",19),d(43,"Enviado"),r(),i(44,"option",20),d(45,"Completado"),r(),i(46,"option",21),d(47,"Cancelado"),r()()()()(),i(48,"div",4)(49,"div",22)(50,"h3",23),d(51,"Productos"),r(),i(52,"button",24),_("click",function(){return u(a),c(e.addItem())}),x(53,"i",25),d(54," Agregar Producto "),r()(),M(55,me,4,0,"div",26)(56,pe,16,0,"div",27),r(),i(57,"div",4)(58,"h3",5),d(59,"Totales y Notas"),r(),i(60,"div",28)(61,"div",29)(62,"div")(63,"label",7),d(64,"Descuento"),r(),i(65,"input",30),b("ngModelChange",function(o){return u(a),g(e.form().discount,o)||(e.form().discount=o),c(o)}),_("ngModelChange",function(){return u(a),c(e.calculateTotals())}),r()(),i(66,"div")(67,"label",7),d(68,"Notas"),r(),i(69,"textarea",31),b("ngModelChange",function(o){return u(a),g(e.form().notes,o)||(e.form().notes=o),c(o)}),r()()(),i(70,"div",32)(71,"div",33)(72,"div",34)(73,"span"),d(74,"Subtotal:"),r(),i(75,"span",35),d(76),r()(),i(77,"div",34)(78,"span"),d(79,"Descuento:"),r(),i(80,"span",36),d(81),r()(),i(82,"div",34)(83,"span"),d(84,"IVA (21%):"),r(),i(85,"span",35),d(86),r()(),x(87,"div",37),i(88,"div",38)(89,"span"),d(90,"Total:"),r(),i(91,"span",39),d(92),r()()()()()(),M(93,ge,4,1,"div",40),i(94,"div",41)(95,"a",42),d(96,"Cancelar"),r(),i(97,"button",43),M(98,be,1,0,"span",44),d(99),r()()()()}if(n&2){let a=L(4);l(2),w("",e.id?"Editar":"Nuevo"," Pedido"),l(10),p("ngModel",e.form().customer_name),l(4),p("ngModel",e.form().customer_email),l(4),p("ngModel",e.form().customer_phone),l(5),p("ngModel",e.form().shipping_address.street),l(4),p("ngModel",e.form().shipping_address.number),l(4),p("ngModel",e.form().shipping_address.city),l(4),f("ngModel",e.form().status),l(18),E(e.items().length===0?55:56),l(10),p("ngModel",e.form().discount),l(4),p("ngModel",e.form().notes),l(7),w("$",e.form().subtotal.toFixed(2)),l(5),w("-$",e.form().discount.toFixed(2)),l(5),w("$",e.form().tax.toFixed(2)),l(6),w("$",e.form().total.toFixed(2)),l(),E(e.error?93:-1),l(4),f("disabled",e.saving||a.invalid),l(),E(e.saving?98:-1),l(),w(" ",e.saving?"Guardando...":"Guardar Pedido"," ")}},dependencies:[ne,J,Y,Z,U,K,X,z,G,te,ee,Q,H,j],encapsulation:2,changeDetection:0})};export{ae as AdminOrderFormPage};
