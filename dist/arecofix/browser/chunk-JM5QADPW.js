import{a as W}from"./chunk-DJUFVP4V.js";import{b as T,d as N,e as D,f as F,g as B,h as I,i as L,l as U,m as j,n as V,p as R,s as O}from"./chunk-ROFL7FBC.js";import"./chunk-YUNB63IX.js";import"./chunk-F4YL3ILH.js";import{l as A}from"./chunk-PNC5ZYCG.js";import{$b as p,Ab as n,Bb as i,Cb as m,Mb as C,Ob as S,Pa as E,Ua as r,W as x,Wb as o,Xb as w,_b as g,ac as u,gb as P,ma as f,tb as y,ub as _,zb as h}from"./chunk-YEQHDEKA.js";import{a as b,b as M,c as v}from"./chunk-7CGTOI24.js";function z(d,s){if(d&1&&(n(0,"div",5),m(1,"i",41),n(2,"span"),o(3),i()()),d&2){let a=S();r(3),w(a.error())}}function H(d,s){if(d&1&&(n(0,"div",6),m(1,"i",42),n(2,"span"),o(3),i()()),d&2){let a=S();r(3),w(a.success())}}function J(d,s){if(d&1&&(n(0,"div",37),m(1,"img",43),i()),d&2){let a=S();r(),h("src",a.form().logo_url,E)}}function K(d,s){d&1&&m(0,"span",40)}var q=class d{auth=x(W);form=f({id:"",name:"",owner_name:"",ruc:"",address:"",tax_percentage:21,tax_abbreviation:"IVA",email:"",phone:"",location:"",currency:"ARS",logo_url:""});loading=f(!0);saving=f(!1);error=f(null);success=f(null);async ngOnInit(){await this.loadSettings()}async loadSettings(){this.loading.set(!0);let s=this.auth.getSupabaseClient(),{data:a,error:e}=await s.from("company_settings").select("*").maybeSingle();a?this.form.set({id:a.id,name:a.name,owner_name:a.owner_name||"",ruc:a.ruc||"",address:a.address||"",tax_percentage:a.tax_percentage||21,tax_abbreviation:a.tax_abbreviation||"IVA",email:a.email||"",phone:a.phone||"",location:a.location||"",currency:a.currency||"ARS",logo_url:a.logo_url||""}):e&&e.code!=="PGRST116"&&this.error.set(e.message),this.loading.set(!1)}async onFileChange(s){let a=s.target.files?.[0];if(!a)return;let e=this.auth.getSupabaseClient(),l=`company/${Date.now()}-${a.name}`,{data:t,error:c}=await e.storage.from("public-assets").upload(l,a);if(c){this.error.set(c.message);return}let{data:G}=e.storage.from("public-assets").getPublicUrl(t.path);this.form.update(k=>M(b({},k),{logo_url:G.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null),this.success.set(null);let s=this.auth.getSupabaseClient(),t=b({},this.form()),{id:e}=t,l=v(t,["id"]);try{if(e){let{error:c}=await s.from("company_settings").update(l).eq("id",e);if(c)throw c}else{let{error:c}=await s.from("company_settings").insert(l);if(c)throw c}this.success.set("Configuraci\xF3n guardada correctamente"),await this.loadSettings()}catch(c){this.error.set(c.message)}finally{this.saving.set(!1)}}static \u0275fac=function(a){return new(a||d)};static \u0275cmp=P({type:d,selectors:[["app-admin-company-settings-page"]],decls:99,vars:15,consts:[[1,"max-w-4xl","mx-auto"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold"],[1,"card","bg-base-100","shadow-lg"],[1,"card-body","p-6"],[1,"alert","alert-error","mb-4","shadow-sm"],[1,"alert","alert-success","mb-4","shadow-sm"],[1,"space-y-6",3,"ngSubmit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"form-control"],[1,"label"],[1,"label-text","font-medium"],[1,"input","input-bordered","flex","items-center","gap-2"],[1,"fas","fa-building","text-gray-400"],["type","text","name","name","required","",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-user","text-gray-400"],["type","text","name","owner_name",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-id-card","text-gray-400"],["type","text","name","ruc",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-map-marker-alt","text-gray-400"],["type","text","name","address",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-envelope","text-gray-400"],["type","email","name","email",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-phone","text-gray-400"],["type","text","name","phone",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-globe","text-gray-400"],["type","text","name","location","placeholder","Ej: Buenos Aires, Argentina",1,"grow",3,"ngModelChange","ngModel"],[1,"divider","text-sm","font-medium","text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"fas","fa-percent","text-gray-400"],["type","number","name","tax_percentage",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-tag","text-gray-400"],["type","text","name","tax_abbreviation","placeholder","Ej: IVA",1,"grow",3,"ngModelChange","ngModel"],["name","currency",1,"select","select-bordered","w-full",3,"ngModelChange","ngModel"],["value","ARS"],["value","USD"],["type","file","accept","image/*",1,"file-input","file-input-bordered","w-full",3,"change"],[1,"mt-4","p-4","border","rounded-lg","bg-base-200","flex","justify-center"],[1,"flex","justify-end","gap-4","mt-8","pt-4","border-t","border-base-200"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-check-circle"],["alt","Logo preview",1,"h-32","object-contain",3,"src"]],template:function(a,e){a&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3,"Configuraci\xF3n de Empresa"),i()(),n(4,"div",3)(5,"div",4),y(6,z,4,1,"div",5),y(7,H,4,1,"div",6),n(8,"form",7),C("ngSubmit",function(){return e.save()}),n(9,"div",8)(10,"div",9)(11,"label",10)(12,"span",11),o(13,"Nombre de la Empresa"),i()(),n(14,"label",12),m(15,"i",13),n(16,"input",14),u("ngModelChange",function(t){return p(e.form().name,t)||(e.form().name=t),t}),i()()(),n(17,"div",9)(18,"label",10)(19,"span",11),o(20,"Propietario"),i()(),n(21,"label",12),m(22,"i",15),n(23,"input",16),u("ngModelChange",function(t){return p(e.form().owner_name,t)||(e.form().owner_name=t),t}),i()()()(),n(24,"div",8)(25,"div",9)(26,"label",10)(27,"span",11),o(28,"RUC / CUIT"),i()(),n(29,"label",12),m(30,"i",17),n(31,"input",18),u("ngModelChange",function(t){return p(e.form().ruc,t)||(e.form().ruc=t),t}),i()()(),n(32,"div",9)(33,"label",10)(34,"span",11),o(35,"Direcci\xF3n"),i()(),n(36,"label",12),m(37,"i",19),n(38,"input",20),u("ngModelChange",function(t){return p(e.form().address,t)||(e.form().address=t),t}),i()()()(),n(39,"div",8)(40,"div",9)(41,"label",10)(42,"span",11),o(43,"Email"),i()(),n(44,"label",12),m(45,"i",21),n(46,"input",22),u("ngModelChange",function(t){return p(e.form().email,t)||(e.form().email=t),t}),i()()(),n(47,"div",9)(48,"label",10)(49,"span",11),o(50,"Tel\xE9fono"),i()(),n(51,"label",12),m(52,"i",23),n(53,"input",24),u("ngModelChange",function(t){return p(e.form().phone,t)||(e.form().phone=t),t}),i()()()(),n(54,"div",9)(55,"label",10)(56,"span",11),o(57,"Ubicaci\xF3n"),i()(),n(58,"label",12),m(59,"i",25),n(60,"input",26),u("ngModelChange",function(t){return p(e.form().location,t)||(e.form().location=t),t}),i()()(),n(61,"div",27),o(62,"Configuraci\xF3n Fiscal"),i(),n(63,"div",28)(64,"div",9)(65,"label",10)(66,"span",11),o(67,"Porcentaje Impuesto (%)"),i()(),n(68,"label",12),m(69,"i",29),n(70,"input",30),u("ngModelChange",function(t){return p(e.form().tax_percentage,t)||(e.form().tax_percentage=t),t}),i()()(),n(71,"div",9)(72,"label",10)(73,"span",11),o(74,"Abreviatura Impuesto"),i()(),n(75,"label",12),m(76,"i",31),n(77,"input",32),u("ngModelChange",function(t){return p(e.form().tax_abbreviation,t)||(e.form().tax_abbreviation=t),t}),i()()(),n(78,"div",9)(79,"label",10)(80,"span",11),o(81,"Moneda"),i()(),n(82,"select",33),u("ngModelChange",function(t){return p(e.form().currency,t)||(e.form().currency=t),t}),n(83,"option",34),o(84,"ARS (Peso Argentino)"),i(),n(85,"option",35),o(86,"USD (D\xF3lar Estadounidense)"),i()()()(),n(87,"div",27),o(88,"Branding"),i(),n(89,"div",9)(90,"label",10)(91,"span",11),o(92,"Logo de la Empresa"),i()(),n(93,"input",36),C("change",function(t){return e.onFileChange(t)}),i(),y(94,J,2,1,"div",37),i(),n(95,"div",38)(96,"button",39),y(97,K,1,0,"span",40),o(98," Guardar Configuraci\xF3n "),i()()()()()()),a&2&&(r(6),_(e.error()?6:-1),r(),_(e.success()?7:-1),r(9),g("ngModel",e.form().name),r(7),g("ngModel",e.form().owner_name),r(8),g("ngModel",e.form().ruc),r(7),g("ngModel",e.form().address),r(8),g("ngModel",e.form().email),r(7),g("ngModel",e.form().phone),r(7),g("ngModel",e.form().location),r(10),g("ngModel",e.form().tax_percentage),r(7),g("ngModel",e.form().tax_abbreviation),r(5),g("ngModel",e.form().currency),r(12),_(e.form().logo_url?94:-1),r(2),h("disabled",e.saving()),r(),_(e.saving()?97:-1))},dependencies:[A,O,I,j,V,T,L,U,N,D,R,B,F],encapsulation:2})};export{q as AdminCompanySettingsPage};
