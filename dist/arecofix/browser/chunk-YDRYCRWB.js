import{a as k}from"./chunk-WKJZXT3A.js";import{a as R}from"./chunk-6C55BXVK.js";import{E as x,U as j,Y as w,Z as I,p as S,q,w as P}from"./chunk-25C2KVON.js";import{a as h,b as y}from"./chunk-VOSPIT4N.js";var A=class i{constructor(t){this.authService=t;this.supabase=this.authService.getSupabaseClient()}supabase;logger=I(R);getData(t={}){let{_page:r=1,_per_page:a=10,category_id:o,brand_id:u,description:f,featured:s,id:p,name:l,price:m,slug:g}=t,b=(r-1)*a,C=b+a-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return t.category_ids&&t.category_ids.length>0?e=e.in("category_id",t.category_ids):o!=null&&(e=e.eq("category_id",o)),u&&(e=e.eq("brand_id",u)),f&&(e=e.ilike("description",`%${f}%`)),s!=null&&(e=e.eq("is_featured",s)),p&&(e=e.eq("id",p)),l&&(e=e.ilike("name",`%${l}%`)),m&&(e=e.eq("price",m)),g&&(e=e.eq("slug",g)),t._sort?e=e.order(t._sort,{ascending:t._order==="asc"}):e=e.order("created_at",{ascending:!1}),e=e.range(b,C),S(e).pipe(P(({data:c,count:M,error:v})=>{if(v)throw v;let _=M||0,n=Math.max(1,Math.ceil(_/a)),O=(c||[]).map(d=>y(h({},d),{featured:d?.featured??d?.is_featured??!1}));return{first:1,prev:r>1?r-1:void 0,next:r<n?r+1:void 0,last:n,pages:n,items:_,data:O||[]}}),x(c=>(this.logger.error("Supabase product query error",c),q({first:1,prev:void 0,next:void 0,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(r){return new(r||i)(w(k))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};export{A as a};
