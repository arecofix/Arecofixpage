import{b as I,d as W,e as q,f as L,g as k,h as R,p as U,s as j}from"./chunk-BUQ7SEQN.js";import{a as T}from"./chunk-MSD3KBTG.js";import"./chunk-HWKWYSDO.js";import{e as A,g as N,h as D}from"./chunk-YWFIYZRP.js";import"./chunk-HLAW74BB.js";import"./chunk-T7AXESXA.js";import{r as P}from"./chunk-I5WECENP.js";import{Bb as b,Cb as i,Db as n,Eb as p,Ob as h,Qb as v,Ra as S,Wa as l,Y as u,Yb as s,Zb as M,_b as F,ac as _,bc as y,cc as x,ib as w,oa as d,vb as g,wb as f}from"./chunk-4GKTJ7DD.js";import{a as c,b as E}from"./chunk-VOSPIT4N.js";function G(r,o){if(r&1&&(i(0,"div",7),p(1,"i",18),i(2,"span"),s(3),n()()),r&2){let e=v();l(3),M(e.error())}}function z(r,o){if(r&1&&(i(0,"div",12),p(1,"img",19),n()),r&2){let e=v();l(),b("src",e.form().avatar_url,S)}}function H(r,o){r&1&&p(0,"span",17)}var O=class r{route=u(A);router=u(N);auth=u(T);id=null;form=d({first_name:"",last_name:"",email:"",phone:"",role:"staff",avatar_url:""});loading=d(!0);saving=d(!1);error=d(null);async ngOnInit(){if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let o=this.auth.getSupabaseClient(),{data:e,error:t}=await o.from("profiles").select("*").eq("id",this.id).single();e&&this.form.set({first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",role:e.role||"staff",avatar_url:e.avatar_url||""})}this.loading.set(!1)}async onFileChange(o){let e=o.target.files?.[0];if(!e)return;let t=this.auth.getSupabaseClient(),m=`avatars/${Date.now()}-${e.name}`,{data:a,error:C}=await t.storage.from("public-assets").upload(m,e);if(C){this.error.set(C.message);return}let{data:V}=t.storage.from("public-assets").getPublicUrl(a.path);this.form.update(B=>E(c({},B),{avatar_url:V.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null);let o=this.auth.getSupabaseClient(),e=c({},this.form());try{if(this.id){let{error:t}=await o.from("profiles").update(e).eq("id",this.id);if(t)throw t}else throw new Error("Creaci\xF3n de nuevos empleados debe hacerse desde el registro o invitaci\xF3n.");this.router.navigate(["/admin/employees"])}catch(t){this.error.set(t.message)}finally{this.saving.set(!1)}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=w({type:r,selectors:[["app-admin-employee-form-page"]],decls:29,vars:7,consts:[[1,"max-w-4xl","mx-auto","text-base-content"],[1,"flex","items-center","gap-4","mb-6"],["routerLink","/admin/employees",1,"btn","btn-circle","btn-ghost","text-base-content"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","text-green-600"],[3,"ngSubmit"],[1,"bg-base-100","p-6","rounded-xl","shadow-sm","border","border-base-200","mb-6","text-base-content"],[1,"alert","alert-error","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-base-content","mb-1.5"],["type","text","name","first_name","required","",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["type","text","name","last_name","required","",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],[1,"mt-4"],["type","file","accept","image/*",1,"file-input","file-input-bordered","file-input-primary","w-full","bg-base-100","text-base-content",3,"change"],[1,"flex","justify-end","gap-4","mt-6"],["routerLink","/admin/employees",1,"btn","btn-ghost"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner","loading-xs","mr-2"],[1,"fas","fa-exclamation-circle"],["alt","Avatar preview",1,"w-24","h-24","rounded-full","object-cover","border-2","border-base-200","shadow-sm",3,"src"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),p(3,"i",3),n(),i(4,"h1",4),s(5),n()(),i(6,"form",5),h("ngSubmit",function(){return t.save()}),i(7,"div",6),g(8,G,4,1,"div",7),i(9,"div",8)(10,"div")(11,"label",9),s(12,"Nombre"),n(),i(13,"input",10),x("ngModelChange",function(a){return y(t.form().first_name,a)||(t.form().first_name=a),a}),n()(),i(14,"div")(15,"label",9),s(16,"Apellido"),n(),i(17,"input",11),x("ngModelChange",function(a){return y(t.form().last_name,a)||(t.form().last_name=a),a}),n()()(),i(18,"div",12)(19,"label",9),s(20,"Foto de Perfil"),n(),i(21,"input",13),h("change",function(a){return t.onFileChange(a)}),n(),g(22,z,2,1,"div",12),n()(),i(23,"div",14)(24,"a",15),s(25,"Cancelar"),n(),i(26,"button",16),g(27,H,1,0,"span",17),s(28," Guardar "),n()()()()),e&2&&(l(5),F("",t.id?"Editar":"Nuevo"," Empleado"),l(3),f(t.error()?8:-1),l(5),_("ngModel",t.form().first_name),l(4),_("ngModel",t.form().last_name),l(5),f(t.form().avatar_url?22:-1),l(4),b("disabled",t.saving()),l(),f(t.saving()?27:-1))},dependencies:[P,j,R,I,W,q,U,k,L,D],encapsulation:2})};export{O as AdminEmployeeFormPage};
