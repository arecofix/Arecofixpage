import{b as j,d as D,e as L,f as B,g as I,h as q,l as O,m as R,n as U,p as V,r as k}from"./chunk-3J4IWN72.js";import{a as T}from"./chunk-MCSV4IA2.js";import{a as F,c as W,d as N}from"./chunk-BWQSVEWZ.js";import"./chunk-44RGWP63.js";import"./chunk-4CQ4C23O.js";import{n as A}from"./chunk-XV34LPXM.js";import{Ca as C,Db as o,Eb as x,Fa as r,Fb as P,Hb as s,Ib as g,Jb as u,Sa as M,X as c,cb as y,db as h,ib as b,jb as i,kb as n,lb as f,na as p,tb as v,vb as w}from"./chunk-DPJIKM6M.js";import{a as _,b as S}from"./chunk-VOSPIT4N.js";function J(l,d){if(l&1&&(i(0,"div",7),f(1,"i",26),i(2,"span"),o(3),n()()),l&2){let a=w();r(3),x(a.error())}}function K(l,d){if(l&1&&(i(0,"div",12),f(1,"img",27),n()),l&2){let a=w();r(),b("src",a.form().avatar_url,C)}}function Q(l,d){l&1&&f(0,"span",25)}var G=class l{route=c(F);router=c(W);auth=c(T);id=null;form=p({first_name:"",last_name:"",email:"",phone:"",role:"staff",job_title:"",avatar_url:""},{});loading=p(!0,{});saving=p(!1,{});error=p(null,{});async ngOnInit(){if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let d=this.auth.getSupabaseClient(),{data:a,error:e}=await d.from("profiles").select("*").eq("id",this.id).single();a&&this.form.set({first_name:a.first_name||"",last_name:a.last_name||"",email:a.email||"",phone:a.phone||"",role:a.role||"staff",job_title:a.job_title||"",avatar_url:a.avatar_url||""})}this.loading.set(!1)}async onFileChange(d){let a=d.target.files?.[0];if(!a)return;let e=this.auth.getSupabaseClient(),m=`avatars/${Date.now()}-${a.name}`,{data:t,error:E}=await e.storage.from("public-assets").upload(m,a);if(E){this.error.set(E.message);return}let{data:z}=e.storage.from("public-assets").getPublicUrl(t.path);this.form.update(H=>S(_({},H),{avatar_url:z.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null);let d=this.auth.getSupabaseClient(),a=_({},this.form());try{if(this.id){let{error:e}=await d.from("profiles").update(a).eq("id",this.id);if(e)throw e}else throw new Error("Creaci\xF3n de nuevos empleados debe hacerse desde el registro o invitaci\xF3n.");this.router.navigate(["/admin/employees"])}catch(e){this.error.set(e.message)}finally{this.saving.set(!1)}}static \u0275fac=function(a){return new(a||l)};static \u0275cmp=M({type:l,selectors:[["app-admin-employee-form-page"]],decls:52,vars:12,consts:[[1,"max-w-4xl","mx-auto","text-gray-800"],[1,"flex","items-center","gap-4","mb-6"],["routerLink","/admin/employees",1,"btn","btn-circle","btn-ghost"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","text-gray-800"],[3,"ngSubmit"],[1,"bg-white","p-6","rounded-xl","shadow-sm","border","border-gray-100","mb-6"],[1,"alert","alert-error","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-gray-700","mb-1.5"],["type","text","name","first_name","required","",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","text","name","last_name","required","",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],[1,"mt-4"],["type","email","name","email",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel","disabled"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","mt-4"],["name","role",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["value","admin"],["value","staff"],["value","user"],["type","text","name","job_title","placeholder","Ej: T\xE9cnico, Vendedor",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","text","name","phone",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","file","accept","image/*",1,"file-input","file-input-bordered","file-input-primary","w-full","bg-white","text-gray-700",3,"change"],[1,"flex","justify-end","gap-4","mt-6"],["routerLink","/admin/employees",1,"btn","btn-ghost"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner","loading-xs","mr-2"],[1,"fas","fa-exclamation-circle"],["alt","Avatar preview",1,"w-24","h-24","rounded-full","object-cover","border-2","border-gray-200","shadow-sm",3,"src"]],template:function(a,e){a&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(3,"i",3),n(),i(4,"h1",4),o(5),n()(),i(6,"form",5),v("ngSubmit",function(){return e.save()}),i(7,"div",6),y(8,J,4,1,"div",7),i(9,"div",8)(10,"div")(11,"label",9),o(12,"Nombre"),n(),i(13,"input",10),u("ngModelChange",function(t){return g(e.form().first_name,t)||(e.form().first_name=t),t}),n()(),i(14,"div")(15,"label",9),o(16,"Apellido"),n(),i(17,"input",11),u("ngModelChange",function(t){return g(e.form().last_name,t)||(e.form().last_name=t),t}),n()()(),i(18,"div",12)(19,"label",9),o(20,"Email"),n(),i(21,"input",13),u("ngModelChange",function(t){return g(e.form().email,t)||(e.form().email=t),t}),n()(),i(22,"div",14)(23,"div")(24,"label",9),o(25,"Rol"),n(),i(26,"select",15),u("ngModelChange",function(t){return g(e.form().role,t)||(e.form().role=t),t}),i(27,"option",16),o(28,"Administrador"),n(),i(29,"option",17),o(30,"Staff / Empleado"),n(),i(31,"option",18),o(32,"Usuario (Degradar)"),n()()(),i(33,"div")(34,"label",9),o(35,"Cargo"),n(),i(36,"input",19),u("ngModelChange",function(t){return g(e.form().job_title,t)||(e.form().job_title=t),t}),n()()(),i(37,"div",12)(38,"label",9),o(39,"Tel\xE9fono"),n(),i(40,"input",20),u("ngModelChange",function(t){return g(e.form().phone,t)||(e.form().phone=t),t}),n()(),i(41,"div",12)(42,"label",9),o(43,"Foto de Perfil"),n(),i(44,"input",21),v("change",function(t){return e.onFileChange(t)}),n(),y(45,K,2,1,"div",12),n()(),i(46,"div",22)(47,"a",23),o(48,"Cancelar"),n(),i(49,"button",24),y(50,Q,1,0,"span",25),o(51," Guardar "),n()()()()),a&2&&(r(5),P("",e.id?"Editar":"Nuevo"," Empleado"),r(3),h(e.error()?8:-1),r(5),s("ngModel",e.form().first_name),r(4),s("ngModel",e.form().last_name),r(4),s("ngModel",e.form().email),b("disabled",!!e.id),r(5),s("ngModel",e.form().role),r(10),s("ngModel",e.form().job_title),r(4),s("ngModel",e.form().phone),r(5),h(e.form().avatar_url?45:-1),r(4),b("disabled",e.saving()),r(),h(e.saving()?50:-1))},dependencies:[A,k,q,R,U,j,O,D,L,V,I,B,N],encapsulation:2})};export{G as AdminEmployeeFormPage};
