import{a as L,b as T,d as W,e as k,f as I,g as R,h as U,p as j,r as q}from"./chunk-VVMQBTNG.js";import{a as D}from"./chunk-5GJFSCEY.js";import{a as A,c as B,d as N}from"./chunk-ZUCCYXWI.js";import"./chunk-R5JSKLLG.js";import"./chunk-LI7IRV6C.js";import"./chunk-LAXSCOZR.js";import{Bb as s,Ca as S,Cb as E,Db as F,Fb as f,Ga as o,Gb as b,Hb as h,Sa as M,X as u,ab as c,bb as p,gb as v,hb as i,ib as n,jb as g,na as m,rb as _,tb as w,uc as P}from"./chunk-JAGY3XSL.js";import{a as y,b as C}from"./chunk-VOSPIT4N.js";function z(l,r){if(l&1&&(i(0,"div",7),g(1,"i",22),i(2,"span"),s(3),n()()),l&2){let t=w();o(3),E(t.error())}}function H(l,r){if(l&1&&(i(0,"div",13),g(1,"img",23),n()),l&2){let t=w();o(),v("src",t.form().logo_url,S)}}function J(l,r){l&1&&g(0,"span",21)}var V=class l{route=u(A);router=u(B);auth=u(D);id=null;form=m({name:"",slug:"",logo_url:"",is_active:!0},{});loading=m(!0,{});saving=m(!1,{});error=m(null,{});async ngOnInit(){if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let r=this.auth.getSupabaseClient(),{data:t,error:e}=await r.from("brands").select("*").eq("id",this.id).single();t&&this.form.set({name:t.name,slug:t.slug,logo_url:t.logo_url||"",is_active:t.is_active})}this.loading.set(!1)}async onFileChange(r){let t=r.target.files?.[0];if(!t)return;let e=this.auth.getSupabaseClient(),d=`brands/${Date.now()}-${t.name}`,{data:a,error:x}=await e.storage.from("public-assets").upload(d,t);if(x){this.error.set(x.message);return}let{data:O}=e.storage.from("public-assets").getPublicUrl(a.path);this.form.update(G=>C(y({},G),{logo_url:O.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null);let r=this.auth.getSupabaseClient(),t=y({},this.form());t.slug||(t.slug=this.slugify(t.name));try{if(this.id){let{error:e}=await r.from("brands").update(t).eq("id",this.id);if(e)throw e}else{let{error:e}=await r.from("brands").insert(t);if(e)throw e}this.router.navigate(["/admin/brands"])}catch(e){this.error.set(e.message)}finally{this.saving.set(!1)}}slugify(r){return r.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=M({type:l,selectors:[["app-admin-brand-form-page"]],decls:33,vars:8,consts:[[1,"max-w-4xl","mx-auto","text-gray-800"],[1,"flex","items-center","gap-4","mb-6"],["routerLink","/admin/brands",1,"btn","btn-circle","btn-ghost"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","text-gray-800"],[3,"ngSubmit"],[1,"bg-white","p-6","rounded-xl","shadow-sm","border","border-gray-100","mb-6"],[1,"alert","alert-error","mb-6"],[1,"mb-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1.5"],["type","text","name","name","required","",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","text","name","slug","placeholder","Se genera autom\xE1ticamente si se deja vac\xEDo",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","file","accept","image/*",1,"file-input","file-input-bordered","file-input-primary","w-full","bg-white","text-gray-700",3,"change"],[1,"mt-4"],[1,"mt-6"],[1,"flex","items-center","gap-3","p-3","bg-white","border","border-gray-200","rounded-lg","hover:bg-gray-50","transition-colors","cursor-pointer","w-fit"],["type","checkbox","name","is_active",1,"checkbox","checkbox-primary","h-5","w-5","rounded","border-gray-300",3,"ngModelChange","ngModel"],[1,"font-medium","text-gray-700"],[1,"flex","justify-end","gap-4","mt-6"],["routerLink","/admin/brands",1,"btn","btn-ghost"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner","loading-xs","mr-2"],[1,"fas","fa-exclamation-circle"],["alt","Logo preview",1,"h-24","object-contain","border","border-gray-200","rounded-lg","p-2","bg-white","shadow-sm",3,"src"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(3,"i",3),n(),i(4,"h1",4),s(5),n()(),i(6,"form",5),_("ngSubmit",function(){return e.save()}),i(7,"div",6),c(8,z,4,1,"div",7),i(9,"div",8)(10,"label",9),s(11,"Nombre"),n(),i(12,"input",10),h("ngModelChange",function(a){return b(e.form().name,a)||(e.form().name=a),a}),n()(),i(13,"div",8)(14,"label",9),s(15,"Slug (URL)"),n(),i(16,"input",11),h("ngModelChange",function(a){return b(e.form().slug,a)||(e.form().slug=a),a}),n()(),i(17,"div",8)(18,"label",9),s(19,"Logo"),n(),i(20,"input",12),_("change",function(a){return e.onFileChange(a)}),n(),c(21,H,2,1,"div",13),n(),i(22,"div",14)(23,"label",15)(24,"input",16),h("ngModelChange",function(a){return b(e.form().is_active,a)||(e.form().is_active=a),a}),n(),i(25,"span",17),s(26,"Activo"),n()()()(),i(27,"div",18)(28,"a",19),s(29,"Cancelar"),n(),i(30,"button",20),c(31,J,1,0,"span",21),s(32," Guardar "),n()()()()),t&2&&(o(5),F("",e.id?"Editar":"Nueva"," Marca"),o(3),p(e.error()?8:-1),o(4),f("ngModel",e.form().name),o(4),f("ngModel",e.form().slug),o(5),p(e.form().logo_url?21:-1),o(3),f("ngModel",e.form().is_active),o(6),v("disabled",e.saving()),o(),p(e.saving()?31:-1))},dependencies:[P,q,U,T,L,W,k,j,R,I,N],encapsulation:2})};export{V as AdminBrandFormPage};
