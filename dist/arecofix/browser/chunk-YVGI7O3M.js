import{a as R}from"./chunk-WYU2UE3L.js";import{a as N}from"./chunk-I4DLVUEL.js";import{a as c}from"./chunk-3YI4VP2H.js";import{C as w,R as n,W as s,k,l as x,ma as I,oa as j,r as F}from"./chunk-SD6TJRIO.js";var O=class o{authService=s(N);logger=s(c);supabase=this.authService.getSupabaseClient();constructor(){}getData(t={}){let{_page:r=1,_per_page:a=10,category_id:d,brand_id:l,description:v,featured:f,id:m,name:p,price:_,slug:h,min_price:b,max_price:S}=t,y=(r-1)*a,C=y+a-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return t.category_ids&&t.category_ids.length>0?e=e.in("category_id",t.category_ids):d!=null&&(e=e.eq("category_id",d)),l&&(e=e.eq("brand_id",l)),v&&(e=e.ilike("description",`%${v}%`)),f!=null&&(e=e.eq("is_featured",f)),m&&(e=e.eq("id",m)),p&&(e=e.ilike("name",`%${p}%`)),_&&(e=e.eq("price",_)),h&&(e=e.eq("slug",h)),b!==void 0&&(e=e.gte("price",b)),S!==void 0&&(e=e.lte("price",S)),t.q&&(e=e.or(`name.ilike.%${t.q}%,description.ilike.%${t.q}%`)),t._sort?e=e.order(t._sort,{ascending:t._order==="asc"}):e=e.order("created_at",{ascending:!1}),e=e.range(y,C),k(e).pipe(F(({data:u,count:E,error:P})=>{if(P)throw P;let q=E||0,g=Math.max(1,Math.ceil(q/a)),M=(u||[]).map(i=>({id:i.id,name:i.name,slug:i.slug,description:i.description,price:Number(i.price),image_url:i.image_url,category_id:i.category_id,brand_id:i.brand_id,stock:Number(i.stock),is_active:!!i.is_active,featured:!!(i.featured??i.is_featured??!1),created_at:i.created_at,updated_at:i.updated_at}));return{first:1,prev:r>1?r-1:void 0,next:r<g?r+1:void 0,last:g,pages:g,items:q,data:M}}),w(u=>(this.logger.error("Supabase product query error",u),x({first:1,prev:void 0,next:void 0,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(r){return new(r||o)};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};var $=class o{logger=s(c);toastService=s(R);favorites=I([]);constructor(){let t=localStorage.getItem("favorites");if(t)try{this.favorites.set(JSON.parse(t))}catch(r){console.error("Error parsing favorites",r),this.favorites.set([])}j(()=>{localStorage.setItem("favorites",JSON.stringify(this.favorites()))})}toggleFavorite(t){this.isFavorite(t.id)?this.removeFavorite(t.id):this.addFavorite(t)}addFavorite(t){this.favorites.update(r=>r.some(a=>a.id===t.id)?r:[...r,t]),this.logger.debug("Product added to favorites",{productName:t.name}),this.toastService.show("Agregado a favoritos","success")}removeFavorite(t){this.favorites.update(r=>r.filter(a=>a.id!==t)),this.logger.debug("Product removed from favorites",{productId:t}),this.toastService.show("Eliminado de favoritos","info")}isFavorite(t){return this.favorites().some(r=>r.id===t)}static \u0275fac=function(r){return new(r||o)};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};export{O as a,$ as b};
