import{a as k}from"./chunk-4FNFMYN4.js";import{a as E,d as C}from"./chunk-4WX2KV2B.js";import"./chunk-QBWIJBVM.js";import"./chunk-BCXBSHNT.js";import{m as S,o as h}from"./chunk-YHPCNF66.js";import{Eb as _,Fa as r,Fb as n,Gb as d,Hb as s,Qb as y,Ta as v,W as u,Wb as b,Yb as f,eb as g,fb as x,lb as t,ma as m,mb as i,nb as c,xb as p}from"./chunk-YBYZLFPG.js";import"./chunk-VOSPIT4N.js";function T(a,o){a&1&&(t(0,"div",6),c(1,"span",7),t(2,"p",8),n(3,"Buscando reparaci\xF3n..."),i()())}function w(a,o){if(a&1&&(t(0,"div",9),c(1,"i",10),t(2,"span"),n(3),i()(),t(4,"div",11)(5,"a",12),n(6,"Volver al Inicio"),i()()),a&2){let e=p();r(3),d(e.error())}}function I(a,o){if(a&1&&(t(0,"div",15)(1,"span",16),n(2,"Fecha Completado"),i(),t(3,"span",17),n(4),b(5,"date"),i()()),a&2){let e=p(2);r(4),d(f(5,1,e.repair().completed_at,"dd/MM/yyyy"))}}function M(a,o){if(a&1&&(t(0,"div",18)(1,"span",19),n(2,"Diagn\xF3stico / Soluci\xF3n"),i(),t(3,"p",31),n(4),i()()),a&2){let e=p(2);r(4),s(" ",e.repair().technician_notes," ")}}function R(a,o){if(a&1&&(t(0,"div",13)(1,"div"),n(2),i()(),t(3,"div",14)(4,"div",15)(5,"span",16),n(6,"Dispositivo"),i(),t(7,"span",17),n(8),i()(),t(9,"div",15)(10,"span",16),n(11,"Cliente"),i(),t(12,"span",17),n(13),i()(),t(14,"div",15)(15,"span",16),n(16,"Fecha Ingreso"),i(),t(17,"span",17),n(18),b(19,"date"),i()(),g(20,I,6,4,"div",15),t(21,"div",18)(22,"span",19),n(23,"Problema Reportado"),i(),t(24,"p",20),n(25),i()(),g(26,M,5,1,"div",18),t(27,"div",21)(28,"div",22)(29,"span",23),n(30,"Presupuesto"),i(),t(31,"span",17),n(32),i()(),t(33,"div",24)(34,"span",23),n(35,"Se\xF1a"),i(),t(36,"span",17),n(37),i()(),c(38,"div",25),t(39,"div",26)(40,"span",17),n(41,"Total a Pagar"),i(),t(42,"span",27),n(43),i()()()(),t(44,"div",28)(45,"a",29),c(46,"i",30),n(47," Consultar "),i()()),a&2){let e=p();r(),_(y("badge ",e.getStatusColor(e.repair().status)," badge-lg p-4 font-bold uppercase")),r(),s(" ",e.getStatusLabel(e.repair().status)," "),r(6),d(e.repair().device_model),r(5),d(e.repair().customer_name),r(5),d(f(19,13,e.repair().created_at,"dd/MM/yyyy")),r(2),x(e.repair().completed_at?20:-1),r(5),d(e.repair().issue_description),r(),x(e.repair().technician_notes&&(e.repair().status==="completed"||e.repair().status==="delivered")?26:-1),r(6),s("$",e.repair().estimated_cost),r(5),s("-$",e.repair().deposit_amount),r(6),s("$",(e.repair().final_cost||e.repair().estimated_cost)-e.repair().deposit_amount)}}var P=class a{route=u(E);auth=u(k);code=null;repair=m(null,{});loading=m(!0,{});error=m(null,{});async ngOnInit(){this.code=this.route.snapshot.paramMap.get("code"),this.code?await this.loadRepair():(this.error.set("C\xF3digo de seguimiento no v\xE1lido."),this.loading.set(!1))}async loadRepair(){console.log("TrackingPage: loadRepair started. Code:",this.code);let o=this.auth.getSupabaseClient();console.log("TrackingPage: Supabase client obtained:",!!o);try{console.log("TrackingPage: Calling rpc get_repair_by_tracking...");let{data:e,error:l}=await o.rpc("get_repair_by_tracking",{code:this.code});console.log("TrackingPage: RPC result:",{data:e,error:l}),l?(console.error("Error fetching repair:",l),this.error.set(`Error: ${l.message||JSON.stringify(l)}`)):e&&e.length>0?(console.log("TrackingPage: Repair found:",e[0]),this.repair.set(e[0])):(console.warn("TrackingPage: No repair found for code:",this.code),this.error.set("No se encontr\xF3 ninguna reparaci\xF3n con este c\xF3digo."))}catch(e){console.error("TrackingPage: Unexpected error:",e),this.error.set(`Error inesperado: ${e.message||e}`)}finally{this.loading.set(!1),console.log("TrackingPage: Loading set to false")}}getStatusLabel(o){return{pending:"Pendiente",in_progress:"En Progreso",completed:"Completado",delivered:"Entregado",cancelled:"Cancelado"}[o]||o}getStatusColor(o){return{pending:"badge-warning",in_progress:"badge-info",completed:"badge-success",delivered:"badge-success",cancelled:"badge-error"}[o]||"badge-ghost"}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=v({type:a,selectors:[["app-tracking-page"]],decls:11,vars:1,consts:[[1,"min-h-screen","bg-base-200","py-10","px-4"],[1,"max-w-md","mx-auto","bg-base-100","rounded-xl","shadow-xl","overflow-hidden"],[1,"bg-primary","p-6","text-center"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-primary-content","opacity-80","text-sm"],[1,"p-6"],[1,"flex","flex-col","items-center","justify-center","py-8"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"mt-4","text-gray-500"],[1,"alert","alert-error"],[1,"fas","fa-exclamation-circle"],[1,"mt-6","text-center"],["routerLink","/",1,"btn","btn-outline","btn-sm"],[1,"flex","justify-center","mb-6"],[1,"space-y-4"],[1,"flex","justify-between","border-b","border-base-200","pb-2"],[1,"font-semibold","text-gray-500"],[1,"font-bold"],[1,"py-2"],[1,"block","font-semibold","text-gray-500","mb-1"],[1,"text-sm","bg-base-200","p-3","rounded-lg"],[1,"bg-base-200","p-4","rounded-lg","mt-4"],[1,"flex","justify-between","mb-1"],[1,"text-sm"],[1,"flex","justify-between","mb-1","text-green-600"],[1,"divider","my-1"],[1,"flex","justify-between","text-lg"],[1,"font-bold","text-primary"],[1,"mt-8","text-center"],["href","https://wa.me/5492326406976","target","_blank",1,"btn","btn-success","btn-wide","text-white"],[1,"fab","fa-whatsapp","mr-2"],[1,"text-sm","bg-green-50","p-3","rounded-lg","border","border-green-100","text-green-800"]],template:function(e,l){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),n(4,"Estado de Reparaci\xF3n"),i(),t(5,"p",4),n(6,"Seguimiento en tiempo real"),i()(),t(7,"div",5),g(8,T,4,0,"div",6)(9,w,7,1)(10,R,48,16),i()()()),e&2&&(r(8),x(l.loading()?8:l.error()?9:l.repair()?10:-1))},dependencies:[h,C,S],encapsulation:2})};export{P as TrackingPage};
