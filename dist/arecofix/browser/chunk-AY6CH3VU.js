import{a as q,b as I,d as U,e as R,f as j,g as z,h as G,i as K,p as O,r as H}from"./chunk-D7NQUWND.js";import{b as B}from"./chunk-YMLALQJL.js";import{b as D,d as L}from"./chunk-N3TMG4ML.js";import"./chunk-KO4BXOND.js";import"./chunk-FNNVO3A6.js";import{$ as m,Ba as M,Bb as l,Cb as N,Db as x,Ea as o,Fb as p,Gb as c,Hb as f,Ra as v,W as h,aa as g,bb as P,cb as F,eb as V,fb as E,gb as W,hb as w,ib as r,jb as n,kb as k,ma as C,ob as A,sb as y,ub as T}from"./chunk-J6ZALCGR.js";import{a as _,b as S}from"./chunk-VOSPIT4N.js";function X(u,a){if(u&1&&k(0,"img",16),u&2){let i=a.$implicit;w("src",i,M)}}function Y(u,a){if(u&1&&(r(0,"div",17),l(1),n()),u&2){let i=T();o(),N(i.error)}}var J=class u{route=h(D);router=h(L);auth=h(B);id=null;form=C({sku:"",name:"",slug:"",description:"",price:0,stock:0,is_active:!0,images:[]});loading=!0;saving=!1;error=null;async ngOnInit(){let a=this.auth.getSupabaseClient();if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let{data:i,error:e}=await a.from("products").select("*").eq("id",this.id).single();e?this.error=e.message:i&&this.form.set({sku:i.sku||"",name:i.name||"",slug:i.slug||"",description:i.description||"",price:i.price||0,stock:i.stock||0,is_active:i.is_active??!0,images:i.images||[]})}this.loading=!1}async onFileChange(a){let i=a.target.files?.[0];if(!i)return;let e=this.auth.getSupabaseClient(),s=`${Date.now()}-${i.name}`,{data:d,error:t}=await e.storage.from("product-images").upload(s,i);if(t){this.error=t.message;return}let{data:Q}=e.storage.from("product-images").getPublicUrl(d.path);this.form.update(b=>S(_({},b),{images:[...b.images,Q.publicUrl]}))}async save(){this.saving=!0,this.error=null;let a=this.auth.getSupabaseClient(),i=_({},this.form());i.slug||(i.slug=this.slugify(i.name));try{if(this.id){let{error:e}=await a.from("products").update(i).eq("id",this.id);if(e)throw e}else{let{error:e}=await a.from("products").insert(i);if(e)throw e}this.router.navigate(["/admin/products"])}catch(e){this.error=e.message||"Error al guardar producto"}finally{this.saving=!1}}slugify(a){return a.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-")}static \u0275fac=function(i){return new(i||u)};static \u0275cmp=v({type:u,selectors:[["app-admin-product-form-page"]],decls:47,vars:10,consts:[["f","ngForm"],[1,"max-w-2xl","mx-auto"],[1,"text-lg","font-medium","mb-4"],[1,"grid","gap-4",3,"ngSubmit"],[1,"block","text-sm"],["type","text","name","name","required","",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],["type","text","name","sku",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],["type","text","name","slug",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],["name","description","rows","4",1,"textarea","textarea-bordered","w-full",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","gap-4"],["type","number","name","price","required","",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],["type","number","name","stock",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2"],["type","checkbox","name","is_active",3,"ngModelChange","ngModel"],["type","file","accept","image/*",3,"change"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-2","mt-2"],[1,"w-full","h-32","object-cover","rounded",3,"src"],[1,"text-red-600"],[1,"flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/products",1,"btn"]],template:function(i,e){if(i&1){let s=A();r(0,"div",1)(1,"h2",2),l(2),n(),r(3,"form",3,0),y("ngSubmit",function(){return m(s),g(e.save())}),r(5,"div")(6,"label",4),l(7,"Nombre"),n(),r(8,"input",5),f("ngModelChange",function(t){return m(s),c(e.form().name,t)||(e.form().name=t),g(t)}),n()(),r(9,"div")(10,"label",4),l(11,"SKU"),n(),r(12,"input",6),f("ngModelChange",function(t){return m(s),c(e.form().sku,t)||(e.form().sku=t),g(t)}),n()(),r(13,"div")(14,"label",4),l(15,"Slug"),n(),r(16,"input",7),f("ngModelChange",function(t){return m(s),c(e.form().slug,t)||(e.form().slug=t),g(t)}),n()(),r(17,"div")(18,"label",4),l(19,"Descripci\xF3n"),n(),r(20,"textarea",8),f("ngModelChange",function(t){return m(s),c(e.form().description,t)||(e.form().description=t),g(t)}),n()(),r(21,"div",9)(22,"div")(23,"label",4),l(24,"Precio"),n(),r(25,"input",10),f("ngModelChange",function(t){return m(s),c(e.form().price,t)||(e.form().price=t),g(t)}),n()(),r(26,"div")(27,"label",4),l(28,"Stock"),n(),r(29,"input",11),f("ngModelChange",function(t){return m(s),c(e.form().stock,t)||(e.form().stock=t),g(t)}),n()()(),r(30,"div",12)(31,"input",13),f("ngModelChange",function(t){return m(s),c(e.form().is_active,t)||(e.form().is_active=t),g(t)}),n(),r(32,"span"),l(33,"Activo"),n()(),r(34,"div")(35,"label",4),l(36,"Fotos"),n(),r(37,"input",14),y("change",function(t){return m(s),g(e.onFileChange(t))}),n(),r(38,"div",15),E(39,X,1,1,"img",16,V),n()(),P(41,Y,2,1,"div",17),r(42,"div",18)(43,"button",19),l(44,"Guardar"),n(),r(45,"a",20),l(46,"Cancelar"),n()()()()}i&2&&(o(2),x("",e.id?"Editar":"Nuevo"," producto"),o(6),p("ngModel",e.form().name),o(4),p("ngModel",e.form().sku),o(4),p("ngModel",e.form().slug),o(4),p("ngModel",e.form().description),o(5),p("ngModel",e.form().price),o(4),p("ngModel",e.form().stock),o(2),p("ngModel",e.form().is_active),o(8),W(e.form().images),o(2),F(e.error?41:-1),o(2),w("disabled",e.saving))},dependencies:[H,G,I,K,q,U,R,O,z,j],encapsulation:2,changeDetection:0})};export{J as AdminProductFormPage};
