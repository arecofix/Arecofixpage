import{a as p}from"./chunk-MI7WHUK7.js";import{T as n,Y as l}from"./chunk-YATSW66L.js";import{a as r,b as o}from"./chunk-VOSPIT4N.js";var c=class i{auth=l(p);supabase=this.auth.getSupabaseClient();async getPosts(){let{data:t,error:e}=await this.supabase.from("blog_posts").select("*").order("created_at",{ascending:!1});if(e)throw e;return(t||[]).map(a=>this.mapToEntity(a))}async getPost(t){let{data:e,error:a}=await this.supabase.from("blog_posts").select("*").eq("id",t).single();if(a)throw a;return this.mapToEntity(e)}mapToEntity(t){return o(r({},t),{image:t.featured_image||t.image||t.image_url})}async createPost(t){let e=r({},t);e.image&&(e.featured_image=e.image,delete e.image),delete e.meta_title,delete e.meta_description,delete e.published;let{error:a}=await this.supabase.from("blog_posts").insert(e);if(a)throw a}async updatePost(t,e){let a=r({},e);a.image&&(a.featured_image=a.image,delete a.image),delete a.meta_title,delete a.meta_description,delete a.published;let{error:s}=await this.supabase.from("blog_posts").update(a).eq("id",t);if(s)throw s}async deletePost(t){let{error:e}=await this.supabase.from("blog_posts").delete().eq("id",t);if(e)throw e}async uploadImage(t){let e=`posts/${Date.now()}-${t.name}`,{data:a,error:s}=await this.supabase.storage.from("public-assets").upload(e,t);if(s)throw s;let{data:m}=this.supabase.storage.from("public-assets").getPublicUrl(a.path);return m.publicUrl}slugify(t){return t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-")}static \u0275fac=function(e){return new(e||i)};static \u0275prov=n({token:i,factory:i.\u0275fac,providedIn:"root"})};export{c as a};
