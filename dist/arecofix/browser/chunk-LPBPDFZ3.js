import{b as T,d as N,e as D,f as F,g as B,h as I,i as L,l as U,m as V,n as R,p as j,r as O}from"./chunk-GSH74JW6.js";import{a as W}from"./chunk-ZT4MGTUK.js";import"./chunk-VKJMBSB6.js";import"./chunk-7QORBSNT.js";import"./chunk-QGSRP5SS.js";import{m as A}from"./chunk-KW2FFXRI.js";import{Aa as E,Bb as o,Cb as w,Da as r,Fb as g,Gb as s,Hb as p,Qa as P,V as x,ab as y,bb as f,gb as S,hb as n,ib as i,jb as _,la as c,rb as C,tb as h}from"./chunk-VQO264VU.js";import{a as b,b as M,c as v}from"./chunk-VOSPIT4N.js";function z(d,m){if(d&1&&(n(0,"div",3),_(1,"i",28),n(2,"span"),o(3),i()()),d&2){let a=h();r(3),w(a.error())}}function H(d,m){if(d&1&&(n(0,"div",4),_(1,"i",29),n(2,"span"),o(3),i()()),d&2){let a=h();r(3),w(a.success())}}function J(d,m){if(d&1&&(n(0,"div",24),_(1,"img",30),i()),d&2){let a=h();r(),S("src",a.form().logo_url,E)}}function K(d,m){d&1&&_(0,"span",27)}var q=class d{auth=x(W);form=c({id:"",name:"",owner_name:"",ruc:"",address:"",tax_percentage:21,tax_abbreviation:"IVA",email:"",phone:"",location:"",currency:"ARS",logo_url:""},{});loading=c(!0,{});saving=c(!1,{});error=c(null,{});success=c(null,{});async ngOnInit(){await this.loadSettings()}async loadSettings(){this.loading.set(!0);let m=this.auth.getSupabaseClient(),{data:a,error:e}=await m.from("company_settings").select("*").maybeSingle();a?this.form.set({id:a.id,name:a.name,owner_name:a.owner_name||"",ruc:a.ruc||"",address:a.address||"",tax_percentage:a.tax_percentage||21,tax_abbreviation:a.tax_abbreviation||"IVA",email:a.email||"",phone:a.phone||"",location:a.location||"",currency:a.currency||"ARS",logo_url:a.logo_url||""}):e&&e.code!=="PGRST116"&&this.error.set(e.message),this.loading.set(!1)}async onFileChange(m){let a=m.target.files?.[0];if(!a)return;let e=this.auth.getSupabaseClient(),l=`company/${Date.now()}-${a.name}`,{data:t,error:u}=await e.storage.from("public-assets").upload(l,a);if(u){this.error.set(u.message);return}let{data:G}=e.storage.from("public-assets").getPublicUrl(t.path);this.form.update(k=>M(b({},k),{logo_url:G.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null),this.success.set(null);let m=this.auth.getSupabaseClient(),t=b({},this.form()),{id:e}=t,l=v(t,["id"]);try{if(e){let{error:u}=await m.from("company_settings").update(l).eq("id",e);if(u)throw u}else{let{error:u}=await m.from("company_settings").insert(l);if(u)throw u}this.success.set("Configuraci\xF3n guardada correctamente"),await this.loadSettings()}catch(u){this.error.set(u.message)}finally{this.saving.set(!1)}}static \u0275fac=function(a){return new(a||d)};static \u0275cmp=P({type:d,selectors:[["app-admin-company-settings-page"]],decls:68,vars:15,consts:[[1,"max-w-4xl","mx-auto"],[1,"text-2xl","font-bold","text-gray-800","mb-6"],[1,"bg-white","rounded-lg","shadow","p-6","text-gray-800"],[1,"alert","alert-error","mb-4"],[1,"alert","alert-success","mb-4"],[1,"space-y-6",3,"ngSubmit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"form-control"],[1,"label"],["type","text","name","name","required","",1,"input","input-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],["type","text","name","owner_name",1,"input","input-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],["type","text","name","ruc",1,"input","input-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],["type","text","name","address",1,"input","input-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],["type","email","name","email",1,"input","input-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],["type","text","name","phone",1,"input","input-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],["type","text","name","location","placeholder","Ej: Buenos Aires, Argentina",1,"input","input-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],[1,"divider"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["type","number","name","tax_percentage",1,"input","input-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],["type","text","name","tax_abbreviation","placeholder","Ej: IVA",1,"input","input-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],["name","currency",1,"select","select-bordered","bg-white","text-gray-800",3,"ngModelChange","ngModel"],["value","ARS"],["value","USD"],["type","file","accept","image/*",1,"file-input","file-input-bordered","w-full",3,"change"],[1,"mt-4"],[1,"flex","justify-end","gap-4","mt-8"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"loading","loading-spinner"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-check-circle"],["alt","Logo preview",1,"h-24","object-contain","border","rounded","p-2",3,"src"]],template:function(a,e){a&1&&(n(0,"div",0)(1,"h1",1),o(2,"Configuraci\xF3n de Empresa"),i(),n(3,"div",2),y(4,z,4,1,"div",3),y(5,H,4,1,"div",4),n(6,"form",5),C("ngSubmit",function(){return e.save()}),n(7,"div",6)(8,"div",7)(9,"label",8),o(10,"Nombre de la Empresa"),i(),n(11,"input",9),p("ngModelChange",function(t){return s(e.form().name,t)||(e.form().name=t),t}),i()(),n(12,"div",7)(13,"label",8),o(14,"Propietario"),i(),n(15,"input",10),p("ngModelChange",function(t){return s(e.form().owner_name,t)||(e.form().owner_name=t),t}),i()()(),n(16,"div",6)(17,"div",7)(18,"label",8),o(19,"RUC / CUIT"),i(),n(20,"input",11),p("ngModelChange",function(t){return s(e.form().ruc,t)||(e.form().ruc=t),t}),i()(),n(21,"div",7)(22,"label",8),o(23,"Direcci\xF3n"),i(),n(24,"input",12),p("ngModelChange",function(t){return s(e.form().address,t)||(e.form().address=t),t}),i()()(),n(25,"div",6)(26,"div",7)(27,"label",8),o(28,"Email"),i(),n(29,"input",13),p("ngModelChange",function(t){return s(e.form().email,t)||(e.form().email=t),t}),i()(),n(30,"div",7)(31,"label",8),o(32,"Tel\xE9fono"),i(),n(33,"input",14),p("ngModelChange",function(t){return s(e.form().phone,t)||(e.form().phone=t),t}),i()()(),n(34,"div",7)(35,"label",8),o(36,"Ubicaci\xF3n"),i(),n(37,"input",15),p("ngModelChange",function(t){return s(e.form().location,t)||(e.form().location=t),t}),i()(),n(38,"div",16),o(39,"Configuraci\xF3n Fiscal"),i(),n(40,"div",17)(41,"div",7)(42,"label",8),o(43,"Porcentaje Impuesto (%)"),i(),n(44,"input",18),p("ngModelChange",function(t){return s(e.form().tax_percentage,t)||(e.form().tax_percentage=t),t}),i()(),n(45,"div",7)(46,"label",8),o(47,"Abreviatura Impuesto"),i(),n(48,"input",19),p("ngModelChange",function(t){return s(e.form().tax_abbreviation,t)||(e.form().tax_abbreviation=t),t}),i()(),n(49,"div",7)(50,"label",8),o(51,"Moneda"),i(),n(52,"select",20),p("ngModelChange",function(t){return s(e.form().currency,t)||(e.form().currency=t),t}),n(53,"option",21),o(54,"ARS (Peso Argentino)"),i(),n(55,"option",22),o(56,"USD (D\xF3lar Estadounidense)"),i()()()(),n(57,"div",16),o(58,"Branding"),i(),n(59,"div",7)(60,"label",8),o(61,"Logo de la Empresa"),i(),n(62,"input",23),C("change",function(t){return e.onFileChange(t)}),i(),y(63,J,2,1,"div",24),i(),n(64,"div",25)(65,"button",26),y(66,K,1,0,"span",27),o(67," Guardar Configuraci\xF3n "),i()()()()()),a&2&&(r(4),f(e.error()?4:-1),r(),f(e.success()?5:-1),r(6),g("ngModel",e.form().name),r(4),g("ngModel",e.form().owner_name),r(5),g("ngModel",e.form().ruc),r(4),g("ngModel",e.form().address),r(5),g("ngModel",e.form().email),r(4),g("ngModel",e.form().phone),r(4),g("ngModel",e.form().location),r(7),g("ngModel",e.form().tax_percentage),r(4),g("ngModel",e.form().tax_abbreviation),r(4),g("ngModel",e.form().currency),r(11),f(e.form().logo_url?63:-1),r(2),S("disabled",e.saving()),r(),f(e.saving()?66:-1))},dependencies:[A,O,I,V,R,T,L,U,N,D,j,B,F],encapsulation:2})};export{q as AdminCompanySettingsPage};
