import{a as k}from"./chunk-SFGK2H4E.js";import{a as R}from"./chunk-RLEXB5XQ.js";import{D as x,T as j,X as w,Y as I,p as q,q as y,v as P}from"./chunk-IZKGPZFC.js";import{a as _,b as S}from"./chunk-VOSPIT4N.js";var A=class i{constructor(r){this.authService=r;this.supabase=this.authService.getSupabaseClient()}supabase;logger=I(R);getData(r={}){let{_page:t=1,_per_page:a=10,category_id:o,brand_id:u,description:f,featured:s,id:p,name:l,price:m,slug:g}=r,b=(t-1)*a,C=b+a-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return o!=null&&(e=e.eq("category_id",o)),u&&(e=e.eq("brand_id",u)),f&&(e=e.ilike("description",`%${f}%`)),s!=null&&(e=e.eq("is_featured",s)),p&&(e=e.eq("id",p)),l&&(e=e.ilike("name",`%${l}%`)),m&&(e=e.eq("price",m)),g&&(e=e.eq("slug",g)),r._sort?e=e.order(r._sort,{ascending:r._order==="asc"}):e=e.order("created_at",{ascending:!1}),e=e.range(b,C),q(e).pipe(P(({data:n,count:M,error:v})=>{if(v)throw v;let h=M||0,c=Math.max(1,Math.ceil(h/a)),O=(n||[]).map(d=>S(_({},d),{featured:d?.featured??d?.is_featured??!1}));return{first:1,prev:t>1?t-1:void 0,next:t<c?t+1:void 0,last:c,pages:c,items:h,data:O||[]}}),x(n=>(this.logger.error("Supabase product query error",n),y({first:1,prev:void 0,next:void 0,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(t){return new(t||i)(w(k))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};export{A as a};
