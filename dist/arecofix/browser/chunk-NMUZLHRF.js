import{a as ee}from"./chunk-L3HQN64Y.js";import{a as te}from"./chunk-TKLFIGRT.js";import{a as B}from"./chunk-ZAF732JY.js";import{b as H,c as _,d as J,e as K,h as W,j as Q,k as X,r as Y,t as Z}from"./chunk-LSPUXVBI.js";import{a as k}from"./chunk-4HXPTVC3.js";import{a as R}from"./chunk-773BQMTG.js";import"./chunk-NIOBXWFE.js";import{d as G,e as L}from"./chunk-755N3HP6.js";import{o as z}from"./chunk-P77MY6VE.js";import{$b as U,Ab as V,Bb as S,Cb as i,Db as e,Eb as d,Kb as $,Ob as D,Qb as v,Ra as N,T as q,Wa as l,Wb as E,Y as m,Yb as r,Zb as A,_b as I,ba as w,ca as F,ib as j,oa as P,vb as g,wb as f,zb as M}from"./chunk-OOA6GWW3.js";import"./chunk-7CGTOI24.js";var y=class o{authService=m(k);logger=m(R);supabase;constructor(){this.supabase=this.authService.getSupabaseClient()}async createMessage(t){try{let n={name:t.name,email:t.email,phone:t.phone||null,subject:t.subject||null,message:t.message,is_read:!1},{error:c}=await this.supabase.from("contact_messages").insert(n);return c&&this.logger.error("Supabase ContactService Error:",c),{error:c}}catch(n){return this.logger.error("ContactService Exception:",n),{error:{message:n?.message||"Unknown error",details:"",hint:"",code:"UNKNOWN",name:"PostgrestError"}}}}static \u0275fac=function(n){return new(n||o)};static \u0275prov=q({token:o,factory:o.\u0275fac,providedIn:"root"})};var re=(o,t)=>t.product.id;function oe(o,t){if(o&1&&(i(0,"div",2)(1,"div",4)(2,"div",5),d(3,"i",6),e(),i(4,"h2",7),r(5,"\xA1Orden Recibida!"),e(),i(6,"p",8),r(7,"Gracias por tu compra. Para procesar el env\xEDo, por favor realiza el pago:"),e(),i(8,"div",9)(9,"p",10),r(10,"Datos Bancarios:"),e(),i(11,"div",11)(12,"p",12)(13,"span"),r(14,"Alias:"),e(),i(15,"span",13),r(16,"areco.fix"),e()(),i(17,"p",12)(18,"span"),r(19,"CBU:"),e(),i(20,"span",13),r(21,"0000003100084531456958"),e()()()(),i(22,"p",14),r(23," Una vez realizado el pago, env\xEDa el comprobante al: "),d(24,"br"),i(25,"strong",15),r(26,"+54 9 11 2596-0900"),e()(),i(27,"div",16)(28,"a",17),d(29,"i",18),r(30," Enviar Comprobante "),e(),i(31,"a",19),r(32,"Volver al Inicio"),e()()()()),o&2){let n,c=v();l(28),S("href","https://wa.me/5491125960900?text=Hola,%20hice%20un%20pedido%20a%20nombre%20de%20"+((n=c.checkoutForm.get("name"))==null?null:n.value)+".%20Adjunto%20comprobante.",N)}}function ae(o,t){o&1&&(i(0,"p",37),r(1,"Tu carrito est\xE1 vac\xEDo."),e(),i(2,"a",38),r(3,"Ir a comprar"),e())}function le(o,t){if(o&1){let n=$();i(0,"div",40),d(1,"img",43),i(2,"div",44)(3,"h3",45),r(4),e(),i(5,"p",46),r(6),e()(),i(7,"div",47)(8,"span",45),r(9),e(),i(10,"button",48),D("click",function(){let u=w(n).$implicit,b=v(3);return F(b.cartService.removeFromCart(u.product.id))}),d(11,"i",49),e()()()}if(o&2){let n=t.$implicit;l(),S("src",n.product.image_url||(n.product.gallery_urls==null?null:n.product.gallery_urls[0])||"assets/img/no-image.png",N),l(3),A(n.product.name),l(2),U("$",n.product.price," x ",n.quantity),l(3),I(" $",(n.product.price*n.quantity).toFixed(2)," ")}}function ce(o,t){if(o&1&&(i(0,"div",39),M(1,le,12,5,"div",40,re),e(),d(3,"div",41),i(4,"div",42)(5,"span"),r(6,"Total"),e(),i(7,"span"),r(8),e()()),o&2){let n=v(2);l(),V(n.cartService.cartItems()),l(7),I("$",n.cartService.totalPrice().toFixed(2))}}function se(o,t){o&1&&(i(0,"span",29),r(1,"El nombre es requerido"),e())}function de(o,t){o&1&&(i(0,"span",29),r(1,"Email inv\xE1lido"),e())}function me(o,t){o&1&&(i(0,"span",29),r(1,"El tel\xE9fono es requerido"),e())}function ue(o,t){o&1&&(i(0,"span",29),r(1,"La direcci\xF3n es requerida"),e())}function pe(o,t){o&1&&d(0,"span",36)}function be(o,t){if(o&1){let n=$();i(0,"div",3)(1,"div",20)(2,"div",21)(3,"h2",22),r(4,"Resumen del Carrito"),e(),g(5,ae,4,0)(6,ce,9,1),e()(),i(7,"div",23)(8,"div",21)(9,"h2",22),r(10,"Datos del Cliente"),e(),i(11,"form",24),D("ngSubmit",function(){w(n);let u=v();return F(u.placeOrder())}),i(12,"div",25)(13,"label",26)(14,"span",27),r(15,"Nombre Completo"),e()(),d(16,"input",28),g(17,se,2,0,"span",29),e(),i(18,"div",25)(19,"label",26)(20,"span",27),r(21,"Email"),e()(),d(22,"input",30),g(23,de,2,0,"span",29),e(),i(24,"div",25)(25,"label",26)(26,"span",27),r(27,"Tel\xE9fono"),e()(),d(28,"input",31),g(29,me,2,0,"span",29),e(),i(30,"div",25)(31,"label",26)(32,"span",27),r(33,"Direcci\xF3n de Env\xEDo"),e()(),d(34,"textarea",32),g(35,ue,2,0,"span",29),e(),i(36,"div",25)(37,"label",26)(38,"span",27),r(39,"Notas (Opcional)"),e()(),d(40,"textarea",33),e(),i(41,"div",34)(42,"button",35),g(43,pe,1,0,"span",36),r(44," Finalizar Compra "),e()()()()()()}if(o&2){let n,c,u,b,s,p,x,h,a=v();l(5),f(a.cartService.cartItems().length===0?5:6),l(6),S("formGroup",a.checkoutForm),l(5),E("input-error",((n=a.checkoutForm.get("name"))==null?null:n.invalid)&&((n=a.checkoutForm.get("name"))==null?null:n.touched)),l(),f((c=a.checkoutForm.get("name"))!=null&&c.invalid&&((c=a.checkoutForm.get("name"))!=null&&c.touched)?17:-1),l(5),E("input-error",((u=a.checkoutForm.get("email"))==null?null:u.invalid)&&((u=a.checkoutForm.get("email"))==null?null:u.touched)),l(),f((b=a.checkoutForm.get("email"))!=null&&b.invalid&&((b=a.checkoutForm.get("email"))!=null&&b.touched)?23:-1),l(5),E("input-error",((s=a.checkoutForm.get("phone"))==null?null:s.invalid)&&((s=a.checkoutForm.get("phone"))==null?null:s.touched)),l(),f((p=a.checkoutForm.get("phone"))!=null&&p.invalid&&((p=a.checkoutForm.get("phone"))!=null&&p.touched)?29:-1),l(5),E("textarea-error",((x=a.checkoutForm.get("address"))==null?null:x.invalid)&&((x=a.checkoutForm.get("address"))==null?null:x.touched)),l(),f((h=a.checkoutForm.get("address"))!=null&&h.invalid&&((h=a.checkoutForm.get("address"))!=null&&h.touched)?35:-1),l(7),S("disabled",a.isProcessing()||a.cartService.cartItems().length===0),l(),f(a.isProcessing()?43:-1)}}var ne=class o{cartService=m(B);orderService=m(ee);authService=m(k);contactService=m(y);fb=m(Y);router=m(G);notificationService=m(te);checkoutForm=this.fb.group({name:["",[_.required]],email:["",[_.required,_.email]],phone:["",[_.required]],address:["",[_.required]],notes:[""]});isProcessing=P(!1);orderSuccess=P(!1);async placeOrder(){if(this.checkoutForm.invalid){this.checkoutForm.markAllAsTouched(),this.notificationService.showError("Por favor, completa todos los campos requeridos.");return}this.isProcessing.set(!0);let t=this.checkoutForm.getRawValue(),n=this.cartService.cartItems(),c=this.cartService.totalPrice(),u={customer_name:t.name,customer_email:t.email,customer_phone:t.phone,customer_address:t.address,status:"pending",subtotal:c,tax:0,discount:0,total:c,notes:t.notes,customer_id:this.authService.getCurrentUser()?.id},b=n.map(s=>({product_name:s.product.name,product_id:s.product.id,quantity:s.quantity,unit_price:s.product.price,subtotal:s.product.price*s.quantity}));try{let{data:s,error:p}=await this.orderService.createOrder(u,b);if(p)throw console.error("Order creation error:",p),p;let x=n.map(C=>`- ${C.product.name} (x${C.quantity}) - $${(C.product.price*C.quantity).toFixed(2)}`).join(`
`),h=`Nuevo Pedido #${s?.order_number||"N/A"}
      
Detalles del Cliente:
Nombre: ${t.name}
Email: ${t.email}
Tel\xE9fono: ${t.phone}
Direcci\xF3n: ${t.address}

Productos:
${x}

Total: $${c.toFixed(2)}

Notas Adicionales:
${t.notes||"Ninguna"}`,a={name:t.name,email:t.email,phone:t.phone,subject:`[NUEVO PEDIDO] #${s?.order_number} - ${t.name} - $${c.toFixed(2)}`,message:h},{error:T}=await this.contactService.createMessage(a);T&&console.error("Message creation error (non-fatal):",T);let O=this.authService.getCurrentUser();O&&await this.authService.getSupabaseClient().from("profiles").update({phone:t.phone,address:t.address,updated_at:new Date().toISOString()}).eq("id",O.id).maybeSingle(),this.orderSuccess.set(!0),this.cartService.clearCart(),this.notificationService.showSuccess("\xA1Orden creada exitosamente!")}catch(s){console.error("Checkout failed full error:",JSON.stringify(s,null,2));let p=s?.message||"Error desconocido",x=s?.code||"N/A";this.notificationService.showError(`Hubo un error al procesar tu orden: ${p} (C\xF3digo: ${x})`)}finally{this.isProcessing.set(!1)}}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=j({type:o,selectors:[["app-checkout-page"]],decls:5,vars:1,consts:[[1,"container","mx-auto","px-4","py-8","max-w-4xl"],[1,"text-3xl","font-bold","mb-8","text-center","text-primary"],[1,"card","bg-base-100","shadow-xl","text-center","p-10","border","border-base-200"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"card-body","items-center"],[1,"text-success","text-6xl","mb-4"],[1,"fas","fa-check-circle"],[1,"card-title","text-2xl","text-base-content","mb-2"],[1,"text-base-content/80","mb-6"],[1,"bg-base-200","p-6","rounded-xl","w-full","max-w-md","mb-6","text-left","border","border-base-300"],[1,"font-bold","text-base-content","mb-2","border-b","border-base-content/10","pb-2"],[1,"space-y-2"],[1,"text-base-content/70","flex","justify-between"],[1,"font-mono","font-bold","text-base-content","select-all","bg-base-100","px-2","rounded"],[1,"text-sm","mb-4","text-base-content/80"],[1,"text-lg","text-primary"],[1,"card-actions","flex","flex-col","gap-3","w-full","max-w-md"],["target","_blank",1,"btn","btn-success","text-white","w-full","btn-lg",3,"href"],[1,"fab","fa-whatsapp","text-xl","mr-2"],["routerLink","/",1,"btn","btn-ghost","w-full"],[1,"card","bg-base-100","shadow-xl","h-fit","border","border-base-200"],[1,"card-body"],[1,"card-title","mb-4","text-base-content"],[1,"card","bg-base-100","shadow-xl","border","border-base-200"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"form-control","w-full"],[1,"label"],[1,"label-text","text-base-content"],["type","text","formControlName","name",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],[1,"text-error","text-xs","mt-1"],["type","email","formControlName","email",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["type","tel","formControlName","phone",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["formControlName","address",1,"textarea","textarea-bordered","h-24","w-full","bg-base-100","text-base-content"],["formControlName","notes",1,"textarea","textarea-bordered","w-full","bg-base-100","text-base-content"],[1,"mt-6"],["type","submit",1,"btn","btn-primary","btn-block","btn-lg",3,"disabled"],[1,"loading","loading-spinner"],[1,"text-base-content"],["routerLink","/products/featured",1,"btn","btn-link","px-0"],[1,"space-y-4"],[1,"flex","gap-4","items-center","p-2","hover:bg-base-200","rounded-lg","transition-colors"],[1,"divider"],[1,"flex","justify-between","text-xl","font-bold","text-base-content"],[1,"w-16","h-16","object-cover","rounded-lg","border","border-base-300",3,"src"],[1,"flex-1"],[1,"font-bold","text-base-content"],[1,"text-sm","text-base-content/70"],[1,"flex","flex-col","items-end","gap-1"],["aria-label","Eliminar",1,"btn","btn-ghost","btn-xs","text-error",3,"click"],[1,"fas","fa-trash-alt"]],template:function(n,c){n&1&&(i(0,"div",0)(1,"h1",1),r(2,"Finalizar Compra"),e(),g(3,oe,33,1,"div",2)(4,be,45,16,"div",3),e()),n&2&&(l(3),f(c.orderSuccess()?3:4))},dependencies:[z,Z,W,H,J,K,X,Q,L],encapsulation:2})};export{ne as CheckoutPage};
