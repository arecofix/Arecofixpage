import{a as $}from"./chunk-7VAY7RSI.js";import{a as G,b as j,d as q,e as O,f as R,g as U,h as z,i as J,l as K,m as H,n as Q,o as X,p as Y,r as Z}from"./chunk-V4FOMNQO.js";import"./chunk-P6KFP5JI.js";import{a as B,c as I,d as L}from"./chunk-B4MTIIOY.js";import"./chunk-UGUM5KGK.js";import"./chunk-WYMAPANE.js";import{n as D}from"./chunk-2LXWRM6P.js";import"./chunk-LAXSCOZR.js";import{Fa as V,Hb as a,Ia as l,Ib as F,Jb as T,Lb as u,Mb as p,Nb as f,Wa as A,X as b,aa as m,ba as g,gb as h,hb as w,jb as W,kb as x,kc as N,lb as M,mb as v,na as y,nb as i,ob as r,pb as _,tb as k,xb as P,zb as E}from"./chunk-BLXVCPJI.js";import{a as C,b as S}from"./chunk-VOSPIT4N.js";var ee=(d,t)=>t.id;function ie(d,t){if(d&1&&(i(0,"option",18),a(1),r()),d&2){let o=t.$implicit;v("value",o.id),l(),F(o.name)}}function re(d,t){if(d&1&&(i(0,"option",18),a(1),r()),d&2){let o=t.$implicit;v("value",o.id),l(),F(o.name)}}function ne(d,t){d&1&&(i(0,"span",38),a(1,"Principal"),r())}function oe(d,t){if(d&1){let o=k();i(0,"div",33),_(1,"img",34),i(2,"div",35)(3,"button",36),P("click",function(){let s=m(o).$index,c=E(2);return g(c.removeImage(s))}),_(4,"i",37),r()(),h(5,ne,2,0,"span",38),r()}if(d&2){let o=t.$implicit,e=t.$index;l(),v("src",o,V),l(4),w(e===0?5:-1)}}function ae(d,t){if(d&1&&(i(0,"div",28),x(1,oe,6,2,"div",33,W),r()),d&2){let o=E();l(),M(o.form().images)}}function de(d,t){if(d&1&&(i(0,"div",29),_(1,"i",39),i(2,"span"),a(3),r()()),d&2){let o=E();l(3),F(o.error)}}function le(d,t){d&1&&(_(0,"span",40),a(1," Subiendo... "))}function se(d,t){d&1&&(_(0,"span",40),a(1," Guardando... "))}function me(d,t){d&1&&a(0," Guardar Producto ")}var te=class d{route=b(B);router=b(I);productService=b($);cdr=b(N);id=null;form=y({sku:"",barcode:"",name:"",slug:"",description:"",price:0,stock:0,brand_id:"",category_id:"",is_active:!0,images:[]},{});brands=y([],{});categories=y([],{});loading=!0;saving=!1;uploading=y(!1,{});error=null;async ngOnInit(){try{let[t,o]=await Promise.all([this.productService.getBrands(),this.productService.getCategories()]);if(this.brands.set(t),this.categories.set(o),this.id=this.route.snapshot.paramMap.get("id"),this.id){let e=await this.productService.getProduct(this.id);e&&this.form.set({sku:e.sku||"",barcode:e.barcode||"",name:e.name||"",slug:e.slug||"",description:e.description||"",price:e.price||0,stock:e.stock||0,brand_id:e.brand_id||"",category_id:e.category_id||"",is_active:e.is_active??!0,images:e.gallery_urls||(e.image_url?[e.image_url]:[])})}}catch(t){this.error=t.message||"Error al cargar datos"}finally{this.loading=!1,this.cdr.markForCheck()}}async onFileChange(t){let o=t.target.files?.[0];if(o){this.uploading.set(!0);try{let e=await this.productService.uploadImage(o);this.form.update(s=>S(C({},s),{images:[...s.images,e]}))}catch(e){this.error=e.message}finally{this.uploading.set(!1),this.cdr.markForCheck()}}}removeImage(t){this.form.update(o=>S(C({},o),{images:o.images.filter((e,s)=>s!==t)})),this.cdr.markForCheck()}generateBarcode(){let t=this.form().sku,o=t||`GEN-${Date.now()}`;this.form.update(e=>S(C({},e),{barcode:o}))}async save(){this.saving=!0,this.error=null;let t=this.form(),o=t.slug;o||(o=this.productService.slugify(t.name));let e={sku:t.sku,barcode:t.barcode,name:t.name,slug:o,description:t.description,price:t.price,stock:t.stock,brand_id:t.brand_id||null,category_id:t.category_id||null,is_active:t.is_active,gallery_urls:Array.isArray(t.images)?t.images:[],image_url:t.images.length>0?t.images[0]:null};try{this.id?await this.productService.updateProduct(this.id,e):await this.productService.createProduct(e),this.router.navigate(["/admin/products"])}catch(s){this.error=s.message||"Error al guardar producto"}finally{this.saving=!1,this.cdr.markForCheck()}}static \u0275fac=function(o){return new(o||d)};static \u0275cmp=A({type:d,selectors:[["app-admin-product-form-page"]],decls:85,vars:14,consts:[["f","ngForm"],[1,"max-w-4xl","mx-auto","text-gray-800"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-800"],[3,"ngSubmit"],[1,"bg-white","p-6","rounded-xl","shadow-sm","border","border-gray-100","mb-6"],[1,"text-lg","font-semibold","mb-4","text-gray-800","border-b","pb-2"],[1,"mb-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1.5"],["type","text","name","name","placeholder","Ej: iPhone 13 Pro Max","required","",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["type","text","name","sku","placeholder","C\xF3digo interno",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],["type","text","name","barcode","placeholder","EAN / UPC",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","button","title","Generar c\xF3digo aleatorio",1,"btn","btn-square","btn-outline",3,"click"],[1,"fas","fa-random"],["name","brand_id",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["name","category_id",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["name","description","rows","4","placeholder","Detalles t\xE9cnicos, caracter\xEDsticas...",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","number","name","price","required","","min","0",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","number","name","stock","min","0",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-3","p-3","bg-white","border","border-gray-200","rounded-lg","hover:bg-gray-50","transition-colors","cursor-pointer","w-fit"],["type","checkbox","name","is_active",1,"checkbox","checkbox-primary","h-5","w-5","rounded","border-gray-300",3,"ngModelChange","ngModel"],[1,"font-medium","text-gray-700"],["type","file","accept","image/*","multiple","",1,"file-input","file-input-bordered","file-input-primary","w-full","bg-white","text-gray-700",3,"change"],[1,"text-sm","text-gray-500","mt-2"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mt-6"],[1,"alert","alert-error","mb-6"],[1,"flex","gap-4","justify-end"],["routerLink","/admin/products",1,"btn","btn-ghost"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"relative","group","aspect-square"],[1,"w-full","h-full","object-cover","rounded-lg","border","border-gray-200","shadow-sm",3,"src"],[1,"absolute","inset-0","bg-black/40","opacity-0","group-hover:opacity-100","transition-opacity","rounded-lg","flex","items-center","justify-center"],["type","button",1,"btn","btn-circle","btn-error","btn-sm","text-white",3,"click"],[1,"fas","fa-trash"],[1,"absolute","bottom-2","left-2","badge","badge-primary","badge-sm","shadow-md"],[1,"fas","fa-exclamation-circle"],[1,"loading","loading-spinner","loading-xs","mr-2"]],template:function(o,e){if(o&1){let s=k();i(0,"div",1)(1,"div",1)(2,"div",2)(3,"h2",3),a(4),r()(),i(5,"form",4,0),P("ngSubmit",function(){return m(s),g(e.save())}),i(7,"div",5)(8,"h3",6),a(9,"Informaci\xF3n B\xE1sica"),r(),i(10,"div",7)(11,"label",8),a(12,"Nombre del Producto"),r(),i(13,"input",9),f("ngModelChange",function(n){return m(s),p(e.form().name,n)||(e.form().name=n),g(n)}),r()(),i(14,"div",10)(15,"div")(16,"label",8),a(17,"SKU"),r(),i(18,"input",11),f("ngModelChange",function(n){return m(s),p(e.form().sku,n)||(e.form().sku=n),g(n)}),r()(),i(19,"div")(20,"label",8),a(21,"C\xF3digo de Barras"),r(),i(22,"div",12)(23,"input",13),f("ngModelChange",function(n){return m(s),p(e.form().barcode,n)||(e.form().barcode=n),g(n)}),r(),i(24,"button",14),P("click",function(){return m(s),g(e.generateBarcode())}),_(25,"i",15),r()()()()(),i(26,"div",5)(27,"h3",6),a(28,"Categorizaci\xF3n"),r(),i(29,"div",10)(30,"div")(31,"label",8),a(32,"Marca"),r(),i(33,"select",16),f("ngModelChange",function(n){return m(s),p(e.form().brand_id,n)||(e.form().brand_id=n),g(n)}),i(34,"option",17),a(35,"Seleccionar Marca"),r(),x(36,ie,2,2,"option",18,ee),r()(),i(38,"div")(39,"label",8),a(40,"Categor\xEDa"),r(),i(41,"select",19),f("ngModelChange",function(n){return m(s),p(e.form().category_id,n)||(e.form().category_id=n),g(n)}),i(42,"option",17),a(43,"Seleccionar Categor\xEDa"),r(),x(44,re,2,2,"option",18,ee),r()()()(),i(46,"div",5)(47,"h3",6),a(48,"Detalles"),r(),i(49,"div",7)(50,"label",8),a(51,"Descripci\xF3n"),r(),i(52,"textarea",20),f("ngModelChange",function(n){return m(s),p(e.form().description,n)||(e.form().description=n),g(n)}),r()(),i(53,"div",10)(54,"div")(55,"label",8),a(56,"Precio ($)"),r(),i(57,"input",21),f("ngModelChange",function(n){return m(s),p(e.form().price,n)||(e.form().price=n),g(n)}),r()(),i(58,"div")(59,"label",8),a(60,"Stock"),r(),i(61,"input",22),f("ngModelChange",function(n){return m(s),p(e.form().stock,n)||(e.form().stock=n),g(n)}),r()()()(),i(62,"div",5)(63,"label",23)(64,"input",24),f("ngModelChange",function(n){return m(s),p(e.form().is_active,n)||(e.form().is_active=n),g(n)}),r(),i(65,"span",25),a(66,"Producto Activo"),r()()(),i(67,"div",5)(68,"h3",6),a(69,"Galer\xEDa de Im\xE1genes"),r(),i(70,"div",7)(71,"label",8),a(72,"Subir Im\xE1genes"),r(),i(73,"input",26),P("change",function(n){return m(s),g(e.onFileChange(n))}),r(),i(74,"p",27),a(75,"Formatos soportados: JPG, PNG, WEBP."),r()(),h(76,ae,3,0,"div",28),r(),h(77,de,4,1,"div",29),i(78,"div",30)(79,"a",31),a(80,"Cancelar"),r(),i(81,"button",32),h(82,le,2,0)(83,se,2,0)(84,me,1,0),r()()()()()}o&2&&(l(4),T("",e.id?"Editar":"Nuevo"," Producto"),l(9),u("ngModel",e.form().name),l(5),u("ngModel",e.form().sku),l(5),u("ngModel",e.form().barcode),l(10),u("ngModel",e.form().brand_id),l(3),M(e.brands()),l(5),u("ngModel",e.form().category_id),l(3),M(e.categories()),l(8),u("ngModel",e.form().description),l(5),u("ngModel",e.form().price),l(4),u("ngModel",e.form().stock),l(3),u("ngModel",e.form().is_active),l(12),w(e.form().images.length>0?76:-1),l(),w(e.error?77:-1),l(4),v("disabled",e.saving||e.uploading()),l(),w(e.uploading()?82:e.saving?83:84))},dependencies:[D,Z,z,H,Q,j,J,G,K,q,O,Y,X,U,R,L],encapsulation:2,changeDetection:0})};export{te as AdminProductFormPage};
