import{a as J}from"./chunk-QFI4IR4S.js";import{a as K}from"./chunk-3GXERERK.js";import{b as $,c as h,d as A,e as L,h as j,j as z,k as B,r as H,t as U}from"./chunk-ROKQGBVC.js";import{a as R}from"./chunk-5HH3CGAW.js";import"./chunk-MI7WHUK7.js";import"./chunk-XFT2X3PC.js";import{c as G,d as M}from"./chunk-CYIQDGHK.js";import"./chunk-BVKNO7TK.js";import"./chunk-RZVF5N6E.js";import"./chunk-T7AXESXA.js";import{p as O}from"./chunk-BKULT56L.js";import{Cb as y,Eb as f,Ha as N,Kb as g,La as l,Mb as o,Nb as V,Ob as w,Pb as D,Y as _,Za as T,ba as k,ca as E,jb as p,kb as x,nb as I,oa as F,ob as q,pb as S,qb as t,rb as e,sb as s,yb as P}from"./chunk-YATSW66L.js";import"./chunk-VOSPIT4N.js";var W=(n,a)=>a.product.id;function X(n,a){n&1&&(t(0,"div",2)(1,"div",4)(2,"div",5),s(3,"i",6),e(),t(4,"h2",7),o(5,"\xA1Orden Recibida!"),e(),t(6,"p",8),o(7,"Gracias por tu compra. Nos pondremos en contacto contigo pronto."),e(),t(8,"div",9)(9,"a",10),o(10,"Volver al Inicio"),e()()()())}function Y(n,a){n&1&&(t(0,"p",28),o(1,"Tu carrito est\xE1 vac\xEDo."),e(),t(2,"a",29),o(3,"Ir a comprar"),e())}function Z(n,a){if(n&1){let i=P();t(0,"div",31),s(1,"img",34),t(2,"div",35)(3,"h3",36),o(4),e(),t(5,"p",37),o(6),e()(),t(7,"div",38)(8,"span",36),o(9),e(),t(10,"button",39),y("click",function(){let m=k(i).$implicit,u=f(3);return E(u.cartService.removeFromCart(m.product.id))}),s(11,"i",40),e()()()}if(n&2){let i=a.$implicit;l(),S("src",i.product.image_url||(i.product.gallery_urls==null?null:i.product.gallery_urls[0])||"assets/img/no-image.png",N),l(3),V(i.product.name),l(2),D("$",i.product.price," x ",i.quantity),l(3),w(" $",(i.product.price*i.quantity).toFixed(2)," ")}}function ee(n,a){if(n&1&&(t(0,"div",30),I(1,Z,12,5,"div",31,W),e(),s(3,"div",32),t(4,"div",33)(5,"span"),o(6,"Total"),e(),t(7,"span"),o(8),e()()),n&2){let i=f(2);l(),q(i.cartService.cartItems()),l(7),w("$",i.cartService.totalPrice().toFixed(2))}}function te(n,a){n&1&&(t(0,"span",20),o(1,"El nombre es requerido"),e())}function ie(n,a){n&1&&(t(0,"span",20),o(1,"Email inv\xE1lido"),e())}function ne(n,a){n&1&&(t(0,"span",20),o(1,"El tel\xE9fono es requerido"),e())}function oe(n,a){n&1&&(t(0,"span",20),o(1,"La direcci\xF3n es requerida"),e())}function re(n,a){n&1&&s(0,"span",27)}function ae(n,a){if(n&1){let i=P();t(0,"div",3)(1,"div",11)(2,"div",12)(3,"h2",13),o(4,"Resumen del Carrito"),e(),p(5,Y,4,0)(6,ee,9,1),e()(),t(7,"div",14)(8,"div",12)(9,"h2",13),o(10,"Datos del Cliente"),e(),t(11,"form",15),y("ngSubmit",function(){k(i);let m=f();return E(m.placeOrder())}),t(12,"div",16)(13,"label",17)(14,"span",18),o(15,"Nombre Completo"),e()(),s(16,"input",19),p(17,te,2,0,"span",20),e(),t(18,"div",16)(19,"label",17)(20,"span",18),o(21,"Email"),e()(),s(22,"input",21),p(23,ie,2,0,"span",20),e(),t(24,"div",16)(25,"label",17)(26,"span",18),o(27,"Tel\xE9fono"),e()(),s(28,"input",22),p(29,ne,2,0,"span",20),e(),t(30,"div",16)(31,"label",17)(32,"span",18),o(33,"Direcci\xF3n de Env\xEDo"),e()(),s(34,"textarea",23),p(35,oe,2,0,"span",20),e(),t(36,"div",16)(37,"label",17)(38,"span",18),o(39,"Notas (Opcional)"),e()(),s(40,"textarea",24),e(),t(41,"div",25)(42,"button",26),p(43,re,1,0,"span",27),o(44," Finalizar Compra "),e()()()()()()}if(n&2){let i,d,m,u,c,b,v,C,r=f();l(5),x(r.cartService.cartItems().length===0?5:6),l(6),S("formGroup",r.checkoutForm),l(5),g("input-error",((i=r.checkoutForm.get("name"))==null?null:i.invalid)&&((i=r.checkoutForm.get("name"))==null?null:i.touched)),l(),x((d=r.checkoutForm.get("name"))!=null&&d.invalid&&((d=r.checkoutForm.get("name"))!=null&&d.touched)?17:-1),l(5),g("input-error",((m=r.checkoutForm.get("email"))==null?null:m.invalid)&&((m=r.checkoutForm.get("email"))==null?null:m.touched)),l(),x((u=r.checkoutForm.get("email"))!=null&&u.invalid&&((u=r.checkoutForm.get("email"))!=null&&u.touched)?23:-1),l(5),g("input-error",((c=r.checkoutForm.get("phone"))==null?null:c.invalid)&&((c=r.checkoutForm.get("phone"))==null?null:c.touched)),l(),x((b=r.checkoutForm.get("phone"))!=null&&b.invalid&&((b=r.checkoutForm.get("phone"))!=null&&b.touched)?29:-1),l(5),g("textarea-error",((v=r.checkoutForm.get("address"))==null?null:v.invalid)&&((v=r.checkoutForm.get("address"))==null?null:v.touched)),l(),x((C=r.checkoutForm.get("address"))!=null&&C.invalid&&((C=r.checkoutForm.get("address"))!=null&&C.touched)?35:-1),l(7),S("disabled",r.isProcessing()||r.cartService.cartItems().length===0),l(),x(r.isProcessing()?43:-1)}}var Q=class n{cartService=_(R);orderService=_(J);fb=_(H);router=_(G);notificationService=_(K);checkoutForm=this.fb.group({name:["",[h.required]],email:["",[h.required,h.email]],phone:["",[h.required]],address:["",[h.required]],notes:[""]});isProcessing=F(!1);orderSuccess=F(!1);async placeOrder(){if(this.checkoutForm.invalid){this.checkoutForm.markAllAsTouched(),this.notificationService.showError("Por favor, completa todos los campos requeridos.");return}this.isProcessing.set(!0);let a=this.checkoutForm.getRawValue(),i=this.cartService.cartItems(),d=this.cartService.totalPrice(),m={customer_name:a.name,customer_email:a.email,customer_phone:a.phone,customer_address:a.address,status:"pending",subtotal:d,tax:0,discount:0,total:d,notes:a.notes},u=i.map(c=>({product_name:c.product.name,product_id:c.product.id,quantity:c.quantity,unit_price:c.product.price,subtotal:c.product.price*c.quantity}));try{let{data:c,error:b}=await this.orderService.createOrder(m,u);if(b)throw b;this.orderSuccess.set(!0),this.cartService.clearCart(),this.notificationService.showSuccess("\xA1Orden creada exitosamente!")}catch(c){console.error("Checkout failed",c),this.notificationService.showError("Hubo un error al procesar tu orden. Por favor intenta nuevamente.")}finally{this.isProcessing.set(!1)}}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=T({type:n,selectors:[["app-checkout-page"]],decls:5,vars:1,consts:[[1,"container","mx-auto","px-4","py-8","max-w-4xl"],[1,"text-3xl","font-bold","mb-8","text-center","text-base-content"],[1,"card","bg-base-100","shadow-xl","text-center","p-10","border","border-base-200"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"card-body","items-center"],[1,"text-success","text-6xl","mb-4"],[1,"fas","fa-check-circle"],[1,"card-title","text-2xl","text-base-content"],[1,"text-base-content/80"],[1,"card-actions","mt-6"],["routerLink","/",1,"btn","btn-primary"],[1,"card","bg-base-100","shadow-xl","h-fit","border","border-base-200"],[1,"card-body"],[1,"card-title","mb-4","text-base-content"],[1,"card","bg-base-100","shadow-xl","border","border-base-200"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"form-control","w-full"],[1,"label"],[1,"label-text","text-base-content"],["type","text","formControlName","name",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],[1,"text-error","text-xs","mt-1"],["type","email","formControlName","email",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["type","tel","formControlName","phone",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["formControlName","address",1,"textarea","textarea-bordered","h-24","w-full","bg-base-100","text-base-content"],["formControlName","notes",1,"textarea","textarea-bordered","w-full","bg-base-100","text-base-content"],[1,"mt-6"],["type","submit",1,"btn","btn-primary","btn-block","btn-lg",3,"disabled"],[1,"loading","loading-spinner"],[1,"text-base-content/70"],["routerLink","/products",1,"btn","btn-link","px-0"],[1,"space-y-4"],[1,"flex","gap-4","items-center","p-2","hover:bg-base-200","rounded-lg","transition-colors"],[1,"divider"],[1,"flex","justify-between","text-xl","font-bold","text-base-content"],[1,"w-16","h-16","object-cover","rounded-lg","border","border-base-300",3,"src"],[1,"flex-1"],[1,"font-bold","text-base-content"],[1,"text-sm","text-base-content/70"],[1,"flex","flex-col","items-end","gap-1"],["aria-label","Eliminar",1,"btn","btn-ghost","btn-xs","text-error",3,"click"],[1,"fas","fa-trash-alt"]],template:function(i,d){i&1&&(t(0,"div",0)(1,"h1",1),o(2,"Checkout"),e(),p(3,X,11,0,"div",2)(4,ae,45,16,"div",3),e()),i&2&&(l(3),x(d.orderSuccess()?3:4))},dependencies:[O,U,j,$,A,L,B,z,M],encapsulation:2})};export{Q as CheckoutPage};
