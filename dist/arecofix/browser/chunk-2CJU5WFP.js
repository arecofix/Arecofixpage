import{a as R}from"./chunk-4TKL6PHB.js";import"./chunk-AQQRJJTD.js";import{e as N,h as D}from"./chunk-ZP3NLRVZ.js";import"./chunk-AF237TA6.js";import{a as j}from"./chunk-T7AXESXA.js";import{o as M,r as F}from"./chunk-XPXWP2W5.js";import{Ab as k,Bb as v,Cb as t,Db as i,Eb as g,Kb as w,Ob as I,Qb as s,Ra as b,Wa as r,Xb as T,Y as u,Yb as n,Zb as d,_b as m,ba as S,ca as C,hc as P,ib as E,oa as x,oc as _,qc as f,vb as c,wb as p,yb as h,zb as y}from"./chunk-D4Q5CFD4.js";import"./chunk-VOSPIT4N.js";function O(a,o){a&1&&(t(0,"div",6),g(1,"span",7),t(2,"p",8),n(3,"Buscando reparaci\xF3n..."),i()())}function V(a,o){if(a&1&&(t(0,"div",9),g(1,"i",10),t(2,"span"),n(3),i()(),t(4,"div",11)(5,"a",12),n(6,"Volver al Inicio"),i()()),a&2){let e=s();r(3),d(e.error())}}function U(a,o){if(a&1&&(t(0,"div",15)(1,"span",16),n(2,"IMEI / Serie"),i(),t(3,"span",18),n(4),i()()),a&2){let e=s(2);r(4),d(e.repair().imei)}}function q(a,o){if(a&1&&(t(0,"div",15)(1,"span",16),n(2,"Fecha Completado"),i(),t(3,"span",18),n(4),_(5,"date"),i()()),a&2){let e=s(2);r(4),d(f(5,1,e.repair().completed_at,"dd/MM/yyyy"))}}function z(a,o){if(a&1&&(t(0,"div",19)(1,"span",20),n(2,"Diagn\xF3stico / Soluci\xF3n"),i(),t(3,"p",33),n(4),i()()),a&2){let e=s(2);r(4),m(" ",e.repair().technician_notes," ")}}function A(a,o){if(a&1){let e=w();t(0,"div",36)(1,"img",37),I("click",function(){let B=S(e).$implicit,L=s(3);return C(L.openImage(B))}),i()()}if(a&2){let e=o.$implicit;r(),v("src",e,b)}}function J(a,o){if(a&1&&(t(0,"div",19)(1,"span",34),n(2,"Im\xE1genes del Estado"),i(),t(3,"div",35),y(4,A,2,1,"div",36,h),i()()),a&2){let e=s(2);r(4),k(e.repair().images)}}function G(a,o){if(a&1&&(t(0,"div",13)(1,"div"),n(2),i()(),t(3,"div",14)(4,"div",15)(5,"span",16),n(6,"C\xF3digo de Seguimiento"),i(),t(7,"span",17),n(8),i()(),t(9,"div",15)(10,"span",16),n(11,"Dispositivo"),i(),t(12,"span",18),n(13),i()(),c(14,U,5,1,"div",15),t(15,"div",15)(16,"span",16),n(17,"Cliente"),i(),t(18,"span",18),n(19),i()(),t(20,"div",15)(21,"span",16),n(22,"Fecha Ingreso"),i(),t(23,"span",18),n(24),_(25,"date"),i()(),c(26,q,6,4,"div",15),t(27,"div",19)(28,"span",20),n(29,"Problema Reportado"),i(),t(30,"p",21),n(31),i()(),c(32,z,5,1,"div",19),c(33,J,6,0,"div",19),t(34,"div",22)(35,"div",23)(36,"span",24),n(37,"Presupuesto"),i(),t(38,"span",18),n(39),i()(),t(40,"div",25)(41,"span",26),n(42,"Se\xF1a"),i(),t(43,"span",27),n(44),i()(),g(45,"div",28),t(46,"div",29)(47,"span",18),n(48,"Total a Pagar"),i(),t(49,"span",17),n(50),i()()()(),t(51,"div",30)(52,"a",31),g(53,"i",32),n(54," Consultar "),i()()),a&2){let e=s();r(),T(P("badge ",e.getStatusColor(e.repair().status)," badge-lg p-4 font-bold uppercase")),r(),m(" ",e.getStatusLabel(e.repair().status)," "),r(6),d(e.repair().tracking_code),r(5),d(e.repair().device_model),r(),p(e.repair().imei?14:-1),r(5),d(e.repair().customer_name),r(5),d(f(25,17,e.repair().received_at||e.repair().created_at,"dd/MM/yyyy")),r(2),p(e.repair().completed_at?26:-1),r(5),d(e.repair().issue_description),r(),p(e.repair().technician_notes&&(e.repair().status==="completed"||e.repair().status==="delivered")?32:-1),r(),p(e.repair().images&&e.repair().images.length>0?33:-1),r(6),m("$",e.repair().estimated_cost),r(5),m("-$",e.repair().deposit_amount),r(6),m("$",(e.repair().final_cost||e.repair().estimated_cost)-e.repair().deposit_amount),r(2),v("href","https://wa.me/"+e.whatsappNumber,b)}}var $=class a{route=u(N);auth=u(R);whatsappNumber=j.contact.whatsappNumber;code=null;repair=x(null);loading=x(!0);error=x(null);async ngOnInit(){this.code=this.route.snapshot.paramMap.get("code"),this.code?await this.loadRepair():(this.error.set("C\xF3digo de seguimiento no v\xE1lido."),this.loading.set(!1))}async loadRepair(){let o=this.auth.getSupabaseClient();try{let{data:e,error:l}=await o.rpc("get_repair_by_tracking",{code:this.code});l?(console.error("Error fetching repair:",l),this.error.set(`Error: ${l.message||JSON.stringify(l)}`)):e&&e.length>0?this.repair.set(e[0]):this.error.set("No se encontr\xF3 ninguna reparaci\xF3n con este c\xF3digo.")}catch(e){console.error("TrackingPage: Unexpected error:",e),this.error.set(`Error inesperado: ${e.message||e}`)}finally{this.loading.set(!1)}}getStatusLabel(o){return{pending:"Pendiente",in_progress:"En Progreso",completed:"Completado",delivered:"Entregado",cancelled:"Cancelado"}[o]||o}getStatusColor(o){return{pending:"badge-warning",in_progress:"badge-info",completed:"badge-success",delivered:"badge-success",cancelled:"badge-error"}[o]||"badge-ghost"}openImage(o){window.open(o,"_blank")}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=E({type:a,selectors:[["app-tracking-page"]],decls:11,vars:1,consts:[[1,"py-10","px-4"],[1,"max-w-md","mx-auto","bg-base-100","rounded-xl","shadow-xl","overflow-hidden","text-base-content"],[1,"bg-primary","p-6","text-center"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-primary-content","opacity-80","text-sm"],[1,"p-6"],[1,"flex","flex-col","items-center","justify-center","py-8"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"mt-4","text-base-content/70"],[1,"alert","alert-error"],[1,"fas","fa-exclamation-circle"],[1,"mt-6","text-center"],["routerLink","/",1,"btn","btn-outline","btn-sm"],[1,"flex","justify-center","mb-6"],[1,"space-y-4"],[1,"flex","justify-between","border-b","border-base-200","pb-2"],[1,"font-semibold","text-base-content/70"],[1,"font-bold","text-primary"],[1,"font-bold","text-base-content"],[1,"py-2"],[1,"block","font-semibold","text-base-content/70","mb-1"],[1,"text-sm","bg-base-200","p-3","rounded-lg","text-base-content"],[1,"bg-base-200","p-4","rounded-lg","mt-4"],[1,"flex","justify-between","mb-1"],[1,"text-sm","text-base-content/70"],[1,"flex","justify-between","mb-1","text-green-600","dark:text-green-400"],[1,"text-sm"],[1,"font-bold"],[1,"divider","my-1"],[1,"flex","justify-between","text-lg"],[1,"mt-8","text-center"],["target","_blank",1,"btn","btn-success","btn-wide","text-white",3,"href"],[1,"fab","fa-whatsapp","mr-2"],[1,"text-sm","bg-green-50","p-3","rounded-lg","border","border-green-100","text-green-800"],[1,"block","font-semibold","text-base-content/70","mb-2"],[1,"grid","grid-cols-2","gap-2"],[1,"aspect-square","bg-base-200","rounded-lg","overflow-hidden","border","border-base-300"],["alt","Estado del equipo",1,"w-full","h-full","object-cover","cursor-pointer","hover:opacity-90","transition-opacity",3,"click","src"]],template:function(e,l){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),n(4,"Estado de Reparaci\xF3n"),i(),t(5,"p",4),n(6,"Seguimiento en tiempo real"),i()(),t(7,"div",5),c(8,O,4,0,"div",6)(9,V,7,1)(10,G,55,20),i()()()),e&2&&(r(8),p(l.loading()?8:l.error()?9:l.repair()?10:-1))},dependencies:[F,D,M],encapsulation:2})};export{$ as TrackingPage};
