{
  "version": 3,
  "sources": ["src/app/core/services/theme.service.ts"],
  "sourcesContent": ["import { Injectable, inject, PLATFORM_ID, signal, computed, effect, OnDestroy } from '@angular/core';\r\nimport { isPlatformBrowser } from '@angular/common';\r\n\r\nexport type ThemeMode = 'light' | 'dark' | 'system';\r\n\r\nconst STORAGE_KEY = 'arecofix-theme-mode';\r\n\r\n/**\r\n * ThemeService\r\n *\r\n * Handles light/dark mode with three priorities:\r\n *   1. User's explicit manual choice (persisted in localStorage)\r\n *   2. OS-level `prefers-color-scheme` media query\r\n *   3. Fallback to dark mode\r\n *\r\n * Architecture:\r\n *   - `mode` signal holds the raw selection ('light' | 'dark' | 'system')\r\n *   - `resolvedTheme` computed resolves 'system' into the actual OS preference\r\n *   - An `effect` applies the `.dark` class on <html> and persists the choice\r\n *   - A MediaQueryList listener reacts to OS-level theme changes in real time\r\n */\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class ThemeService implements OnDestroy {\r\n  private platformId = inject(PLATFORM_ID);\r\n  private mediaQuery: MediaQueryList | null = null;\r\n  private mediaListener: ((e: MediaQueryListEvent) => void) | null = null;\r\n\r\n  /** Raw user preference: 'light' | 'dark' | 'system' */\r\n  readonly mode = signal<ThemeMode>(this.loadInitialMode());\r\n\r\n  /** Whether OS currently prefers dark */\r\n  readonly osDark = signal<boolean>(this.detectOsDark());\r\n\r\n  /** The resolved theme that should be applied */\r\n  readonly resolvedTheme = computed<'light' | 'dark'>(() => {\r\n    const m = this.mode();\r\n    if (m === 'system') return this.osDark() ? 'dark' : 'light';\r\n    return m;\r\n  });\r\n\r\n  /** Convenience boolean for templates */\r\n  readonly isDark = computed(() => this.resolvedTheme() === 'dark');\r\n\r\n  constructor() {\r\n    // Listen for OS-level theme changes\r\n    if (isPlatformBrowser(this.platformId)) {\r\n      this.mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n      this.mediaListener = (e: MediaQueryListEvent) => this.osDark.set(e.matches);\r\n      this.mediaQuery.addEventListener('change', this.mediaListener);\r\n    }\r\n\r\n    // React to resolved theme changes → apply DOM class + persist\r\n    effect(() => {\r\n      const theme = this.resolvedTheme();\r\n      const rawMode = this.mode();\r\n      this.applyTheme(theme);\r\n      this.persistMode(rawMode);\r\n    });\r\n  }\r\n\r\n  // ── Public API ──────────────────────────────────────\r\n\r\n  /** Set theme mode explicitly */\r\n  setMode(mode: ThemeMode): void {\r\n    this.mode.set(mode);\r\n  }\r\n\r\n  /** Toggle between light ↔ dark (skips system) */\r\n  toggle(): void {\r\n    this.mode.set(this.isDark() ? 'light' : 'dark');\r\n  }\r\n\r\n  /** Cycle through: system → light → dark → system */\r\n  cycle(): void {\r\n    const current = this.mode();\r\n    const next: ThemeMode = current === 'system' ? 'light' : current === 'light' ? 'dark' : 'system';\r\n    this.mode.set(next);\r\n  }\r\n\r\n  // ── Private Helpers ─────────────────────────────────\r\n\r\n  private loadInitialMode(): ThemeMode {\r\n    if (!isPlatformBrowser(this.platformId)) return 'dark';\r\n\r\n    const stored = localStorage.getItem(STORAGE_KEY) as ThemeMode | null;\r\n    if (stored && ['light', 'dark', 'system'].includes(stored)) return stored;\r\n\r\n    // No stored preference → use 'system' to respect OS setting\r\n    return 'system';\r\n  }\r\n\r\n  private detectOsDark(): boolean {\r\n    if (!isPlatformBrowser(this.platformId)) return true;\r\n    return window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n  }\r\n\r\n  private applyTheme(theme: 'light' | 'dark'): void {\r\n    if (!isPlatformBrowser(this.platformId)) return;\r\n\r\n    const html = document.documentElement;\r\n    if (theme === 'dark') {\r\n      html.classList.add('dark');\r\n      html.setAttribute('data-theme', 'dark');\r\n    } else {\r\n      html.classList.remove('dark');\r\n      html.setAttribute('data-theme', 'light');\r\n    }\r\n  }\r\n\r\n  private persistMode(mode: ThemeMode): void {\r\n    if (!isPlatformBrowser(this.platformId)) return;\r\n    localStorage.setItem(STORAGE_KEY, mode);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.mediaQuery && this.mediaListener) {\r\n      this.mediaQuery.removeEventListener('change', this.mediaListener);\r\n      this.mediaQuery = null;\r\n      this.mediaListener = null;\r\n    }\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;AAKA,IAAM,cAAc;AAmBd,IAAO,eAAP,MAAO,cAAY;EACf,aAAa,OAAO,WAAW;EAC/B,aAAoC;EACpC,gBAA2D;;EAG1D,OAAO,OAAkB,KAAK,gBAAe,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,OAAA,CAAA,IAAA,CAAA,CAAA;;EAG/C,SAAS,OAAgB,KAAK,aAAY,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;;EAG5C,gBAAgB,SAA2B,MAAK;AACvD,UAAM,IAAI,KAAK,KAAI;AACnB,QAAI,MAAM;AAAU,aAAO,KAAK,OAAM,IAAK,SAAS;AACpD,WAAO;EACT,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,gBAAA,CAAA,IAAA,CAAA,CAAA;;EAGQ,SAAS,SAAS,MAAM,KAAK,cAAa,MAAO,QAAM,GAAA,YAAA,CAAA,EAAA,WAAA,SAAA,CAAA,IAAA,CAAA,CAAA;EAEhE,cAAA;AAEE,QAAI,kBAAkB,KAAK,UAAU,GAAG;AACtC,WAAK,aAAa,OAAO,WAAW,8BAA8B;AAClE,WAAK,gBAAgB,CAAC,MAA2B,KAAK,OAAO,IAAI,EAAE,OAAO;AAC1E,WAAK,WAAW,iBAAiB,UAAU,KAAK,aAAa;IAC/D;AAGA,WAAO,MAAK;AACV,YAAM,QAAQ,KAAK,cAAa;AAChC,YAAM,UAAU,KAAK,KAAI;AACzB,WAAK,WAAW,KAAK;AACrB,WAAK,YAAY,OAAO;IAC1B,CAAC;EACH;;;EAKA,QAAQ,MAAe;AACrB,SAAK,KAAK,IAAI,IAAI;EACpB;;EAGA,SAAM;AACJ,SAAK,KAAK,IAAI,KAAK,OAAM,IAAK,UAAU,MAAM;EAChD;;EAGA,QAAK;AACH,UAAM,UAAU,KAAK,KAAI;AACzB,UAAM,OAAkB,YAAY,WAAW,UAAU,YAAY,UAAU,SAAS;AACxF,SAAK,KAAK,IAAI,IAAI;EACpB;;EAIQ,kBAAe;AACrB,QAAI,CAAC,kBAAkB,KAAK,UAAU;AAAG,aAAO;AAEhD,UAAM,SAAS,aAAa,QAAQ,WAAW;AAC/C,QAAI,UAAU,CAAC,SAAS,QAAQ,QAAQ,EAAE,SAAS,MAAM;AAAG,aAAO;AAGnE,WAAO;EACT;EAEQ,eAAY;AAClB,QAAI,CAAC,kBAAkB,KAAK,UAAU;AAAG,aAAO;AAChD,WAAO,OAAO,WAAW,8BAA8B,EAAE;EAC3D;EAEQ,WAAW,OAAuB;AACxC,QAAI,CAAC,kBAAkB,KAAK,UAAU;AAAG;AAEzC,UAAM,OAAO,SAAS;AACtB,QAAI,UAAU,QAAQ;AACpB,WAAK,UAAU,IAAI,MAAM;AACzB,WAAK,aAAa,cAAc,MAAM;IACxC,OAAO;AACL,WAAK,UAAU,OAAO,MAAM;AAC5B,WAAK,aAAa,cAAc,OAAO;IACzC;EACF;EAEQ,YAAY,MAAe;AACjC,QAAI,CAAC,kBAAkB,KAAK,UAAU;AAAG;AACzC,iBAAa,QAAQ,aAAa,IAAI;EACxC;EAEA,cAAW;AACT,QAAI,KAAK,cAAc,KAAK,eAAe;AACzC,WAAK,WAAW,oBAAoB,UAAU,KAAK,aAAa;AAChE,WAAK,aAAa;AAClB,WAAK,gBAAgB;IACvB;EACF;;qCAlGW,eAAY;EAAA;4EAAZ,eAAY,SAAZ,cAAY,WAAA,YAFX,OAAM,CAAA;;;sEAEP,cAAY,CAAA;UAHxB;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
