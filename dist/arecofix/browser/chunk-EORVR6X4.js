import{f as l,h as M}from"./chunk-DI2RWA4C.js";import{a as D}from"./chunk-4FNFMYN4.js";import{d as q,k as u}from"./chunk-4WX2KV2B.js";import"./chunk-QBWIJBVM.js";import"./chunk-BCXBSHNT.js";import{o as j}from"./chunk-YHPCNF66.js";import{$ as E,Ca as T,Db as $,Fa as c,Fb as s,Gb as v,Hb as k,Pb as F,R as S,Ta as C,Tb as L,W as d,aa as N,eb as _,fb as x,ib as P,jb as B,kb as y,lb as n,ma as w,mb as o,nb as m,rb as A,vb as I,xb as g}from"./chunk-YBYZLFPG.js";import"./chunk-VOSPIT4N.js";var h=class{constructor(t,e){this.supabase=t;this.logger=e}async findAll(t){try{let e=this.supabase.from(this.tableName).select("*");t&&(e=e.order(t.column,{ascending:t.ascending??!0}));let{data:r,error:i}=await e;if(i)throw new l(i.message,i);return r||[]}catch(e){throw this.logger.error(`Error fetching all ${this.tableName}`,e),e}}async findById(t){try{let{data:e,error:r}=await this.supabase.from(this.tableName).select("*").eq("id",t).single();if(r){if(r.code==="PGRST116")return null;throw new l(r.message,r)}return e}catch(e){throw this.logger.error(`Error fetching ${this.tableName} by ID`,e),e}}async create(t){try{let{data:e,error:r}=await this.supabase.from(this.tableName).insert(t).select().single();if(r)throw new l(r.message,r);return e}catch(e){throw this.logger.error(`Error creating ${this.tableName}`,e),e}}async update(t,e){try{let{data:r,error:i}=await this.supabase.from(this.tableName).update(e).eq("id",t).select().single();if(i)throw new l(i.message,i);return r}catch(r){throw this.logger.error(`Error updating ${this.tableName}`,r),r}}async delete(t){try{let{error:e}=await this.supabase.from(this.tableName).delete().eq("id",t);if(e)throw new l(e.message,e)}catch(e){throw this.logger.error(`Error deleting ${this.tableName}`,e),e}}async toggleStatus(t,e){try{let{data:r,error:i}=await this.supabase.from(this.tableName).update({is_active:!e}).eq("id",t).select().single();if(i)throw new l(i.message,i);return r}catch(r){throw this.logger.error(`Error toggling ${this.tableName} status`,r),r}}async findWhere(t,e,r){try{let i=this.supabase.from(this.tableName).select("*").eq(t,e);r&&(i=i.order(r.column,{ascending:r.ascending??!0}));let{data:p,error:b}=await i;if(b)throw new l(b.message,b);return p||[]}catch(i){throw this.logger.error(`Error fetching ${this.tableName} with filter`,i),i}}async count(){try{let{count:t,error:e}=await this.supabase.from(this.tableName).select("*",{count:"exact",head:!0});if(e)throw new l(e.message,e);return t||0}catch(t){throw this.logger.error(`Error counting ${this.tableName}`,t),t}}};var f=class a extends h{tableName="brands";constructor(){let t=d(D),e=d(u);super(t.getSupabaseClient(),e)}static \u0275fac=function(e){return new(e||a)};static \u0275prov=S({token:a,factory:a.\u0275fac,providedIn:"root"})};var O=a=>["/admin/brands",a],V=(a,t)=>t.id;function G(a,t){a&1&&(n(0,"tr")(1,"td",8),s(2,"Cargando..."),o()())}function U(a,t){a&1&&(n(0,"tr")(1,"td",8),s(2,"No hay marcas registradas."),o()())}function W(a,t){if(a&1&&m(0,"img",9),a&2){let e=g().$implicit;y("alt",F(e.name))("src",e.logo_url,T)}}function H(a,t){a&1&&(n(0,"div",10),m(1,"i",16),o())}function J(a,t){if(a&1){let e=A();n(0,"tr")(1,"td"),_(2,W,1,3,"img",9)(3,H,2,0,"div",10),o(),n(4,"td")(5,"div",11),s(6),o(),n(7,"div",12),s(8),o()(),n(9,"td")(10,"button",13),I("click",function(){let i=E(e).$implicit,p=g(2);return N(p.toggleStatus(i))}),s(11),o()(),n(12,"td")(13,"a",14),m(14,"i",15),o()()()}if(a&2){let e=t.$implicit;c(2),x(e.logo_url?2:3),c(4),v(e.name),c(2),v(e.slug),c(2),$("badge-success",e.is_active)("badge-error",!e.is_active),c(),k(" ",e.is_active?"Activo":"Inactivo"," "),c(2),y("routerLink",L(9,O,e.id))}}function K(a,t){if(a&1&&P(0,J,15,11,"tr",null,V),a&2){let e=g();B(e.brands())}}var R=class a{brandRepo=d(f);logger=d(u);notification=d(M);brands=w([],{});loading=w(!0,{});async ngOnInit(){await this.loadBrands()}async loadBrands(){this.loading.set(!0);try{let t=await this.brandRepo.findAll({column:"name",ascending:!0});this.brands.set(t)}catch(t){this.logger.error("Failed to load brands",t),this.notification.showError("Error al cargar las marcas")}finally{this.loading.set(!1)}}async toggleStatus(t){try{await this.brandRepo.toggleStatus(t.id,t.is_active),await this.loadBrands(),this.notification.showSuccess("Estado actualizado correctamente")}catch(e){this.logger.error("Failed to toggle brand status",e),this.notification.showError("Error al actualizar el estado")}}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=C({type:a,selectors:[["app-admin-brands-page"]],decls:23,vars:1,consts:[[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-800"],["routerLink","/admin/brands/new",1,"btn","btn-primary"],[1,"fas","fa-plus","mr-2"],[1,"bg-white","rounded-lg","shadow","overflow-hidden","text-gray-800"],[1,"overflow-x-auto"],[1,"table","w-full"],[1,"text-gray-800"],["colspan","4",1,"text-center","py-4"],[1,"w-10","h-10","object-contain",3,"src","alt"],[1,"w-10","h-10","bg-gray-100","rounded","flex","items-center","justify-center","text-gray-400"],[1,"font-bold"],[1,"text-sm","opacity-50"],[1,"badge",3,"click"],[1,"btn","btn-sm","btn-ghost",3,"routerLink"],[1,"fas","fa-edit"],[1,"fas","fa-image"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"h1",1),s(2,"Marcas"),o(),n(3,"a",2),m(4,"i",3),s(5," Nueva Marca "),o()(),n(6,"div",4)(7,"div",5)(8,"table",6)(9,"thead")(10,"tr",7)(11,"th"),s(12,"Logo"),o(),n(13,"th"),s(14,"Nombre"),o(),n(15,"th"),s(16,"Estado"),o(),n(17,"th"),s(18,"Acciones"),o()()(),n(19,"tbody"),_(20,G,3,0,"tr")(21,U,3,0,"tr")(22,K,2,0),o()()()()),e&2&&(c(20),x(r.loading()?20:r.brands().length===0?21:22))},dependencies:[j,q],encapsulation:2})};export{R as AdminBrandsPage};
