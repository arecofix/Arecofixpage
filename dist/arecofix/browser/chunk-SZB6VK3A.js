import{b as N,d as T,e as D,f as L,g as B,h as I,i as O,l as j,m as q,n as k,o as G,p as z,r as H}from"./chunk-TXZ4IKMM.js";import{a as R}from"./chunk-FDEIW4RV.js";import"./chunk-KXBHGC7O.js";import{b as F,d as W,e as A}from"./chunk-SJUHAIWY.js";import"./chunk-2IHNZNBZ.js";import{o as V}from"./chunk-NGBKTTVY.js";import{$ as c,Fa as l,Fb as a,Gb as E,Hb as P,Jb as g,Kb as u,Lb as _,Ta as b,W as h,aa as p,eb as C,fb as w,kb as y,lb as t,ma as f,mb as n,nb as x,rb as S,vb as M,xb as s}from"./chunk-CVZCBU36.js";import{a as v}from"./chunk-VOSPIT4N.js";function K(d,m){d&1&&(t(0,"div",6),x(1,"span",7),n())}function Q(d,m){if(d&1&&(t(0,"div",31),x(1,"i",35),t(2,"span"),a(3),n()()),d&2){let e=s(2);l(3),E(e.error())}}function U(d,m){d&1&&x(0,"span",34)}function X(d,m){if(d&1){let e=S();t(0,"form",8),M("ngSubmit",function(){c(e);let i=s();return p(i.save())}),t(1,"div",9)(2,"div",10)(3,"label",11)(4,"span",12),a(5,"Nombre del Cliente"),n()(),t(6,"input",13),_("ngModelChange",function(i){c(e);let o=s();return u(o.form().customer_name,i)||(o.form().customer_name=i),p(i)}),n()(),t(7,"div",10)(8,"label",11)(9,"span",12),a(10,"Tel\xE9fono"),n()(),t(11,"input",14),_("ngModelChange",function(i){c(e);let o=s();return u(o.form().customer_phone,i)||(o.form().customer_phone=i),p(i)}),n()()(),t(12,"div",15)(13,"label",11)(14,"span",12),a(15,"Modelo del Dispositivo"),n()(),t(16,"input",16),_("ngModelChange",function(i){c(e);let o=s();return u(o.form().device_model,i)||(o.form().device_model=i),p(i)}),n()(),t(17,"div",15)(18,"label",11)(19,"span",12),a(20,"Descripci\xF3n del Problema"),n()(),t(21,"textarea",17),_("ngModelChange",function(i){c(e);let o=s();return u(o.form().issue_description,i)||(o.form().issue_description=i),p(i)}),n()(),t(22,"div",18),a(23,"Estado y Costos"),n(),t(24,"div",19)(25,"div",10)(26,"label",11)(27,"span",12),a(28,"Estado"),n()(),t(29,"select",20),_("ngModelChange",function(i){c(e);let o=s();return u(o.form().status,i)||(o.form().status=i),p(i)}),t(30,"option",21),a(31,"Pendiente"),n(),t(32,"option",22),a(33,"En Progreso"),n(),t(34,"option",23),a(35,"Completado"),n(),t(36,"option",24),a(37,"Entregado"),n(),t(38,"option",25),a(39,"Cancelado"),n()()(),t(40,"div",10)(41,"label",11)(42,"span",12),a(43,"Costo Estimado"),n()(),t(44,"label",26)(45,"span"),a(46,"$"),n(),t(47,"input",27),_("ngModelChange",function(i){c(e);let o=s();return u(o.form().estimated_cost,i)||(o.form().estimated_cost=i),p(i)}),n()()(),t(48,"div",10)(49,"label",11)(50,"span",12),a(51,"Costo Final"),n()(),t(52,"label",26)(53,"span"),a(54,"$"),n(),t(55,"input",28),_("ngModelChange",function(i){c(e);let o=s();return u(o.form().final_cost,i)||(o.form().final_cost=i),p(i)}),n()()()(),t(56,"div",29)(57,"label",11)(58,"span",12),a(59,"Notas del T\xE9cnico (Interno)"),n()(),t(60,"textarea",30),_("ngModelChange",function(i){c(e);let o=s();return u(o.form().technician_notes,i)||(o.form().technician_notes=i),p(i)}),n()(),C(61,Q,4,1,"div",31),t(62,"div",32)(63,"a",3),a(64,"Cancelar"),n(),t(65,"button",33),C(66,U,1,0,"span",34),a(67," Guardar Reparaci\xF3n "),n()()()}if(d&2){let e=s();l(6),g("ngModel",e.form().customer_name),l(5),g("ngModel",e.form().customer_phone),l(5),g("ngModel",e.form().device_model),l(5),g("ngModel",e.form().issue_description),l(8),g("ngModel",e.form().status),l(18),g("ngModel",e.form().estimated_cost),l(8),g("ngModel",e.form().final_cost),l(5),g("ngModel",e.form().technician_notes),l(),w(e.error()?61:-1),l(4),y("disabled",e.saving()||!e.form().customer_name||!e.form().device_model),l(),w(e.saving()?66:-1)}}var J=class d{route=h(F);router=h(W);auth=h(R);id=null;form=f({customer_name:"",customer_phone:"",device_model:"",issue_description:"",status:"pending",estimated_cost:0,final_cost:0,technician_notes:""});loading=f(!0);saving=f(!1);error=f(null);async ngOnInit(){if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let m=this.auth.getSupabaseClient(),{data:e,error:r}=await m.from("repairs").select("*").eq("id",this.id).single();e&&this.form.set({customer_name:e.customer_name,customer_phone:e.customer_phone||"",device_model:e.device_model,issue_description:e.issue_description||"",status:e.status,estimated_cost:e.estimated_cost||0,final_cost:e.final_cost||0,technician_notes:e.technician_notes||""})}this.loading.set(!1)}async save(){this.saving.set(!0),this.error.set(null);let m=this.auth.getSupabaseClient(),e=v({},this.form());["completed","delivered"].includes(e.status)&&(e.completed_at=new Date().toISOString());try{if(this.id){let{error:r}=await m.from("repairs").update(e).eq("id",this.id);if(r)throw r}else{let{error:r}=await m.from("repairs").insert(e);if(r)throw r}this.router.navigate(["/admin/repairs"])}catch(r){this.error.set(r.message)}finally{this.saving.set(!1)}}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=b({type:d,selectors:[["app-admin-repair-form-page"]],decls:10,vars:2,consts:[[1,"max-w-3xl","mx-auto"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-800"],["routerLink","/admin/repairs",1,"btn","btn-ghost"],[1,"fas","fa-arrow-left","mr-2"],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"flex","justify-center","py-8"],[1,"loading","loading-spinner","loading-lg"],[3,"ngSubmit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","mb-6"],[1,"form-control"],[1,"label"],[1,"label-text","font-medium"],["type","text","name","customer_name","required","",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],["type","tel","name","customer_phone",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],[1,"form-control","mb-4"],["type","text","name","device_model","required","","placeholder","Ej: iPhone 11, Samsung A52, Laptop HP...",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],["name","issue_description","placeholder","Describe la falla reportada por el cliente...",1,"textarea","textarea-bordered","h-24",3,"ngModelChange","ngModel"],[1,"divider"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],["name","status",1,"select","select-bordered","w-full",3,"ngModelChange","ngModel"],["value","pending"],["value","in_progress"],["value","completed"],["value","delivered"],["value","cancelled"],[1,"input-group"],["type","number","name","estimated_cost","min","0",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],["type","number","name","final_cost","min","0",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],[1,"form-control","mb-6"],["name","technician_notes","placeholder","Detalles de la reparaci\xF3n realizada...",1,"textarea","textarea-bordered","h-24",3,"ngModelChange","ngModel"],[1,"alert","alert-error","mb-6"],[1,"flex","justify-end","gap-4"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"loading","loading-spinner","loading-xs"],[1,"fas","fa-exclamation-circle"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"h1",2),a(3),n(),t(4,"a",3),x(5,"i",4),a(6," Volver "),n()(),t(7,"div",5),C(8,K,2,0,"div",6)(9,X,68,11,"form"),n()()),e&2&&(l(3),P("",r.id?"Editar":"Nueva"," Reparaci\xF3n"),l(5),w(r.loading()?8:9))},dependencies:[V,H,I,q,k,N,O,j,T,D,z,G,B,L,A],encapsulation:2})};export{J as AdminRepairFormPage};
