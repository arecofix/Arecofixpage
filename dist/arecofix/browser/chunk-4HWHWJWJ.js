import{k as d,l}from"./chunk-ECZXGVFH.js";import{R as c,W as o}from"./chunk-DX2LKEMG.js";import{a as s,b as n}from"./chunk-C6Q5SG76.js";var p=class r{auth=o(l);tenantService=o(d);supabase=this.auth.getSupabaseClient();async getPosts(){let{data:t,error:e}=await this.supabase.from("blog_posts").select("*").eq("tenant_id",this.tenantService.getTenantId()).order("created_at",{ascending:!1});if(e)throw e;return(t||[]).map(a=>this.mapToEntity(a))}async getPost(t){let{data:e,error:a}=await this.supabase.from("blog_posts").select("*").eq("id",t).eq("tenant_id",this.tenantService.getTenantId()).single();if(a)throw a;return this.mapToEntity(e)}mapToEntity(t){return n(s({},t),{image:t.featured_image||t.image||t.image_url})}async createPost(t){let e=s({},t);e.image&&(e.featured_image=e.image,delete e.image),delete e.meta_title,delete e.meta_description,delete e.published,e.tenant_id=this.tenantService.getTenantId();let{error:a}=await this.supabase.from("blog_posts").insert(e);if(a)throw a}async updatePost(t,e){let a=s({},e);a.image&&(a.featured_image=a.image,delete a.image),delete a.meta_title,delete a.meta_description,delete a.published;let{error:i}=await this.supabase.from("blog_posts").update(a).eq("id",t).eq("tenant_id",this.tenantService.getTenantId());if(i)throw i}async deletePost(t){let{error:e}=await this.supabase.from("blog_posts").delete().eq("id",t).eq("tenant_id",this.tenantService.getTenantId());if(e)throw e}async uploadImage(t){let e=`posts/${Date.now()}-${t.name}`,{data:a,error:i}=await this.supabase.storage.from("public-assets").upload(e,t);if(i)throw i;let{data:m}=this.supabase.storage.from("public-assets").getPublicUrl(a.path);return m.publicUrl}slugify(t){return t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-")}static \u0275fac=function(e){return new(e||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};export{p as a};
