import{a as re}from"./chunk-MMX2KHFQ.js";import{a as ne}from"./chunk-A7HSRCHR.js";import"./chunk-BGHZUC77.js";import"./chunk-6WWONRBM.js";import{b as K,d as U,g as X,m as Y,n as Z,o as ee,t as te}from"./chunk-63CMMPDH.js";import{a as ie}from"./chunk-6MFU4D2Y.js";import"./chunk-YTQUIG7T.js";import"./chunk-QBOH7QZY.js";import{o as J}from"./chunk-YNFFGNY6.js";import{j as H,m as W,o as z,q as G}from"./chunk-Q44XB7TV.js";import{$ as M,Ab as t,Bb as i,Cb as s,Ec as q,Gb as A,Kb as v,Mb as g,Tb as R,Ua as a,Vb as d,W as C,Wb as p,Xb as u,aa as T,gb as $,hc as y,jb as E,lc as x,ma as f,mc as h,nc as I,p as V,pc as Q,tb as _,ub as b,uc as S,xb as P,yb as k,zb as c}from"./chunk-DX2LKEMG.js";import{a as j,b as B}from"./chunk-C6Q5SG76.js";var O=class r{transform(n){return n?{pending:"A Pagar",processing:"Abonado",completed:"Completado",cancelled:"Cancelado"}[n]||n:""}static \u0275fac=function(e){return new(e||r)};static \u0275pipe=E({name:"orderStatus",type:r,pure:!0})};var w=class r{transform(n){return n&&{pending:"badge-error",processing:"badge-success",completed:"badge-success",cancelled:"badge-error",deleted:"badge-ghost"}[n]||"badge-ghost"}static \u0275fac=function(e){return new(e||r)};static \u0275pipe=E({name:"statusColor",type:r,pure:!0})};var oe=r=>["/admin/orders",r],le=r=>["/admin/orders",r,"edit"],D=(r,n)=>n.id;function se(r,n){r&1&&(t(0,"div",40),s(1,"span",42),i())}function ce(r,n){if(r&1&&(t(0,"div",41),s(1,"i",43),t(2,"span"),d(3),i()()),r&2){let e=g();a(3),p(e.error())}}function me(r,n){if(r&1&&(t(0,"span",67),d(1),i()),r&2){let e=g(2).$implicit;a(),u("+",e.items.length-1," m\xE1s")}}function pe(r,n){if(r&1&&(t(0,"span",66),d(1),i(),d(2),_(3,me,2,1,"span",67)),r&2){let e=g().$implicit;a(),u("",e.items[0].quantity,"x"),a(),u(" ",e.items[0].product_name," "),a(),b(e.items.length>1?3:-1)}}function ge(r,n){r&1&&(t(0,"span",58),d(1,"Sin items"),i())}function ue(r,n){if(r&1){let e=A();t(0,"button",68),v("click",function(){M(e);let m=g().$implicit,l=g(2);return T(l.toggleOrderStatus(m))}),s(1,"i",69),i()}}function xe(r,n){if(r&1&&(t(0,"tr",49)(1,"td",54),d(2),i(),t(3,"td")(4,"div",55),d(5),i(),t(6,"div",56),d(7),i()(),t(8,"td")(9,"div",57),_(10,pe,4,3)(11,ge,2,0,"span",58),i()(),t(12,"td",55),d(13),x(14,"currency"),i(),t(15,"td")(16,"span",59),x(17,"statusColor"),d(18),x(19,"orderStatus"),i()(),t(20,"td",56),d(21),x(22,"date"),i(),t(23,"td",48)(24,"div",60),_(25,ue,2,0,"button",61),t(26,"a",62),s(27,"i",63),i(),t(28,"a",64),s(29,"i",65),i()()()()),r&2){let e=n.$implicit;a(2),p(e.order_number),a(3),p(e.customer_name),a(2),p(e.customer_email),a(3),b(e.items&&e.items.length>0?10:11),a(3),u(" ",h(14,11,e.total)," "),a(3),c("ngClass",h(17,13,e.status)),a(2),u(" ",h(19,15,e.status)," "),a(3),u(" ",I(22,17,e.created_at,"dd MMM yyyy, HH:mm")," "),a(4),b(e.status==="pending"?25:-1),a(),c("routerLink",y(20,oe,e.id)),a(2),c("routerLink",y(22,le,e.id))}}function fe(r,n){if(r&1&&(t(0,"li",78)(1,"span",85)(2,"span",66),d(3),i(),d(4),i()()),r&2){let e=n.$implicit;a(3),u("",e.quantity,"x"),a(),u(" ",e.product_name)}}function _e(r,n){if(r&1&&(t(0,"li",79),d(1),i()),r&2){let e=g().$implicit;a(),u("+",e.items.length-2," productos m\xE1s...")}}function be(r,n){if(r&1){let e=A();t(0,"button",86),v("click",function(){M(e);let m=g().$implicit,l=g(2);return T(l.toggleOrderStatus(m))}),s(1,"i",69),i()}}function ve(r,n){if(r&1&&(t(0,"div",51)(1,"div",70)(2,"div",71)(3,"div",72)(4,"span",73),d(5),i(),t(6,"span",74),d(7),x(8,"date"),i()(),t(9,"div",75),x(10,"statusColor"),d(11),x(12,"orderStatus"),i()(),t(13,"h3",55),d(14),i(),t(15,"div",76)(16,"ul",77),P(17,fe,5,2,"li",78,D),_(19,_e,2,1,"li",79),i()(),t(20,"div",80)(21,"span",81),d(22),x(23,"currency"),i(),t(24,"div",60),_(25,be,2,0,"button",82),t(26,"a",83),s(27,"i",63),i(),t(28,"a",84),s(29,"i",65),i()()()()()),r&2){let e=n.$implicit;a(5),p(e.order_number),a(2),p(I(8,10,e.created_at,"short")),a(2),c("ngClass",h(10,13,e.status)),a(2),u(" ",h(12,15,e.status)," "),a(3),p(e.customer_name),a(3),k(e.items.slice(0,2)),a(2),b(e.items&&e.items.length>2?19:-1),a(3),p(h(23,17,e.total)),a(3),b(e.status==="pending"?25:-1),a(),c("routerLink",y(19,oe,e.id)),a(2),c("routerLink",y(21,le,e.id))}}function he(r,n){if(r&1&&(t(0,"div",52),s(1,"pagination",87),i()),r&2){let e=g(2);a(),c("pages",e.totalPages())("currentPage",e.currentPage())}}function ye(r,n){r&1&&(t(0,"div",53),s(1,"i",88),t(2,"p"),d(3,"No se encontraron pedidos."),i()())}function Se(r,n){if(r&1&&(t(0,"div",44)(1,"table",45)(2,"thead",46)(3,"tr",47)(4,"th"),d(5,"Pedido"),i(),t(6,"th"),d(7,"Cliente"),i(),t(8,"th"),d(9,"Productos"),i(),t(10,"th"),d(11,"Total"),i(),t(12,"th"),d(13,"Estado"),i(),t(14,"th"),d(15,"Fecha"),i(),t(16,"th",48),d(17,"Acciones"),i()()(),t(18,"tbody"),P(19,xe,30,24,"tr",49,D),i()()(),t(21,"div",50),P(22,ve,30,23,"div",51,D),i(),_(24,he,2,2,"div",52),_(25,ye,4,0,"div",53)),r&2){let e=g();a(19),k(e.paginatedOrders()),a(3),k(e.paginatedOrders()),a(2),b(e.filteredOrders().length>0?24:-1),a(),b(e.filteredOrders().length===0?25:-1)}}var de=class r{orderService=C(re);logger=C(ie);cdr=C(q);orders=f([]);loading=f(!0);error=f(null);searchQuery=f("");filterStatus=f("all");sortOrder=f("date_desc");currentPage=f(1);itemsPerPage=f(10);filteredOrders=S(()=>{let n=this.orders(),e=this.searchQuery().toLowerCase(),o=this.filterStatus();o!=="all"&&(n=n.filter(l=>l.status===o)),e&&(n=n.filter(l=>l.order_number?.toLowerCase().includes(e)||l.customer_name?.toLowerCase().includes(e)||l.customer_email?.toLowerCase().includes(e)));let m=this.sortOrder();return n.sort((l,F)=>{let N=new Date(l.created_at||0).getTime(),L=new Date(F.created_at||0).getTime();switch(m){case"date_asc":return N-L;case"date_desc":return L-N;case"total_desc":return(F.total||0)-(l.total||0);default:return 0}})});paginatedOrders=S(()=>{let n=this.filteredOrders(),e=(this.currentPage()-1)*this.itemsPerPage();return n.slice(e,e+this.itemsPerPage())});totalPages=S(()=>Math.ceil(this.filteredOrders().length/this.itemsPerPage()));stats=S(()=>{let n=this.orders();return{total:n.length,pending:n.filter(e=>e.status==="pending").length,completed:n.filter(e=>e.status==="completed").length,revenue:n.filter(e=>e.status!=="cancelled").reduce((e,o)=>e+(o.total||0),0)}});async ngOnInit(){this.loadOrders()}async loadOrders(){this.loading.set(!0);try{let n=await V(this.orderService.getOrders());this.orders.set(n)}catch(n){this.error.set(n.message||"Error al cargar pedidos")}finally{this.loading.set(!1),this.cdr.detectChanges()}}async toggleOrderStatus(n){if(n.status!=="pending"&&n.status!=="paid")return;let e=n.status==="pending"?"paid":"pending";try{let{error:o}=await this.orderService.updateOrderStatus(n.id,e);if(o)throw o;this.orders.update(m=>m.map(l=>l.id===n.id?B(j({},l),{status:e}):l))}catch(o){this.logger.error("Error updating status:",o),alert("Error al actualizar el estado del pedido")}}updateSort(n){let e=n.target.value;this.sortOrder.set(e)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=$({type:r,selectors:[["app-admin-orders-page"]],decls:66,vars:18,consts:[[1,"max-w-7xl","mx-auto","pb-20","p-4"],[1,"flex","flex-col","md:flex-row","justify-between","items-start","md:items-center","py-6","gap-4","border-b","border-gray-200","dark:border-gray-800","mb-6"],[1,"text-3xl","font-bold","text-gray-800","dark:text-white","flex","items-center","gap-3"],[1,"fas","fa-shopping-bag","text-green-500"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["routerLink","/admin/orders/new",1,"btn","btn-primary","shadow-lg","shadow-green-500/20"],[1,"fas","fa-plus","mr-2"],[1,"grid","grid-cols-2","lg:grid-cols-4","gap-4","mb-8"],[1,"stats","shadow","bg-white","dark:bg-gray-800","border","border-gray-100","dark:border-gray-700"],[1,"stat"],[1,"stat-figure","text-primary"],[1,"fas","fa-list-alt","text-3xl","opacity-50"],[1,"stat-title","text-xs","uppercase","tracking-wider"],[1,"stat-value","text-primary"],[1,"stat-figure","text-warning"],[1,"fas","fa-clock","text-3xl","opacity-50"],[1,"stat-title","text-xs","uppercase","tracking-wider","text-warning"],[1,"stat-value","text-warning"],[1,"stat-figure","text-success"],[1,"fas","fa-check-circle","text-3xl","opacity-50"],[1,"stat-title","text-xs","uppercase","tracking-wider","text-success"],[1,"stat-value","text-success"],[1,"stat-figure","text-info"],[1,"fas","fa-dollar-sign","text-3xl","opacity-50"],[1,"stat-value","text-info","text-2xl","overflow-hidden","text-ellipsis"],[1,"flex","flex-col","lg:flex-row","gap-4","mb-6","bg-white","dark:bg-gray-800","p-4","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700"],[1,"flex-1"],[1,"relative"],[1,"fas","fa-search","absolute","left-4","top-1/2","-translate-y-1/2","text-gray-400"],["type","text","placeholder","Buscar cliente, n\xFAmero de pedido...",1,"input","input-bordered","w-full","pl-10",3,"ngModelChange","ngModel"],[1,"overflow-x-auto","pb-2","lg:pb-0"],[1,"join"],["type","radio","name","status","aria-label","Todos",1,"join-item","btn",3,"click","checked"],["type","radio","name","status","aria-label","Pendientes",1,"join-item","btn",3,"click","checked"],["type","radio","name","status","aria-label","Pagado",1,"join-item","btn",3,"click","checked"],["type","radio","name","status","aria-label","Completados",1,"join-item","btn",3,"click","checked"],[1,"select","select-bordered","w-full","lg:w-auto",3,"change","ngModel"],["value","date_desc"],["value","date_asc"],["value","total_desc"],[1,"flex","justify-center","p-12"],[1,"alert","alert-error"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"fas","fa-exclamation-triangle"],[1,"hidden","md:block","bg-white","dark:bg-gray-800","rounded-xl","shadow-lg","overflow-hidden","border","border-gray-100","dark:border-gray-700"],[1,"table","w-full"],[1,"bg-gray-50","dark:bg-gray-700/50"],[1,"text-gray-600","dark:text-gray-300","font-bold","uppercase","text-xs","tracking-wider"],[1,"text-right"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/30","transition-colors"],[1,"md:hidden","grid","grid-cols-1","gap-4"],[1,"card","bg-white","dark:bg-gray-800","shadow-sm","border","border-gray-100","dark:border-gray-700"],[1,"mt-8","flex","justify-center","pb-8"],[1,"text-center","py-20","opacity-50"],[1,"font-mono","font-bold","text-primary"],[1,"font-bold","text-gray-900","dark:text-white"],[1,"text-xs","text-gray-500"],[1,"text-sm","max-w-xs","truncate"],[1,"italic","text-gray-400"],[1,"badge","badge-sm","font-semibold","border-0",3,"ngClass"],[1,"flex","justify-end","gap-2"],["data-tip","Marcar Pagado",1,"btn","btn-sm","btn-ghost","text-green-500","tooltip"],["data-tip","Ver Detalle",1,"btn","btn-sm","btn-ghost","text-gray-500","tooltip",3,"routerLink"],[1,"fas","fa-eye"],["data-tip","Editar",1,"btn","btn-sm","btn-ghost","text-indigo-500","tooltip",3,"routerLink"],[1,"fas","fa-pen"],[1,"font-bold"],[1,"badge","badge-xs","badge-ghost"],["data-tip","Marcar Pagado",1,"btn","btn-sm","btn-ghost","text-green-500","tooltip",3,"click"],[1,"fas","fa-check-dollar"],[1,"card-body","p-4"],[1,"flex","justify-between","items-start","mb-2"],[1,"flex","flex-col"],[1,"font-mono","text-xs","font-bold","text-primary"],[1,"text-xs","text-gray-400"],[1,"badge","badge-sm","border-0","font-bold",3,"ngClass"],[1,"py-2","border-y","border-dashed","border-gray-200","dark:border-gray-700","my-2"],[1,"text-sm","space-y-1"],[1,"flex","justify-between"],[1,"text-xs","text-gray-400","italic"],[1,"flex","justify-between","items-center","mt-2"],[1,"text-xl","font-bold","text-gray-900","dark:text-white"],["data-tip","Marcar Pagado",1,"btn","btn-sm","btn-ghost","text-green-500","tooltip","tooltip-left"],["data-tip","Ver Detalle",1,"btn","btn-sm","btn-ghost","text-gray-500","tooltip","tooltip-top",3,"routerLink"],["data-tip","Editar",1,"btn","btn-sm","btn-ghost","text-indigo-500","tooltip","tooltip-left",3,"routerLink"],[1,"truncate","pr-2"],["data-tip","Marcar Pagado",1,"btn","btn-sm","btn-ghost","text-green-500","tooltip","tooltip-left",3,"click"],[3,"pages","currentPage"],[1,"fas","fa-shopping-bag","text-4xl","mb-3"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),s(4,"i",3),d(5," Pedidos "),i(),t(6,"p",4),d(7,"Gestiona las \xF3rdenes de compra de tus clientes."),i()(),t(8,"a",5),s(9,"i",6),d(10," Nuevo Pedido "),i()(),t(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),s(15,"i",11),i(),t(16,"div",12),d(17,"Total Pedidos"),i(),t(18,"div",13),d(19),i()()(),t(20,"div",8)(21,"div",9)(22,"div",14),s(23,"i",15),i(),t(24,"div",16),d(25,"Pendientes"),i(),t(26,"div",17),d(27),i()()(),t(28,"div",8)(29,"div",9)(30,"div",18),s(31,"i",19),i(),t(32,"div",20),d(33,"Completados"),i(),t(34,"div",21),d(35),i()()(),t(36,"div",8)(37,"div",9)(38,"div",22),s(39,"i",23),i(),t(40,"div",12),d(41,"Ingresos Totales"),i(),t(42,"div",24),d(43),x(44,"currency"),i()()()(),t(45,"div",25)(46,"div",26)(47,"div",27),s(48,"i",28),t(49,"input",29),v("ngModelChange",function(l){return o.searchQuery.set(l)}),i()()(),t(50,"div",30)(51,"div",31)(52,"input",32),v("click",function(){return o.filterStatus.set("all")}),i(),t(53,"input",33),v("click",function(){return o.filterStatus.set("pending")}),i(),t(54,"input",34),v("click",function(){return o.filterStatus.set("paid")}),i(),t(55,"input",35),v("click",function(){return o.filterStatus.set("completed")}),i()()(),t(56,"select",36),v("change",function(l){return o.updateSort(l)}),t(57,"option",37),d(58,"M\xE1s Recientes"),i(),t(59,"option",38),d(60,"M\xE1s Antiguos"),i(),t(61,"option",39),d(62,"Mayor Monto"),i()()(),_(63,se,2,0,"div",40)(64,ce,4,1,"div",41)(65,Se,26,2),i()),e&2&&(a(19),p(o.stats().total),a(),R("border-warning",o.stats().pending>0),a(7),p(o.stats().pending),a(8),p(o.stats().completed),a(8),p(Q(44,13,o.stats().revenue,"ARS","symbol","1.0-0")),a(6),c("ngModel",o.searchQuery()),a(3),c("checked",o.filterStatus()==="all"),a(),c("checked",o.filterStatus()==="pending"),a(),c("checked",o.filterStatus()==="paid"),a(),c("checked",o.filterStatus()==="completed"),a(),c("ngModel",o.sortOrder()),a(7),b(o.loading()?63:o.error()?64:65))},dependencies:[J,G,H,ne,te,Z,ee,K,Y,U,X,z,W,O,w],encapsulation:2,changeDetection:0})};export{de as AdminOrdersPage};
