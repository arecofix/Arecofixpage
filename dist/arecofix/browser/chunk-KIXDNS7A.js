import{a as R}from"./chunk-ETUYVYEI.js";import{b as I}from"./chunk-23BTM2IY.js";import{C as x,R as _,V as j,W as w,o as q,p as y,u as P}from"./chunk-RGAVNK56.js";import{a as h,b as S}from"./chunk-VOSPIT4N.js";var k=class r{constructor(i){this.authService=i;this.supabase=this.authService.getSupabaseClient()}supabase;logger=w(I);getData(i={}){let{_page:t=1,_per_page:a=10,category_id:n,description:p,featured:o,id:f,name:l,price:m,slug:d}=i,g=(t-1)*a,A=g+a-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return n&&(e=e.eq("category_id",n)),p&&(e=e.ilike("description",`%${p}%`)),o!=null&&(e=e.eq("is_featured",o)),f&&(e=e.eq("id",f)),l&&(e=e.ilike("name",`%${l}%`)),m&&(e=e.eq("price",m)),d&&(e=e.eq("slug",d)),e=e.range(g,A),q(e).pipe(P(({data:s,count:C,error:v})=>{if(v)throw v;let b=C||0,c=Math.max(1,Math.ceil(b/a)),M=(s||[]).map(u=>S(h({},u),{featured:u?.featured??u?.is_featured??!1}));return{first:1,prev:t>1?t-1:null,next:t<c?t+1:null,last:c,pages:c,items:b,data:M||[]}}),x(s=>(this.logger.error("Supabase product query error",s),y({first:1,prev:null,next:null,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(t){return new(t||r)(j(R))};static \u0275prov=_({token:r,factory:r.\u0275fac,providedIn:"root"})};export{k as a};
