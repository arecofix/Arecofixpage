import{a as A}from"./chunk-4HXPTVC3.js";import{a as $}from"./chunk-773BQMTG.js";import{C as j,T as w,X as I,Y as R,n as P,o as x,u as k}from"./chunk-OOA6GWW3.js";import{a as y,b as S}from"./chunk-7CGTOI24.js";var C=class i{constructor(t){this.authService=t;this.supabase=this.authService.getSupabaseClient()}supabase;logger=R($);getData(t={}){let{_page:r=1,_per_page:o=10,category_id:a,brand_id:u,description:f,featured:s,id:p,name:l,price:g,slug:m,min_price:_,max_price:b}=t,v=(r-1)*o,M=v+o-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return t.category_ids&&t.category_ids.length>0?e=e.in("category_id",t.category_ids):a!=null&&(e=e.eq("category_id",a)),u&&(e=e.eq("brand_id",u)),f&&(e=e.ilike("description",`%${f}%`)),s!=null&&(e=e.eq("is_featured",s)),p&&(e=e.eq("id",p)),l&&(e=e.ilike("name",`%${l}%`)),g&&(e=e.eq("price",g)),m&&(e=e.eq("slug",m)),_!==void 0&&(e=e.gte("price",_)),b!==void 0&&(e=e.lte("price",b)),t.q&&(e=e.or(`name.ilike.%${t.q}%,description.ilike.%${t.q}%`)),t._sort?e=e.order(t._sort,{ascending:t._order==="asc"}):e=e.order("created_at",{ascending:!1}),e=e.range(v,M),P(e).pipe(k(({data:n,count:O,error:h})=>{if(h)throw h;let q=O||0,c=Math.max(1,Math.ceil(q/o)),D=(n||[]).map(d=>S(y({},d),{featured:d?.featured??d?.is_featured??!1}));return{first:1,prev:r>1?r-1:void 0,next:r<c?r+1:void 0,last:c,pages:c,items:q,data:D||[]}}),j(n=>(this.logger.error("Supabase product query error",n),x({first:1,prev:void 0,next:void 0,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(r){return new(r||i)(I(A))};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};export{C as a};
