import{b as j,d as D,e as L,f as B,g as I,h as q,l as O,m as R,n as U,p as V,r as k}from"./chunk-GSH74JW6.js";import{a as T}from"./chunk-ZT4MGTUK.js";import{a as W,c as x,d as N}from"./chunk-VKJMBSB6.js";import"./chunk-7QORBSNT.js";import"./chunk-QGSRP5SS.js";import{m as F}from"./chunk-KW2FFXRI.js";import{Aa as M,Bb as o,Cb as P,Da as r,Db as A,Fb as s,Gb as p,Hb as g,Qa as w,V as c,ab as _,bb as y,gb as h,hb as i,ib as n,jb as f,la as u,rb as v,tb as E}from"./chunk-VQO264VU.js";import{a as b,b as C}from"./chunk-VOSPIT4N.js";function J(l,m){if(l&1&&(i(0,"div",7),f(1,"i",26),i(2,"span"),o(3),n()()),l&2){let a=E();r(3),P(a.error())}}function K(l,m){if(l&1&&(i(0,"div",12),f(1,"img",27),n()),l&2){let a=E();r(),h("src",a.form().avatar_url,M)}}function Q(l,m){l&1&&f(0,"span",25)}var G=class l{route=c(W);router=c(x);auth=c(T);id=null;form=u({first_name:"",last_name:"",email:"",phone:"",role:"staff",job_title:"",avatar_url:""},{});loading=u(!0,{});saving=u(!1,{});error=u(null,{});async ngOnInit(){if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let m=this.auth.getSupabaseClient(),{data:a,error:e}=await m.from("profiles").select("*").eq("id",this.id).single();a&&this.form.set({first_name:a.first_name||"",last_name:a.last_name||"",email:a.email||"",phone:a.phone||"",role:a.role||"staff",job_title:a.job_title||"",avatar_url:a.avatar_url||""})}this.loading.set(!1)}async onFileChange(m){let a=m.target.files?.[0];if(!a)return;let e=this.auth.getSupabaseClient(),d=`avatars/${Date.now()}-${a.name}`,{data:t,error:S}=await e.storage.from("public-assets").upload(d,a);if(S){this.error.set(S.message);return}let{data:z}=e.storage.from("public-assets").getPublicUrl(t.path);this.form.update(H=>C(b({},H),{avatar_url:z.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null);let m=this.auth.getSupabaseClient(),a=b({},this.form());try{if(this.id){let{error:e}=await m.from("profiles").update(a).eq("id",this.id);if(e)throw e}else throw new Error("Creaci\xF3n de nuevos empleados debe hacerse desde el registro o invitaci\xF3n.");this.router.navigate(["/admin/employees"])}catch(e){this.error.set(e.message)}finally{this.saving.set(!1)}}static \u0275fac=function(a){return new(a||l)};static \u0275cmp=w({type:l,selectors:[["app-admin-employee-form-page"]],decls:52,vars:12,consts:[[1,"max-w-4xl","mx-auto","text-gray-800"],[1,"flex","items-center","gap-4","mb-6"],["routerLink","/admin/employees",1,"btn","btn-circle","btn-ghost"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","text-gray-800"],[3,"ngSubmit"],[1,"admin-form-section"],[1,"alert","alert-error","mb-6"],[1,"admin-form-grid"],[1,"admin-form-label"],["type","text","name","first_name","required","",1,"admin-form-input",3,"ngModelChange","ngModel"],["type","text","name","last_name","required","",1,"admin-form-input",3,"ngModelChange","ngModel"],[1,"mt-4"],["type","email","name","email",1,"admin-form-input",3,"ngModelChange","ngModel","disabled"],[1,"admin-form-grid","mt-4"],["name","role",1,"admin-form-select",3,"ngModelChange","ngModel"],["value","admin"],["value","staff"],["value","user"],["type","text","name","job_title","placeholder","Ej: T\xE9cnico, Vendedor",1,"admin-form-input",3,"ngModelChange","ngModel"],["type","text","name","phone",1,"admin-form-input",3,"ngModelChange","ngModel"],["type","file","accept","image/*",1,"file-input","file-input-bordered","file-input-primary","admin-form-file",3,"change"],[1,"flex","justify-end","gap-4","mt-6"],["routerLink","/admin/employees",1,"btn","btn-ghost"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner","loading-xs","mr-2"],[1,"fas","fa-exclamation-circle"],["alt","Avatar preview",1,"w-24","h-24","rounded-full","object-cover","border-2","border-gray-200","shadow-sm",3,"src"]],template:function(a,e){a&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(3,"i",3),n(),i(4,"h1",4),o(5),n()(),i(6,"form",5),v("ngSubmit",function(){return e.save()}),i(7,"div",6),_(8,J,4,1,"div",7),i(9,"div",8)(10,"div")(11,"label",9),o(12,"Nombre"),n(),i(13,"input",10),g("ngModelChange",function(t){return p(e.form().first_name,t)||(e.form().first_name=t),t}),n()(),i(14,"div")(15,"label",9),o(16,"Apellido"),n(),i(17,"input",11),g("ngModelChange",function(t){return p(e.form().last_name,t)||(e.form().last_name=t),t}),n()()(),i(18,"div",12)(19,"label",9),o(20,"Email"),n(),i(21,"input",13),g("ngModelChange",function(t){return p(e.form().email,t)||(e.form().email=t),t}),n()(),i(22,"div",14)(23,"div")(24,"label",9),o(25,"Rol"),n(),i(26,"select",15),g("ngModelChange",function(t){return p(e.form().role,t)||(e.form().role=t),t}),i(27,"option",16),o(28,"Administrador"),n(),i(29,"option",17),o(30,"Staff / Empleado"),n(),i(31,"option",18),o(32,"Usuario (Degradar)"),n()()(),i(33,"div")(34,"label",9),o(35,"Cargo"),n(),i(36,"input",19),g("ngModelChange",function(t){return p(e.form().job_title,t)||(e.form().job_title=t),t}),n()()(),i(37,"div",12)(38,"label",9),o(39,"Tel\xE9fono"),n(),i(40,"input",20),g("ngModelChange",function(t){return p(e.form().phone,t)||(e.form().phone=t),t}),n()(),i(41,"div",12)(42,"label",9),o(43,"Foto de Perfil"),n(),i(44,"input",21),v("change",function(t){return e.onFileChange(t)}),n(),_(45,K,2,1,"div",12),n()(),i(46,"div",22)(47,"a",23),o(48,"Cancelar"),n(),i(49,"button",24),_(50,Q,1,0,"span",25),o(51," Guardar "),n()()()()),a&2&&(r(5),A("",e.id?"Editar":"Nuevo"," Empleado"),r(3),y(e.error()?8:-1),r(5),s("ngModel",e.form().first_name),r(4),s("ngModel",e.form().last_name),r(4),s("ngModel",e.form().email),h("disabled",!!e.id),r(5),s("ngModel",e.form().role),r(10),s("ngModel",e.form().job_title),r(4),s("ngModel",e.form().phone),r(5),y(e.form().avatar_url?45:-1),r(4),h("disabled",e.saving()),r(),y(e.saving()?50:-1))},dependencies:[F,k,q,R,U,j,O,D,L,V,I,B,N],encapsulation:2})};export{G as AdminEmployeeFormPage};
