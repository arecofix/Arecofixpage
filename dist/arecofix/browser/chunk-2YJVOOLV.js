import{b as I,d as W,e as q,f as L,g as k,h as R,p as U,s as j}from"./chunk-ROKQGBVC.js";import{a as T}from"./chunk-RZKRXCEK.js";import"./chunk-XFT2X3PC.js";import{a as A,c as N,d as D}from"./chunk-CYIQDGHK.js";import"./chunk-BVKNO7TK.js";import"./chunk-RZVF5N6E.js";import"./chunk-T7AXESXA.js";import{p as P}from"./chunk-BKULT56L.js";import{Cb as b,Eb as y,Ha as E,La as l,Mb as m,Nb as M,Ob as F,Qb as v,Rb as _,Sb as w,Y as g,Za as S,jb as u,kb as f,oa as d,pb as h,qb as i,rb as a,sb as p}from"./chunk-YATSW66L.js";import{a as c,b as C}from"./chunk-VOSPIT4N.js";function G(r,o){if(r&1&&(i(0,"div",7),p(1,"i",18),i(2,"span"),m(3),a()()),r&2){let e=y();l(3),M(e.error())}}function z(r,o){if(r&1&&(i(0,"div",12),p(1,"img",19),a()),r&2){let e=y();l(),h("src",e.form().avatar_url,E)}}function H(r,o){r&1&&p(0,"span",17)}var O=class r{route=g(A);router=g(N);auth=g(T);id=null;form=d({first_name:"",last_name:"",email:"",phone:"",role:"staff",avatar_url:""});loading=d(!0);saving=d(!1);error=d(null);async ngOnInit(){if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let o=this.auth.getSupabaseClient(),{data:e,error:t}=await o.from("profiles").select("*").eq("id",this.id).single();e&&this.form.set({first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",role:e.role||"staff",avatar_url:e.avatar_url||""})}this.loading.set(!1)}async onFileChange(o){let e=o.target.files?.[0];if(!e)return;let t=this.auth.getSupabaseClient(),s=`avatars/${Date.now()}-${e.name}`,{data:n,error:x}=await t.storage.from("public-assets").upload(s,e);if(x){this.error.set(x.message);return}let{data:V}=t.storage.from("public-assets").getPublicUrl(n.path);this.form.update(B=>C(c({},B),{avatar_url:V.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null);let o=this.auth.getSupabaseClient(),e=c({},this.form());try{if(this.id){let{error:t}=await o.from("profiles").update(e).eq("id",this.id);if(t)throw t}else throw new Error("Creaci\xF3n de nuevos empleados debe hacerse desde el registro o invitaci\xF3n.");this.router.navigate(["/admin/employees"])}catch(t){this.error.set(t.message)}finally{this.saving.set(!1)}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=S({type:r,selectors:[["app-admin-employee-form-page"]],decls:29,vars:7,consts:[[1,"max-w-4xl","mx-auto","text-gray-800"],[1,"flex","items-center","gap-4","mb-6"],["routerLink","/admin/employees",1,"btn","btn-circle","btn-ghost"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","text-gray-800"],[3,"ngSubmit"],[1,"bg-white","p-6","rounded-xl","shadow-sm","border","border-gray-100","mb-6"],[1,"alert","alert-error","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-gray-700","mb-1.5"],["type","text","name","first_name","required","",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],["type","text","name","last_name","required","",1,"w-full","bg-white","text-gray-900","border","border-gray-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-gray-400",3,"ngModelChange","ngModel"],[1,"mt-4"],["type","file","accept","image/*",1,"file-input","file-input-bordered","file-input-primary","w-full","bg-white","text-gray-700",3,"change"],[1,"flex","justify-end","gap-4","mt-6"],["routerLink","/admin/employees",1,"btn","btn-ghost"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner","loading-xs","mr-2"],[1,"fas","fa-exclamation-circle"],["alt","Avatar preview",1,"w-24","h-24","rounded-full","object-cover","border-2","border-gray-200","shadow-sm",3,"src"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),p(3,"i",3),a(),i(4,"h1",4),m(5),a()(),i(6,"form",5),b("ngSubmit",function(){return t.save()}),i(7,"div",6),u(8,G,4,1,"div",7),i(9,"div",8)(10,"div")(11,"label",9),m(12,"Nombre"),a(),i(13,"input",10),w("ngModelChange",function(n){return _(t.form().first_name,n)||(t.form().first_name=n),n}),a()(),i(14,"div")(15,"label",9),m(16,"Apellido"),a(),i(17,"input",11),w("ngModelChange",function(n){return _(t.form().last_name,n)||(t.form().last_name=n),n}),a()()(),i(18,"div",12)(19,"label",9),m(20,"Foto de Perfil"),a(),i(21,"input",13),b("change",function(n){return t.onFileChange(n)}),a(),u(22,z,2,1,"div",12),a()(),i(23,"div",14)(24,"a",15),m(25,"Cancelar"),a(),i(26,"button",16),u(27,H,1,0,"span",17),m(28," Guardar "),a()()()()),e&2&&(l(5),F("",t.id?"Editar":"Nuevo"," Empleado"),l(3),f(t.error()?8:-1),l(5),v("ngModel",t.form().first_name),l(4),v("ngModel",t.form().last_name),l(5),f(t.form().avatar_url?22:-1),l(4),h("disabled",t.saving()),l(),f(t.saving()?27:-1))},dependencies:[P,j,R,I,W,q,U,k,L,D],encapsulation:2})};export{O as AdminEmployeeFormPage};
