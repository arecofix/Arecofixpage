import{b as I}from"./chunk-YMLALQJL.js";import{C as x,R as _,V as w,o as P,p as q,u as y}from"./chunk-J6ZALCGR.js";import{a as g,b as S}from"./chunk-VOSPIT4N.js";var R=class r{constructor(a){this.authService=a;this.supabase=this.authService.getSupabaseClient()}supabase;getData(a={}){let{_page:t=1,_per_page:i=10,category_id:u,description:p,featured:s,id:f,name:l,price:d,slug:m}=a,b=(t-1)*i,j=b+i-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return u&&(e=e.eq("category_id",u)),p&&(e=e.ilike("description",`%${p}%`)),s!=null&&(e=e.eq("is_featured",s)),f&&(e=e.eq("id",f)),l&&(e=e.ilike("name",`%${l}%`)),d&&(e=e.eq("price",d)),m&&(e=e.eq("slug",m)),e=e.range(b,j),P(e).pipe(y(({data:o,count:k,error:v})=>{if(v)throw v;let h=k||0,c=Math.max(1,Math.ceil(h/i)),A=(o||[]).map(n=>S(g({},n),{featured:n?.featured??n?.is_featured??!1}));return{first:1,prev:t>1?t-1:null,next:t<c?t+1:null,last:c,pages:c,items:h,data:A||[]}}),x(o=>(console.error("Supabase Error:",o),q({first:1,prev:null,next:null,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(t){return new(t||r)(w(I))};static \u0275prov=_({token:r,factory:r.\u0275fac,providedIn:"root"})};export{R as a};
