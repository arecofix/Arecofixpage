{
  "version": 3,
  "sources": ["src/app/admin/posts/services/admin-post.service.ts"],
  "sourcesContent": ["import { Injectable, inject } from '@angular/core';\r\nimport { AuthService } from '@app/core/services/auth.service';\r\nimport { Post } from '@app/features/posts/domain/entities/post.entity';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class AdminPostService {\r\n    private auth = inject(AuthService);\r\n    private supabase = this.auth.getSupabaseClient();\r\n\r\n    async getPosts(): Promise<Post[]> {\r\n        const { data, error } = await this.supabase\r\n            .from('blog_posts')\r\n            .select('*')\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (error) throw error;\r\n        return (data || []).map((post: any) => this.mapToEntity(post));\r\n    }\r\n\r\n    async getPost(id: string): Promise<Post> {\r\n        const { data, error } = await this.supabase\r\n            .from('blog_posts')\r\n            .select('*')\r\n            .eq('id', id)\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return this.mapToEntity(data);\r\n    }\r\n\r\n    private mapToEntity(data: any): Post {\r\n        return {\r\n            ...data,\r\n            image: data.featured_image || data.image || data.image_url\r\n        };\r\n    }\r\n\r\n    async createPost(payload: Partial<Post>): Promise<void> {\r\n        // Map 'image' to 'featured_image' for DB\r\n        const dbPayload: any = { ...payload };\r\n\r\n        // Map image\r\n        if (dbPayload.image) {\r\n            dbPayload.featured_image = dbPayload.image;\r\n            delete dbPayload.image;\r\n        }\r\n\r\n        // Remove fields that don't exist in the user's table\r\n        delete dbPayload.meta_title;\r\n        delete dbPayload.meta_description;\r\n        delete dbPayload.published;\r\n\r\n        const { error } = await this.supabase.from('blog_posts').insert(dbPayload);\r\n        if (error) throw error;\r\n    }\r\n\r\n    async updatePost(id: string, payload: Partial<Post>): Promise<void> {\r\n        const dbPayload: any = { ...payload };\r\n\r\n        // Map image\r\n        if (dbPayload.image) {\r\n            dbPayload.featured_image = dbPayload.image;\r\n            delete dbPayload.image;\r\n        }\r\n\r\n        // Remove fields that don't exist in the user's table\r\n        delete dbPayload.meta_title;\r\n        delete dbPayload.meta_description;\r\n        delete dbPayload.published;\r\n\r\n        const { error } = await this.supabase.from('blog_posts').update(dbPayload).eq('id', id);\r\n        if (error) throw error;\r\n    }\r\n\r\n    async deletePost(id: string): Promise<void> {\r\n        const { error } = await this.supabase.from('blog_posts').delete().eq('id', id);\r\n        if (error) throw error;\r\n    }\r\n\r\n    async uploadImage(file: File): Promise<string> {\r\n        const filePath = `posts/${Date.now()}-${file.name}`;\r\n        const { data, error } = await this.supabase.storage.from('public-assets').upload(filePath, file);\r\n\r\n        if (error) throw error;\r\n\r\n        const { data: publicUrl } = this.supabase.storage.from('public-assets').getPublicUrl(data.path);\r\n        return publicUrl.publicUrl;\r\n    }\r\n\r\n    slugify(text: string): string {\r\n        return text\r\n            .toString()\r\n            .toLowerCase()\r\n            .trim()\r\n            .replace(/\\s+/g, '-')\r\n            .replace(/&/g, '-and-')\r\n            .replace(/[^a-z0-9-]/g, '')\r\n            .replace(/-+/g, '-');\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;AAOM,IAAO,mBAAP,MAAO,kBAAgB;EACjB,OAAO,OAAO,WAAW;EACzB,WAAW,KAAK,KAAK,kBAAiB;EAE9C,MAAM,WAAQ;AACV,UAAM,EAAE,MAAM,MAAK,IAAK,MAAM,KAAK,SAC9B,KAAK,YAAY,EACjB,OAAO,GAAG,EACV,MAAM,cAAc,EAAE,WAAW,MAAK,CAAE;AAE7C,QAAI;AAAO,YAAM;AACjB,YAAQ,QAAQ,CAAA,GAAI,IAAI,CAAC,SAAc,KAAK,YAAY,IAAI,CAAC;EACjE;EAEA,MAAM,QAAQ,IAAU;AACpB,UAAM,EAAE,MAAM,MAAK,IAAK,MAAM,KAAK,SAC9B,KAAK,YAAY,EACjB,OAAO,GAAG,EACV,GAAG,MAAM,EAAE,EACX,OAAM;AAEX,QAAI;AAAO,YAAM;AACjB,WAAO,KAAK,YAAY,IAAI;EAChC;EAEQ,YAAY,MAAS;AACzB,WAAO,iCACA,OADA;MAEH,OAAO,KAAK,kBAAkB,KAAK,SAAS,KAAK;;EAEzD;EAEA,MAAM,WAAW,SAAsB;AAEnC,UAAM,YAAiB,mBAAK;AAG5B,QAAI,UAAU,OAAO;AACjB,gBAAU,iBAAiB,UAAU;AACrC,aAAO,UAAU;IACrB;AAGA,WAAO,UAAU;AACjB,WAAO,UAAU;AACjB,WAAO,UAAU;AAEjB,UAAM,EAAE,MAAK,IAAK,MAAM,KAAK,SAAS,KAAK,YAAY,EAAE,OAAO,SAAS;AACzE,QAAI;AAAO,YAAM;EACrB;EAEA,MAAM,WAAW,IAAY,SAAsB;AAC/C,UAAM,YAAiB,mBAAK;AAG5B,QAAI,UAAU,OAAO;AACjB,gBAAU,iBAAiB,UAAU;AACrC,aAAO,UAAU;IACrB;AAGA,WAAO,UAAU;AACjB,WAAO,UAAU;AACjB,WAAO,UAAU;AAEjB,UAAM,EAAE,MAAK,IAAK,MAAM,KAAK,SAAS,KAAK,YAAY,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,EAAE;AACtF,QAAI;AAAO,YAAM;EACrB;EAEA,MAAM,WAAW,IAAU;AACvB,UAAM,EAAE,MAAK,IAAK,MAAM,KAAK,SAAS,KAAK,YAAY,EAAE,OAAM,EAAG,GAAG,MAAM,EAAE;AAC7E,QAAI;AAAO,YAAM;EACrB;EAEA,MAAM,YAAY,MAAU;AACxB,UAAM,WAAW,SAAS,KAAK,IAAG,CAAE,IAAI,KAAK,IAAI;AACjD,UAAM,EAAE,MAAM,MAAK,IAAK,MAAM,KAAK,SAAS,QAAQ,KAAK,eAAe,EAAE,OAAO,UAAU,IAAI;AAE/F,QAAI;AAAO,YAAM;AAEjB,UAAM,EAAE,MAAM,UAAS,IAAK,KAAK,SAAS,QAAQ,KAAK,eAAe,EAAE,aAAa,KAAK,IAAI;AAC9F,WAAO,UAAU;EACrB;EAEA,QAAQ,MAAY;AAChB,WAAO,KACF,SAAQ,EACR,YAAW,EACX,KAAI,EACJ,QAAQ,QAAQ,GAAG,EACnB,QAAQ,MAAM,OAAO,EACrB,QAAQ,eAAe,EAAE,EACzB,QAAQ,OAAO,GAAG;EAC3B;;qCA7FS,mBAAgB;EAAA;4EAAhB,mBAAgB,SAAhB,kBAAgB,WAAA,YAFb,OAAM,CAAA;;;sEAET,kBAAgB,CAAA;UAH5B;WAAW;MACR,YAAY;KACf;;;",
  "names": []
}
