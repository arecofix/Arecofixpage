import{a as C}from"./chunk-VGQVHFGG.js";import{a as A}from"./chunk-FOCRVBU7.js";import{C as w,S as I,W as R,X as k,n as P,o as x,u as j}from"./chunk-J6ZEXR2D.js";import{a as S,b as q}from"./chunk-7CGTOI24.js";var M=class i{constructor(t){this.authService=t;this.supabase=this.authService.getSupabaseClient()}supabase;logger=k(A);getData(t={}){let{_page:r=1,_per_page:a=10,category_id:o,brand_id:u,description:f,featured:s,id:p,name:l,price:m,slug:g,min_price:_,max_price:b}=t,v=(r-1)*a,O=v+a-1,e=this.supabase.from("products").select("*",{count:"exact"}).eq("is_active",!0);return t.category_ids&&t.category_ids.length>0?e=e.in("category_id",t.category_ids):o!=null&&(e=e.eq("category_id",o)),u&&(e=e.eq("brand_id",u)),f&&(e=e.ilike("description",`%${f}%`)),s!=null&&(e=e.eq("is_featured",s)),p&&(e=e.eq("id",p)),l&&(e=e.ilike("name",`%${l}%`)),m&&(e=e.eq("price",m)),g&&(e=e.eq("slug",g)),_!==void 0&&(e=e.gte("price",_)),b!==void 0&&(e=e.lte("price",b)),t._sort?e=e.order(t._sort,{ascending:t._order==="asc"}):e=e.order("created_at",{ascending:!1}),e=e.range(v,O),P(e).pipe(j(({data:n,count:$,error:h})=>{if(h)throw h;let y=$||0,c=Math.max(1,Math.ceil(y/a)),D=(n||[]).map(d=>q(S({},d),{featured:d?.featured??d?.is_featured??!1}));return{first:1,prev:r>1?r-1:void 0,next:r<c?r+1:void 0,last:c,pages:c,items:y,data:D||[]}}),w(n=>(this.logger.error("Supabase product query error",n),x({first:1,prev:void 0,next:void 0,last:1,pages:1,items:0,data:[]}))))}static \u0275fac=function(r){return new(r||i)(R(C))};static \u0275prov=I({token:i,factory:i.\u0275fac,providedIn:"root"})};export{M as a};
