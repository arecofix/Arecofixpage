{
  "version": 3,
  "sources": ["src/app/core/services/seo.service.ts"],
  "sourcesContent": ["import { Injectable, inject, PLATFORM_ID, makeStateKey, TransferState } from '@angular/core';\r\nimport { Title, Meta } from '@angular/platform-browser';\r\nimport { Router, NavigationEnd, ActivatedRoute } from '@angular/router';\r\nimport { DOCUMENT, isPlatformServer } from '@angular/common';\r\nimport { filter, map, mergeMap } from 'rxjs/operators';\r\nimport { environment } from '../../../environments/environment';\r\n\r\nexport interface SeoData {\r\n  title: string;\r\n  description: string;\r\n  imageUrl?: string;\r\n  type?: 'website' | 'product' | 'article';\r\n  keywords?: string;\r\n}\r\n\r\nconst SEO_DATA_KEY = makeStateKey<SeoData>('SEO_DATA');\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SeoService {\r\n  private titleService = inject(Title);\r\n  private metaService = inject(Meta);\r\n  private router = inject(Router);\r\n  private activatedRoute = inject(ActivatedRoute);\r\n  private document = inject(DOCUMENT);\r\n  private platformId = inject(PLATFORM_ID);\r\n  private transferState = inject(TransferState);\r\n\r\n  constructor() {\r\n    this.init();\r\n  }\r\n\r\n  private init() {\r\n    // 1. Check if we have TransferState data (Client Side Hydration)\r\n    if (!isPlatformServer(this.platformId)) {\r\n      const serverSeoData = this.transferState.get(SEO_DATA_KEY, null);\r\n      if (serverSeoData) {\r\n        this.setPageData(serverSeoData);\r\n        // Optional: clear state after use if needed, but keeping it is oftentimes safer\r\n        // this.transferState.remove(SEO_DATA_KEY);\r\n      }\r\n    }\r\n\r\n    // 2. Subscribe to Route Changes\r\n    this.router.events.pipe(\r\n      filter(event => event instanceof NavigationEnd),\r\n      map(() => this.rootRoute(this.activatedRoute)),\r\n      filter(route => route.outlet === 'primary'),\r\n      mergeMap(route => route.data)\r\n    ).subscribe(data => {\r\n      // If the route has 'seo' data, use it.\r\n      if (data['seo']) {\r\n        const seoData = data['seo'] as SeoData;\r\n        this.setPageData(seoData);\r\n\r\n        // If on Server, save to TransferState\r\n        if (isPlatformServer(this.platformId)) {\r\n          this.transferState.set(SEO_DATA_KEY, seoData);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private rootRoute(route: ActivatedRoute): ActivatedRoute {\r\n    while (route.firstChild) {\r\n      route = route.firstChild;\r\n    }\r\n    return route;\r\n  }\r\n\r\n  resetData() {\r\n    // Remove specific product/article tags that might linger\r\n    this.metaService.removeTag('property=\"product:price:amount\"');\r\n    this.metaService.removeTag('property=\"product:price:currency\"');\r\n    this.metaService.removeTag('property=\"article:published_time\"');\r\n    this.metaService.removeTag('property=\"article:author\"');\r\n    \r\n    // Reset basic Open Graph type to website default\r\n    this.metaService.updateTag({ property: 'og:type', content: 'website' });\r\n  }\r\n  \r\n  /**\r\n   * Sets the core page metadata including Title, Description, and Canonical URL.\r\n   * This is the entry point for basic SEO configuration per page.\r\n   */\r\n  setPageData(data: SeoData) {\r\n    const { title, description, imageUrl, type = 'website', keywords } = data;\r\n    \r\n    // 0. Reset previous specific tags\r\n    this.resetData();\r\n\r\n    // 1. Set Browser Title\r\n    const finalTitle = title.includes('|') || title.includes('Arecofix') ? title : `${title} | Arecofix`;\r\n    this.titleService.setTitle(finalTitle);\r\n\r\n    // 2. Set Meta Description\r\n    this.metaService.updateTag({ name: 'description', content: description });\r\n\r\n    // 3. Set Keywords (Optional)\r\n    if (keywords) {\r\n      this.metaService.updateTag({ name: 'keywords', content: keywords });\r\n    }\r\n\r\n    // 4. Set Social Media Tags (Open Graph & Twitter)\r\n    this.setSocialMediaTags({\r\n        title: finalTitle,\r\n        description,\r\n        image: imageUrl || `${environment.baseUrl}/assets/img/brands/logo/logo-normal1.PNG`,\r\n        url: this.router.url,\r\n        type\r\n    });\r\n\r\n    // 5. Set Canonical URL\r\n    this.setCanonicalUrl(this.router.url);\r\n  }\r\n\r\n  /**\r\n   * Specifically sets Open Graph and Twitter Card metadata.\r\n   * Crucial for WhatsApp, Facebook, and Twitter sharing previews.\r\n   */\r\n  setSocialMediaTags(config: { title: string; description: string; image: string; url: string; type: string }) {\r\n    // Open Graph (Facebook, WhatsApp, LinkedIn)\r\n    this.metaService.updateTag({ property: 'og:title', content: config.title });\r\n    this.metaService.updateTag({ property: 'og:description', content: config.description });\r\n    this.metaService.updateTag({ property: 'og:type', content: config.type });\r\n    this.metaService.updateTag({ property: 'og:url', content: config.url.startsWith('http') ? config.url : `${environment.baseUrl}${config.url}` });\r\n    \r\n    const fullImageUrl = config.image.startsWith('http') ? config.image : `${environment.baseUrl}${config.image.startsWith('/') ? '' : '/'}${config.image}`;\r\n    this.metaService.updateTag({ property: 'og:image', content: fullImageUrl });\r\n    \r\n    // Ensure image secure url is set for https\r\n    if (fullImageUrl.startsWith('https')) {\r\n        this.metaService.updateTag({ property: 'og:image:secure_url', content: fullImageUrl });\r\n    }\r\n\r\n    // Twitter Card\r\n    this.metaService.updateTag({ name: 'twitter:card', content: 'summary_large_image' });\r\n    this.metaService.updateTag({ name: 'twitter:title', content: config.title });\r\n    this.metaService.updateTag({ name: 'twitter:description', content: config.description });\r\n    this.metaService.updateTag({ name: 'twitter:image', content: fullImageUrl });\r\n  }\r\n\r\n  setCanonicalUrl(url: string) {\r\n    // Check if link exists\r\n    let link: HTMLLinkElement | null = this.document.querySelector('link[rel=\"canonical\"]');\r\n    if (!link) {\r\n        link = this.document.createElement('link');\r\n        link.setAttribute('rel', 'canonical');\r\n        this.document.head.appendChild(link);\r\n    }\r\n    const finalUrl = url.startsWith('http') ? url : `${environment.baseUrl}${url}`;\r\n    link.setAttribute('href', finalUrl);\r\n  }\r\n\r\n  setJsonLd(schema: Record<string, any>) {\r\n    const scriptId = 'json-ld-schema';\r\n    let script = this.document.getElementById(scriptId) as HTMLScriptElement;\r\n\r\n    if (!script) {\r\n        script = this.document.createElement('script');\r\n        script.id = scriptId;\r\n        script.type = 'application/ld+json';\r\n        this.document.head.appendChild(script);\r\n    }\r\n\r\n    script.text = JSON.stringify(schema);\r\n  }\r\n}\r\n\r\n"],
  "mappings": "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",
  "names": []
}
