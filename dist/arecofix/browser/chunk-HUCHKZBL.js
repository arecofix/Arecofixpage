import{a as v}from"./chunk-4HXPTVC3.js";import{T as y,Y as P}from"./chunk-OOA6GWW3.js";var C=class g{auth=P(v);supabase=this.auth.getSupabaseClient();async getProducts(){let{data:e,error:t}=await this.supabase.from("products").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}async getProduct(e){let{data:t,error:s}=await this.supabase.from("products").select("*").eq("id",e).single();if(s)throw s;return t}async getBrands(){let{data:e,error:t}=await this.supabase.from("brands").select("*").eq("is_active",!0).order("name");if(t)throw t;return e||[]}async getCategories(){let{data:e,error:t}=await this.supabase.from("categories").select("*").eq("is_active",!0).order("name");if(t)throw t;return e||[]}async createProduct(e){let{error:t}=await this.supabase.from("products").insert(e);if(t)throw t}async updateProduct(e,t){let{error:s}=await this.supabase.from("products").update(t).eq("id",e);if(s)throw s}async uploadImage(e){let t=`products/${Date.now()}-${e.name}`,{data:s,error:u}=await this.supabase.storage.from("public-assets").upload(t,e);if(u)throw u;let{data:o}=this.supabase.storage.from("public-assets").getPublicUrl(s.path);return o.publicUrl}slugify(e){return e.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-")}async exportProductsToCSV(){let e=await this.getProducts();if(!e.length)return;let t=["id","name","slug","description","price","stock","category_id","brand_id","image_url","is_active","is_featured","sku","barcode"],s=[t.join(","),...e.map(l=>t.map(p=>{let i=l[p]||"";return typeof i=="string"&&(i.includes(",")||i.includes('"')||i.includes(`
`))?`"${i.replace(/"/g,'""')}"`:i}).join(","))].join(`
`),u=new Blob([s],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),d=URL.createObjectURL(u);o.setAttribute("href",d),o.setAttribute("download",`products_export_${new Date().toISOString().split("T")[0]}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}async importProductsFromCSV(e){return new Promise((t,s)=>{let u=new FileReader;u.onload=async o=>{try{let l=o.target.result.split(/\r\n|\n/),p=l[0].split(",").map(n=>n.trim()),i=[],h=0;for(let n=1;n<l.length;n++){let w=l[n].trim();if(!w)continue;let m=[],b=!1,f="";for(let r of w)r==='"'?b=!b:r===","&&!b?(m.push(f),f=""):f+=r;if(m.push(f),m.length!==p.length){console.warn(`Skipping line ${n+1}: Column count mismatch`),h++;continue}let a={};p.forEach((r,_)=>{let c=m[_]?.trim();c?.startsWith('"')&&c?.endsWith('"')&&(c=c.substring(1,c.length-1).replace(/""/g,'"')),c===""?a[r]=null:r==="price"||r==="stock"||r==="min_stock_alert"?a[r]=Number(c):r==="is_active"||r==="is_featured"?a[r]=c.toLowerCase()==="true":a[r]=c}),(!a.id||a.id==="new")&&delete a.id,a.name&&a.price>=0?i.push(a):h++}if(i.length>0){let{error:n}=await this.supabase.from("products").upsert(i,{onConflict:"id"});if(n)throw n}t({success:i.length,errors:h})}catch(d){s(d)}},u.onerror=o=>s(o),u.readAsText(e)})}static \u0275fac=function(t){return new(t||g)};static \u0275prov=y({token:g,factory:g.\u0275fac,providedIn:"root"})};export{C as a};
