import{a as W}from"./chunk-L3HQN64Y.js";import"./chunk-4HXPTVC3.js";import{a as V}from"./chunk-773BQMTG.js";import"./chunk-NIOBXWFE.js";import{e as R}from"./chunk-755N3HP6.js";import{g as N,l as $,o as M}from"./chunk-P77MY6VE.js";import{Ab as S,Bb as u,Cb as n,Db as r,Eb as s,Ec as L,Kb as I,Ob as T,Qb as m,Wa as o,Wb as P,Y as _,Yb as a,Zb as p,_b as f,ba as w,ca as A,ib as F,kc as E,lb as x,oc as h,pc as y,qc as D,vb as l,wb as c,zb as v}from"./chunk-OOA6GWW3.js";import{a as O,b as k}from"./chunk-7CGTOI24.js";var C=class t{transform(i){return i?{pending:"A Pagar",processing:"Abonado",completed:"Completado",cancelled:"Cancelado"}[i]||i:""}static \u0275fac=function(e){return new(e||t)};static \u0275pipe=x({name:"orderStatus",type:t,pure:!0})};var b=class t{transform(i){return i&&{pending:"badge-error",processing:"badge-success",completed:"badge-success",cancelled:"badge-error",deleted:"badge-ghost"}[i]||"badge-ghost"}static \u0275fac=function(e){return new(e||t)};static \u0275pipe=x({name:"statusColor",type:t,pure:!0})};var G=t=>["/admin/orders",t],H=t=>["/admin/orders",t,"edit"],q=(t,i)=>i.id;function J(t,i){t&1&&(n(0,"div",4),s(1,"span",6),r())}function K(t,i){if(t&1&&(n(0,"div",5),s(1,"i",7),n(2,"span"),a(3),r()()),t&2){let e=m();o(3),p(e.error)}}function Q(t,i){t&1&&(n(0,"div",8),s(1,"i",10),n(2,"p",11),a(3,"No hay pedidos registrados"),r(),n(4,"a",12),a(5,"Crear Primer Pedido"),r()())}function U(t,i){if(t&1&&(n(0,"li")(1,"span",28),a(2),r(),a(3),r()),t&2){let e=i.$implicit;o(2),f("",e.quantity,"x"),o(),f(" ",e.product_name," ")}}function X(t,i){t&1&&(n(0,"span",20),a(1,"Sin productos"),r())}function Y(t,i){if(t&1){let e=I();n(0,"button",29),T("click",function(){w(e);let g=m().$implicit,z=m(3);return A(z.toggleOrderStatus(g))}),s(1,"i",30),r()}if(t&2){let e=m().$implicit;P("btn-success",e.status==="pending")("btn-warning",e.status==="processing"),u("title",e.status==="pending"?"Marcar como Abonado":"Volver a Pendiente"),o(),P("fa-check-dollar",e.status==="pending")("fa-undo",e.status==="processing")}}function Z(t,i){if(t&1&&(n(0,"tr",15)(1,"td",16),a(2),r(),n(3,"td")(4,"div",17),a(5),r(),n(6,"div",18),a(7),r()(),n(8,"td")(9,"ul",19),v(10,U,4,2,"li",null,q),l(12,X,2,0,"span",20),r()(),n(13,"td",21),a(14),r(),n(15,"td")(16,"span",22),h(17,"statusColor"),a(18),h(19,"orderStatus"),r()(),n(20,"td"),a(21),h(22,"date"),r(),n(23,"td")(24,"div",23),l(25,Y,2,9,"button",24),n(26,"a",25),s(27,"i",26),r(),n(28,"a",25),s(29,"i",27),r()()()()),t&2){let e=i.$implicit;o(2),p(e.order_number),o(3),p(e.customer_name),o(2),p(e.customer_email),o(3),S(e.items),o(2),c(!e.items||e.items.length===0?12:-1),o(2),f("$",e.total.toFixed(2)),o(2),u("ngClass",y(17,11,e.status)),o(2),f(" ",y(19,13,e.status)," "),o(3),p(D(22,15,e.created_at,"short")),o(4),c(e.status==="pending"||e.status==="processing"?25:-1),o(),u("routerLink",E(18,G,e.id)),o(2),u("routerLink",E(20,H,e.id))}}function ee(t,i){if(t&1&&(n(0,"div",9)(1,"table",13)(2,"thead")(3,"tr",14)(4,"th"),a(5,"N\xFAmero"),r(),n(6,"th"),a(7,"Cliente"),r(),n(8,"th"),a(9,"Productos"),r(),n(10,"th"),a(11,"Total"),r(),n(12,"th"),a(13,"Estado"),r(),n(14,"th"),a(15,"Fecha"),r(),n(16,"th"),a(17,"Acciones"),r()()(),n(18,"tbody"),v(19,Z,30,22,"tr",15,q),r()()()),t&2){let e=m(2);o(19),S(e.orders)}}function te(t,i){if(t&1&&l(0,Q,6,0,"div",8)(1,ee,21,0,"div",9),t&2){let e=m();c(e.orders.length===0?0:1)}}var B=class t{orderService=_(W);logger=_(V);cdr=_(L);orders=[];loading=!0;error=null;async ngOnInit(){try{this.orderService.getOrders().subscribe({next:i=>{this.orders=i,this.loading=!1,this.cdr.markForCheck()},error:i=>{this.error=i.message||"Error al cargar pedidos",this.loading=!1,this.cdr.markForCheck()}})}catch(i){this.error=i.message||"Error al cargar pedidos",this.loading=!1,this.cdr.markForCheck()}}async toggleOrderStatus(i){if(i.status!=="pending"&&i.status!=="processing")return;let e=i.status==="pending"?"processing":"pending";try{let{error:d}=await this.orderService.updateOrderStatus(i.id,e);if(d)throw d;this.orders=this.orders.map(g=>g.id===i.id?k(O({},g),{status:e}):g),this.cdr.markForCheck()}catch(d){this.logger.error("Error updating status:",d),alert("Error al actualizar el estado del pedido")}}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["app-admin-orders-page"]],decls:9,vars:3,consts:[[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-green-600"],["routerLink","/admin/orders/new",1,"btn","btn-primary"],[1,"fas","fa-plus","mr-2"],[1,"flex","justify-center","items-center","py-12"],[1,"alert","alert-error"],[1,"loading","loading-spinner","loading-lg"],[1,"fas","fa-exclamation-circle"],[1,"text-center","py-12"],[1,"overflow-x-auto","bg-base-100","rounded-lg","shadow","text-base-content"],[1,"fas","fa-shopping-cart","text-6xl","text-base-content/30","mb-4"],[1,"text-base-content/70","text-lg"],["routerLink","/admin/orders/new",1,"btn","btn-primary","mt-4"],[1,"table","w-full"],[1,"text-base-content","font-bold"],[1,"hover:bg-base-200/50"],[1,"font-mono"],[1,"font-medium"],[1,"text-sm","opacity-70"],[1,"text-sm"],[1,"opacity-50","italic"],[1,"font-semibold"],[1,"badge",3,"ngClass"],[1,"flex","gap-2"],[1,"btn","btn-sm","text-white",3,"btn-success","btn-warning","title"],[1,"btn","btn-sm","btn-ghost","hover:bg-base-300",3,"routerLink"],[1,"fas","fa-eye"],[1,"fas","fa-edit"],[1,"font-bold"],[1,"btn","btn-sm","text-white",3,"click","title"],[1,"fas"]],template:function(e,d){e&1&&(n(0,"div",0)(1,"h2",1),a(2,"Pedidos"),r(),n(3,"a",2),s(4,"i",3),a(5," Nuevo Pedido "),r()(),l(6,J,2,0,"div",4),l(7,K,4,1,"div",5),l(8,te,2,1)),e&2&&(o(6),c(d.loading?6:-1),o(),c(d.error?7:-1),o(),c(!d.loading&&!d.error?8:-1))},dependencies:[R,M,N,$,C,b],encapsulation:2,changeDetection:0})};export{B as AdminOrdersPage};
