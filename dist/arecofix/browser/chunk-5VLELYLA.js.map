{
  "version": 3,
  "sources": ["src/app/admin/users/admin-users-page.ts", "src/app/admin/users/admin-users-page.html"],
  "sourcesContent": ["import { Component, inject, OnInit, signal } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { AuthService } from '@app/core/services/auth.service';\r\nimport { TenantService } from '@app/core/services/tenant.service';\r\nimport { UserProfile } from '@app/shared/interfaces/user.interface';\r\nimport { ROLES } from '@app/core/constants/roles.constants';\r\n\r\n@Component({\r\n    selector: 'app-admin-users-page',\r\n    standalone: true,\r\n    imports: [CommonModule, FormsModule],\r\n    templateUrl: './admin-users-page.html',\r\n})\r\nexport class AdminUsersPage implements OnInit {\r\n    private auth = inject(AuthService);\r\n    private tenantService = inject(TenantService);\r\n    public users = signal<UserProfile[]>([]);\r\n    public branches = signal<any[]>([]);\r\n    public loading = signal<boolean>(true);\r\n\r\n    async ngOnInit() {\r\n        await this.loadBranches();\r\n        await this.loadUsers();\r\n    }\r\n\r\n    async loadBranches() {\r\n        const supabase = this.auth.getSupabaseClient();\r\n        const tenantId = this.tenantService.getTenantId();\r\n        const { data, error } = await supabase\r\n            .from('branches')\r\n            .select('*')\r\n            .eq('tenant_id', tenantId)\r\n            .order('name');\r\n        \r\n        if (!error && data) {\r\n            this.branches.set(data);\r\n        }\r\n    }\r\n\r\n    async loadUsers() {\r\n        this.loading.set(true);\r\n        const supabase = this.auth.getSupabaseClient();\r\n        const tenantId = this.tenantService.getTenantId();\r\n        const { data, error } = await supabase\r\n            .from('profiles')\r\n            .select('*')\r\n            .eq('tenant_id', tenantId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (!error && data) {\r\n            this.users.set(data as UserProfile[]);\r\n        }\r\n        this.loading.set(false);\r\n    }\r\n\r\n    async updateUserRole(user: UserProfile, newRole: string) {\r\n        const supabase = this.auth.getSupabaseClient();\r\n        const { error } = await supabase\r\n            .from('profiles')\r\n            .update({ role: newRole })\r\n            .eq('id', user.id);\r\n\r\n        if (!error) {\r\n            user.role = newRole as any;\r\n        } else {\r\n            alert('Error actualizando el rol: ' + error.message);\r\n        }\r\n    }\r\n\r\n    async updateUserBranch(user: UserProfile, newBranchId: string) {\r\n        const supabase = this.auth.getSupabaseClient();\r\n        const { error } = await supabase\r\n            .from('profiles')\r\n            .update({ branch_id: newBranchId || null })\r\n            .eq('id', user.id);\r\n\r\n        if (!error) {\r\n            user.branch_id = newBranchId;\r\n        } else {\r\n            alert('Error actualizando la sucursal: ' + error.message);\r\n        }\r\n    }\r\n}\r\n", "<div class=\"flex justify-between items-center mb-6\">\r\n    <h1 class=\"text-2xl font-bold text-green-600\">Usuarios</h1>\r\n</div>\r\n\r\n<div class=\"bg-base-100 rounded-lg shadow overflow-hidden text-base-content\">\r\n    <div class=\"overflow-x-auto\">\r\n        <table class=\"table w-full\">\r\n            <thead>\r\n                <tr class=\"text-base-content\">\r\n                    <th>Usuario</th>\r\n                    <th>Rol en el Negocio</th>\r\n                    <th>Sucursal Asignada</th>\r\n                    <th>Fecha Registro</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                @if (loading()) {\r\n                <tr>\r\n                    <td colspan=\"4\" class=\"text-center py-4\">Cargando usuarios...</td>\r\n                </tr>\r\n                } @else if (users().length === 0) {\r\n                <tr>\r\n                    <td colspan=\"4\" class=\"text-center py-4 text-gray-400\">No hay usuarios registrados.</td>\r\n                </tr>\r\n                } @else {\r\n                @for (user of users(); track user.id) {\r\n                <tr>\r\n                    <td>\r\n                        <div class=\"flex items-center gap-3\">\r\n                            <div class=\"avatar\">\r\n                                <div class=\"mask mask-squircle w-12 h-12\">\r\n                                    <img [src]=\"user.avatar_url || 'https://ui-avatars.com/api/?name=' + user.first_name + '+' + user.last_name\"\r\n                                        alt=\"Avatar\" />\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <div class=\"font-bold\">{{ user.first_name }} {{ user.last_name }}</div>\r\n                                <div class=\"text-xs opacity-50\">{{ user.email }}</div>\r\n                            </div>\r\n                        </div>\r\n                    </td>\r\n                    <td>\r\n                        <select class=\"select select-sm select-bordered w-full max-w-xs\"\r\n                                [ngModel]=\"user.role\"\r\n                                (ngModelChange)=\"updateUserRole(user, $event)\">\r\n                            <option value=\"user\">Cliente (User)</option>\r\n                            <option value=\"staff\">TÃ©cnico (Staff)</option>\r\n                            <option value=\"admin\">Administrador (Admin)</option>\r\n                        </select>\r\n                    </td>\r\n                    <td>\r\n                        <select class=\"select select-sm select-bordered w-full max-w-xs\"\r\n                                [ngModel]=\"user.branch_id\"\r\n                                (ngModelChange)=\"updateUserBranch(user, $event)\"\r\n                                [disabled]=\"user.role === 'admin' || user.role === 'user'\">\r\n                            <option [ngValue]=\"null\">-- Sin Sucursal Asignada --</option>\r\n                            @for (branch of branches(); track branch.id) {\r\n                                <option [ngValue]=\"branch.id\">{{ branch.name }}</option>\r\n                            }\r\n                        </select>\r\n                        @if(user.role === 'admin') {\r\n                            <div class=\"text-[10px] text-gray-400 mt-1\">Global (Todas las sucursales)</div>\r\n                        }\r\n                    </td>\r\n                    <td class=\"text-sm opacity-70\">{{ user.created_at | date:'shortDate' }}</td>\r\n                </tr>\r\n                }\r\n                }\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n</div>"],
  "mappings": "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",
  "names": []
}
