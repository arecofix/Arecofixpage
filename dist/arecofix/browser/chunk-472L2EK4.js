import{a as j,b as O,d as U,e as G,f as z,g as K,h as H,i as J,l as Q,m as X,n as Y,p as Z,r as $}from"./chunk-67JN6MIM.js";import{a as R}from"./chunk-ETUYVYEI.js";import"./chunk-23BTM2IY.js";import{a as L,c as I,d as q}from"./chunk-ZWPO54DG.js";import"./chunk-SH266SLM.js";import"./chunk-Z5OW2DIK.js";import{p as B}from"./chunk-DTICAINP.js";import{$ as c,Ca as W,Fa as l,Fb as m,Gb as k,Hb as N,Jb as u,Kb as p,Lb as _,Ta as x,W as f,aa as g,eb as y,fb as h,hb as T,ib as M,ic as D,jb as E,kb as w,lb as n,ma as b,mb as r,nb as C,rb as V,vb as v,xb as F}from"./chunk-RGAVNK56.js";import{a as P,b as S}from"./chunk-VOSPIT4N.js";var ee=(s,o)=>o.id;function ne(s,o){if(s&1&&(n(0,"option",17),m(1),r()),s&2){let t=o.$implicit;w("value",t.id),l(),k(t.name)}}function re(s,o){if(s&1&&(n(0,"option",17),m(1),r()),s&2){let t=o.$implicit;w("value",t.id),l(),k(t.name)}}function ae(s,o){s&1&&(n(0,"span",38),m(1,"Principal"),r())}function oe(s,o){if(s&1){let t=V();n(0,"div",34),C(1,"img",35),n(2,"button",36),v("click",function(){let a=c(t).$index,d=F(2);return g(d.removeImage(a))}),C(3,"i",37),r(),y(4,ae,2,0,"span",38),r()}if(s&2){let t=o.$implicit,e=o.$index;l(),w("src",t,W),l(3),h(e===0?4:-1)}}function de(s,o){if(s&1&&(n(0,"div",28),M(1,oe,5,2,"div",34,T),r()),s&2){let t=F();l(),E(t.form().images)}}function le(s,o){if(s&1&&(n(0,"div",29),m(1),r()),s&2){let t=F();l(),k(t.error)}}function se(s,o){s&1&&C(0,"span",32)}var te=class s{route=f(L);router=f(I);auth=f(R);cdr=f(D);id=null;form=b({sku:"",barcode:"",name:"",slug:"",description:"",price:0,stock:0,brand_id:"",category_id:"",is_active:!0,images:[]});brands=b([]);categories=b([]);loading=!0;saving=!1;uploading=b(!1);error=null;async ngOnInit(){let o=this.auth.getSupabaseClient(),[t,e]=await Promise.all([o.from("brands").select("*").eq("is_active",!0).order("name"),o.from("categories").select("*").eq("is_active",!0).order("name")]);if(t.data&&this.brands.set(t.data),e.data&&this.categories.set(e.data),this.id=this.route.snapshot.paramMap.get("id"),this.id){let{data:a,error:d}=await o.from("products").select("*").eq("id",this.id).single();d?this.error=d.message:a&&this.form.set({sku:a.sku||"",barcode:a.barcode||"",name:a.name||"",slug:a.slug||"",description:a.description||"",price:a.price||0,stock:a.stock||0,brand_id:a.brand_id||"",category_id:a.category_id||"",is_active:a.is_active??!0,images:a.gallery_urls||(a.image_url?[a.image_url]:[])})}this.loading=!1,this.cdr.markForCheck()}async onFileChange(o){let t=o.target.files?.[0];if(!t)return;this.uploading.set(!0);let e=this.auth.getSupabaseClient(),a=`products/${Date.now()}-${t.name}`;try{let{data:d,error:i}=await e.storage.from("public-assets").upload(a,t);if(i){this.error=i.message;return}let{data:ie}=e.storage.from("public-assets").getPublicUrl(d.path);this.form.update(A=>S(P({},A),{images:[...A.images,ie.publicUrl]}))}catch(d){this.error=d.message}finally{this.uploading.set(!1),this.cdr.markForCheck()}}removeImage(o){this.form.update(t=>S(P({},t),{images:t.images.filter((e,a)=>a!==o)})),this.cdr.markForCheck()}generateBarcode(){let o=this.form().sku,t=o||`GEN-${Date.now()}`;this.form.update(e=>S(P({},e),{barcode:t}))}async save(){this.saving=!0,this.error=null;let o=this.auth.getSupabaseClient(),t=this.form(),e=t.slug;e||(e=this.slugify(t.name));let a={sku:t.sku,barcode:t.barcode,name:t.name,slug:e,description:t.description,price:t.price,stock:t.stock,brand_id:t.brand_id||null,category_id:t.category_id||null,is_active:t.is_active,gallery_urls:Array.isArray(t.images)?t.images:[],image_url:t.images.length>0?t.images[0]:null};try{if(this.id){let{error:d}=await o.from("products").update(a).eq("id",this.id);if(d)throw d}else{let{error:d}=await o.from("products").insert(a);if(d)throw d}this.router.navigate(["/admin/products"])}catch(d){this.error=d.message||"Error al guardar producto"}finally{this.saving=!1,this.cdr.markForCheck()}}slugify(o){return o.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-")}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=x({type:s,selectors:[["app-admin-product-form-page"]],decls:73,vars:15,consts:[["f","ngForm"],[1,"max-w-2xl","mx-auto"],[1,"text-lg","font-medium","mb-4"],[1,"grid","gap-4",3,"ngSubmit"],[1,"block","text-sm"],["type","text","name","name","required","",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"form-control"],[1,"label"],["type","text","name","sku",1,"input","input-bordered",3,"ngModelChange","ngModel"],[1,"join"],["type","text","name","barcode",1,"input","input-bordered","join-item","w-full",3,"ngModelChange","ngModel"],["type","button",1,"btn","join-item",3,"click"],[1,"fas","fa-random"],["type","text","name","name","required","",1,"input","input-bordered",3,"ngModelChange","ngModel"],["name","brand_id",1,"select","select-bordered",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["name","category_id",1,"select","select-bordered",3,"ngModelChange","ngModel"],["name","description","rows","4",1,"textarea","textarea-bordered","w-full",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","gap-4"],["type","number","name","price","required","",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],["type","number","name","stock",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2"],["type","checkbox","name","is_active",3,"ngModelChange","ngModel"],[1,"block","text-sm","font-medium","mb-2"],["type","file","accept","image/*","multiple","",1,"file-input","file-input-bordered","w-full",3,"change"],[1,"text-sm","text-gray-500","mt-1"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-4","mt-4"],[1,"text-red-600"],[1,"flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"loading","loading-spinner","loading-xs"],["routerLink","/admin/products",1,"btn"],[1,"relative","group"],[1,"w-full","h-32","object-cover","rounded-lg","border-2","border-gray-200",3,"src"],["type","button",1,"absolute","top-1","right-1","btn","btn-circle","btn-sm","btn-error","opacity-0","group-hover:opacity-100","transition-opacity",3,"click"],[1,"fas","fa-times"],[1,"absolute","bottom-1","left-1","badge","badge-primary","badge-sm"]],template:function(t,e){if(t&1){let a=V();n(0,"div",1)(1,"h2",2),m(2),r(),n(3,"form",3,0),v("ngSubmit",function(){return c(a),g(e.save())}),n(5,"div")(6,"label",4),m(7,"Nombre"),r(),n(8,"input",5),_("ngModelChange",function(i){return c(a),p(e.form().name,i)||(e.form().name=i),g(i)}),r()(),n(9,"div",6)(10,"div",7)(11,"label",8),m(12,"SKU"),r(),n(13,"input",9),_("ngModelChange",function(i){return c(a),p(e.form().sku,i)||(e.form().sku=i),g(i)}),r()(),n(14,"div",7)(15,"label",8),m(16,"C\xF3digo de Barras"),r(),n(17,"div",10)(18,"input",11),_("ngModelChange",function(i){return c(a),p(e.form().barcode,i)||(e.form().barcode=i),g(i)}),r(),n(19,"button",12),v("click",function(){return c(a),g(e.generateBarcode())}),C(20,"i",13),r()()()(),n(21,"div",7)(22,"label",8),m(23,"Nombre"),r(),n(24,"input",14),_("ngModelChange",function(i){return c(a),p(e.form().name,i)||(e.form().name=i),g(i)}),r()(),n(25,"div",6)(26,"div",7)(27,"label",8),m(28,"Marca"),r(),n(29,"select",15),_("ngModelChange",function(i){return c(a),p(e.form().brand_id,i)||(e.form().brand_id=i),g(i)}),n(30,"option",16),m(31,"Seleccionar Marca"),r(),M(32,ne,2,2,"option",17,ee),r()(),n(34,"div",7)(35,"label",8),m(36,"Categor\xEDa"),r(),n(37,"select",18),_("ngModelChange",function(i){return c(a),p(e.form().category_id,i)||(e.form().category_id=i),g(i)}),n(38,"option",16),m(39,"Seleccionar Categor\xEDa"),r(),M(40,re,2,2,"option",17,ee),r()()(),n(42,"div")(43,"label",4),m(44,"Descripci\xF3n"),r(),n(45,"textarea",19),_("ngModelChange",function(i){return c(a),p(e.form().description,i)||(e.form().description=i),g(i)}),r()(),n(46,"div",20)(47,"div")(48,"label",4),m(49,"Precio"),r(),n(50,"input",21),_("ngModelChange",function(i){return c(a),p(e.form().price,i)||(e.form().price=i),g(i)}),r()(),n(51,"div")(52,"label",4),m(53,"Stock"),r(),n(54,"input",22),_("ngModelChange",function(i){return c(a),p(e.form().stock,i)||(e.form().stock=i),g(i)}),r()()(),n(55,"div",23)(56,"input",24),_("ngModelChange",function(i){return c(a),p(e.form().is_active,i)||(e.form().is_active=i),g(i)}),r(),n(57,"span"),m(58,"Activo"),r()(),n(59,"div")(60,"label",25),m(61,"Fotos del Producto"),r(),n(62,"input",26),v("change",function(i){return c(a),g(e.onFileChange(i))}),r(),n(63,"p",27),m(64,"Puedes subir m\xFAltiples im\xE1genes. La primera ser\xE1 la imagen principal."),r(),y(65,de,3,0,"div",28),r(),y(66,le,2,1,"div",29),n(67,"div",30)(68,"button",31),y(69,se,1,0,"span",32),m(70," Guardar "),r(),n(71,"a",33),m(72,"Cancelar"),r()()()()}t&2&&(l(2),N("",e.id?"Editar":"Nuevo"," producto"),l(6),u("ngModel",e.form().name),l(5),u("ngModel",e.form().sku),l(5),u("ngModel",e.form().barcode),l(6),u("ngModel",e.form().name),l(5),u("ngModel",e.form().brand_id),l(3),E(e.brands()),l(5),u("ngModel",e.form().category_id),l(3),E(e.categories()),l(5),u("ngModel",e.form().description),l(5),u("ngModel",e.form().price),l(4),u("ngModel",e.form().stock),l(2),u("ngModel",e.form().is_active),l(9),h(e.form().images.length>0?65:-1),l(),h(e.error?66:-1),l(2),w("disabled",e.saving||e.uploading()),l(),h(e.uploading()?69:-1))},dependencies:[B,$,H,X,Y,O,J,j,Q,U,G,Z,K,z,q],encapsulation:2,changeDetection:0})};export{te as AdminProductFormPage};
