import{a as R}from"./chunk-GV4BHUR2.js";import{a as k,b as I,c as b,d as A,e as N,h as V,j as D,k as T,q as G,s as M}from"./chunk-GSH74JW6.js";import"./chunk-ZT4MGTUK.js";import{a as y,c as F,d as w}from"./chunk-VKJMBSB6.js";import"./chunk-7QORBSNT.js";import"./chunk-QGSRP5SS.js";import"./chunk-KW2FFXRI.js";import{$ as v,Aa as C,Bb as a,Cb as E,Da as s,Db as S,Qa as x,V as m,_ as h,ab as u,bb as p,ec as P,gb as f,hb as t,ib as e,jb as l,nb as _,rb as g,tb as c}from"./chunk-VQO264VU.js";import"./chunk-VOSPIT4N.js";function j(r,n){r&1&&(l(0,"i",8),a(1," Guardando... "))}function q(r,n){r&1&&(l(0,"i",9),a(1," Guardar "))}function U(r,n){r&1&&(t(0,"div",6),l(1,"div",10),t(2,"p"),a(3,"Cargando..."),e()())}function z(r,n){if(r&1){let i=_();t(0,"div",25),l(1,"img",33),t(2,"button",34),g("click",function(){h(i);let d=c(2);return d.imagePreview=null,v(d.form.patchValue({image_url:""}))}),l(3,"i",35),e()()}if(r&2){let i=c(2);s(),f("src",i.imagePreview,C)}}function B(r,n){if(r&1){let i=_();t(0,"form",7)(1,"div",11)(2,"h3"),a(3,"Informaci\xF3n General"),e(),t(4,"div",12)(5,"label",13),a(6,"T\xEDtulo"),e(),l(7,"input",14),e(),t(8,"div",12)(9,"label",15),a(10,"Slug (URL)"),e(),l(11,"input",16),t(12,"small",17),a(13),e()(),t(14,"div",12)(15,"label",18),a(16,"Contenido"),e(),l(17,"textarea",19),e(),t(18,"div",20)(19,"label",21),l(20,"input",22)(21,"span",23),a(22," Publicado "),e()()(),t(23,"div",11)(24,"h3"),a(25,"Imagen Destacada"),e(),t(26,"div",24),u(27,z,4,1,"div",25),t(28,"div",26)(29,"button",27),a(30,"Subir Imagen"),e(),t(31,"input",28),g("change",function(d){h(i);let O=c();return v(O.onFileSelected(d))}),e()()()(),t(32,"div",11)(33,"h3"),a(34,"SEO"),e(),t(35,"div",12)(36,"label",29),a(37,"Meta T\xEDtulo"),e(),l(38,"input",30),e(),t(39,"div",12)(40,"label",31),a(41,"Meta Descripci\xF3n"),e(),l(42,"textarea",32),e()()()}if(r&2){let i,o=c();f("formGroup",o.form),s(13),S("La URL ser\xE1: /#/posts/",(i=o.form.get("slug"))==null?null:i.value),s(14),p(o.imagePreview?27:-1)}}var L=class r{fb=m(G);postService=m(R);route=m(y);router=m(F);cdr=m(P);form;loading=!1;submitting=!1;isEdit=!1;postId=null;imagePreview=null;constructor(){this.form=this.fb.group({title:["",[b.required]],slug:["",[b.required]],content:[""],published:[!1],meta_title:[""],meta_description:[""],image_url:[""]})}async ngOnInit(){this.postId=this.route.snapshot.paramMap.get("id"),this.postId&&(this.isEdit=!0,await this.loadPost(this.postId)),this.form.get("title")?.valueChanges.subscribe(n=>{!this.isEdit&&n&&!this.form.get("slug")?.dirty&&this.form.patchValue({slug:this.postService.slugify(n)})})}async loadPost(n){try{this.loading=!0;let i=await this.postService.getPost(n);this.form.patchValue(i),this.imagePreview=i.image_url||null}catch{alert("Error al cargar la entrada"),this.router.navigate(["/admin/posts"])}finally{this.loading=!1,this.cdr.markForCheck()}}async onFileSelected(n){let i=n.target.files?.[0];if(i)try{this.loading=!0;let o=await this.postService.uploadImage(i);this.form.patchValue({image_url:o}),this.imagePreview=o}catch{alert("Error al subir imagen")}finally{this.loading=!1,this.cdr.markForCheck()}}async onSubmit(){if(!this.form.invalid)try{this.submitting=!0;let n=this.form.value;this.isEdit&&this.postId?await this.postService.updatePost(this.postId,n):await this.postService.createPost(n),this.router.navigate(["/admin/posts"])}catch(n){alert("Error al guardar: "+n.message)}finally{this.submitting=!1,this.cdr.markForCheck()}}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=x({type:r,selectors:[["app-admin-post-form-page"]],decls:15,vars:5,consts:[[1,"admin-header"],[1,"header-content"],[1,"header-actions"],["routerLink","/admin/posts",1,"btn-secondary"],[1,"btn-primary",3,"click","disabled"],[1,"admin-content"],[1,"loading-state"],[1,"admin-form",3,"formGroup"],[1,"fas","fa-spinner","fa-spin"],[1,"fas","fa-save"],[1,"spinner"],[1,"form-section"],[1,"form-group"],["for","title"],["type","text","id","title","formControlName","title","placeholder","Ej: Servicio t\xE9cnico de celulares",1,"form-control"],["for","slug"],["type","text","id","slug","formControlName","slug","placeholder","ej: servicio-tecnico-de-celulares",1,"form-control"],[1,"form-hint"],["for","content"],["id","content","formControlName","content","rows","10","placeholder","Escribe el contenido aqu\xED...",1,"form-control"],[1,"form-group","checkbox-group"],[1,"checkbox-container"],["type","checkbox","formControlName","published"],[1,"checkmark"],[1,"image-upload-container"],[1,"image-preview"],[1,"upload-btn-wrapper"],["type","button",1,"btn-secondary"],["type","file","accept","image/*",3,"change"],["for","meta_title"],["type","text","id","meta_title","formControlName","meta_title",1,"form-control"],["for","meta_description"],["id","meta_description","formControlName","meta_description","rows","3",1,"form-control"],["alt","Preview",3,"src"],["type","button",1,"btn-icon","delete",3,"click"],[1,"fas","fa-trash"]],template:function(i,o){i&1&&(t(0,"div",0)(1,"div",1)(2,"h1"),a(3),e(),t(4,"p"),a(5),e()(),t(6,"div",2)(7,"a",3),a(8,"Cancelar"),e(),t(9,"button",4),g("click",function(){return o.onSubmit()}),u(10,j,2,0)(11,q,2,0),e()()(),t(12,"div",5),u(13,U,4,0,"div",6)(14,B,43,3,"form",7),e()),i&2&&(s(3),E(o.isEdit?"Editar Entrada":"Nueva Entrada"),s(2),E(o.isEdit?"Modifica los detalles de la entrada":"Crea una nueva entrada para el blog"),s(4),f("disabled",o.form.invalid||o.submitting),s(),p(o.submitting?10:11),s(3),p(o.loading?13:14))},dependencies:[M,V,I,k,A,N,T,D,w],encapsulation:2,changeDetection:0})};export{L as AdminPostFormPage};
