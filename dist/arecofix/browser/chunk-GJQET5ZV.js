import{k as S,l as C}from"./chunk-ECZXGVFH.js";import{a as d}from"./chunk-P2JKZEUE.js";import{C as l,L as f,R as v,V as _,W as b,k as o,l as n,r as p}from"./chunk-DX2LKEMG.js";var y=class c{constructor(r){this.authService=r;this.supabase=this.authService.getSupabaseClient()}supabase;logger=b(d);tenantService=b(S);processResponse(r,t,e){let a=t||r.length,s=e._per_page>0?e._per_page:a,i=Math.max(1,Math.ceil(a/(s||1)));return{first:1,prev:e._page>1?e._page-1:null,next:e._page<i?e._page+1:null,last:i,pages:i,items:a,data:r}}getData(r){let{_page:t=1,_per_page:e=10}=r,a=(t-1)*e,s=a+e-1;return o(this.supabase.from("categories").select("*",{count:"exact"}).eq("tenant_id",this.tenantService.getTenantId()).eq("is_active",!0).range(a,s)).pipe(p(({data:i,count:g,error:u})=>{if(u)throw u;return this.processResponse(i||[],g,{_page:t,_per_page:e})}),l(i=>(this.logger.error("Supabase Error:",i),n({first:1,prev:null,next:null,last:1,pages:1,items:0,data:[]}))))}getFeaturedData(){return o(this.supabase.from("categories").select("*",{count:"exact"}).eq("tenant_id",this.tenantService.getTenantId()).eq("is_active",!0).eq("type","product").order("name").limit(100)).pipe(p(({data:e,count:a,error:s})=>{if(s)throw s;return this.processResponse(e||[],a,{_page:1,_per_page:100})}),l(e=>(this.logger.error("Supabase Error:",e),n({first:1,prev:null,next:null,last:1,pages:1,items:0,data:[]}))))}getDataBySlug(r){let t=(r||"").trim().toLowerCase(),e=this.tenantService.getTenantId();return o(this.supabase.from("categories").select("*").eq("tenant_id",e).eq("slug",t).limit(1)).pipe(f(({data:a,error:s})=>s?(this.logger.error("Supabase Error (exact slug):",s),n({data:[],error:s})):a&&a.length>0?n({data:a,error:null}):o(this.supabase.from("categories").select("*").eq("tenant_id",e).ilike("slug",`%${t}%`).order("slug").limit(10)).pipe(p(({data:i,error:g})=>{if(g)return{data:[],error:g};let u=i||[],h=u.find(m=>m.slug.toLowerCase()===t)??u.find(m=>m.slug.toLowerCase().startsWith(t))??u[0];return{data:h?[h]:[],error:null}}))),p(({data:a,error:s})=>{if(s)throw s;return this.processResponse(a||[],a?.length??0,{_page:1,_per_page:1})}),l(a=>(this.logger.error("Supabase Error (slug lookup):",a),n({first:1,prev:null,next:null,last:1,pages:1,items:0,data:[]}))))}getById(r){return!r||r==="null"||r==="0"?n(null):o(this.supabase.from("categories").select("*").eq("tenant_id",this.tenantService.getTenantId()).eq("id",r).single()).pipe(p(({data:t,error:e})=>{if(e)throw e;return t}),l(t=>(this.logger.error("Supabase Error:",t),n(null))))}getAll(){return o(this.supabase.from("categories").select("*").eq("tenant_id",this.tenantService.getTenantId()).eq("is_active",!0).eq("type","product").order("name")).pipe(p(({data:r,error:t})=>{if(t)throw t;return r||[]}),l(r=>(this.logger.error("Supabase Error getAll:",r),n([]))))}static \u0275fac=function(t){return new(t||c)(_(C))};static \u0275prov=v({token:c,factory:c.\u0275fac,providedIn:"root"})};export{y as a};
