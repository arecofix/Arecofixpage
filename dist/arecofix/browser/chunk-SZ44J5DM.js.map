{
  "version": 3,
  "sources": ["src/app/core/services/seo.service.ts"],
  "sourcesContent": ["import { Injectable, inject, PLATFORM_ID, makeStateKey, TransferState, DOCUMENT } from '@angular/core';\r\nimport { Title, Meta } from '@angular/platform-browser';\r\nimport { Router, NavigationEnd, ActivatedRoute } from '@angular/router';\r\nimport { isPlatformServer } from '@angular/common';\r\nimport { filter, map, mergeMap } from 'rxjs/operators';\r\nimport { environment } from '../../../environments/environment';\r\n\r\nexport interface SeoData {\r\n  title: string;\r\n  description: string;\r\n  imageUrl?: string;\r\n  type?: 'website' | 'product' | 'article' | 'profile';\r\n  keywords?: string;\r\n  url?: string; // Optional override\r\n  schema?: Record<string, any>;\r\n  author?: string;\r\n  twitterCard?: 'summary' | 'summary_large_image' | 'app' | 'player';\r\n}\r\n\r\nconst SEO_DATA_KEY = makeStateKey<SeoData>('SEO_DATA');\r\n\r\n// Dictionary of predefined Meta Tags based on internal routes\r\nexport const STATIC_SEO_CONFIG: Record<string, SeoData> = {\r\n  '/': {\r\n    title: 'Soluciones de Software & Consultoría IT',\r\n    description: 'Expertos en desarrollo de software a medida, aplicaciones móviles y transformación digital. Consultoría IT y servicio técnico especializado en Marcos Paz.',\r\n    imageUrl: 'assets/img/branding/og-services.jpg'\r\n  },\r\n  '/celular': {\r\n    title: 'Reparación de Celulares en Marcos Paz | Servicio Técnico Arecofix',\r\n    description: 'Arreglo de pantallas, baterías y pines de carga en el acto. Calidad garantizada en Marcos Paz.',\r\n    imageUrl: 'assets/img/branding/og-celulares.jpg',\r\n    keywords: 'reparacion de celulares marcos paz, servicio tecnico celulares, arreglo de pantallas, cambio de bateria, arecofix'\r\n  },\r\n  '/contacto': {\r\n    title: 'Contacto | Arecofix - Estamos para Ayudarte',\r\n    description: '¿Tenés alguna consulta o necesitás soporte técnico? Contáctanos por WhatsApp, Email o visitanos en nuestro local.',\r\n    imageUrl: 'assets/img/branding/og-contact.jpg'\r\n  },\r\n  '/servicios': {\r\n    title: 'Servicios de Tecnología y Reparación | Arecofix',\r\n    description: 'Soluciones integrales: Reparación de Celulares, Desarrollo de Software, Cámaras de Seguridad y Soporte IT para empresas.',\r\n    imageUrl: 'assets/img/branding/og-services.jpg',\r\n    keywords: 'servicios informaticos, reparacion celulares, desarrollo software, soporte it, camaras seguridad'\r\n  },\r\n  '/nosotros': {\r\n    title: 'Sobre Nosotros | Arecofix - Innovación y Compromiso',\r\n    description: 'Conocé al equipo detrás de Arecofix. Somos expertos en tecnología comprometidos con brindar soluciones de calidad en Marcos Paz.',\r\n    imageUrl: 'assets/img/branding/logo/logo-normal1.PNG'\r\n  },\r\n  '/academy': {\r\n    title: 'Arecofix Academy | Cursos de Tecnología',\r\n    description: 'Aprendé reparación de celulares, programación y más con nuestros cursos presenciales y online.',\r\n    imageUrl: 'assets/img/branding/logo/logo-normal1.PNG'\r\n  }\r\n};\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SeoService {\r\n  private titleService = inject(Title);\r\n  private metaService = inject(Meta);\r\n  private router = inject(Router);\r\n  private activatedRoute = inject(ActivatedRoute);\r\n  private document = inject(DOCUMENT);\r\n  private platformId = inject(PLATFORM_ID);\r\n  private transferState = inject(TransferState);\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Initializes the SEO service.\r\n   * Subscribes to router events to automatically update tags.\r\n   */\r\n  public initialize() {\r\n    // 1. Check if we have TransferState data (Client Side Hydration)\r\n    if (!isPlatformServer(this.platformId)) {\r\n      const serverSeoData = this.transferState.get(SEO_DATA_KEY, null);\r\n      if (serverSeoData) {\r\n        this.setPageData(serverSeoData);\r\n      }\r\n    } else {\r\n      // Immediate execution for Server to avoid racing with NavigationEnd\r\n      const initialUrl = this.router.url.split('?')[0];\r\n      if (STATIC_SEO_CONFIG[initialUrl]) {\r\n        this.setPageData(STATIC_SEO_CONFIG[initialUrl]);\r\n      }\r\n    }\r\n\r\n    // 2. Subscribe to Route Changes\r\n    this.router.events.pipe(\r\n      filter(event => event instanceof NavigationEnd),\r\n      map((event: any) => event.urlAfterRedirects.split('?')[0]), // Normalize the URL\r\n    ).subscribe((currentPath: string) => {\r\n      \r\n      // Look in the Static Configuration Object first\r\n      let seoData = STATIC_SEO_CONFIG[currentPath];\r\n\r\n      // If not defined statically, attempt to read from ActivatedRoute data\r\n      if (!seoData) {\r\n        const routeData = this.getContentRoute(this.activatedRoute).snapshot.data;\r\n        if (routeData && routeData['seo']) {\r\n          seoData = routeData['seo'] as SeoData;\r\n        }\r\n      }\r\n\r\n      // If no static or activated route data exists, enforce absolute defaults\r\n      if (!seoData) {\r\n        seoData = {\r\n          title: 'Arecofix - Servicio Técnico de Celulares y Soluciones IT',\r\n          description: 'Experto en reparación de celulares en el acto, desarrollo web y transformación digital en Marcos Paz.',\r\n          imageUrl: 'assets/img/branding/og-services.jpg'\r\n        };\r\n      }\r\n\r\n      if (seoData) {\r\n        // Prevent rewriting empty state while hydrating\r\n        if (!isPlatformServer(this.platformId) && this.transferState.hasKey(SEO_DATA_KEY)) {\r\n           this.transferState.remove(SEO_DATA_KEY);\r\n           return;\r\n        }\r\n\r\n        this.setPageData(seoData);\r\n\r\n      } else {\r\n        if (!isPlatformServer(this.platformId) && this.transferState.hasKey(SEO_DATA_KEY)) {\r\n           this.transferState.remove(SEO_DATA_KEY);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Recursively traverses the route tree to find the last child (the actual page component).\r\n   */\r\n  private getContentRoute(route: ActivatedRoute): ActivatedRoute {\r\n    while (route.firstChild) {\r\n      route = route.firstChild;\r\n    }\r\n    return route;\r\n  }\r\n\r\n  /**\r\n   * Sets all SEO metadata for the current page.\r\n   */\r\n  public setPageData(data: SeoData) {\r\n    if (isPlatformServer(this.platformId)) {\r\n      this.transferState.set(SEO_DATA_KEY, data);\r\n    }\r\n\r\n    const { \r\n        title, \r\n        description, \r\n        imageUrl, \r\n        type = 'website', \r\n        keywords, \r\n        schema,\r\n        url,\r\n        author,\r\n        twitterCard = 'summary_large_image'\r\n    } = data;\r\n    \r\n    // 1. Set Browser Title\r\n    const finalTitle = title.includes('|') || title.includes('Arecofix') ? title : `${title} | Arecofix`;\r\n    this.titleService.setTitle(finalTitle);\r\n\r\n    // 2. Set Meta Description\r\n    this.metaService.updateTag({ name: 'description', content: description });\r\n\r\n    // 3. Keywords\r\n    if (keywords) {\r\n      this.metaService.updateTag({ name: 'keywords', content: keywords });\r\n    }\r\n\r\n    // 4. Author\r\n    if (author) {\r\n        this.metaService.updateTag({ name: 'author', content: author });\r\n    }\r\n\r\n    // 5. Construct Canonical & Image URLs absolutely\r\n    const currentPath = url || this.router.url.split('?')[0]; // discard query params from canonical\r\n    const finalUrl = currentPath.startsWith('http') ? currentPath : `${environment.baseUrl}${currentPath}`;\r\n    \r\n    let finalImageUrl = `${environment.baseUrl}/assets/img/branding/og-services.jpg`; // Default absolute image\r\n    if (imageUrl) {\r\n        if (imageUrl.startsWith('http')) {\r\n            finalImageUrl = imageUrl;\r\n        } else {\r\n            const cleanPath = imageUrl.startsWith('/') ? imageUrl.substring(1) : imageUrl;\r\n            finalImageUrl = `${environment.baseUrl}/${cleanPath}`;\r\n        }\r\n    }\r\n\r\n    // 6. Set Social Media Tags (Open Graph)\r\n    this.metaService.updateTag({ property: 'og:title', content: finalTitle });\r\n    this.metaService.updateTag({ property: 'og:description', content: description });\r\n    this.metaService.updateTag({ property: 'og:type', content: type });\r\n    this.metaService.updateTag({ property: 'og:url', content: finalUrl });\r\n    this.metaService.updateTag({ property: 'og:image', content: finalImageUrl });\r\n    if (finalImageUrl.startsWith('https')) {\r\n        this.metaService.updateTag({ property: 'og:image:secure_url', content: finalImageUrl });\r\n    }\r\n    this.metaService.updateTag({ property: 'og:site_name', content: 'Arecofix' });\r\n\r\n    // 7. Twitter Cards\r\n    this.metaService.updateTag({ name: 'twitter:card', content: twitterCard });\r\n    this.metaService.updateTag({ name: 'twitter:title', content: finalTitle });\r\n    this.metaService.updateTag({ name: 'twitter:description', content: description });\r\n    this.metaService.updateTag({ name: 'twitter:image', content: finalImageUrl });\r\n\r\n    // 8. Canonical URL\r\n    this.setCanonicalUrl(finalUrl);\r\n\r\n    // 9. Structured Data (JSON-LD)\r\n    if (schema) {\r\n      this.injectJsonLd(schema);\r\n    } else {\r\n        this.removeJsonLd();\r\n    }\r\n  }\r\n\r\n  private setCanonicalUrl(url: string) {\r\n    let link: HTMLLinkElement | null = this.document.querySelector('link[rel=\"canonical\"]');\r\n    if (!link) {\r\n        link = this.document.createElement('link');\r\n        link.setAttribute('rel', 'canonical');\r\n        this.document.head.appendChild(link);\r\n    }\r\n    link.setAttribute('href', url);\r\n  }\r\n\r\n  private injectJsonLd(schema: Record<string, any>) {\r\n    const scriptId = 'json-ld-schema';\r\n    let script = this.document.getElementById(scriptId) as HTMLScriptElement;\r\n\r\n    if (!script) {\r\n        script = this.document.createElement('script');\r\n        script.id = scriptId;\r\n        script.type = 'application/ld+json';\r\n        this.document.head.appendChild(script);\r\n    }\r\n\r\n    script.text = JSON.stringify(schema);\r\n  }\r\n\r\n  private removeJsonLd() {\r\n    const script = this.document.getElementById('json-ld-schema');\r\n    if (script) {\r\n      script.remove();\r\n    }\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
