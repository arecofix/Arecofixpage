{
  "version": 3,
  "sources": ["src/app/public/categories/services/category.service.ts"],
  "sourcesContent": ["import { inject, Injectable } from '@angular/core';\r\nimport { Observable, from, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { SupabaseClient } from '@supabase/supabase-js';\r\nimport { AuthService } from '@app/core/services/auth.service';\r\nimport { LoggerService } from '@app/core/services/logger.service';\r\n\r\nimport {\r\n  iCategoriesResponse,\r\n  iRequestParams,\r\n  iCategory,\r\n} from '@app/public/categories/interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class CategoryService {\r\n  private supabase: SupabaseClient;\r\n  private logger = inject(LoggerService);\r\n\r\n  constructor(private authService: AuthService) {\r\n    this.supabase = this.authService.getSupabaseClient();\r\n  }\r\n\r\n  private processResponse(data: any[], count: number | null, params: { _page: number; _per_page: number }): iCategoriesResponse {\r\n    const totalItems = count || data.length;\r\n    const perPage = params._per_page > 0 ? params._per_page : totalItems;\r\n    const pages = Math.max(1, Math.ceil(totalItems / (perPage || 1)));\r\n\r\n    return {\r\n      first: 1,\r\n      prev: params._page > 1 ? params._page - 1 : null,\r\n      next: params._page < pages ? params._page + 1 : null,\r\n      last: pages,\r\n      pages,\r\n      items: totalItems,\r\n      data: data as iCategory[],\r\n    };\r\n  }\r\n\r\n  public getData(params: iRequestParams): Observable<iCategoriesResponse> {\r\n    const { _page = 1, _per_page = 10 } = params;\r\n    const start = (_page - 1) * _per_page;\r\n    const end = start + _per_page - 1;\r\n\r\n    return from(\r\n      this.supabase\r\n        .from('categories')\r\n        .select('*', { count: 'exact' })\r\n        .eq('is_active', true)\r\n        .range(start, end)\r\n    ).pipe(\r\n      map(({ data, count, error }) => {\r\n        if (error) throw error;\r\n        return this.processResponse(data || [], count, { _page, _per_page });\r\n      }),\r\n      catchError((err) => {\r\n        this.logger.error('Supabase Error:', err);\r\n        return of({ first: 1, prev: null, next: null, last: 1, pages: 1, items: 0, data: [] });\r\n      })\r\n    );\r\n  }\r\n\r\n  public getFeaturedData(): Observable<iCategoriesResponse> {\r\n    // Assuming featured means something specific or just top categories\r\n    // For now, let's just get the first 3\r\n    const _page = 1;\r\n    const _per_page = 100;\r\n\r\n    return from(\r\n      this.supabase\r\n        .from('categories')\r\n        .select('*', { count: 'exact' })\r\n        .eq('is_active', true)\r\n        .order('name')\r\n        .limit(_per_page)\r\n    ).pipe(\r\n      map(({ data, count, error }) => {\r\n        if (error) throw error;\r\n        return this.processResponse(data || [], count, { _page, _per_page });\r\n      }),\r\n      catchError((err) => {\r\n        this.logger.error('Supabase Error:', err);\r\n        return of({ first: 1, prev: null, next: null, last: 1, pages: 1, items: 0, data: [] });\r\n      })\r\n    );\r\n  }\r\n\r\n  public getDataBySlug(slug: string): Observable<iCategoriesResponse> {\r\n    return from(\r\n      this.supabase\r\n        .from('categories')\r\n        .select('*')\r\n        .eq('slug', slug)\r\n        .limit(1)\r\n    ).pipe(\r\n      map(({ data, error }) => {\r\n        if (error) throw error;\r\n        // Data is an array now\r\n        return this.processResponse(data || [], data?.length || 0, { _page: 1, _per_page: 1 });\r\n      }),\r\n      catchError((err) => {\r\n        this.logger.error('Supabase Error:', err);\r\n        return of({ first: 1, prev: null, next: null, last: 1, pages: 1, items: 0, data: [] });\r\n      })\r\n    );\r\n  }\r\n\r\n  public getById(id: string): Observable<iCategory | null> {\r\n    if (!id || id === 'null') return of(null);\r\n    return from(\r\n      this.supabase\r\n        .from('categories')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .single()\r\n    ).pipe(\r\n      map(({ data, error }) => {\r\n        if (error) throw error;\r\n        return data as iCategory;\r\n      }),\r\n      catchError((err) => {\r\n        this.logger.error('Supabase Error:', err);\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
