import{b as j,d as D,e as L,f as B,g as I,h as q,l as O,m as R,n as U,p as V,r as k}from"./chunk-67JN6MIM.js";import{a as T}from"./chunk-ETUYVYEI.js";import"./chunk-23BTM2IY.js";import{a as W,c as N,d as x}from"./chunk-ZWPO54DG.js";import"./chunk-SH266SLM.js";import"./chunk-Z5OW2DIK.js";import{p as F}from"./chunk-DTICAINP.js";import{Ca as M,Fa as r,Fb as o,Gb as P,Hb as A,Jb as s,Kb as p,Lb as g,Ta as w,W as c,eb as _,fb as h,kb as y,lb as i,ma as u,mb as n,nb as f,vb as v,xb as E}from"./chunk-RGAVNK56.js";import{a as b,b as C}from"./chunk-VOSPIT4N.js";function J(l,m){if(l&1&&(i(0,"div",6),f(1,"i",26),i(2,"span"),o(3),n()()),l&2){let a=E();r(3),P(a.error())}}function K(l,m){if(l&1&&(i(0,"div",21),f(1,"img",27),n()),l&2){let a=E();r(),y("src",a.form().avatar_url,M)}}function Q(l,m){l&1&&f(0,"span",25)}var G=class l{route=c(W);router=c(N);auth=c(T);id=null;form=u({first_name:"",last_name:"",email:"",phone:"",role:"staff",job_title:"",avatar_url:""});loading=u(!0);saving=u(!1);error=u(null);async ngOnInit(){if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let m=this.auth.getSupabaseClient(),{data:a,error:e}=await m.from("profiles").select("*").eq("id",this.id).single();a&&this.form.set({first_name:a.first_name||"",last_name:a.last_name||"",email:a.email||"",phone:a.phone||"",role:a.role||"staff",job_title:a.job_title||"",avatar_url:a.avatar_url||""})}this.loading.set(!1)}async onFileChange(m){let a=m.target.files?.[0];if(!a)return;let e=this.auth.getSupabaseClient(),d=`avatars/${Date.now()}-${a.name}`,{data:t,error:S}=await e.storage.from("public-assets").upload(d,a);if(S){this.error.set(S.message);return}let{data:z}=e.storage.from("public-assets").getPublicUrl(t.path);this.form.update(H=>C(b({},H),{avatar_url:z.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null);let m=this.auth.getSupabaseClient(),a=b({},this.form());try{if(this.id){let{error:e}=await m.from("profiles").update(a).eq("id",this.id);if(e)throw e}else throw new Error("Creaci\xF3n de nuevos empleados debe hacerse desde el registro o invitaci\xF3n.");this.router.navigate(["/admin/employees"])}catch(e){this.error.set(e.message)}finally{this.saving.set(!1)}}static \u0275fac=function(a){return new(a||l)};static \u0275cmp=w({type:l,selectors:[["app-admin-employee-form-page"]],decls:52,vars:12,consts:[[1,"max-w-2xl","mx-auto"],[1,"flex","items-center","gap-4","mb-6"],["routerLink","/admin/employees",1,"btn","btn-circle","btn-ghost"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","text-gray-800"],[1,"bg-white","rounded-lg","shadow","p-6"],[1,"alert","alert-error","mb-4"],[1,"space-y-4",3,"ngSubmit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"form-control"],[1,"label"],["type","text","name","first_name","required","",1,"input","input-bordered",3,"ngModelChange","ngModel"],["type","text","name","last_name","required","",1,"input","input-bordered",3,"ngModelChange","ngModel"],["type","email","name","email",1,"input","input-bordered",3,"ngModelChange","ngModel","disabled"],["name","role",1,"select","select-bordered",3,"ngModelChange","ngModel"],["value","admin"],["value","staff"],["value","user"],["type","text","name","job_title","placeholder","Ej: T\xE9cnico, Vendedor",1,"input","input-bordered",3,"ngModelChange","ngModel"],["type","text","name","phone",1,"input","input-bordered",3,"ngModelChange","ngModel"],["type","file","accept","image/*",1,"file-input","file-input-bordered","w-full",3,"change"],[1,"mt-4"],[1,"flex","justify-end","gap-4","mt-6"],["routerLink","/admin/employees",1,"btn","btn-ghost"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"loading","loading-spinner"],[1,"fas","fa-exclamation-circle"],["alt","Avatar preview",1,"w-20","h-20","rounded-full","object-cover","border","p-1",3,"src"]],template:function(a,e){a&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(3,"i",3),n(),i(4,"h1",4),o(5),n()(),i(6,"div",5),_(7,J,4,1,"div",6),i(8,"form",7),v("ngSubmit",function(){return e.save()}),i(9,"div",8)(10,"div",9)(11,"label",10),o(12,"Nombre"),n(),i(13,"input",11),g("ngModelChange",function(t){return p(e.form().first_name,t)||(e.form().first_name=t),t}),n()(),i(14,"div",9)(15,"label",10),o(16,"Apellido"),n(),i(17,"input",12),g("ngModelChange",function(t){return p(e.form().last_name,t)||(e.form().last_name=t),t}),n()()(),i(18,"div",9)(19,"label",10),o(20,"Email"),n(),i(21,"input",13),g("ngModelChange",function(t){return p(e.form().email,t)||(e.form().email=t),t}),n()(),i(22,"div",8)(23,"div",9)(24,"label",10),o(25,"Rol"),n(),i(26,"select",14),g("ngModelChange",function(t){return p(e.form().role,t)||(e.form().role=t),t}),i(27,"option",15),o(28,"Administrador"),n(),i(29,"option",16),o(30,"Staff / Empleado"),n(),i(31,"option",17),o(32,"Usuario (Degradar)"),n()()(),i(33,"div",9)(34,"label",10),o(35,"Cargo"),n(),i(36,"input",18),g("ngModelChange",function(t){return p(e.form().job_title,t)||(e.form().job_title=t),t}),n()()(),i(37,"div",9)(38,"label",10),o(39,"Tel\xE9fono"),n(),i(40,"input",19),g("ngModelChange",function(t){return p(e.form().phone,t)||(e.form().phone=t),t}),n()(),i(41,"div",9)(42,"label",10),o(43,"Foto de Perfil"),n(),i(44,"input",20),v("change",function(t){return e.onFileChange(t)}),n(),_(45,K,2,1,"div",21),n(),i(46,"div",22)(47,"a",23),o(48,"Cancelar"),n(),i(49,"button",24),_(50,Q,1,0,"span",25),o(51," Guardar "),n()()()()()),a&2&&(r(5),A("",e.id?"Editar":"Nuevo"," Empleado"),r(2),h(e.error()?7:-1),r(6),s("ngModel",e.form().first_name),r(4),s("ngModel",e.form().last_name),r(4),s("ngModel",e.form().email),y("disabled",!!e.id),r(5),s("ngModel",e.form().role),r(10),s("ngModel",e.form().job_title),r(4),s("ngModel",e.form().phone),r(5),h(e.form().avatar_url?45:-1),r(4),y("disabled",e.saving()),r(),h(e.saving()?50:-1))},dependencies:[F,k,q,R,U,j,O,D,L,V,I,B,x],encapsulation:2})};export{G as AdminEmployeeFormPage};
