import{a as $}from"./chunk-WBABWZAJ.js";import{a as G,b as j,d as q,e as O,f as R,g as U,h as z,i as J,l as K,m as H,n as Q,o as X,p as Y,r as Z}from"./chunk-GSH74JW6.js";import"./chunk-ZT4MGTUK.js";import{a as B,c as I,d as L}from"./chunk-VKJMBSB6.js";import"./chunk-7QORBSNT.js";import"./chunk-QGSRP5SS.js";import{m as D}from"./chunk-KW2FFXRI.js";import{$ as c,Aa as V,Bb as o,Cb as k,Da as l,Db as T,Fb as u,Gb as p,Hb as f,Qa as A,V as h,_ as s,ab as b,bb as v,db as W,eb as M,ec as N,fb as E,gb as P,hb as i,ib as n,jb as _,la as y,nb as x,rb as C,tb as F}from"./chunk-VQO264VU.js";import{a as S,b as w}from"./chunk-VOSPIT4N.js";var ee=(d,t)=>t.id;function ie(d,t){if(d&1&&(i(0,"option",18),o(1),n()),d&2){let a=t.$implicit;P("value",a.id),l(),k(a.name)}}function ne(d,t){if(d&1&&(i(0,"option",18),o(1),n()),d&2){let a=t.$implicit;P("value",a.id),l(),k(a.name)}}function re(d,t){d&1&&(i(0,"span",38),o(1,"Principal"),n())}function ae(d,t){if(d&1){let a=x();i(0,"div",33),_(1,"img",34),i(2,"div",35)(3,"button",36),C("click",function(){let m=s(a).$index,g=F(2);return c(g.removeImage(m))}),_(4,"i",37),n()(),b(5,re,2,0,"span",38),n()}if(d&2){let a=t.$implicit,e=t.$index;l(),P("src",a,V),l(4),v(e===0?5:-1)}}function oe(d,t){if(d&1&&(i(0,"div",28),M(1,ae,6,2,"div",33,W),n()),d&2){let a=F();l(),E(a.form().images)}}function de(d,t){if(d&1&&(i(0,"div",29),_(1,"i",39),i(2,"span"),o(3),n()()),d&2){let a=F();l(3),k(a.error)}}function le(d,t){d&1&&(_(0,"span",40),o(1," Subiendo... "))}function me(d,t){d&1&&(_(0,"span",40),o(1," Guardando... "))}function se(d,t){d&1&&o(0," Guardar Producto ")}var te=class d{route=h(B);router=h(I);productService=h($);cdr=h(N);id=null;form=y({sku:"",barcode:"",name:"",slug:"",description:"",price:0,stock:0,brand_id:"",category_id:"",is_active:!0,images:[]},{});brands=y([],{});categories=y([],{});loading=!0;saving=!1;uploading=y(!1,{});error=null;async ngOnInit(){try{let[t,a]=await Promise.all([this.productService.getBrands(),this.productService.getCategories()]);if(this.brands.set(t),this.categories.set(a),this.id=this.route.snapshot.paramMap.get("id"),this.id){let e=await this.productService.getProduct(this.id);e&&this.form.set({sku:e.sku||"",barcode:e.barcode||"",name:e.name||"",slug:e.slug||"",description:e.description||"",price:e.price||0,stock:e.stock||0,brand_id:e.brand_id||"",category_id:e.category_id||"",is_active:e.is_active??!0,images:e.gallery_urls||(e.image_url?[e.image_url]:[])})}}catch(t){this.error=t.message||"Error al cargar datos"}finally{this.loading=!1,this.cdr.markForCheck()}}async onFileChange(t){let a=t.target.files?.[0];if(a){this.uploading.set(!0);try{let e=await this.productService.uploadImage(a);this.form.update(m=>w(S({},m),{images:[...m.images,e]}))}catch(e){this.error=e.message}finally{this.uploading.set(!1),this.cdr.markForCheck()}}}removeImage(t){this.form.update(a=>w(S({},a),{images:a.images.filter((e,m)=>m!==t)})),this.cdr.markForCheck()}generateBarcode(){let t=this.form().sku,a=t||`GEN-${Date.now()}`;this.form.update(e=>w(S({},e),{barcode:a}))}async save(){this.saving=!0,this.error=null;let t=this.form(),a=t.slug;a||(a=this.productService.slugify(t.name));let e={sku:t.sku,barcode:t.barcode,name:t.name,slug:a,description:t.description,price:t.price,stock:t.stock,brand_id:t.brand_id||null,category_id:t.category_id||null,is_active:t.is_active,gallery_urls:Array.isArray(t.images)?t.images:[],image_url:t.images.length>0?t.images[0]:null};try{this.id?await this.productService.updateProduct(this.id,e):await this.productService.createProduct(e),this.router.navigate(["/admin/products"])}catch(m){this.error=m.message||"Error al guardar producto"}finally{this.saving=!1,this.cdr.markForCheck()}}static \u0275fac=function(a){return new(a||d)};static \u0275cmp=A({type:d,selectors:[["app-admin-product-form-page"]],decls:84,vars:14,consts:[["f","ngForm"],[1,"max-w-4xl","mx-auto","text-gray-800"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-800"],[3,"ngSubmit"],[1,"admin-form-section"],[1,"text-lg","font-semibold","mb-4","text-gray-800","border-b","pb-2"],[1,"mb-4"],[1,"admin-form-label"],["type","text","name","name","placeholder","Ej: iPhone 13 Pro Max","required","",1,"admin-form-input",3,"ngModelChange","ngModel"],[1,"admin-form-grid"],["type","text","name","sku","placeholder","C\xF3digo interno",1,"admin-form-input",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],["type","text","name","barcode","placeholder","EAN / UPC",1,"admin-form-input",3,"ngModelChange","ngModel"],["type","button","title","Generar c\xF3digo aleatorio",1,"btn","btn-square","btn-outline",3,"click"],[1,"fas","fa-random"],["name","brand_id",1,"admin-form-select",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["name","category_id",1,"admin-form-select",3,"ngModelChange","ngModel"],["name","description","rows","4","placeholder","Detalles t\xE9cnicos, caracter\xEDsticas...",1,"admin-form-textarea",3,"ngModelChange","ngModel"],["type","number","name","price","required","","min","0",1,"admin-form-input",3,"ngModelChange","ngModel"],["type","number","name","stock","min","0",1,"admin-form-input",3,"ngModelChange","ngModel"],[1,"admin-form-checkbox-container","w-fit"],["type","checkbox","name","is_active",1,"checkbox","checkbox-primary","admin-form-checkbox",3,"ngModelChange","ngModel"],[1,"font-medium","text-gray-700"],["type","file","accept","image/*","multiple","",1,"file-input","file-input-bordered","file-input-primary","admin-form-file",3,"change"],[1,"text-sm","text-gray-500","mt-2"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mt-6"],[1,"alert","alert-error","mb-6"],[1,"flex","gap-4","justify-end"],["routerLink","/admin/products",1,"btn","btn-ghost"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"relative","group","aspect-square"],[1,"w-full","h-full","object-cover","rounded-lg","border","border-gray-200","shadow-sm",3,"src"],[1,"absolute","inset-0","bg-black/40","opacity-0","group-hover:opacity-100","transition-opacity","rounded-lg","flex","items-center","justify-center"],["type","button",1,"btn","btn-circle","btn-error","btn-sm","text-white",3,"click"],[1,"fas","fa-trash"],[1,"absolute","bottom-2","left-2","badge","badge-primary","badge-sm","shadow-md"],[1,"fas","fa-exclamation-circle"],[1,"loading","loading-spinner","loading-xs","mr-2"]],template:function(a,e){if(a&1){let m=x();i(0,"div",1)(1,"div",2)(2,"h2",3),o(3),n()(),i(4,"form",4,0),C("ngSubmit",function(){return s(m),c(e.save())}),i(6,"div",5)(7,"h3",6),o(8,"Informaci\xF3n B\xE1sica"),n(),i(9,"div",7)(10,"label",8),o(11,"Nombre del Producto"),n(),i(12,"input",9),f("ngModelChange",function(r){return s(m),p(e.form().name,r)||(e.form().name=r),c(r)}),n()(),i(13,"div",10)(14,"div")(15,"label",8),o(16,"SKU"),n(),i(17,"input",11),f("ngModelChange",function(r){return s(m),p(e.form().sku,r)||(e.form().sku=r),c(r)}),n()(),i(18,"div")(19,"label",8),o(20,"C\xF3digo de Barras"),n(),i(21,"div",12)(22,"input",13),f("ngModelChange",function(r){return s(m),p(e.form().barcode,r)||(e.form().barcode=r),c(r)}),n(),i(23,"button",14),C("click",function(){return s(m),c(e.generateBarcode())}),_(24,"i",15),n()()()()(),i(25,"div",5)(26,"h3",6),o(27,"Categorizaci\xF3n"),n(),i(28,"div",10)(29,"div")(30,"label",8),o(31,"Marca"),n(),i(32,"select",16),f("ngModelChange",function(r){return s(m),p(e.form().brand_id,r)||(e.form().brand_id=r),c(r)}),i(33,"option",17),o(34,"Seleccionar Marca"),n(),M(35,ie,2,2,"option",18,ee),n()(),i(37,"div")(38,"label",8),o(39,"Categor\xEDa"),n(),i(40,"select",19),f("ngModelChange",function(r){return s(m),p(e.form().category_id,r)||(e.form().category_id=r),c(r)}),i(41,"option",17),o(42,"Seleccionar Categor\xEDa"),n(),M(43,ne,2,2,"option",18,ee),n()()()(),i(45,"div",5)(46,"h3",6),o(47,"Detalles"),n(),i(48,"div",7)(49,"label",8),o(50,"Descripci\xF3n"),n(),i(51,"textarea",20),f("ngModelChange",function(r){return s(m),p(e.form().description,r)||(e.form().description=r),c(r)}),n()(),i(52,"div",10)(53,"div")(54,"label",8),o(55,"Precio ($)"),n(),i(56,"input",21),f("ngModelChange",function(r){return s(m),p(e.form().price,r)||(e.form().price=r),c(r)}),n()(),i(57,"div")(58,"label",8),o(59,"Stock"),n(),i(60,"input",22),f("ngModelChange",function(r){return s(m),p(e.form().stock,r)||(e.form().stock=r),c(r)}),n()()()(),i(61,"div",5)(62,"label",23)(63,"input",24),f("ngModelChange",function(r){return s(m),p(e.form().is_active,r)||(e.form().is_active=r),c(r)}),n(),i(64,"span",25),o(65,"Producto Activo"),n()()(),i(66,"div",5)(67,"h3",6),o(68,"Galer\xEDa de Im\xE1genes"),n(),i(69,"div",7)(70,"label",8),o(71,"Subir Im\xE1genes"),n(),i(72,"input",26),C("change",function(r){return s(m),c(e.onFileChange(r))}),n(),i(73,"p",27),o(74,"Formatos soportados: JPG, PNG, WEBP."),n()(),b(75,oe,3,0,"div",28),n(),b(76,de,4,1,"div",29),i(77,"div",30)(78,"a",31),o(79,"Cancelar"),n(),i(80,"button",32),b(81,le,2,0)(82,me,2,0)(83,se,1,0),n()()()()}a&2&&(l(3),T("",e.id?"Editar":"Nuevo"," Producto"),l(9),u("ngModel",e.form().name),l(5),u("ngModel",e.form().sku),l(5),u("ngModel",e.form().barcode),l(10),u("ngModel",e.form().brand_id),l(3),E(e.brands()),l(5),u("ngModel",e.form().category_id),l(3),E(e.categories()),l(8),u("ngModel",e.form().description),l(5),u("ngModel",e.form().price),l(4),u("ngModel",e.form().stock),l(3),u("ngModel",e.form().is_active),l(12),v(e.form().images.length>0?75:-1),l(),v(e.error?76:-1),l(4),P("disabled",e.saving||e.uploading()),l(),v(e.uploading()?81:e.saving?82:83))},dependencies:[D,Z,z,H,Q,j,J,G,K,q,O,Y,X,U,R,L],encapsulation:2,changeDetection:0})};export{te as AdminProductFormPage};
