import{a as b,d as w}from"./chunk-UFOBHB2H.js";import{a as I}from"./chunk-JYOT3LNB.js";import"./chunk-F5WBDNED.js";import{a as x}from"./chunk-F4YL3ILH.js";import{B as k,j as D,l as A}from"./chunk-RVT6AV4G.js";import{Ab as e,Bb as a,Cb as n,Ob as y,Ua as s,W as C,Xb as i,Yb as c,gb as S,ma as g,nc as E,oc as _,tb as f,ub as v,zb as h}from"./chunk-G4WDTWI7.js";import"./chunk-7CGTOI24.js";var d={primary:"#4f46e5",primaryTransparent:"rgba(79, 70, 229, 0.2)",red:"#ef4444",blue:"#3b82f6",green:"#10b981",yellow:"#f59e0b",purple:"#8b5cf6",pink:"#ec4899",indigo:"#6366f1",palette:["#ef4444","#3b82f6","#10b981","#f59e0b","#8b5cf6","#6366f1","#ec4899"],paletteAlt:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#6366f1"]};function P(r,o){r&1&&(e(0,"div",2),n(1,"span",3),a())}function O(r,o){if(r&1&&(n(0,"div",44),e(1,"div",45)(2,"div",46)(3,"span",47),n(4,"i",48),e(5,"span"),i(6,"Sesi\xF3n Actual"),a()(),e(7,"span",49),i(8),a()(),e(9,"div",46)(10,"span",47),n(11,"i",50),e(12,"span"),i(13,"Usuario"),a()(),e(14,"span",51),i(15),a()(),e(16,"a",52),n(17,"i",53),i(18," Ver Dashboard Completo "),a()()),r&2){let t=y(2);s(8),c(t.analyticsStats().sessionId?"Activa":"N/A"),s(7),c(t.analyticsStats().distinctId||"An\xF3nimo")}}function M(r,o){r&1&&(e(0,"div",43),n(1,"i",54),e(2,"span"),i(3,"PostHog no est\xE1 inicializado correctamente"),a()())}function R(r,o){if(r&1&&(e(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7),n(4,"i",8),a(),e(5,"div",9),i(6,"Usuarios"),a(),e(7,"div",10),i(8),a(),e(9,"div",11),i(10,"Registrados"),a()()(),e(11,"div",5)(12,"div",6)(13,"div",12),n(14,"i",13),a(),e(15,"div",9),i(16,"Productos"),a(),e(17,"div",14),i(18),a(),e(19,"div",11),i(20,"En cat\xE1logo"),a()()(),e(21,"div",5)(22,"div",6)(23,"div",15),n(24,"i",16),a(),e(25,"div",9),i(26,"Ventas"),a(),e(27,"div",17),i(28),a(),e(29,"div",11),i(30,"Total realizadas"),a()()(),e(31,"div",5)(32,"div",6)(33,"div",18),n(34,"i",19),a(),e(35,"div",9),i(36,"Ingresos"),a(),e(37,"div",20),i(38),E(39,"currency"),a(),e(40,"div",11),i(41,"Total facturado"),a()()()(),e(42,"div",21)(43,"div",22)(44,"div",23)(45,"h2",24),i(46,"Resumen de Ventas"),a(),e(47,"div",25),n(48,"canvas",26),a()()(),e(49,"div",27)(50,"div",23)(51,"h2",24),i(52,"Productos Top"),a(),e(53,"div",28),n(54,"canvas",26),a()()(),e(55,"div",27)(56,"div",23)(57,"h2",24),i(58,"Ventas por Categor\xEDa"),a(),e(59,"div",29),n(60,"canvas",26),a()()()(),e(61,"div",30)(62,"div",27)(63,"div",23)(64,"h2",24),i(65,"Acciones R\xE1pidas"),a(),e(66,"div",31)(67,"a",32),n(68,"i",33),i(69," Nuevo Producto "),a(),e(70,"a",34),n(71,"i",35),i(72," Nueva Venta "),a(),e(73,"a",36),n(74,"i",37),i(75," Gestionar Usuarios "),a(),e(76,"a",38),n(77,"i",39),i(78," Taller "),a()()()(),e(79,"div",27)(80,"div",23)(81,"h2",24),i(82,"Analytics & Sistema"),a(),e(83,"div",40)(84,"div",41)(85,"span"),i(86,"Base de Datos"),a(),e(87,"span",42),i(88,"Conectado"),a()(),e(89,"div",41)(90,"span"),i(91,"Analytics (PostHog)"),a(),e(92,"span",42),i(93),a()(),f(94,O,19,2)(95,M,4,0,"div",43),a()()()()),r&2){let t=y();s(8),c(t.stats().users),s(10),c(t.stats().products),s(10),c(t.stats().sales),s(10),c(_(39,15,t.stats().revenue)),s(10),h("data",t.salesChartData)("options",t.salesChartOptions)("type",t.salesChartType),s(6),h("data",t.productsChartData)("options",t.productsChartOptions)("type",t.productsChartType),s(6),h("data",t.categoryChartData)("options",t.categoryChartOptions)("type",t.categoryChartType),s(33),c(t.posthogStatus()),s(),v(t.analyticsStats().enabled?94:95)}}var T=class r{auth=C(I);stats=g({users:0,products:0,sales:0,revenue:0});analyticsStats=g({enabled:!1,sessionId:"",distinctId:""});loading=g(!0);salesChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom"},title:{display:!0,text:"Ventas del A\xF1o"}}};salesChartType="line";salesChartData={labels:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],datasets:[{data:[65,59,80,81,56,55,40,70,90,100,110,120],label:"Ventas ($)",borderColor:d.primary,backgroundColor:d.primaryTransparent,fill:!0}]};productsChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Productos M\xE1s Vendidos"}}};productsChartType="bar";productsChartData={labels:["iPhone 11","Samsung A52","Modulo iPhone X","Cargador 20W","Funda Silicona"],datasets:[{data:[28,48,40,19,86],label:"Unidades",backgroundColor:d.palette}]};categoryChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"right"},title:{display:!0,text:"Ventas por Categor\xEDa"}}};categoryChartType="doughnut";categoryChartData={labels:["Repuestos","Accesorios","Servicios","Cursos"],datasets:[{data:[300,500,100,50],backgroundColor:d.paletteAlt}]};async ngOnInit(){await this.loadStats(),this.loadAnalyticsInfo()}async loadStats(){this.loading.set(!0);let o=this.auth.getSupabaseClient();try{let{data:t,error:m}=await o.rpc("get_dashboard_stats");if(m)throw m;if(t){if(this.stats.set({users:t.users||0,products:t.products||0,sales:t.sales||0,revenue:t.revenue||0}),t.sales_chart&&t.sales_chart.length>0){let p=t.sales_chart.map(l=>this.formatMonth(l.period)),u=t.sales_chart.map(l=>l.total);this.salesChartData={labels:p,datasets:[{data:u,label:"Ventas ($)",borderColor:d.primary,backgroundColor:d.primaryTransparent,fill:!0}]}}if(t.products_chart&&t.products_chart.length>0){let p=t.products_chart.map(l=>l.name),u=t.products_chart.map(l=>l.quantity);this.productsChartData={labels:p,datasets:[{data:u,label:"Unidades",backgroundColor:d.palette}]}}if(t.category_chart&&t.category_chart.length>0){let p=t.category_chart.map(l=>l.name),u=t.category_chart.map(l=>l.count);this.categoryChartData={labels:p,datasets:[{data:u,backgroundColor:d.paletteAlt}]}}}}catch(t){console.error("Error loading dashboard stats:",t)}finally{this.loading.set(!1)}}formatMonth(o){let[t,m]=o.split("-");return new Date(parseInt(t),parseInt(m)-1,1).toLocaleDateString("es-ES",{month:"short"})}loadAnalyticsInfo(){try{x.posthogKey&&x.posthogKey!==""&&b?this.analyticsStats.set({enabled:!0,sessionId:b.get_session_id()||"",distinctId:b.get_distinct_id()||"An\xF3nimo"}):this.analyticsStats.set({enabled:!1,sessionId:"",distinctId:""})}catch(o){console.error("Error loading analytics info:",o),this.analyticsStats.set({enabled:!1,sessionId:"",distinctId:""})}}posthogStatus(){return this.analyticsStats().enabled?"Activo":"Inactivo"}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["app-admin-dashboard-page"]],decls:5,vars:1,consts:[[1,"p-6"],[1,"text-2xl","font-bold","mb-6","text-black","dark:text-green-400"],[1,"flex","justify-center","py-12"],[1,"loading","loading-spinner","loading-lg"],[1,"grid","grid-cols-2","lg:grid-cols-4","gap-6","mb-8"],[1,"stats","shadow","bg-base-100","dark:bg-gray-800","text-base-content","dark:text-white"],[1,"stat"],[1,"stat-figure","text-primary"],[1,"fas","fa-users","text-3xl"],[1,"stat-title","dark:text-gray-400"],[1,"stat-value","text-primary"],[1,"stat-desc","dark:text-gray-500"],[1,"stat-figure","text-secondary"],[1,"fas","fa-box","text-3xl"],[1,"stat-value","text-secondary"],[1,"stat-figure","text-accent"],[1,"fas","fa-shopping-cart","text-3xl"],[1,"stat-value","text-accent"],[1,"stat-figure","text-success"],[1,"fas","fa-dollar-sign","text-3xl"],[1,"stat-value","text-success"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-8"],[1,"card","shadow","lg:col-span-2","bg-base-100","dark:bg-gray-800","text-base-content","dark:text-white"],[1,"card-body"],[1,"card-title","mb-4"],[1,"h-80","w-full"],["baseChart","",3,"data","options","type"],[1,"card","shadow","bg-base-100","dark:bg-gray-800","text-base-content","dark:text-white"],[1,"h-64","w-full"],[1,"h-64","w-full","flex","justify-center"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"grid","grid-cols-2","gap-4"],["routerLink","/admin/products/new",1,"btn","btn-outline","btn-primary"],[1,"fas","fa-plus","mr-2"],["routerLink","/admin/sales",1,"btn","btn-outline","btn-accent"],[1,"fas","fa-cash-register","mr-2"],["routerLink","/admin/users",1,"btn","btn-outline","dark:text-white","dark:border-white","dark:hover:bg-white","dark:hover:text-gray-900"],[1,"fas","fa-user-plus","mr-2"],["routerLink","/admin/repairs",1,"btn","btn-outline","btn-secondary"],[1,"fas","fa-tools","mr-2"],[1,"space-y-4"],[1,"flex","justify-between","items-center"],[1,"badge","badge-success"],[1,"alert","alert-warning","text-xs","mt-4"],[1,"divider","my-2"],[1,"space-y-3"],[1,"flex","justify-between","items-center","text-sm"],[1,"flex","items-center","gap-2"],[1,"fas","fa-eye","text-info"],[1,"font-semibold"],[1,"fas","fa-user","text-primary"],[1,"font-semibold","text-xs"],["href","https://us.posthog.com/project/253677/dashboard/791256","target","_blank",1,"btn","btn-sm","btn-outline","btn-info","w-full","mt-2"],[1,"fas","fa-chart-line","mr-2"],[1,"fas","fa-exclamation-triangle"]],template:function(t,m){t&1&&(e(0,"div",0)(1,"h1",1),i(2,"Panel de Control"),a(),f(3,P,2,0,"div",2)(4,R,96,17),a()),t&2&&(s(3),v(m.loading()?3:4))},dependencies:[A,k,w,D],encapsulation:2})};export{T as AdminDashboardPage};
