import './polyfills.server.mjs';
import{i as H,m as J}from"./chunk-OEE6LMKQ.mjs";import{a as D,b as F,d as L,e as k,f as U,g as V,h as j,i as q,m as O,n as R,o as G,q as z,t as Z}from"./chunk-QBNUQKUT.mjs";import"./chunk-WO5P5INO.mjs";import"./chunk-35OYAJOP.mjs";import"./chunk-HT57LKWA.mjs";import"./chunk-VF3MFHMJ.mjs";import{$ as x,$b as E,Bb as W,Cb as T,Db as C,Eb as n,Fb as a,Gb as m,Kb as I,Ob as h,Qb as b,Ra as P,W as v,Wa as l,Xb as N,Zb as r,_b as S,aa as M,bc as g,cc as c,dc as p,ib as B,ma as u,xb as _,yb as f}from"./chunk-PUXVFRR7.mjs";import{a as w,b as A}from"./chunk-DGJQU3KY.mjs";var Y=(d,s)=>s.id;function $(d,s){if(d&1&&(n(0,"div",5),m(1,"i",61),n(2,"span"),r(3),a()()),d&2){let i=b();l(3),S(i.error())}}function ee(d,s){if(d&1&&(n(0,"div",6),m(1,"i",62),n(2,"span"),r(3),a()()),d&2){let i=b();l(3),S(i.success())}}function te(d,s){if(d&1&&(n(0,"div",39),m(1,"img",63),a()),d&2){let i=b();l(),C("src",i.form().logo_url,P)}}function ne(d,s){d&1&&m(0,"span",42)}function ae(d,s){if(d&1){let i=I();n(0,"tr")(1,"td",64),r(2),a(),n(3,"td"),r(4),a(),n(5,"td")(6,"button",65),h("click",function(){let o=x(i).$implicit,t=b();return M(t.toggleBranchStatus(o))}),r(7),a()(),n(8,"td",49)(9,"button",66),h("click",function(){let o=x(i).$implicit,t=b();return M(t.deleteBranch(o.id))}),m(10,"i",67),a()()()}if(d&2){let i=s.$implicit;l(2),S(i.name),l(2),S(i.address||"--"),l(2),N("badge-success",i.is_active)("badge-ghost",!i.is_active),l(),E(" ",i.is_active?"Activa":"Inactiva"," ")}}function ie(d,s){d&1&&(n(0,"tr")(1,"td",68),r(2,"No hay sucursales registradas."),a()())}function re(d,s){d&1&&m(0,"span",42)}var K=class d{auth=v(J);tenantService=v(H);form=u({id:"",name:"",owner_name:"",tax_id:"",ruc:"CUIT/CUIL",address:"",tax_percentage:21,tax_abbreviation:"IVA",email:"",phone:"",location:"",currency:"ARS",logo_url:""});loading=u(!0);saving=u(!1);error=u(null);success=u(null);branches=u([]);newBranch=u({name:"",address:"",is_active:!0});savingBranch=u(!1);async ngOnInit(){await this.loadSettings()}async loadSettings(){this.loading.set(!0);let s=this.auth.getSupabaseClient(),i=this.tenantService.getTenantId(),{data:e,error:o}=await s.from("tenants").select("*").eq("id",i).single();e?this.form.set({id:e.id,name:e.name,owner_name:e.owner_name||"",tax_id:e.tax_id||"",ruc:e.tax_id_name||"CUIT/CUIL",address:e.location||"",tax_percentage:e.tax_percentage||21,tax_abbreviation:e.tax_abbreviation||"IVA",email:e.contact_email||"",phone:e.contact_phone||"",location:e.location||"",currency:e.currency||"ARS",logo_url:e.branding_settings?.logo_url||""}):o&&o.code!=="PGRST116"&&this.error.set(o.message);let{data:t}=await s.from("branches").select("*").eq("tenant_id",i).order("name");this.branches.set(t||[]),this.loading.set(!1)}async onFileChange(s){let i=s.target.files?.[0];if(!i)return;let e=this.auth.getSupabaseClient(),o=`company/${Date.now()}-${i.name}`,{data:t,error:y}=await e.storage.from("public-assets").upload(o,i);if(y){this.error.set(y.message);return}let{data:Q}=e.storage.from("public-assets").getPublicUrl(t.path);this.form.update(X=>A(w({},X),{logo_url:Q.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null),this.success.set(null);let s=this.auth.getSupabaseClient(),i=w({},this.form()),e=this.tenantService.getTenantId(),o={name:i.name,owner_name:i.owner_name,tax_id:i.tax_id,tax_id_name:i.ruc,location:i.address||i.location,tax_percentage:i.tax_percentage,tax_abbreviation:i.tax_abbreviation,contact_email:i.email,contact_phone:i.phone,currency:i.currency,branding_settings:{logo_url:i.logo_url,primary_color:"#3b82f6"},updated_at:new Date().toISOString()};try{let{error:t}=await s.from("tenants").update(o).eq("id",e);if(t)throw t;let{data:y}=await s.from("tenants").select("*").eq("id",e).single();y&&this.tenantService.setTenant(y),this.success.set("Configuraci\xF3n de la empresa guardada correctamente"),await this.loadSettings()}catch(t){this.error.set(t.message)}finally{this.saving.set(!1)}}async addBranch(){let s=this.newBranch();if(!s.name){this.error.set("El nombre de la sucursal es obligatorio.");return}this.savingBranch.set(!0);let i=this.auth.getSupabaseClient(),e=this.tenantService.getTenantId();try{let{error:o}=await i.from("branches").insert([{name:s.name,address:s.address,is_active:s.is_active,tenant_id:e}]);if(o)throw o;this.success.set("Sucursal agregada con \xE9xito"),this.newBranch.set({name:"",address:"",is_active:!0}),await this.loadSettings()}catch(o){this.error.set(o.message)}finally{this.savingBranch.set(!1)}}async deleteBranch(s){if(!confirm("\xBFSeguro que deseas eliminar esta sucursal?"))return;let i=this.auth.getSupabaseClient();try{let{error:e}=await i.from("branches").delete().eq("id",s);if(e)throw e;this.success.set("Sucursal eliminada"),await this.loadSettings()}catch(e){this.error.set(e.message)}}async toggleBranchStatus(s){let i=this.auth.getSupabaseClient();try{let{error:e}=await i.from("branches").update({is_active:!s.is_active}).eq("id",s.id);if(e)throw e;await this.loadSettings()}catch(e){this.error.set(e.message)}}static \u0275fac=function(i){return new(i||d)};static \u0275cmp=B({type:d,selectors:[["app-admin-company-settings-page"]],decls:151,vars:23,consts:[[1,"max-w-4xl","mx-auto"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold"],[1,"card","bg-base-100","shadow-lg"],[1,"card-body","p-6"],[1,"alert","alert-error","mb-4","shadow-sm"],[1,"alert","alert-success","mb-4","shadow-sm"],[1,"space-y-6",3,"ngSubmit"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"form-control"],[1,"label"],[1,"label-text","font-medium"],[1,"input","input-bordered","flex","items-center","gap-2"],[1,"fas","fa-building","text-gray-400"],["type","text","name","name","required","",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-user","text-gray-400"],["type","text","name","owner_name",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-id-card","text-gray-400"],["type","text","name","tax_id","placeholder","Ej: 20-12345678-9",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-map-marker-alt","text-gray-400"],["type","text","name","address",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-envelope","text-gray-400"],["type","email","name","email",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-phone","text-gray-400"],["type","text","name","phone",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-globe","text-gray-400"],["type","text","name","location","placeholder","Ej: Buenos Aires, Argentina",1,"grow",3,"ngModelChange","ngModel"],[1,"divider","text-sm","font-medium","text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"fas","fa-percent","text-gray-400"],["type","number","name","tax_percentage",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-tag","text-gray-400"],["type","text","name","tax_abbreviation","placeholder","Ej: IVA",1,"grow",3,"ngModelChange","ngModel"],[1,"fas","fa-fingerprint","text-gray-400"],["type","text","name","ruc_name","placeholder","Ej: CUIT, CUIL, RUC",1,"grow",3,"ngModelChange","ngModel"],["name","currency",1,"select","select-bordered","w-full",3,"ngModelChange","ngModel"],["value","ARS"],["value","USD"],["type","file","accept","image/*",1,"file-input","file-input-bordered","w-full",3,"change"],[1,"mt-4","p-4","border","rounded-lg","bg-base-200","flex","justify-center"],[1,"flex","justify-end","gap-4","mt-8","pt-4","border-t","border-base-200"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner"],[1,"card","bg-base-100","shadow-lg","mt-8"],[1,"text-xl","font-bold","mb-4"],[1,"text-gray-500","mb-6","text-sm"],[1,"overflow-x-auto","border","rounded-xl","mb-8"],[1,"table","table-zebra","w-full"],[1,"bg-base-200"],[1,"text-right"],[1,"bg-base-200","p-6","rounded-xl","border","border-base-300"],[1,"font-bold","text-lg","mb-4"],[1,"fas","fa-plus-circle","text-primary","mr-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","items-end"],[1,"label-text"],["type","text","placeholder","Ej: Zona Centro",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],["type","text","placeholder","Ej: San Martin 123",1,"input","input-bordered","w-full",3,"ngModelChange","ngModel"],[1,"mt-4","flex","items-center","justify-between"],[1,"cursor-pointer","label","flex","gap-2"],["type","checkbox",1,"checkbox","checkbox-primary",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-check-circle"],["alt","Logo preview",1,"h-32","object-contain",3,"src"],[1,"font-medium"],[1,"badge","cursor-pointer",3,"click"],["title","Eliminar",1,"btn","btn-ghost","btn-sm","text-error",3,"click"],[1,"fas","fa-trash"],["colspan","4",1,"text-center","py-4","text-gray-500"]],template:function(i,e){i&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),r(3,"Configuraci\xF3n de Empresa"),a()(),n(4,"div",3)(5,"div",4),_(6,$,4,1,"div",5),_(7,ee,4,1,"div",6),n(8,"form",7),h("ngSubmit",function(){return e.save()}),n(9,"div",8)(10,"div",9)(11,"label",10)(12,"span",11),r(13,"Nombre de la Empresa"),a()(),n(14,"label",12),m(15,"i",13),n(16,"input",14),p("ngModelChange",function(t){return c(e.form().name,t)||(e.form().name=t),t}),a()()(),n(17,"div",9)(18,"label",10)(19,"span",11),r(20,"Propietario"),a()(),n(21,"label",12),m(22,"i",15),n(23,"input",16),p("ngModelChange",function(t){return c(e.form().owner_name,t)||(e.form().owner_name=t),t}),a()()()(),n(24,"div",8)(25,"div",9)(26,"label",10)(27,"span",11),r(28),a()(),n(29,"label",12),m(30,"i",17),n(31,"input",18),p("ngModelChange",function(t){return c(e.form().tax_id,t)||(e.form().tax_id=t),t}),a()()(),n(32,"div",9)(33,"label",10)(34,"span",11),r(35,"Direcci\xF3n"),a()(),n(36,"label",12),m(37,"i",19),n(38,"input",20),p("ngModelChange",function(t){return c(e.form().address,t)||(e.form().address=t),t}),a()()()(),n(39,"div",8)(40,"div",9)(41,"label",10)(42,"span",11),r(43,"Email"),a()(),n(44,"label",12),m(45,"i",21),n(46,"input",22),p("ngModelChange",function(t){return c(e.form().email,t)||(e.form().email=t),t}),a()()(),n(47,"div",9)(48,"label",10)(49,"span",11),r(50,"Tel\xE9fono"),a()(),n(51,"label",12),m(52,"i",23),n(53,"input",24),p("ngModelChange",function(t){return c(e.form().phone,t)||(e.form().phone=t),t}),a()()()(),n(54,"div",9)(55,"label",10)(56,"span",11),r(57,"Ubicaci\xF3n"),a()(),n(58,"label",12),m(59,"i",25),n(60,"input",26),p("ngModelChange",function(t){return c(e.form().location,t)||(e.form().location=t),t}),a()()(),n(61,"div",27),r(62,"Configuraci\xF3n Fiscal"),a(),n(63,"div",28)(64,"div",9)(65,"label",10)(66,"span",11),r(67,"Porcentaje Impuesto (%)"),a()(),n(68,"label",12),m(69,"i",29),n(70,"input",30),p("ngModelChange",function(t){return c(e.form().tax_percentage,t)||(e.form().tax_percentage=t),t}),a()()(),n(71,"div",9)(72,"label",10)(73,"span",11),r(74,"Nombre del Impuesto"),a()(),n(75,"label",12),m(76,"i",31),n(77,"input",32),p("ngModelChange",function(t){return c(e.form().tax_abbreviation,t)||(e.form().tax_abbreviation=t),t}),a()()(),n(78,"div",9)(79,"label",10)(80,"span",11),r(81,"Nombre de Identificaci\xF3n"),a()(),n(82,"label",12),m(83,"i",33),n(84,"input",34),p("ngModelChange",function(t){return c(e.form().ruc,t)||(e.form().ruc=t),t}),a()()(),n(85,"div",9)(86,"label",10)(87,"span",11),r(88,"Moneda"),a()(),n(89,"select",35),p("ngModelChange",function(t){return c(e.form().currency,t)||(e.form().currency=t),t}),n(90,"option",36),r(91,"ARS (Peso Argentino)"),a(),n(92,"option",37),r(93,"USD (D\xF3lar Estadounidense)"),a()()()(),n(94,"div",27),r(95,"Branding"),a(),n(96,"div",9)(97,"label",10)(98,"span",11),r(99,"Logo de la Empresa"),a()(),n(100,"input",38),h("change",function(t){return e.onFileChange(t)}),a(),_(101,te,2,1,"div",39),a(),n(102,"div",40)(103,"button",41),_(104,ne,1,0,"span",42),r(105," Guardar Configuraci\xF3n "),a()()()()(),n(106,"div",43)(107,"div",4)(108,"h2",44),r(109,"Gesti\xF3n de Sucursales"),a(),n(110,"p",45),r(111,"Administra las ubicaciones f\xEDsicas de tu negocio. Estas podr\xE1n ser asignadas a reparaciones o inventario."),a(),n(112,"div",46)(113,"table",47)(114,"thead")(115,"tr",48)(116,"th"),r(117,"Nombre"),a(),n(118,"th"),r(119,"Direcci\xF3n"),a(),n(120,"th"),r(121,"Estado"),a(),n(122,"th",49),r(123,"Acciones"),a()()(),n(124,"tbody"),W(125,ae,11,7,"tr",null,Y),_(127,ie,3,0,"tr"),a()()(),n(128,"div",50)(129,"h3",51),m(130,"i",52),r(131,"Agregar Nueva Sucursal"),a(),n(132,"div",53)(133,"div",9)(134,"label",10)(135,"span",54),r(136,"Nombre de la Sucursal"),a()(),n(137,"input",55),p("ngModelChange",function(t){return c(e.newBranch().name,t)||(e.newBranch().name=t),t}),a()(),n(138,"div",9)(139,"label",10)(140,"span",54),r(141,"Direcci\xF3n (Opcional)"),a()(),n(142,"input",56),p("ngModelChange",function(t){return c(e.newBranch().address,t)||(e.newBranch().address=t),t}),a()()(),n(143,"div",57)(144,"label",58)(145,"input",59),p("ngModelChange",function(t){return c(e.newBranch().is_active,t)||(e.newBranch().is_active=t),t}),a(),n(146,"span",54),r(147,"Sucursal Activa"),a()(),n(148,"button",60),h("click",function(){return e.addBranch()}),_(149,re,1,0,"span",42),r(150," Agregar Sucursal "),a()()()()()()),i&2&&(l(6),f(e.error()?6:-1),l(),f(e.success()?7:-1),l(9),g("ngModel",e.form().name),l(7),g("ngModel",e.form().owner_name),l(5),E("",e.form().ruc," (N\xFAmero)"),l(3),g("ngModel",e.form().tax_id),l(7),g("ngModel",e.form().address),l(8),g("ngModel",e.form().email),l(7),g("ngModel",e.form().phone),l(7),g("ngModel",e.form().location),l(10),g("ngModel",e.form().tax_percentage),l(7),g("ngModel",e.form().tax_abbreviation),l(7),g("ngModel",e.form().ruc),l(5),g("ngModel",e.form().currency),l(12),f(e.form().logo_url?101:-1),l(2),C("disabled",e.saving()),l(),f(e.saving()?104:-1),l(21),T(e.branches()),l(2),f(e.branches().length===0?127:-1),l(10),g("ngModel",e.newBranch().name),l(5),g("ngModel",e.newBranch().address),l(3),g("ngModel",e.newBranch().is_active),l(3),C("disabled",e.savingBranch()||!e.newBranch().name),l(),f(e.savingBranch()?149:-1))},dependencies:[Z,j,R,G,F,q,D,O,L,k,z,V,U],encapsulation:2})};export{K as AdminCompanySettingsPage};
