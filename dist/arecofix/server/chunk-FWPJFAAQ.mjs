import './polyfills.server.mjs';
import{a as Q}from"./chunk-UBCPGJXU.mjs";import"./chunk-5SYQL5LV.mjs";import"./chunk-ACF32YXE.mjs";import"./chunk-OEE6LMKQ.mjs";import"./chunk-WUMV5ZNI.mjs";import{b as R,d as j,e as xe,f as be,g as $,h as fe,i as he,m as L,n as z,o as U,p as Ce,t as q}from"./chunk-QBNUQKUT.mjs";import{a as ke}from"./chunk-IZSWMJWO.mjs";import{a as ve}from"./chunk-3X5ZJVON.mjs";import"./chunk-WO5P5INO.mjs";import"./chunk-35OYAJOP.mjs";import"./chunk-HT57LKWA.mjs";import{p as ge,t as _e}from"./chunk-BLYQXFN2.mjs";import{p as pe,q as ue,r as A}from"./chunk-VF3MFHMJ.mjs";import{$ as c,$b as P,Ab as ee,Bb as w,Cb as M,Db as _,Eb as t,Ec as se,Fb as i,Fc as ce,Gb as u,Gc as D,Hb as v,Ib as k,Jb as F,Kb as y,Lc as me,Ob as p,Pb as Z,Qb as s,Ra as K,Vb as te,W as T,Wa as l,Wb as ie,Xb as E,Zb as n,_b as h,aa as m,ac as ne,bc as oe,cc as re,dc as ae,ha as X,ib as B,kc as le,lc as H,ma as x,pc as O,qa as Y,rc as J,sc as de,xb as b,yb as f,zb as N,zc as I}from"./chunk-PUXVFRR7.mjs";import"./chunk-DGJQU3KY.mjs";var Ee=(o,a)=>a.id;function Ve(o,a){if(o&1&&(t(0,"div",17),u(1,"i",41),t(2,"span"),n(3),i()()),o&2){let e=s(4);l(3),h(e.error())}}function Te(o,a){if(o&1){let e=y();t(0,"div",26)(1,"input",42),p("ngModelChange",function(d){c(e);let g=s(4);return m(g.priceValue.set(d))}),i(),t(2,"span",43),n(3),i()()}if(o&2){let e=s(4);l(),_("ngModel",e.priceValue())("placeholder",e.priceMode()==="fixed"?"Monto en $":"Ej: 10 (aumento) o -5 (descuento)"),l(2),P(" ",e.priceMode()==="fixed"?"$":"%"," ")}}function Be(o,a){if(o&1){let e=y();t(0,"input",44),p("ngModelChange",function(d){c(e);let g=s(4);return m(g.stockValue.set(d))}),i()}if(o&2){let e=s(4);_("ngModel",e.stockValue())}}function Ae(o,a){if(o&1&&(t(0,"option",33),n(1),i()),o&2){let e=a.$implicit;_("value",e.id),l(),h(e.name)}}function De(o,a){if(o&1&&(t(0,"option",33),n(1),i()),o&2){let e=a.$implicit;_("value",e.id),l(),h(e.name)}}function Ne(o,a){if(o&1){let e=y();t(0,"div",16),b(1,Ve,4,1,"div",17),t(2,"div",18)(3,"div",19)(4,"p",20),n(5,"Precio"),i()(),t(6,"div",21)(7,"select",22),p("ngModelChange",function(d){c(e);let g=s(3);return m(g.priceMode.set(d))}),t(8,"option",23),n(9,"\u2014 Sin cambios \u2014"),i(),t(10,"option",24),n(11,"Fijar precio exacto..."),i(),t(12,"option",25),n(13,"Ajuste porcentual (+/- %)"),i()(),b(14,Te,4,3,"div",26),i()(),t(15,"div",18)(16,"div",19)(17,"p",20),n(18,"Stock"),i()(),t(19,"div",21)(20,"select",22),p("ngModelChange",function(d){c(e);let g=s(3);return m(g.stockMode.set(d))}),t(21,"option",23),n(22,"\u2014 Sin cambios \u2014"),i(),t(23,"option",24),n(24,"Fijar en..."),i(),t(25,"option",27),n(26,"Aumentar en..."),i(),t(27,"option",28),n(28,"Disminuir en..."),i()(),b(29,Be,1,1,"input",29),i()(),t(30,"div",30)(31,"p",20),n(32,"Categor\xEDa"),i(),t(33,"div",31)(34,"select",22),p("ngModelChange",function(d){c(e);let g=s(3);return m(g.targetCategoryId.set(d))}),t(35,"option",32),n(36,"\u2014 Sin cambios \u2014"),i(),w(37,Ae,2,2,"option",33,Ee),i()()(),t(39,"div",30)(40,"p",20),n(41,"Marca"),i(),t(42,"div",31)(43,"select",22),p("ngModelChange",function(d){c(e);let g=s(3);return m(g.targetBrandId.set(d))}),t(44,"option",32),n(45,"\u2014 Sin cambios \u2014"),i(),w(46,De,2,2,"option",33,Ee),i()()(),t(48,"div",34)(49,"p",20),n(50,"Estado"),i(),t(51,"div",31)(52,"select",22),p("ngModelChange",function(d){c(e);let g=s(3);return m(g.targetStatus.set(d))}),t(53,"option",23),n(54,"\u2014 Sin cambios \u2014"),i(),t(55,"option",35),n(56,"\u2705 Publicado (Activo)"),i(),t(57,"option",36),n(58,"\u2B1C Borrador (Inactivo)"),i()()()()(),t(59,"div",37)(60,"button",38),p("click",function(){c(e);let d=s(3);return m(d.close())}),n(61,"Cancelar"),i(),t(62,"button",39),p("click",function(){c(e);let d=s(3);return m(d.prepareExecute())}),u(63,"i",40),n(64," Vista previa "),i()()}if(o&2){let e=s(3);l(),f(e.error()?1:-1),l(6),_("ngModel",e.priceMode()),l(7),f(e.priceMode()!=="none"?14:-1),l(6),_("ngModel",e.stockMode()),l(9),f(e.stockMode()!=="none"?29:-1),l(5),_("ngModel",e.targetCategoryId()),l(3),M(e.categories()),l(6),_("ngModel",e.targetBrandId()),l(3),M(e.brands()),l(6),_("ngModel",e.targetStatus()),l(10),_("disabled",!e.hasEditChanges())}}function Fe(o,a){if(o&1&&(t(0,"div",51),u(1,"i",41),t(2,"span"),n(3),i()()),o&2){let e=s(4);l(3),h(e.error())}}function Oe(o,a){if(o&1){let e=y();t(0,"div",45)(1,"div",46),u(2,"i",47),i(),t(3,"h4",48),n(4,"Eliminar productos seleccionados"),i(),t(5,"p",49),n(6," Se eliminar\xE1n "),t(7,"span",50),n(8),i(),n(9," de forma permanente del inventario. Los productos eliminados no aparecer\xE1n en el cat\xE1logo ni en b\xFAsquedas. "),i(),b(10,Fe,4,1,"div",51),i(),t(11,"div",52)(12,"button",38),p("click",function(){c(e);let d=s(3);return m(d.close())}),n(13,"Cancelar"),i(),t(14,"button",53),p("click",function(){c(e);let d=s(3);return m(d.prepareExecute())}),u(15,"i",54),n(16," Confirmar eliminaci\xF3n "),i()()}if(o&2){let e=s(3);l(8),ne("",e.selectedIds().length," producto",e.selectedIds().length!==1?"s":""),l(2),f(e.error()?10:-1)}}function Re(o,a){if(o&1&&(b(0,Ne,65,9),b(1,Oe,17,3)),o&2){let e=s(2);f(e.activeTab()==="edit"?0:-1),l(),f(e.activeTab()==="delete"?1:-1)}}function je(o,a){o&1&&(u(0,"span",62),n(1," Eliminando... "))}function $e(o,a){o&1&&(u(0,"i",54),n(1," S\xED, eliminar ahora "))}function Le(o,a){if(o&1){let e=y();t(0,"div",55),u(1,"i",47),i(),t(2,"div")(3,"h4",56),n(4,"\xBFConfirmar eliminaci\xF3n?"),i(),t(5,"p",57),n(6," Se eliminar\xE1n "),t(7,"span",50),n(8),i(),n(9,". "),u(10,"br"),t(11,"span",58),n(12,"Esta acci\xF3n no se puede deshacer."),i()()(),t(13,"div",59)(14,"button",60),p("click",function(){c(e);let d=s(3);return m(d.showConfirmation.set(!1))}),n(15," Regresar "),i(),t(16,"button",61),p("click",function(){c(e);let d=s(3);return m(d.execute())}),b(17,je,2,0)(18,$e,2,0),i()()}if(o&2){let e=s(3);l(8),P("",e.selectedIds().length," productos"),l(6),_("disabled",e.isProcessing()),l(2),_("disabled",e.isProcessing()),l(),f(e.isProcessing()?17:18)}}function ze(o,a){if(o&1&&(t(0,"li",68),u(1,"i",71),t(2,"span"),n(3),i()()),o&2){let e=a.$implicit;l(3),h(e)}}function Ue(o,a){o&1&&(u(0,"span",62),n(1," Actualizando... "))}function qe(o,a){o&1&&(u(0,"i",72),n(1," \xA1S\xED, actualizar ahora! "))}function Qe(o,a){if(o&1){let e=y();t(0,"div",63),u(1,"i",64),i(),t(2,"div")(3,"h4",56),n(4,"\xBFAplicar cambios?"),i(),t(5,"p",65),n(6," A "),t(7,"span",66),n(8),i(),n(9,": "),i(),t(10,"ul",67),w(11,ze,4,1,"li",68,N),i()(),t(13,"div",69)(14,"button",60),p("click",function(){c(e);let d=s(3);return m(d.showConfirmation.set(!1))}),n(15," Regresar "),i(),t(16,"button",70),p("click",function(){c(e);let d=s(3);return m(d.execute())}),b(17,Ue,2,0)(18,qe,2,0),i()()}if(o&2){let e=s(3);l(8),P("",e.selectedIds().length," productos"),l(3),M(e.confirmSummary()),l(3),_("disabled",e.isProcessing()),l(2),_("disabled",e.isProcessing()),l(),f(e.isProcessing()?17:18)}}function Ge(o,a){if(o&1&&(t(0,"div",13),b(1,Le,19,4)(2,Qe,19,4),i()),o&2){let e=s(2);l(),f(e.activeTab()==="delete"?1:2)}}function We(o,a){if(o&1){let e=y();t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"h3",4),n(6,"Operaci\xF3n Masiva"),i(),t(7,"p",5)(8,"span",6),n(9),i(),n(10," productos seleccionados "),i()(),t(11,"button",7),p("click",function(){c(e);let d=s();return m(d.close())}),n(12,"\u2715"),i()(),t(13,"div",8)(14,"button",9),p("click",function(){c(e);let d=s();return m(d.setTab("edit"))}),u(15,"i",10),n(16," Editar campos "),i(),t(17,"button",11),p("click",function(){c(e);let d=s();return m(d.setTab("delete"))}),u(18,"i",12),n(19," Eliminar "),i()()(),b(20,Re,2,2)(21,Ge,3,1,"div",13),i(),t(22,"form",14)(23,"button",15),p("click",function(){c(e);let d=s();return m(d.close())}),n(24,"close"),i()()()}if(o&2){let e=s();l(9),h(e.selectedIds().length),l(2),_("disabled",e.isProcessing()),l(3),E("tab-active",e.activeTab()==="edit"),l(3),E("tab-active",e.activeTab()==="delete")("text-error",e.activeTab()==="delete"),l(3),f(e.showConfirmation()?21:20)}}var G=class o{productService=T(Q);isOpen=D(!1);selectedIds=D([]);brands=D([]);categories=D([]);initialTab=ce("edit");onSuccess=se();ngOnChanges(a){a.isOpen&&this.isOpen()&&(this.activeTab.set(this.initialTab()),this.showConfirmation.set(!1),this.error.set(null))}isProcessing=x(!1);showConfirmation=x(!1);error=x(null);activeTab=x("edit");stockMode=x("none");stockValue=x(null);priceMode=x("none");priceValue=x(null);targetCategoryId=x("");targetBrandId=x("");targetStatus=x("none");hasEditChanges=I(()=>this.stockMode()!=="none"||this.priceMode()!=="none"||this.targetCategoryId()!==""||this.targetBrandId()!==""||this.targetStatus()!=="none");confirmSummary=I(()=>{let a=[];return this.priceMode()==="fixed"&&a.push(`Precio \u2192 $${this.priceValue()}`),this.priceMode()==="percentage"&&a.push(`Precio ${this.priceValue()>0?"+":""}${this.priceValue()}%`),this.stockMode()==="fixed"&&a.push(`Existencias \u2192 ${this.stockValue()}`),this.stockMode()==="increase"&&a.push(`Existencias +${this.stockValue()}`),this.stockMode()==="decrease"&&a.push(`Existencias -${this.stockValue()}`),this.targetCategoryId()&&a.push("Categor\xEDa cambiada"),this.targetBrandId()&&a.push("Marca cambiada"),this.targetStatus()==="active"&&a.push("Estado \u2192 Activo"),this.targetStatus()==="inactive"&&a.push("Estado \u2192 Inactivo"),a});prepareExecute(){if(this.error.set(null),this.activeTab()==="delete"){this.showConfirmation.set(!0);return}if(this.stockMode()!=="none"&&(this.stockValue()===null||this.stockValue()<0)){this.error.set("El valor de stock debe ser un n\xFAmero positivo.");return}if(this.priceMode()==="fixed"&&(this.priceValue()===null||this.priceValue()<0)){this.error.set("El precio debe ser un n\xFAmero positivo.");return}if(!this.hasEditChanges()){this.error.set("No has seleccionado ning\xFAn cambio para aplicar.");return}this.showConfirmation.set(!0)}async execute(){this.isProcessing.set(!0),this.showConfirmation.set(!1);try{this.activeTab()==="delete"?await this.productService.bulkDelete(this.selectedIds()):await this._executeEdit(),this.onSuccess.emit(),this.close()}catch(a){this.error.set(a.message||"Error al procesar la operaci\xF3n masiva")}finally{this.isProcessing.set(!1)}}async _executeEdit(){let a=this.selectedIds(),e=this.priceMode()==="percentage"||this.stockMode()==="increase"||this.stockMode()==="decrease",r=new Map,d=new Map;e&&(await this.productService.getProducts()).filter(V=>a.includes(V.id)).forEach(V=>{r.set(V.id,V.stock??0),d.set(V.id,V.price??0)});let g=a.map(C=>{let S={};if(this.priceMode()==="fixed")S.price=this.priceValue();else if(this.priceMode()==="percentage"){let V=d.get(C)??0;S.price=Math.round(V*(1+(this.priceValue()??0)/100))}return this.stockMode()==="fixed"?S.stock=this.stockValue():this.stockMode()==="increase"?S.stock=(r.get(C)??0)+(this.stockValue()??0):this.stockMode()==="decrease"&&(S.stock=Math.max(0,(r.get(C)??0)-(this.stockValue()??0))),this.targetCategoryId()&&(S.category_id=this.targetCategoryId()),this.targetBrandId()&&(S.brand_id=this.targetBrandId()),this.targetStatus()==="active"&&(S.is_active=!0),this.targetStatus()==="inactive"&&(S.is_active=!1),{id:C,payload:S}});await this.productService.bulkCustomUpdate(g)}setTab(a){this.activeTab.set(a),this.error.set(null),this.showConfirmation.set(!1)}close(){this.isProcessing()||(this.isOpen.set(!1),this.resetForm())}resetForm(){this.stockMode.set("none"),this.stockValue.set(null),this.priceMode.set("none"),this.priceValue.set(null),this.targetCategoryId.set(""),this.targetBrandId.set(""),this.targetStatus.set("none"),this.showConfirmation.set(!1),this.error.set(null),this.activeTab.set("edit")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=B({type:o,selectors:[["app-bulk-edit-modal"]],inputs:{isOpen:[1,"isOpen"],selectedIds:[1,"selectedIds"],brands:[1,"brands"],categories:[1,"categories"],initialTab:[1,"initialTab"]},outputs:{isOpen:"isOpenChange",selectedIds:"selectedIdsChange",brands:"brandsChange",categories:"categoriesChange",onSuccess:"onSuccess"},features:[Y],decls:1,vars:1,consts:[[1,"modal","modal-open","z-50"],[1,"modal-box","w-11/12","max-w-2xl","bg-white","dark:bg-gray-800","rounded-2xl","shadow-2xl","relative","p-0","overflow-hidden","border","border-gray-200","dark:border-gray-700"],[1,"px-6","pt-5","pb-0"],[1,"flex","justify-between","items-start","mb-4"],[1,"font-bold","text-xl","text-gray-800","dark:text-white"],[1,"text-xs","text-gray-500","mt-0.5"],[1,"font-bold","text-primary"],[1,"btn","btn-sm","btn-circle","btn-ghost",3,"click","disabled"],[1,"tabs","tabs-bordered","w-full"],[1,"tab","tab-lg","flex-1","font-semibold","gap-2",3,"click"],[1,"fas","fa-pen-to-square","text-sm"],[1,"tab","tab-lg","flex-1","font-semibold","gap-2","hover:text-error",3,"click"],[1,"fas","fa-trash-alt","text-sm"],[1,"p-10","text-center","space-y-5"],["method","dialog",1,"modal-backdrop","bg-black/60","backdrop-blur-sm"],[3,"click"],[1,"p-6","space-y-5","max-h-[60vh]","overflow-y-auto"],[1,"alert","alert-error","text-sm","py-2"],[1,"grid","grid-cols-3","gap-3","items-start","border-b","border-gray-100","dark:border-gray-700","pb-5"],[1,"pt-2"],[1,"font-bold","text-xs","uppercase","tracking-wider","text-gray-400"],[1,"col-span-2","space-y-2"],[1,"select","select-bordered","w-full","select-sm",3,"ngModelChange","ngModel"],["value","none"],["value","fixed"],["value","percentage"],[1,"relative"],["value","increase"],["value","decrease"],["type","number","min","0","placeholder","Cantidad",1,"input","input-bordered","w-full","input-sm",3,"ngModel"],[1,"grid","grid-cols-3","gap-3","items-center","border-b","border-gray-100","dark:border-gray-700","pb-5"],[1,"col-span-2"],["value",""],[3,"value"],[1,"grid","grid-cols-3","gap-3","items-center"],["value","active"],["value","inactive"],[1,"bg-gray-50","dark:bg-gray-700/50","p-4","flex","justify-end","gap-3","border-t","border-gray-200","dark:border-gray-700"],[1,"btn","btn-ghost","btn-sm",3,"click"],[1,"btn","btn-primary","btn-sm","px-8","shadow-lg","shadow-primary/20",3,"click","disabled"],[1,"fas","fa-eye","mr-2"],[1,"fas","fa-exclamation-circle"],["type","number",1,"input","input-bordered","w-full","input-sm","pr-8",3,"ngModelChange","ngModel","placeholder"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-gray-400","text-xs","font-bold"],["type","number","min","0","placeholder","Cantidad",1,"input","input-bordered","w-full","input-sm",3,"ngModelChange","ngModel"],[1,"p-8","text-center"],[1,"w-20","h-20","bg-error/10","text-error","rounded-full","flex","items-center","justify-center","mx-auto","mb-5"],[1,"fas","fa-trash-alt","text-4xl"],[1,"text-xl","font-bold","text-gray-800","dark:text-white","mb-2"],[1,"text-gray-500","text-sm","max-w-sm","mx-auto","mb-6"],[1,"font-bold","text-error"],[1,"alert","alert-error","text-sm","py-2","mb-4"],[1,"bg-error/5","p-4","flex","justify-end","gap-3","border-t","border-error/20"],[1,"btn","btn-error","btn-sm","px-8",3,"click"],[1,"fas","fa-trash-alt","mr-2"],[1,"w-20","h-20","bg-error/10","text-error","rounded-full","flex","items-center","justify-center","mx-auto"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white"],[1,"text-gray-500","mt-2"],[1,"text-xs","text-gray-400"],[1,"flex","justify-center","gap-4"],[1,"btn","btn-outline","btn-sm","px-8",3,"click","disabled"],[1,"btn","btn-error","btn-sm","px-10",3,"click","disabled"],[1,"loading","loading-spinner","loading-xs"],[1,"w-20","h-20","bg-warning/10","text-warning","rounded-full","flex","items-center","justify-center","mx-auto"],[1,"fas","fa-check-circle","text-4xl"],[1,"text-gray-500","mt-1","text-sm"],[1,"font-bold","text-gray-800","dark:text-white"],[1,"mt-3","space-y-1","text-sm","text-left","inline-block"],[1,"flex","items-center","gap-2"],[1,"flex","justify-center","gap-4","mt-4"],[1,"btn","btn-primary","btn-sm","px-10",3,"click","disabled"],[1,"fas","fa-check","text-success","text-xs","w-4"],[1,"fas","fa-check","mr-2"]],template:function(e,r){e&1&&b(0,We,25,9,"div",0),e&2&&f(r.isOpen()?0:-1)},dependencies:[A,q,fe,z,U,R,he,L,j,xe,Ce,$,be],encapsulation:2,changeDetection:0})};function Ke(o,a){if(o&1&&(v(0,"p",26),n(1),k()),o&2){let e=a.$implicit;l(),h(e)}}function Ze(o,a){if(o&1&&(v(0,"div",21),w(1,Ke,2,1,"p",26,N),k()),o&2){let e=s();l(),M(e.report.details)}}var W=class o{report;close=new X;get hasErrors(){return this.report.skipped>0}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=B({type:o,selectors:[["app-import-result-modal"]],inputs:{report:"report"},outputs:{close:"close"},decls:38,vars:49,consts:[[1,"modal","modal-open"],[1,"modal-box","max-w-lg","relative","overflow-hidden"],[1,"absolute","top-0","left-0","right-0","h-1","bg-gradient-to-r","from-green-400","via-teal-400","to-blue-500"],[1,"flex","items-center","gap-3","mb-6","pt-2"],[1,"w-12","h-12","rounded-2xl","flex","items-center","justify-center"],[1,"fas","text-2xl"],[1,"font-bold","text-xl"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"grid","grid-cols-2","gap-3","mb-6"],[1,"stat","bg-green-50","dark:bg-green-900/20","rounded-xl","px-4","py-3","border","border-green-100","dark:border-green-800/30"],[1,"stat-title","text-xs","text-green-700","dark:text-green-400"],[1,"stat-value","text-2xl","text-green-600","dark:text-green-400"],[1,"stat","bg-blue-50","dark:bg-blue-900/20","rounded-xl","px-4","py-3","border","border-blue-100","dark:border-blue-800/30"],[1,"stat-title","text-xs","text-blue-700","dark:text-blue-400"],[1,"stat-value","text-2xl","text-blue-600","dark:text-blue-400"],[1,"stat","bg-purple-50","dark:bg-purple-900/20","rounded-xl","px-4","py-3","border","border-purple-100","dark:border-purple-800/30"],[1,"stat-title","text-xs","text-purple-700","dark:text-purple-400"],[1,"stat-value","text-2xl","text-purple-600","dark:text-purple-400"],[1,"stat","rounded-xl","px-4","py-3","border"],[1,"stat-title","text-xs"],[1,"stat-value","text-2xl"],[1,"bg-gray-50","dark:bg-gray-800/50","rounded-xl","p-4","mb-6","space-y-1.5"],[1,"modal-action","mt-4"],[1,"btn","btn-primary","btn-block",3,"click"],[1,"fas","fa-check","mr-2"],[1,"modal-backdrop",3,"click"],[1,"text-sm","text-gray-700","dark:text-gray-300"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"div",1),F(2,"div",2),v(3,"div",3)(4,"div",4),F(5,"i",5),k(),v(6,"div")(7,"h3",6),n(8,"Importaci\xF3n completada"),k(),v(9,"p",7),n(10,"Resumen del procesamiento del CSV"),k()()(),v(11,"div",8)(12,"div",9)(13,"div",10),n(14,"Nuevos productos"),k(),v(15,"div",11),n(16),k()(),v(17,"div",12)(18,"div",13),n(19,"Precios actualizados"),k(),v(20,"div",14),n(21),k()(),v(22,"div",15)(23,"div",16),n(24,"Repuestos renombrados"),k(),v(25,"div",17),n(26),k()(),v(27,"div",18)(28,"div",19),n(29,"Omitidas"),k(),v(30,"div",20),n(31),k()()(),b(32,Ze,3,0,"div",21),v(33,"div",22)(34,"button",23),Z("click",function(){return r.close.emit()}),F(35,"i",24),n(36," Listo, actualizar inventario "),k()()(),v(37,"label",25),Z("click",function(){return r.close.emit()}),k()()),e&2&&(l(4),E("bg-green-100",!r.hasErrors)("dark:bg-green-900",!r.hasErrors)("bg-amber-100",r.hasErrors)("dark:bg-amber-900",r.hasErrors),l(),E("fa-check-circle",!r.hasErrors)("text-green-600",!r.hasErrors)("fa-exclamation-triangle",r.hasErrors)("text-amber-500",r.hasErrors),l(11),h(r.report.inserted),l(5),h(r.report.priceUpdated),l(5),h(r.report.renamed),l(),E("bg-red-50",r.report.skipped>0)("dark:bg-red-900/20",r.report.skipped>0)("border-red-100",r.report.skipped>0)("dark:border-red-800/30",r.report.skipped>0)("bg-gray-50",r.report.skipped===0)("dark:bg-gray-800/50",r.report.skipped===0)("border-gray-100",r.report.skipped===0)("dark:border-gray-700",r.report.skipped===0),l(),E("text-red-700",r.report.skipped>0)("dark:text-red-400",r.report.skipped>0)("text-gray-500",r.report.skipped===0),l(2),E("text-red-600",r.report.skipped>0)("dark:text-red-400",r.report.skipped>0)("text-gray-400",r.report.skipped===0),l(),h(r.report.skipped),l(),f(r.report.details.length>0?32:-1))},dependencies:[A],encapsulation:2,changeDetection:0})};var He=()=>[1,2,3,4,5,6,7,8],Pe=o=>["/admin/products",o],we=(o,a)=>a.id;function Je(o,a){o&1&&(u(0,"span",32),n(1," Importando\u2026 "))}function Xe(o,a){o&1&&(u(0,"i",33),n(1," Importar "))}function Ye(o,a){if(o&1){let e=y();t(0,"div",26)(1,"div",34)(2,"div",35)(3,"span",36),n(4),i(),n(5," seleccionados "),i(),t(6,"div",18)(7,"button",37),p("click",function(){c(e);let d=s();return m(d.openBulkEdit())}),u(8,"i",38),n(9," Editar "),i(),t(10,"button",39),p("click",function(){c(e);let d=s();return m(d.openBulkDelete())}),u(11,"i",40),n(12," Eliminar "),i(),t(13,"button",41),p("click",function(){c(e);let d=s();return m(d.clearSelection())}),u(14,"i",42),i()()()()}if(o&2){let e=s();l(4),h(e.selectedIds().size)}}function et(o,a){o&1&&u(0,"div",43)}function tt(o,a){o&1&&(t(0,"div",27),w(1,et,1,0,"div",43,ee),i()),o&2&&(l(),M(le(0,He)))}function it(o,a){if(o&1&&(t(0,"div",28)(1,"div",44),u(2,"i",45),t(3,"span"),n(4),i()()()),o&2){let e=s();l(4),h(e.error())}}function nt(o,a){if(o&1&&(n(0),O(1,"slice")),o&2){let e=s().$implicit;P(" Marca ID: ",de(1,1,e.brand_id,0,5),"... ")}}function ot(o,a){o&1&&n(0," Generic ")}function rt(o,a){o&1&&(t(0,"span",74),n(1,"Agotado"),i())}function at(o,a){if(o&1){let e=y();t(0,"tr",61),p("click",function(){let d=c(e).$implicit,g=s(2);return m(g.toggleSelection(d.id))}),t(1,"td",62),p("click",function(d){return c(e),m(d.stopPropagation())}),t(2,"label")(3,"input",51),p("change",function(){let d=c(e).$implicit,g=s(2);return m(g.toggleSelection(d.id))}),i()()(),t(4,"td")(5,"div",63)(6,"div",64)(7,"div",65),u(8,"img",66),i()(),t(9,"div")(10,"div",67),n(11),i(),t(12,"div",68),n(13),i()()()(),t(14,"td")(15,"div",69)(16,"span",70),n(17),i(),t(18,"span",71),b(19,nt,2,5)(20,ot,1,0),i()()(),t(21,"td",72),n(22),O(23,"currency"),i(),t(24,"td")(25,"div",18)(26,"div",73),n(27),i(),b(28,rt,2,0,"span",74),i()(),t(29,"td")(30,"div",75),u(31,"div",76),n(32),i()(),t(33,"td",77),p("click",function(d){return c(e),m(d.stopPropagation())}),t(34,"a",78),u(35,"i",79),i()()()}if(o&2){let e=a.$implicit,r=s(2);l(3),_("checked",r.selectedIds().has(e.id)),l(5),_("src",e.image_url||"assets/img/no-image.png",K)("alt",e.name),l(3),h(e.name),l(2),h(e.slug),l(4),h(e.sku||"---"),l(2),f(e.brand_id?19:20),l(3),P(" ",J(23,28,e.price,e.currency||"ARS")," "),l(4),ie("--value",e.stock?e.stock>100?100:e.stock:0),E("text-success",!e.stock||e.stock>10)("text-warning",e.stock&&e.stock<=10&&e.stock>0)("text-error",e.stock===0),l(),P(" ",e.stock||0," "),l(),f(e.stock===0?28:-1),l(2),E("badge-success",e.is_active)("badge-ghost",!e.is_active),l(),E("bg-white",e.is_active)("bg-gray-500",!e.is_active),l(),P(" ",e.is_active?"Activo":"Borrador"," "),l(2),_("routerLink",H(31,Pe,e.id))}}function lt(o,a){if(o&1){let e=y();t(0,"div",80)(1,"div",81)(2,"input",82),p("change",function(){let d=c(e).$implicit,g=s(2);return m(g.toggleSelection(d.id))}),i(),t(3,"div",83),u(4,"img",84),i(),t(5,"div",85)(6,"div",86)(7,"h3",87),n(8),i(),t(9,"div",88),n(10),i()(),t(11,"p",89),n(12),i(),t(13,"div",90)(14,"div")(15,"span",91),n(16,"Precio"),i(),t(17,"span",92),n(18),O(19,"currency"),i()(),t(20,"div",52)(21,"span",91),n(22,"Stock"),i(),t(23,"span",93),n(24),i()()()()(),t(25,"div",94)(26,"a",95),n(27," Editar Detalle "),u(28,"i",96),i()()()}if(o&2){let e=a.$implicit,r=s(2);E("ring-2",r.selectedIds().has(e.id))("ring-indigo-500",r.selectedIds().has(e.id)),l(2),_("checked",r.selectedIds().has(e.id)),l(2),_("src",e.image_url||"assets/img/no-image.png",K),l(4),h(e.name),l(),E("badge-success",e.is_active)("badge-ghost",!e.is_active),l(),P(" ",e.is_active?"ON":"OFF"," "),l(2),h(e.sku),l(6),h(J(19,18,e.price,e.currency||"ARS")),l(5),E("text-error",e.stock===0),l(),h(e.stock||0),l(2),_("routerLink",H(21,Pe,e.id))}}function dt(o,a){o&1&&(t(0,"div",59),u(1,"i",97),t(2,"p",98),n(3,"No se encontraron productos."),i()())}function st(o,a){if(o&1&&(t(0,"div",60),u(1,"pagination",99),i()),o&2){let e=s(2);l(),_("pages",e.totalPages())("currentPage",e.currentPage())}}function ct(o,a){if(o&1){let e=y();t(0,"div",46)(1,"table",47)(2,"thead",48)(3,"tr",49)(4,"th",50)(5,"label")(6,"input",51),p("change",function(){c(e);let d=s();return m(d.toggleSelectAll())}),i()()(),t(7,"th"),n(8,"Producto"),i(),t(9,"th"),n(10,"SKU / Marca"),i(),t(11,"th"),n(12,"Precio"),i(),t(13,"th"),n(14,"Stock"),i(),t(15,"th"),n(16,"Estado"),i(),t(17,"th",52),n(18,"Acciones"),i()()(),t(19,"tbody"),w(20,at,36,33,"tr",53,we),i()()(),t(22,"div",54)(23,"div",55)(24,"label",56)(25,"input",51),p("change",function(){c(e);let d=s();return m(d.toggleSelectAll())}),i(),t(26,"span",57),n(27,"Seleccionar Todo en p\xE1gina"),i()()(),w(28,lt,29,23,"div",58,we),i(),b(30,dt,4,0,"div",59),b(31,st,2,2,"div",60)}if(o&2){let e=s();l(6),_("checked",e.isAllSelected()),l(14),M(e.paginatedProducts()),l(5),_("checked",e.isAllSelected()),l(3),M(e.paginatedProducts()),l(2),f(e.paginatedProducts().length===0?30:-1),l(),f(e.paginatedProducts().length>0?31:-1)}}function mt(o,a){if(o&1&&(t(0,"div",30)(1,"div",100),u(2,"span",101),t(3,"p",102),n(4,"Procesando importaci\xF3n\u2026"),i(),t(5,"p",103),n(6),i(),t(7,"p",104),n(8,"No cierres esta ventana."),i()()()),o&2){let e=s();l(6),h(e.importProgress())}}function pt(o,a){if(o&1){let e=y();t(0,"app-import-result-modal",105),p("close",function(){c(e);let d=s();return m(d.onImportResultClose())}),i()}if(o&2){let e=s();_("report",e.importReport())}}var Me=class o{productService=T(Q);cdr=T(me);route=T(ge);products=x([]);brands=x([]);categories=x([]);searchQuery=x("");sortOrder=x("name_asc");selectedIds=x(new Set);isBulkModalOpen=x(!1);bulkInitialTab=x("edit");currentPage=x(1);itemsPerPage=x(10);loading=x(!0);importing=x(!1);importProgress=x("");error=x(null);importReport=x(null);showImportResult=x(!1);constructor(){this.route.queryParams.pipe(ve()).subscribe(a=>{let e=a._page?Number(a._page):1;this.currentPage.set(e||1)})}allFilteredProducts=I(()=>{let a=this.searchQuery().toLowerCase(),e=[...this.products()];a&&(e=e.filter(d=>d.name.toLowerCase().includes(a)||d.sku?.toLowerCase().includes(a)));let r=this.sortOrder();return e.sort((d,g)=>{switch(r){case"price_asc":return d.price-g.price;case"price_desc":return g.price-d.price;case"stock_asc":return(d.stock||0)-(g.stock||0);case"stock_desc":return(g.stock||0)-(d.stock||0);default:return d.name.localeCompare(g.name)}})});paginatedProducts=I(()=>{let a=this.allFilteredProducts(),e=(this.currentPage()-1)*this.itemsPerPage();return a.slice(e,e+this.itemsPerPage())});totalPages=I(()=>Math.ceil(this.allFilteredProducts().length/this.itemsPerPage()));isAllSelected=I(()=>{let a=this.paginatedProducts();if(a.length===0)return!1;let e=this.selectedIds();return a.every(r=>e.has(r.id))});selectedIdsList=I(()=>Array.from(this.selectedIds()));async ngOnInit(){await this.loadData()}async loadData(){this.loading.set(!0);try{let[a,e,r]=await Promise.all([this.productService.getProducts(),this.productService.getBrands(),this.productService.getCategories()]);this.products.set(a),this.brands.set(e),this.categories.set(r)}catch(a){this.error.set(a.message||"Error al cargar datos")}finally{this.loading.set(!1),this.cdr.detectChanges()}}toggleSelectAll(){let a=this.paginatedProducts(),e=new Set(this.selectedIds());this.isAllSelected()?a.forEach(d=>e.delete(d.id)):a.forEach(d=>e.add(d.id)),this.selectedIds.set(e)}toggleSelection(a){let e=new Set(this.selectedIds());e.has(a)?e.delete(a):e.add(a),this.selectedIds.set(e)}clearSelection(){this.selectedIds.set(new Set)}updateSort(a){this.sortOrder.set(a.target.value)}openBulkEdit(){this.bulkInitialTab.set("edit"),this.isBulkModalOpen.set(!0)}openBulkDelete(){this.bulkInitialTab.set("delete"),this.isBulkModalOpen.set(!0)}async onBulkEditSuccess(){this.clearSelection(),await this.loadData()}async exportProducts(){try{await this.productService.exportProductsToCSV()}catch(a){this.error.set("Error al exportar: "+a.message)}}async importProducts(a){let e=a.target.files?.[0];if(a.target.value="",!!e)try{this.importing.set(!0),this.importProgress.set("Leyendo CSV y cargando inventario actual\u2026"),this.error.set(null),this.cdr.detectChanges();let r=await this.productService.importProductsFromCSV(e);this.importProgress.set(""),this.importReport.set(r),this.showImportResult.set(!0),this.cdr.detectChanges()}catch(r){this.error.set("Error al importar: "+r.message),this.importProgress.set("")}finally{this.importing.set(!1),this.cdr.detectChanges()}}async onImportResultClose(){this.showImportResult.set(!1),this.importReport.set(null),await this.loadData()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=B({type:o,selectors:[["app-admin-products-page"]],decls:47,vars:14,consts:[["fileInput",""],[1,"max-w-7xl","mx-auto","pb-20","relative","min-h-screen"],[1,"flex","flex-col","md:flex-row","justify-between","items-start","md:items-center","py-6","gap-4","sticky","top-0","z-30","bg-gray-50/95","dark:bg-[#0f172a]/95","backdrop-blur-sm","border-b","border-gray-200","dark:border-gray-800","px-4"],[1,"text-3xl","font-bold","bg-clip-text","text-transparent","bg-linear-to-r","from-green-500","to-teal-400"],[1,"text-sm","text-gray-500","dark:text-gray-400","hidden","md:block"],[1,"flex","gap-2","w-full","md:w-auto","overflow-x-auto","pb-2","md:pb-0","no-scrollbar"],[1,"btn","btn-outline","btn-sm","md:btn-md",3,"click","disabled"],[1,"fas","fa-file-export","mr-2"],["type","file","accept",".csv",1,"hidden",3,"change"],["routerLink","/admin/products/new",1,"btn","btn-primary","btn-sm","md:btn-md","shadow-lg","shadow-green-500/20","whitespace-nowrap"],[1,"fas","fa-plus","mr-2"],[1,"p-4","grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","mb-4"],[1,"form-control","w-full","lg:col-span-2"],[1,"relative","group"],[1,"absolute","-inset-0.5","bg-linear-to-r","from-green-400","to-blue-500","rounded-lg","blur","opacity-25","group-hover:opacity-50","transition","duration-1000"],[1,"relative","flex","items-center","bg-white","dark:bg-gray-800","rounded-lg","shadow-sm"],[1,"fas","fa-search","px-4","text-gray-400"],["type","text","placeholder","Buscar por nombre, SKU, marca...",1,"input","input-ghost","w-full","focus:bg-transparent","text-lg","h-12",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-bold","text-gray-500","hidden","md:block"],[1,"select","select-bordered","w-full","bg-white","dark:bg-gray-800",3,"change","ngModel"],["value","name_asc"],["value","price_asc"],["value","price_desc"],["value","stock_asc"],["value","stock_desc"],[1,"fixed","bottom-4","left-4","right-4","md:left-1/2","md:-translate-x-1/2","md:w-auto","z-40","animate-fade-in-up"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6","p-4"],[1,"p-4"],[3,"isOpenChange","onSuccess","isOpen","selectedIds","brands","categories","initialTab"],[1,"fixed","inset-0","z-50","flex","flex-col","items-center","justify-center","bg-black/60","backdrop-blur-sm"],[3,"report"],[1,"loading","loading-spinner","loading-xs","mr-2"],[1,"fas","fa-file-import","mr-2"],[1,"bg-gray-900","text-white","dark:bg-white","dark:text-gray-900","rounded-full","shadow-2xl","px-6","py-3","flex","items-center","justify-between","gap-4","border","border-gray-700","dark:border-gray-200"],[1,"font-bold","whitespace-nowrap"],[1,"badge","badge-primary","mr-2"],[1,"btn","btn-sm","btn-ghost","hover:bg-white/20","dark:hover:bg-black/10","text-white","dark:text-gray-900","whitespace-nowrap",3,"click"],[1,"fas","fa-pen","mr-1.5"],[1,"btn","btn-sm","btn-ghost","hover:bg-error/30","text-error","whitespace-nowrap",3,"click"],[1,"fas","fa-trash-alt","mr-1.5"],[1,"btn","btn-circle","btn-xs","btn-ghost","text-white","dark:text-gray-900","opacity-70","hover:opacity-100",3,"click"],[1,"fas","fa-times"],[1,"skeleton","h-64","rounded-xl"],[1,"alert","alert-error"],[1,"fas","fa-exclamation-triangle"],[1,"hidden","lg:block","bg-white","dark:bg-gray-800","rounded-xl","shadow-lg","border","border-gray-100","dark:border-gray-700","overflow-hidden","mx-4"],[1,"table","w-full"],[1,"bg-gray-50","dark:bg-gray-700/50"],[1,"text-gray-600","dark:text-gray-300","font-bold","uppercase","text-xs","tracking-wider"],[1,"w-12"],["type","checkbox",1,"checkbox","checkbox-sm","checkbox-primary",3,"change","checked"],[1,"text-right"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/30","transition-colors","group","cursor-pointer"],[1,"lg:hidden","grid","grid-cols-1","gap-4","px-4"],[1,"flex","items-center","justify-between","bg-white","dark:bg-gray-800","p-3","rounded-lg","shadow-sm"],[1,"label","cursor-pointer","gap-3"],[1,"label-text","font-bold"],[1,"card","bg-white","dark:bg-gray-800","shadow-sm","border","border-gray-100","dark:border-gray-700",3,"ring-2","ring-indigo-500"],[1,"flex","flex-col","items-center","justify-center","py-20","text-center","opacity-50"],[1,"mt-8","flex","justify-center","pb-8"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/30","transition-colors","group","cursor-pointer",3,"click"],[3,"click"],[1,"flex","items-center","gap-4"],[1,"avatar"],[1,"mask","mask-squircle","w-12","h-12","bg-gray-100","dark:bg-gray-700"],[1,"object-cover",3,"src","alt"],[1,"font-bold","text-gray-900","dark:text-white","line-clamp-1"],[1,"text-xs","text-gray-400","font-mono"],[1,"flex","flex-col"],[1,"font-mono","text-xs","font-bold"],[1,"text-xs","text-gray-500"],[1,"font-mono","font-bold","text-indigo-600","dark:text-indigo-400"],[1,"radial-progress","text-xs",2,"--size","2rem"],[1,"badge","badge-error","badge-xs"],[1,"badge","badge-sm","gap-2"],[1,"w-2","h-2","rounded-full"],[1,"text-right",3,"click"],["data-tip","Editar",1,"btn","btn-ghost","btn-sm","btn-circle","tooltip","tooltip-left",3,"routerLink"],[1,"fas","fa-pen","text-gray-500","hover:text-indigo-500"],[1,"card","bg-white","dark:bg-gray-800","shadow-sm","border","border-gray-100","dark:border-gray-700"],[1,"card-body","p-4","flex-row","items-start","gap-4"],["type","checkbox",1,"checkbox","checkbox-primary","mt-1",3,"change","checked"],[1,"avatar","rounded-xl","w-20","h-20","bg-gray-100","shrink-0"],[1,"object-cover","rounded-xl",3,"src"],[1,"flex-1","min-w-0"],[1,"flex","justify-between","items-start"],[1,"font-bold","text-gray-900","dark:text-white","truncate","pr-2"],[1,"badge","badge-xs"],[1,"text-xs","text-gray-500","font-mono","mb-2"],[1,"flex","justify-between","items-end","mt-2"],[1,"block","text-xs","text-gray-400"],[1,"text-lg","font-bold","text-indigo-600","dark:text-indigo-400"],[1,"font-mono","font-bold"],[1,"card-actions","border-t","border-gray-100","dark:border-gray-700","p-2","flex","justify-end","bg-gray-50","dark:bg-gray-800/50","rounded-b-2xl"],[1,"btn","btn-sm","btn-ghost","w-full",3,"routerLink"],[1,"fas","fa-arrow-right","ml-2","opacity-50"],[1,"fas","fa-box-open","text-6xl","mb-4","text-gray-300"],[1,"text-xl"],[3,"pages","currentPage"],[1,"bg-white","dark:bg-gray-800","rounded-2xl","shadow-2xl","p-8","flex","flex-col","items-center","gap-4","max-w-sm","text-center"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"font-bold","text-lg"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"text-xs","text-gray-400"],[3,"close","report"]],template:function(e,r){if(e&1){let d=y();t(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),n(4," Inventario "),i(),t(5,"p",4),n(6,"Gestiona tu cat\xE1logo completo desde aqu\xED."),i()(),t(7,"div",5)(8,"button",6),p("click",function(){return c(d),m(r.exportProducts())}),u(9,"i",7),n(10," CSV "),i(),t(11,"button",6),p("click",function(){c(d);let C=te(15);return m(C.click())}),b(12,Je,2,0)(13,Xe,2,0),i(),t(14,"input",8,0),p("change",function(C){return c(d),m(r.importProducts(C))}),i(),t(16,"a",9),u(17,"i",10),n(18," Nuevo "),i()()(),t(19,"div",11)(20,"div",12)(21,"div",13),u(22,"div",14),t(23,"div",15),u(24,"i",16),t(25,"input",17),p("ngModelChange",function(C){return c(d),m(r.searchQuery.set(C))}),i()()()(),t(26,"div",18)(27,"span",19),n(28,"Ordenar:"),i(),t(29,"select",20),p("change",function(C){return c(d),m(r.updateSort(C))}),t(30,"option",21),n(31,"A-Z Nombre"),i(),t(32,"option",22),n(33,"Precio: Bajo a Alto"),i(),t(34,"option",23),n(35,"Precio: Alto a Bajo"),i(),t(36,"option",24),n(37,"Stock: Bajo a Alto"),i(),t(38,"option",25),n(39,"Stock: Alto a Bajo"),i()()()(),b(40,Ye,15,1,"div",26),b(41,tt,3,1,"div",27)(42,it,5,1,"div",28)(43,ct,32,4),i(),t(44,"app-bulk-edit-modal",29),ae("isOpenChange",function(C){return c(d),re(r.isBulkModalOpen,C)||(r.isBulkModalOpen=C),m(C)}),p("onSuccess",function(){return c(d),m(r.onBulkEditSuccess())}),i(),b(45,mt,9,1,"div",30),b(46,pt,1,1,"app-import-result-modal",31)}e&2&&(l(8),_("disabled",r.loading()||r.importing()),l(3),_("disabled",r.loading()||r.importing()),l(),f(r.importing()?12:13),l(13),_("ngModel",r.searchQuery()),l(4),_("ngModel",r.sortOrder()),l(11),f(r.selectedIds().size>0?40:-1),l(),f(r.loading()?41:r.error()?42:43),l(3),oe("isOpen",r.isBulkModalOpen),_("selectedIds",r.selectedIdsList())("brands",r.brands())("categories",r.categories())("initialTab",r.bulkInitialTab()),l(),f(r.importing()?45:-1),l(),f(r.showImportResult()&&r.importReport()?46:-1))},dependencies:[A,_e,q,z,U,R,L,j,$,ke,G,W,ue,pe],encapsulation:2,changeDetection:0})};export{Me as AdminProductsPage};
