{
  "version": 3,
  "sources": ["src/app/features/posts/application/post.service.ts"],
  "sourcesContent": ["import { Injectable, inject } from '@angular/core';\r\nimport { AuthService } from '@app/core/services/auth.service';\r\nimport { Post } from '@app/features/posts/domain/entities/post.entity';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class PostService {\r\n    private auth = inject(AuthService);\r\n    private supabase = this.auth.getSupabaseClient();\r\n\r\n    async getPostBySlug(slug: string): Promise<Post | null> {\r\n        const { data, error } = await this.supabase\r\n            .from('blog_posts')\r\n            .select('*')\r\n            .eq('slug', slug)\r\n            .maybeSingle();\r\n\r\n        if (error) {\r\n            console.error('PostService Error:', error);\r\n            throw error;\r\n        }\r\n\r\n        if (!data) return null;\r\n        \r\n        return this.mapToEntity(data);\r\n    }\r\n\r\n    async getRecentPosts(limit = 5): Promise<Post[]> {\r\n        const { data, error } = await this.supabase\r\n            .from('blog_posts')\r\n            .select('*')\r\n            .order('created_at', { ascending: false })\r\n            .limit(limit);\r\n\r\n        if (error) throw error;\r\n        \r\n        return (data || []).map((item: any) => this.mapToEntity(item));\r\n    }\r\n\r\n    private mapToEntity(data: any): Post {\r\n        const rawImage = data.featured_image || data.image || data.image_url;\r\n        return {\r\n            ...data,\r\n            // Robustly map image from possible DB fields\r\n            image: this.getImageUrl(rawImage)\r\n        } as Post;\r\n    }\r\n\r\n    private getImageUrl(pathOrUrl: string | null): string | null {\r\n        if (!pathOrUrl) return null;\r\n        if (pathOrUrl.startsWith('http') || pathOrUrl.startsWith('assets/')) return pathOrUrl;\r\n        \r\n        // If it's a raw path, assume it's in 'public-assets' bucket\r\n        // Check if it already has the bucket name in path\r\n        if (pathOrUrl.includes('public-assets/')) {\r\n             return this.supabase.storage.from('public-assets').getPublicUrl(pathOrUrl.split('public-assets/')[1]).data.publicUrl;\r\n        }\r\n\r\n        return this.supabase.storage.from('public-assets').getPublicUrl(pathOrUrl).data.publicUrl;\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;AAOM,IAAO,cAAP,MAAO,aAAW;EACZ,OAAO,OAAO,WAAW;EACzB,WAAW,KAAK,KAAK,kBAAiB;EAE9C,MAAM,cAAc,MAAY;AAC5B,UAAM,EAAE,MAAM,MAAK,IAAK,MAAM,KAAK,SAC9B,KAAK,YAAY,EACjB,OAAO,GAAG,EACV,GAAG,QAAQ,IAAI,EACf,YAAW;AAEhB,QAAI,OAAO;AACP,cAAQ,MAAM,sBAAsB,KAAK;AACzC,YAAM;IACV;AAEA,QAAI,CAAC;AAAM,aAAO;AAElB,WAAO,KAAK,YAAY,IAAI;EAChC;EAEA,MAAM,eAAe,QAAQ,GAAC;AAC1B,UAAM,EAAE,MAAM,MAAK,IAAK,MAAM,KAAK,SAC9B,KAAK,YAAY,EACjB,OAAO,GAAG,EACV,MAAM,cAAc,EAAE,WAAW,MAAK,CAAE,EACxC,MAAM,KAAK;AAEhB,QAAI;AAAO,YAAM;AAEjB,YAAQ,QAAQ,CAAA,GAAI,IAAI,CAAC,SAAc,KAAK,YAAY,IAAI,CAAC;EACjE;EAEQ,YAAY,MAAS;AACzB,UAAM,WAAW,KAAK,kBAAkB,KAAK,SAAS,KAAK;AAC3D,WAAO,iCACA,OADA;;MAGH,OAAO,KAAK,YAAY,QAAQ;;EAExC;EAEQ,YAAY,WAAwB;AACxC,QAAI,CAAC;AAAW,aAAO;AACvB,QAAI,UAAU,WAAW,MAAM,KAAK,UAAU,WAAW,SAAS;AAAG,aAAO;AAI5E,QAAI,UAAU,SAAS,gBAAgB,GAAG;AACrC,aAAO,KAAK,SAAS,QAAQ,KAAK,eAAe,EAAE,aAAa,UAAU,MAAM,gBAAgB,EAAE,CAAC,CAAC,EAAE,KAAK;IAChH;AAEA,WAAO,KAAK,SAAS,QAAQ,KAAK,eAAe,EAAE,aAAa,SAAS,EAAE,KAAK;EACpF;;qCArDS,cAAW;EAAA;4EAAX,cAAW,SAAX,aAAW,WAAA,YAFR,OAAM,CAAA;;;sEAET,aAAW,CAAA;UAHvB;WAAW;MACR,YAAY;KACf;;;",
  "names": []
}
