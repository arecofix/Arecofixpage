import './polyfills.server.mjs';
import{i as $,m as B}from"./chunk-2LQFN4DP.mjs";import{d as N,g as F,m as V,n as D,o as O,t as q}from"./chunk-QBNUQKUT.mjs";import"./chunk-NDIXGXKX.mjs";import"./chunk-MZNO5DKA.mjs";import"./chunk-X5DU6PYO.mjs";import{n as T,r as I}from"./chunk-VF3MFHMJ.mjs";import{$ as _,Bb as b,Cb as S,Db as d,Eb as i,Fb as n,Gb as E,Kb as w,Ob as C,Qb as c,Ra as U,W as f,Wa as l,Zb as r,_b as p,aa as x,ac as M,ib as y,ma as m,pc as A,rc as P,xb as h,yb as v}from"./chunk-PUXVFRR7.mjs";import"./chunk-DGJQU3KY.mjs";var k=(a,t)=>t.id;function z(a,t){a&1&&(i(0,"tr")(1,"td",6),r(2,"Cargando usuarios..."),n()())}function j(a,t){a&1&&(i(0,"tr")(1,"td",7),r(2,"No hay usuarios registrados."),n()())}function G(a,t){if(a&1&&(i(0,"option",19),r(1),n()),a&2){let e=t.$implicit;d("ngValue",e.id),l(),p(e.name)}}function L(a,t){a&1&&(i(0,"div",20),r(1,"Global (Todas las sucursales)"),n())}function H(a,t){if(a&1){let e=w();i(0,"tr")(1,"td")(2,"div",8)(3,"div",9)(4,"div",10),E(5,"img",11),n()(),i(6,"div")(7,"div",12),r(8),n(),i(9,"div",13),r(10),n()()()(),i(11,"td")(12,"select",14),C("ngModelChange",function(o){let u=_(e).$implicit,g=c(2);return x(g.updateUserRole(u,o))}),i(13,"option",15),r(14,"Cliente (User)"),n(),i(15,"option",16),r(16,"T\xE9cnico (Staff)"),n(),i(17,"option",17),r(18,"Administrador (Admin)"),n()()(),i(19,"td")(20,"select",18),C("ngModelChange",function(o){let u=_(e).$implicit,g=c(2);return x(g.updateUserBranch(u,o))}),i(21,"option",19),r(22,"-- Sin Sucursal Asignada --"),n(),b(23,G,2,2,"option",19,k),n(),h(25,L,2,0,"div",20),n(),i(26,"td",21),r(27),A(28,"date"),n()()}if(a&2){let e=t.$implicit,s=c(2);l(5),d("src",e.avatar_url||"https://ui-avatars.com/api/?name="+e.first_name+"+"+e.last_name,U),l(3),M("",e.first_name," ",e.last_name),l(2),p(e.email),l(2),d("ngModel",e.role),l(8),d("ngModel",e.branch_id)("disabled",e.role==="admin"||e.role==="user"),l(),d("ngValue",null),l(2),S(s.branches()),l(2),v(e.role==="admin"?25:-1),l(2),p(P(28,10,e.created_at,"shortDate"))}}function J(a,t){if(a&1&&b(0,H,29,13,"tr",null,k),a&2){let e=c();S(e.users())}}var R=class a{auth=f(B);tenantService=f($);users=m([]);branches=m([]);loading=m(!0);async ngOnInit(){await this.loadBranches(),await this.loadUsers()}async loadBranches(){let t=this.auth.getSupabaseClient(),e=this.tenantService.getTenantId(),{data:s,error:o}=await t.from("branches").select("*").eq("tenant_id",e).order("name");!o&&s&&this.branches.set(s)}async loadUsers(){this.loading.set(!0);let t=this.auth.getSupabaseClient(),e=this.tenantService.getTenantId(),{data:s,error:o}=await t.from("profiles").select("*").eq("tenant_id",e).order("created_at",{ascending:!1});!o&&s&&this.users.set(s),this.loading.set(!1)}async updateUserRole(t,e){let s=this.auth.getSupabaseClient(),{error:o}=await s.from("profiles").update({role:e}).eq("id",t.id);o?alert("Error actualizando el rol: "+o.message):t.role=e}async updateUserBranch(t,e){let s=this.auth.getSupabaseClient(),{error:o}=await s.from("profiles").update({branch_id:e||null}).eq("id",t.id);o?alert("Error actualizando la sucursal: "+o.message):t.branch_id=e}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=y({type:a,selectors:[["app-admin-users-page"]],decls:20,vars:1,consts:[[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-green-600"],[1,"bg-base-100","rounded-lg","shadow","overflow-hidden","text-base-content"],[1,"overflow-x-auto"],[1,"table","w-full"],[1,"text-base-content"],["colspan","4",1,"text-center","py-4"],["colspan","4",1,"text-center","py-4","text-gray-400"],[1,"flex","items-center","gap-3"],[1,"avatar"],[1,"mask","mask-squircle","w-12","h-12"],["alt","Avatar",3,"src"],[1,"font-bold"],[1,"text-xs","opacity-50"],[1,"select","select-sm","select-bordered","w-full","max-w-xs",3,"ngModelChange","ngModel"],["value","user"],["value","staff"],["value","admin"],[1,"select","select-sm","select-bordered","w-full","max-w-xs",3,"ngModelChange","ngModel","disabled"],[3,"ngValue"],[1,"text-[10px]","text-gray-400","mt-1"],[1,"text-sm","opacity-70"]],template:function(e,s){e&1&&(i(0,"div",0)(1,"h1",1),r(2,"Usuarios"),n()(),i(3,"div",2)(4,"div",3)(5,"table",4)(6,"thead")(7,"tr",5)(8,"th"),r(9,"Usuario"),n(),i(10,"th"),r(11,"Rol en el Negocio"),n(),i(12,"th"),r(13,"Sucursal Asignada"),n(),i(14,"th"),r(15,"Fecha Registro"),n()()(),i(16,"tbody"),h(17,z,3,0,"tr")(18,j,3,0,"tr")(19,J,2,0),n()()()()),e&2&&(l(17),v(s.loading()?17:s.users().length===0?18:19))},dependencies:[I,q,D,O,V,N,F,T],encapsulation:2})};export{R as AdminUsersPage};
