import './polyfills.server.mjs';
import{a as f}from"./chunk-3ZJRLAHS.mjs";import{a}from"./chunk-NBZ3MTX5.mjs";import{N as d,r as m}from"./chunk-D7WVJHD7.mjs";import{R as g,U as c,W as n,e as h,xa as p}from"./chunk-IUHZUWYM.mjs";import{a as u,b as l}from"./chunk-N7QBYMCK.mjs";var b=new c("SUPABASE_CLIENT");var S=class o{supabase=n(b);router=n(d);logger=n(f);platformId=n(p);authState=new h({user:null,session:null});authState$=this.authState.asObservable();constructor(){m(this.platformId)&&this.initializeAuth()}initializeAuth(){this.supabase.auth.onAuthStateChange((s,e)=>{e?.user?this.authState.next({user:e.user,session:e}):this.authState.next({user:null,session:null})})}async signIn(s,e){let{data:r,error:t}=await this.supabase.auth.signInWithPassword({email:s,password:e});return t?{user:null,session:null,error:t.message}:(this.authState.next({user:r.user,session:r.session}),{user:r.user,session:r.session})}async signUp(s,e,r){try{let{data:t,error:i}=await this.supabase.auth.signUp({email:s,password:e,options:{emailRedirectTo:a.authRedirectUrl,data:r?l(u({},r),{display_name:(r.display_name??`${r.first_name??""} ${r.last_name??""}`.trim())||null}):void 0}});return i?(this.logger.error("Supabase signUp error",i),{user:null,session:null,error:i.message}):(this.authState.next({user:t.user,session:t.session}),{user:t.user,session:t.session})}catch(t){return this.logger.error("Unexpected error during signup",t),{user:null,session:null,error:t instanceof Error?t.message:"Unknown error"}}}async signOut(){let{error:s}=await this.supabase.auth.signOut();return s?s.message:(this.authState.next({user:null,session:null}),null)}async getUser(){let{data:s}=await this.supabase.auth.getUser();return s.user}async getSession(){let{data:s}=await this.supabase.auth.getSession();return s.session}async getUserProfile(s){let{data:e,error:r}=await this.supabase.from("profiles").select("*").eq("id",s).single();return r?(this.logger.error("Error fetching profile",r),null):e}async updateUserProfile(s,e){let{data:r,error:t}=await this.supabase.from("profiles").update(e).eq("id",s).select().single();return t?(this.logger.error("Error updating profile",t),null):r}async resetPassword(s){let{error:e}=await this.supabase.auth.resetPasswordForEmail(s,{redirectTo:a.authRedirectUrl});return e?e.message:null}isAuthenticated(){return this.authState.value.user!==null}getCurrentUser(){return this.authState.value.user}getCurrentSession(){return this.authState.value.session}getAuthState$(){return this.authState.asObservable()}async testDatabaseConnection(){try{let{data:s,error:e}=await this.supabase.from("profiles").select("id").limit(1);return this.logger.debug("Database connection test",{data:s,error:e}),!e}catch(s){return this.logger.error("Database connection test failed",s),!1}}async updatePassword(s){let{error:e}=await this.supabase.auth.updateUser({password:s});return e?e.message:null}async updateEmail(s){let{error:e}=await this.supabase.auth.updateUser({email:s});return e?e.message:null}async signInWithGoogle(){let{data:s,error:e}=await this.supabase.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}});return e?{user:null,session:null,error:e.message}:{user:null,session:null}}async signInWithGithub(){let{data:s,error:e}=await this.supabase.auth.signInWithOAuth({provider:"github",options:{redirectTo:window.location.origin}});return e?{user:null,session:null,error:e.message}:{user:null,session:null}}async signInWithFacebook(){let{data:s,error:e}=await this.supabase.auth.signInWithOAuth({provider:"facebook",options:{redirectTo:window.location.origin}});return e?{user:null,session:null,error:e.message}:{user:null,session:null}}async verifyOTP(s,e){let{data:r,error:t}=await this.supabase.auth.verifyOtp({email:s,token:e,type:"email"});return t?{user:null,session:null,error:t.message}:(this.authState.next({user:r.user,session:r.session}),{user:r.user,session:r.session})}async sendMagicLink(s){let{error:e}=await this.supabase.auth.signInWithOtp({email:s,options:{emailRedirectTo:a.authRedirectUrl}});return e?e.message:null}async checkEmailExists(s){try{let{data:e,error:r}=await this.supabase.from("profiles").select("id").eq("email",s).single();return!r&&e!==null}catch{return!1}}async deleteAccount(){let s=this.getCurrentUser();if(!s)return"No user is currently authenticated";let{error:e}=await this.supabase.from("profiles").delete().eq("id",s.id);return e?e.message:(this.logger.warn("Account deletion requires backend implementation"),await this.signOut(),null)}async refreshSession(){let{data:s,error:e}=await this.supabase.auth.refreshSession();return e?(this.logger.error("Error refreshing session",e),null):(s.session?.user&&this.authState.next({user:s.session.user,session:s.session}),s.session)}getSupabaseClient(){return this.supabase}static \u0275fac=function(e){return new(e||o)};static \u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"})};export{b as a,S as b};
