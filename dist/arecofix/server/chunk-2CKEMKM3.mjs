import './polyfills.server.mjs';
import{h as U}from"./chunk-PALUBPQW.mjs";import{e as j}from"./chunk-BDXJUVVV.mjs";import{a as N,b as T,d as D,e as L,f as I,g as W,h as k,q,t as R}from"./chunk-6NF7UMPV.mjs";import"./chunk-RBOCUYI6.mjs";import"./chunk-6FAII6YG.mjs";import"./chunk-C5GT56EO.mjs";import{p as P,s as A,t as B}from"./chunk-CJMKWES6.mjs";import"./chunk-R44Y3TM4.mjs";import{$b as F,Db as y,Eb as n,Fb as i,Gb as u,Ob as S,Qb as x,Ra as C,W as m,Wa as o,Zb as l,_b as E,bc as f,cc as h,dc as v,ib as M,ma as g,xb as p,yb as b}from"./chunk-CUO5BU3F.mjs";import{a as c,b as _}from"./chunk-N7QBYMCK.mjs";function z(s,r){if(s&1&&(n(0,"div",7),u(1,"i",22),n(2,"span"),l(3),i()()),s&2){let t=x();o(3),E(t.error())}}function H(s,r){if(s&1&&(n(0,"div",13),u(1,"img",23),i()),s&2){let t=x();o(),y("src",t.form().logo_url,C)}}function J(s,r){s&1&&u(0,"span",21)}var V=class s{route=m(P);router=m(A);auth=m(j);tenantService=m(U);id=null;form=g({name:"",slug:"",logo_url:"",is_active:!0});loading=g(!0);saving=g(!1);error=g(null);async ngOnInit(){if(this.id=this.route.snapshot.paramMap.get("id"),this.id){let r=this.auth.getSupabaseClient(),{data:t,error:e}=await r.from("brands").select("*").eq("tenant_id",this.tenantService.getTenantId()).eq("id",this.id).single();t&&this.form.set({name:t.name,slug:t.slug,logo_url:t.logo_url||"",is_active:t.is_active})}this.loading.set(!1)}async onFileChange(r){let t=r.target.files?.[0];if(!t)return;let e=this.auth.getSupabaseClient(),d=`brands/${Date.now()}-${t.name}`,{data:a,error:w}=await e.storage.from("public-assets").upload(d,t);if(w){this.error.set(w.message);return}let{data:O}=e.storage.from("public-assets").getPublicUrl(a.path);this.form.update(G=>_(c({},G),{logo_url:O.publicUrl}))}async save(){this.saving.set(!0),this.error.set(null);let r=this.auth.getSupabaseClient(),t=c({},this.form());t.slug||(t.slug=this.slugify(t.name));try{if(this.id){let{error:e}=await r.from("brands").update(t).eq("id",this.id).eq("tenant_id",this.tenantService.getTenantId());if(e)throw e}else{let{error:e}=await r.from("brands").insert(_(c({},t),{tenant_id:this.tenantService.getTenantId()}));if(e)throw e}this.router.navigate(["/admin/brands"])}catch(e){this.error.set(e.message)}finally{this.saving.set(!1)}}slugify(r){return r.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=M({type:s,selectors:[["app-admin-brand-form-page"]],decls:33,vars:8,consts:[[1,"max-w-4xl","mx-auto","text-base-content"],[1,"flex","items-center","gap-4","mb-6"],["routerLink","/admin/brands",1,"btn","btn-circle","btn-ghost","text-base-content"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","text-green-600"],[3,"ngSubmit"],[1,"bg-base-100","p-6","rounded-xl","shadow-sm","border","border-base-200","mb-6","text-base-content"],[1,"alert","alert-error","mb-6"],[1,"mb-4"],[1,"block","text-sm","font-medium","text-base-content","mb-1.5"],["type","text","name","name","required","",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["type","text","name","slug","placeholder","Se genera autom\xE1ticamente si se deja vac\xEDo",1,"w-full","bg-base-100","text-base-content","border","border-base-300","rounded-lg","px-4","py-2","focus:outline-none","focus:ring-2","transition-all","duration-200","ease-in-out","shadow-sm","hover:border-base-content/40",3,"ngModelChange","ngModel"],["type","file","accept","image/*",1,"file-input","file-input-bordered","file-input-primary","w-full","bg-base-100","text-base-content",3,"change"],[1,"mt-4"],[1,"mt-6"],[1,"flex","items-center","gap-3","p-3","bg-base-100","border","border-base-300","rounded-lg","hover:bg-base-200","transition-colors","cursor-pointer","w-fit"],["type","checkbox","name","is_active",1,"checkbox","checkbox-primary","h-5","w-5","rounded","border-base-300",3,"ngModelChange","ngModel"],[1,"font-medium","text-base-content"],[1,"flex","justify-end","gap-4","mt-6"],["routerLink","/admin/brands",1,"btn","btn-error","text-white"],["type","submit",1,"btn","btn-primary","px-8",3,"disabled"],[1,"loading","loading-spinner","loading-xs","mr-2"],[1,"fas","fa-exclamation-circle"],["alt","Logo preview",1,"h-24","object-contain","border","border-base-300","rounded-lg","p-2","bg-base-100","shadow-sm",3,"src"]],template:function(t,e){t&1&&(n(0,"div",0)(1,"div",1)(2,"a",2),u(3,"i",3),i(),n(4,"h1",4),l(5),i()(),n(6,"form",5),S("ngSubmit",function(){return e.save()}),n(7,"div",6),p(8,z,4,1,"div",7),n(9,"div",8)(10,"label",9),l(11,"Nombre"),i(),n(12,"input",10),v("ngModelChange",function(a){return h(e.form().name,a)||(e.form().name=a),a}),i()(),n(13,"div",8)(14,"label",9),l(15,"Slug (URL)"),i(),n(16,"input",11),v("ngModelChange",function(a){return h(e.form().slug,a)||(e.form().slug=a),a}),i()(),n(17,"div",8)(18,"label",9),l(19,"Logo"),i(),n(20,"input",12),S("change",function(a){return e.onFileChange(a)}),i(),p(21,H,2,1,"div",13),i(),n(22,"div",14)(23,"label",15)(24,"input",16),v("ngModelChange",function(a){return h(e.form().is_active,a)||(e.form().is_active=a),a}),i(),n(25,"span",17),l(26,"Activo"),i()()()(),n(27,"div",18)(28,"a",19),l(29,"Cancelar"),i(),n(30,"button",20),p(31,J,1,0,"span",21),l(32," Guardar "),i()()()()),t&2&&(o(5),F("",e.id?"Editar":"Nueva"," Marca"),o(3),b(e.error()?8:-1),o(4),f("ngModel",e.form().name),o(4),f("ngModel",e.form().slug),o(5),b(e.form().logo_url?21:-1),o(3),f("ngModel",e.form().is_active),o(6),y("disabled",e.saving()),o(),b(e.saving()?31:-1))},dependencies:[R,k,T,N,D,L,q,W,I,B],encapsulation:2})};export{V as AdminBrandFormPage};
