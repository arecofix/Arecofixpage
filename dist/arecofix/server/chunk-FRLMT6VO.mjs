import './polyfills.server.mjs';
import{a as u}from"./chunk-I7SKRB6J.mjs";import{m as d}from"./chunk-OEE6LMKQ.mjs";import{R as c,W as s,p as i}from"./chunk-PUXVFRR7.mjs";import{a as n,b as p}from"./chunk-DGJQU3KY.mjs";var h=class o{repository=s(u);auth=s(d);STATUS_DELIVERED=6;STATUS_CANCELLED=7;async getById(t){return i(this.repository.getById(t))}async getAdminList(t,e){let r=this.auth.getCurrentUser();if(!r)throw new Error("Usuario no autenticado");let m=(await this.auth.getUserProfile(r.id))?.branch_id;return i(this.repository.getAdminList({branch_id:m,limit:t,offset:e}))}async delete(t){await i(this.repository.delete(t))}async create(t){let e=this.auth.getCurrentUser();if(!e)throw new Error("Usuario no autenticado");let r=await this.auth.getUserProfile(e.id);if(!r)throw new Error("Perfil no encontrado");let a=p(n({},t),{branch_id:r.branch_id,received_by:e.id,assigned_technician_id:t.assigned_technician_id||e.id,tracking_code:this.generateTrackingCode()});return a.current_status_id&&this.isFinalStatus(a.current_status_id)&&(a.completed_at=new Date().toISOString()),i(this.repository.create(a))}async update(t,e){let r=n({},e);r.current_status_id&&this.isFinalStatus(r.current_status_id)&&(r.completed_at||(r.completed_at=new Date().toISOString())),await i(this.repository.update(t,r))}async uploadImage(t){return this.repository.uploadImage(t)}generateTrackingCode(){return Math.random().toString(36).substring(2,10).toUpperCase()+"-"+Date.now().toString(36).toUpperCase()}isFinalStatus(t){return t===this.STATUS_DELIVERED||t===this.STATUS_CANCELLED}static \u0275fac=function(e){return new(e||o)};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{h as a};
