{
  "version": 3,
  "sources": ["src/app/shared/services/cart.service.ts"],
  "sourcesContent": ["import { Injectable, signal, computed, effect, inject, PLATFORM_ID } from '@angular/core';\r\nimport { isPlatformBrowser } from '@angular/common';\r\n\r\nimport { Product } from '@app/public/products/interfaces';\r\nimport { LoggerService } from '@app/core/services/logger.service';\r\n\r\nexport interface CartItem {\r\n    product: Product;\r\n    quantity: number;\r\n}\r\n\r\nimport { ToastService } from './toast.service';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class CartService {\r\n    private logger = inject(LoggerService);\r\n    private toastService = inject(ToastService);\r\n    private platformId = inject(PLATFORM_ID);\r\n    \r\n    cartItems = signal<CartItem[]>([]);\r\n\r\n    constructor() {\r\n        if (isPlatformBrowser(this.platformId)) {\r\n            // Load cart from local storage on init\r\n            const savedCart = localStorage.getItem('cart');\r\n            if (savedCart) {\r\n                try {\r\n                    this.cartItems.set(JSON.parse(savedCart));\r\n                } catch (e) {\r\n                    this.cartItems.set([]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Save cart to local storage whenever it changes\r\n        effect(() => {\r\n            const currentCart = this.cartItems();\r\n            if (isPlatformBrowser(this.platformId)) {\r\n                localStorage.setItem('cart', JSON.stringify(currentCart));\r\n            }\r\n        });\r\n    }\r\n\r\n    addToCart(product: Product) {\r\n        this.cartItems.update(items => {\r\n            const existingItem = items.find(item => item.product.id === product.id);\r\n            if (existingItem) {\r\n                return items.map(item =>\r\n                    item.product.id === product.id\r\n                        ? { ...item, quantity: item.quantity + 1 }\r\n                        : item\r\n                );\r\n            }\r\n            return [...items, { product, quantity: 1 }];\r\n        });\r\n        this.logger.debug('Product added to cart', { productName: product.name });\r\n        this.toastService.show('Agregaste un producto al carrito', 'success', () => this.openCart());\r\n    }\r\n\r\n    removeFromCart(productId: string) {\r\n        this.cartItems.update(items => items.filter(item => item.product.id !== productId));\r\n    }\r\n\r\n    updateQuantity(productId: string, quantity: number) {\r\n        if (quantity <= 0) {\r\n            this.removeFromCart(productId);\r\n            return;\r\n        }\r\n        this.cartItems.update(items =>\r\n            items.map(item =>\r\n                item.product.id === productId\r\n                    ? { ...item, quantity }\r\n                    : item\r\n            )\r\n        );\r\n    }\r\n\r\n    clearCart() {\r\n        this.cartItems.set([]);\r\n    }\r\n\r\n    totalItems = computed(() => this.cartItems().reduce((acc, item) => acc + item.quantity, 0));\r\n    totalPrice = computed(() => this.cartItems().reduce((acc, item) => acc + (item.product.price * item.quantity), 0));\r\n\r\n    // Cart Visibility State\r\n    isCartOpen = signal(false);\r\n\r\n    openCart() {\r\n        this.isCartOpen.set(true);\r\n    }\r\n\r\n    closeCart() {\r\n        this.isCartOpen.set(false);\r\n    }\r\n\r\n    toggleCart() {\r\n        this.isCartOpen.update(v => !v);\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;AAgBM,IAAO,cAAP,MAAO,aAAW;EACZ,SAAS,OAAO,aAAa;EAC7B,eAAe,OAAO,YAAY;EAClC,aAAa,OAAO,WAAW;EAEvC,YAAY,OAAmB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;EAEjC,cAAA;AACI,QAAI,kBAAkB,KAAK,UAAU,GAAG;AAEpC,YAAM,YAAY,aAAa,QAAQ,MAAM;AAC7C,UAAI,WAAW;AACX,YAAI;AACA,eAAK,UAAU,IAAI,KAAK,MAAM,SAAS,CAAC;QAC5C,SAAS,GAAG;AACR,eAAK,UAAU,IAAI,CAAA,CAAE;QACzB;MACJ;IACJ;AAGA,WAAO,MAAK;AACR,YAAM,cAAc,KAAK,UAAS;AAClC,UAAI,kBAAkB,KAAK,UAAU,GAAG;AACpC,qBAAa,QAAQ,QAAQ,KAAK,UAAU,WAAW,CAAC;MAC5D;IACJ,CAAC;EACL;EAEA,UAAU,SAAgB;AACtB,SAAK,UAAU,OAAO,WAAQ;AAC1B,YAAM,eAAe,MAAM,KAAK,UAAQ,KAAK,QAAQ,OAAO,QAAQ,EAAE;AACtE,UAAI,cAAc;AACd,eAAO,MAAM,IAAI,UACb,KAAK,QAAQ,OAAO,QAAQ,KACtB,iCAAK,OAAL,EAAW,UAAU,KAAK,WAAW,EAAC,KACtC,IAAI;MAElB;AACA,aAAO,CAAC,GAAG,OAAO,EAAE,SAAS,UAAU,EAAC,CAAE;IAC9C,CAAC;AACD,SAAK,OAAO,MAAM,yBAAyB,EAAE,aAAa,QAAQ,KAAI,CAAE;AACxE,SAAK,aAAa,KAAK,oCAAoC,WAAW,MAAM,KAAK,SAAQ,CAAE;EAC/F;EAEA,eAAe,WAAiB;AAC5B,SAAK,UAAU,OAAO,WAAS,MAAM,OAAO,UAAQ,KAAK,QAAQ,OAAO,SAAS,CAAC;EACtF;EAEA,eAAe,WAAmB,UAAgB;AAC9C,QAAI,YAAY,GAAG;AACf,WAAK,eAAe,SAAS;AAC7B;IACJ;AACA,SAAK,UAAU,OAAO,WAClB,MAAM,IAAI,UACN,KAAK,QAAQ,OAAO,YACd,iCAAK,OAAL,EAAW,SAAQ,KACnB,IAAI,CACb;EAET;EAEA,YAAS;AACL,SAAK,UAAU,IAAI,CAAA,CAAE;EACzB;EAEA,aAAa,SAAS,MAAM,KAAK,UAAS,EAAG,OAAO,CAAC,KAAK,SAAS,MAAM,KAAK,UAAU,CAAC,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;EAC1F,aAAa,SAAS,MAAM,KAAK,UAAS,EAAG,OAAO,CAAC,KAAK,SAAS,MAAO,KAAK,QAAQ,QAAQ,KAAK,UAAW,CAAC,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;;EAGjH,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;EAEzB,WAAQ;AACJ,SAAK,WAAW,IAAI,IAAI;EAC5B;EAEA,YAAS;AACL,SAAK,WAAW,IAAI,KAAK;EAC7B;EAEA,aAAU;AACN,SAAK,WAAW,OAAO,OAAK,CAAC,CAAC;EAClC;;qCAnFS,cAAW;EAAA;4EAAX,cAAW,SAAX,aAAW,WAAA,YAFR,OAAM,CAAA;;;sEAET,aAAW,CAAA;UAHvB;WAAW;MACR,YAAY;KACf;;;",
  "names": []
}
