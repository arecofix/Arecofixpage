import './polyfills.server.mjs';
import{a as te}from"./chunk-TMUNOG7K.mjs";import{a as Y}from"./chunk-TIDIKGOO.mjs";import{a as Z}from"./chunk-3FGFT2Z7.mjs";import{l as Q,m as W}from"./chunk-2LQFN4DP.mjs";import{a as ee}from"./chunk-WIBX3BG7.mjs";import{a as X}from"./chunk-44N27TJG.mjs";import"./chunk-QIQJ6T5Y.mjs";import"./chunk-WUMV5ZNI.mjs";import{b as z,c as x,d as U,e as j,h as R,j as B,k as L,l as H,s as J,u as K}from"./chunk-QBNUQKUT.mjs";import"./chunk-NDIXGXKX.mjs";import"./chunk-MZNO5DKA.mjs";import"./chunk-X5DU6PYO.mjs";import{s as M,t as G}from"./chunk-BLYQXFN2.mjs";import"./chunk-VF3MFHMJ.mjs";import{$ as E,$b as N,Bb as q,Cb as O,Db as _,Eb as t,Fb as e,Gb as d,Kb as P,Ob as F,Qb as v,Ra as w,W as p,Wa as l,Xb as S,Zb as n,_b as V,aa as k,ac as A,ib as I,ma as y,p as T,xb as f,yb as g}from"./chunk-PUXVFRR7.mjs";import"./chunk-DGJQU3KY.mjs";var le=(o,i)=>i.product.id;function ce(o,i){if(o&1&&(t(0,"div",2)(1,"div",4)(2,"div",5),d(3,"i",6),e(),t(4,"h2",7),n(5,"\xA1Orden Recibida!"),e(),t(6,"p",8),n(7,"Gracias por tu compra. Para procesar el env\xEDo, por favor realiza el pago:"),e(),t(8,"div",9)(9,"p",10),n(10,"Datos Bancarios:"),e(),t(11,"div",11)(12,"p",12)(13,"span"),n(14,"Alias:"),e(),t(15,"span",13),n(16,"areco.fix"),e()(),t(17,"p",12)(18,"span"),n(19,"CBU:"),e(),t(20,"span",13),n(21,"0000003100084531456958"),e()()()(),t(22,"p",14),n(23," Una vez realizado el pago, env\xEDa el comprobante al: "),d(24,"br"),t(25,"strong",15),n(26,"+54 9 11 2596-0900"),e()(),t(27,"div",16)(28,"a",17),d(29,"i",18),n(30," Enviar Comprobante "),e(),t(31,"a",19),n(32,"Volver al Inicio"),e()()()()),o&2){let r,s=v();l(28),_("href","https://wa.me/5491125960900?text=Hola,%20hice%20un%20pedido%20a%20nombre%20de%20"+((r=s.checkoutForm.get("name"))==null?null:r.value)+".%20Adjunto%20comprobante.",w)}}function de(o,i){o&1&&(t(0,"p",42),n(1,"Tu carrito est\xE1 vac\xEDo."),e(),t(2,"a",43),n(3,"Ir a comprar"),e())}function se(o,i){if(o&1){let r=P();t(0,"div",45),d(1,"img",48),t(2,"div",49)(3,"h3",50),n(4),e(),t(5,"p",51),n(6),e()(),t(7,"div",52)(8,"span",50),n(9),e(),t(10,"button",53),F("click",function(){let u=E(r).$implicit,b=v(3);return k(b.cartService.removeFromCart(u.product.id))}),d(11,"i",54),e()()()}if(o&2){let r=i.$implicit;l(),_("src",r.product.image_url||(r.product.gallery_urls==null?null:r.product.gallery_urls[0])||"assets/img/no-image.png",w),l(3),V(r.product.name),l(2),A("$",r.product.price," x ",r.quantity),l(3),N(" $",(r.product.price*r.quantity).toFixed(2)," ")}}function me(o,i){if(o&1&&(t(0,"div",44),q(1,se,12,5,"div",45,le),e(),d(3,"div",46),t(4,"div",47)(5,"span"),n(6,"Total"),e(),t(7,"span"),n(8),e()()),o&2){let r=v(2);l(),O(r.cartService.cartItems()),l(7),N("$",r.cartService.totalPrice().toFixed(2))}}function ue(o,i){o&1&&(t(0,"span",29),n(1,"El nombre es requerido"),e())}function pe(o,i){o&1&&(t(0,"span",29),n(1,"Email inv\xE1lido"),e())}function be(o,i){o&1&&(t(0,"span",29),n(1,"El tel\xE9fono es requerido"),e())}function xe(o,i){o&1&&d(0,"span",41)}function fe(o,i){if(o&1){let r=P();t(0,"div",3)(1,"div",20)(2,"div",21)(3,"h2",22),n(4,"Resumen del Carrito"),e(),f(5,de,4,0)(6,me,9,1),e()(),t(7,"div",23)(8,"div",21)(9,"h2",22),n(10,"Datos del Cliente"),e(),t(11,"form",24),F("ngSubmit",function(){E(r);let u=v();return k(u.placeOrder())}),t(12,"div",25)(13,"label",26)(14,"span",27),n(15,"Nombre Completo"),e()(),d(16,"input",28),f(17,ue,2,0,"span",29),e(),t(18,"div",25)(19,"label",26)(20,"span",27),n(21,"Email"),e()(),d(22,"input",30),f(23,pe,2,0,"span",29),e(),t(24,"div",25)(25,"label",26)(26,"span",27),n(27,"Tel\xE9fono"),e()(),d(28,"input",31),f(29,be,2,0,"span",29),e(),t(30,"div",32)(31,"div",33)(32,"div",25)(33,"label",26)(34,"span",27),n(35,"Calle"),e()(),d(36,"input",34),e(),t(37,"div",25)(38,"label",26)(39,"span",27),n(40,"N\xFAmero"),e()(),d(41,"input",35),e()(),t(42,"div",33)(43,"div",25)(44,"label",26)(45,"span",27),n(46,"Barrio / Depto"),e()(),d(47,"input",36),e(),t(48,"div",25)(49,"label",26)(50,"span",27),n(51,"Ciudad"),e()(),d(52,"input",37),e()()(),t(53,"div",25)(54,"label",26)(55,"span",27),n(56,"Notas (Opcional)"),e()(),d(57,"textarea",38),e(),t(58,"div",39)(59,"button",40),f(60,xe,1,0,"span",41),n(61," Finalizar Compra "),e()()()()()()}if(o&2){let r,s,u,b,h,c,a=v();l(5),g(a.cartService.cartItems().length===0?5:6),l(6),_("formGroup",a.checkoutForm),l(5),S("input-error",((r=a.checkoutForm.get("name"))==null?null:r.invalid)&&((r=a.checkoutForm.get("name"))==null?null:r.touched)),l(),g((s=a.checkoutForm.get("name"))!=null&&s.invalid&&((s=a.checkoutForm.get("name"))!=null&&s.touched)?17:-1),l(5),S("input-error",((u=a.checkoutForm.get("email"))==null?null:u.invalid)&&((u=a.checkoutForm.get("email"))==null?null:u.touched)),l(),g((b=a.checkoutForm.get("email"))!=null&&b.invalid&&((b=a.checkoutForm.get("email"))!=null&&b.touched)?23:-1),l(5),S("input-error",((h=a.checkoutForm.get("phone"))==null?null:h.invalid)&&((h=a.checkoutForm.get("phone"))==null?null:h.touched)),l(),g((c=a.checkoutForm.get("phone"))!=null&&c.invalid&&((c=a.checkoutForm.get("phone"))!=null&&c.touched)?29:-1),l(30),_("disabled",a.isProcessing()||a.cartService.cartItems().length===0),l(),g(a.isProcessing()?60:-1)}}var ie=class o{cartService=p(X);orderService=p(te);authService=p(W);contactService=p(Y);productService=p(ee);profileService=p(Q);fb=p(J);router=p(M);notificationService=p(Z);checkoutForm=this.fb.group({name:["",[x.required]],email:["",[x.required,x.email]],phone:["",[x.required]],address:this.fb.group({street:["",[x.required]],number:["",[x.required]],city:["Marcos Paz",[x.required]],neighborhood:[""]}),notes:[""]});isProcessing=y(!1);orderSuccess=y(!1);async placeOrder(){if(this.checkoutForm.invalid){this.checkoutForm.markAllAsTouched(),this.notificationService.showError("Por favor, completa todos los campos requeridos.");return}this.isProcessing.set(!0);let i=this.checkoutForm.getRawValue(),r=this.cartService.cartItems(),s=this.cartService.totalPrice(),u=`${i.address.street} ${i.address.number}, ${i.address.neighborhood?i.address.neighborhood+", ":""}${i.address.city}`,b={customer_name:i.name,customer_email:i.email,customer_phone:i.phone,shipping_address:i.address,status:"pending",subtotal:s,tax:0,discount:0,total:s,notes:i.notes,user_id:this.authService.getCurrentUser()?.id},h=r.map(c=>({product_name:c.product.name,product_id:c.product.id,quantity:c.quantity,unit_price:c.product.price,subtotal:c.product.price*c.quantity}));try{let{data:c,error:a}=await this.orderService.createOrder(b,h);if(a)throw console.error("Order creation error:",a),a;let C=r.map(m=>`- ${m.product.name} (x${m.quantity}) - $${(m.product.price*m.quantity).toFixed(2)}`).join(`
`),ne=`Nuevo Pedido #${c?.order_number||"N/A"}
      
Detalles del Cliente:
Nombre: ${i.name}
Email: ${i.email}
Tel\xE9fono: ${i.phone}
Direcci\xF3n: ${u}

Productos:
${C}

Total: $${s.toFixed(2)}

Notas Adicionales:
${i.notes||"Ninguna"}`,re={name:i.name,email:i.email,phone:i.phone,subject:`[NUEVO PEDIDO] #${c?.order_number} - ${i.name} - $${s.toFixed(2)}`,message:ne},{error:$}=await this.contactService.createMessage(re);$&&console.error("Message creation error (non-fatal):",$);let D=this.authService.getCurrentUser();if(D)try{await this.profileService.updateProfile(D.id,{phone:i.phone,address:i.address,updated_at:new Date().toISOString()})}catch(m){console.log("Non-critical profile update error",m)}let oe=[...new Set(r.map(m=>m.product.id))];try{let m=oe.map(ae=>T(this.productService.updateProduct(ae,{is_featured:!0})));await Promise.all(m)}catch(m){console.warn("Could not update featured status for products (likely permission issue):",m)}this.orderSuccess.set(!0),this.cartService.clearCart(),this.notificationService.showSuccess("\xA1Orden creada exitosamente!")}catch(c){console.error("Checkout failed full error:",JSON.stringify(c,null,2));let a=c?.message||"Error desconocido",C=c?.code||"N/A";this.notificationService.showError(`Hubo un error al procesar tu orden: ${a} (C\xF3digo: ${C})`)}finally{this.isProcessing.set(!1)}}static \u0275fac=function(r){return new(r||o)};static \u0275cmp=I({type:o,selectors:[["app-checkout-page"]],decls:5,vars:1,consts:[[1,"container","mx-auto","px-4","py-8","max-w-4xl"],[1,"text-3xl","font-bold","mb-8","text-center","text-primary"],[1,"card","bg-base-100","shadow-xl","text-center","p-10","border","border-base-200"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"card-body","items-center"],[1,"text-success","text-6xl","mb-4"],[1,"fas","fa-check-circle"],[1,"card-title","text-2xl","text-base-content","mb-2"],[1,"text-base-content/80","mb-6"],[1,"bg-base-200","p-6","rounded-xl","w-full","max-w-md","mb-6","text-left","border","border-base-300"],[1,"font-bold","text-base-content","mb-2","border-b","border-base-content/10","pb-2"],[1,"space-y-2"],[1,"text-base-content/70","flex","justify-between"],[1,"font-mono","font-bold","text-base-content","select-all","bg-base-100","px-2","rounded"],[1,"text-sm","mb-4","text-base-content/80"],[1,"text-lg","text-primary"],[1,"card-actions","flex","flex-col","gap-3","w-full","max-w-md"],["target","_blank",1,"btn","btn-success","text-white","w-full","btn-lg",3,"href"],[1,"fab","fa-whatsapp","text-xl","mr-2"],["routerLink","/",1,"btn","btn-ghost","w-full"],[1,"card","bg-base-100","shadow-xl","h-fit","border","border-base-200"],[1,"card-body"],[1,"card-title","mb-4","text-base-content"],[1,"card","bg-base-100","shadow-xl","border","border-base-200"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"form-control","w-full"],[1,"label"],[1,"label-text","text-base-content"],["type","text","formControlName","name",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],[1,"text-error","text-xs","mt-1"],["type","email","formControlName","email",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["type","tel","formControlName","phone",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["formGroupName","address",1,"space-y-4"],[1,"grid","grid-cols-2","gap-4"],["type","text","formControlName","street",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["type","text","formControlName","number",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["type","text","formControlName","neighborhood","placeholder","Opcional",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["type","text","formControlName","city",1,"input","input-bordered","w-full","bg-base-100","text-base-content"],["formControlName","notes",1,"textarea","textarea-bordered","w-full","bg-base-100","text-base-content"],[1,"mt-6"],["type","submit",1,"btn","btn-primary","btn-block","btn-lg",3,"disabled"],[1,"loading","loading-spinner"],[1,"text-base-content"],["routerLink","/products/featured",1,"btn","btn-link","px-0"],[1,"space-y-4"],[1,"flex","gap-4","items-center","p-2","hover:bg-base-200","rounded-lg","transition-colors"],[1,"divider"],[1,"flex","justify-between","text-xl","font-bold","text-base-content"],[1,"w-16","h-16","object-cover","rounded-lg","border","border-base-300",3,"src"],[1,"flex-1"],[1,"font-bold","text-base-content"],[1,"text-sm","text-base-content/70"],[1,"flex","flex-col","items-end","gap-1"],["aria-label","Eliminar",1,"btn","btn-ghost","btn-xs","text-error",3,"click"],[1,"fas","fa-trash-alt"]],template:function(r,s){r&1&&(t(0,"div",0)(1,"h1",1),n(2,"Finalizar Compra"),e(),f(3,ce,33,1,"div",2)(4,fe,62,13,"div",3),e()),r&2&&(l(3),g(s.orderSuccess()?3:4))},dependencies:[K,R,z,U,j,H,L,B,G],encapsulation:2})};export{ie as CheckoutPage};
