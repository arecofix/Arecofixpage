import './polyfills.server.mjs';
import"./chunk-DPLNUI4A.mjs";import{a as Y}from"./chunk-4MAJOETZ.mjs";import{a as V}from"./chunk-FIOJQ5SM.mjs";import{m as $}from"./chunk-2LQFN4DP.mjs";import{a as U}from"./chunk-NDIXGXKX.mjs";import"./chunk-MZNO5DKA.mjs";import{a as j}from"./chunk-X5DU6PYO.mjs";import{p as F,t as G}from"./chunk-BLYQXFN2.mjs";import{k as O,n as M,r as L}from"./chunk-VF3MFHMJ.mjs";import{$ as w,$b as s,Ab as I,Bb as T,Cb as N,Db as b,Eb as t,Fb as i,Gb as p,Kb as P,Ob as R,Qb as x,R as y,Ra as E,W as c,Wa as o,Wb as A,Zb as n,_b as m,aa as k,ib as C,kc as D,ma as f,pc as _,rc as h,xb as u,yb as g}from"./chunk-PUXVFRR7.mjs";import"./chunk-DGJQU3KY.mjs";var v=class a{auth=c($);async getRepairByCode(r){return await this.auth.getSupabaseClient().rpc("get_repair_by_tracking",{t_code:r})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=y({token:a,factory:a.\u0275fac,providedIn:"root"})};var q=()=>[1,2,3,4,5];function H(a,r){a&1&&(t(0,"div",7),p(1,"span",12),t(2,"p",13),n(3,"Consultando Sat\xE9lite..."),i()())}function K(a,r){if(a&1&&(t(0,"div",8)(1,"div",14),p(2,"i",15),i(),t(3,"h2",16),n(4),i(),t(5,"p",17),n(6,"Verific\xE1 tu c\xF3digo o contactanos por WhatsApp."),i(),t(7,"div",18)(8,"a",19),p(9,"i",20),n(10," Soporte Directo "),i(),t(11,"a",21),n(12,"Volver al inicio"),i()()()),a&2){let e=x();o(4),m(e.error()),o(4),b("href","https://wa.me/"+e.whatsappNumber,E)}}function Q(a,r){if(a&1&&(t(0,"div",31),n(1),i()),a&2){let e=r.$implicit,l=x();b("ngClass",l.current_status_id>=e?"bg-primary border-primary text-white scale-110 shadow-lg shadow-primary/30":"bg-white border-neutral-100 text-neutral-300"),o(),s(" ",e," ")}}function W(a,r){if(a&1&&(t(0,"div",46)(1,"h4",58),p(2,"span",59),n(3," Reporte T\xE9cnico "),i(),t(4,"p",60),n(5),i()()),a&2){let e=x();o(5),s(' "',e.technical_report||e.technician_notes,'" ')}}function X(a,r){if(a&1&&(t(0,"span",52),n(1),i()),a&2){let e=x();o(),s("SE\xD1A ENTREGADA: $",e.deposit_amount)}}function J(a,r){if(a&1){let e=P();t(0,"div",22)(1,"div",23)(2,"span",24),n(3,"Estado de Reparaci\xF3n"),i(),t(4,"span",25),n(5),i()(),t(6,"h2",26),n(7),i(),t(8,"p",27),n(9),i()(),t(10,"div",28)(11,"div",29)(12,"div",30),T(13,Q,2,2,"div",31,I),i(),t(15,"div",32),p(16,"div",33),i()(),t(17,"div",34)(18,"div",35)(19,"div",36)(20,"div",37),p(21,"i",38),i(),t(22,"div")(23,"h4",39),n(24,"Equipo en Taller"),i(),t(25,"p",40),n(26),i()()(),t(27,"div",41)(28,"div",42)(29,"span",43),n(30,"Fecha de Ingreso"),i(),t(31,"span",44),n(32),_(33,"date"),i()(),t(34,"div",42)(35,"span",43),n(36,"Motivo"),i(),t(37,"span",45),n(38),i()()()(),u(39,W,6,1,"div",46),t(40,"div",47)(41,"div",48)(42,"div")(43,"h4",49),n(44,"Presupuesto Final"),i(),t(45,"p",50),n(46),i()(),t(47,"div",51),u(48,X,2,1,"span",52),i()(),t(49,"div",53)(50,"button",54),R("click",function(){w(e);let d=x();return k(d.printTicket())}),p(51,"i",55),n(52," Tal\xF3n "),i(),t(53,"a",56),p(54,"i",57),n(55," Chat "),i()()()()()}if(a&2){let e=r,l=x();b("ngClass",l.getStatusColor(e.current_status_id)),o(5),s("#",e.tracking_code),o(2),s(" ",l.getStatusLabel(e.current_status_id)," "),o(2),s(" Tu ",e.device_model," est\xE1 siendo gestionado con la m\xE1xima prioridad t\xE9cnica. "),o(4),N(D(16,q)),o(3),A("width",(e.current_status_id-1)*25,"%"),o(10),m(e.device_model),o(6),m(h(33,13,e.received_at||e.created_at,"dd MMM yyyy")),o(6),s('"',e.issue_description,'"'),o(),g(e.technician_notes||e.technical_report?39:-1),o(7),s("$",(e.final_cost||e.estimated_cost||0)-(e.deposit_amount||0)),o(2),g(e.deposit_amount&&e.deposit_amount>0?48:-1),o(5),b("href","https://wa.me/"+l.whatsappNumber,E)}}function Z(a,r){if(a&1&&(t(0,"div",11)(1,"div",61)(2,"h1",62),n(3,"ARECOFIX"),i(),t(4,"p",63),n(5,"Gesti\xF3n T\xE9cnica Profesional"),i(),t(6,"p",64),n(7),i()(),t(8,"div",65)(9,"div",66)(10,"span"),n(11,"TRACKING:"),i(),t(12,"span",67),n(13),i()(),t(14,"div",66)(15,"span"),n(16,"FECHA:"),i(),t(17,"span"),n(18),_(19,"date"),i()(),t(20,"div",68)(21,"span"),n(22,"CLIENTE:"),i(),t(23,"span",69),n(24),i()(),t(25,"div",66)(26,"span"),n(27,"EQUIPO:"),i(),t(28,"span",69),n(29),i()()(),t(30,"div",70)(31,"p",71),n(32,"Saldo a Pagar"),i(),t(33,"p",72),n(34),i()(),t(35,"div",73)(36,"p"),n(37,"* Presentar este tal\xF3n para el retiro."),i(),t(38,"p"),n(39,"* No se entregan equipos sin comprobante."),i(),t(40,"p"),n(41,"* Garant\xEDa: 30 d\xEDas sobre el trabajo realizado."),i()(),t(42,"div",74),p(43,"div",75),t(44,"p",76),n(45,"FIRMA T\xC9CNICA"),i()()()),a&2){let e=r;o(7),s("OT #: ",e.repair_number||"---"),o(6),m(e.tracking_code),o(5),m(h(19,6,e.received_at||e.created_at,"dd/MM/yy HH:mm")),o(6),m(e.customer_name),o(5),m(e.device_model),o(5),s("$",(e.final_cost||e.estimated_cost||0)-(e.deposit_amount||0))}}var B=class a{route=c(F);trackingService=c(v);logger=c(U);seoService=c(V);companyService=c(Y);whatsappNumber=j.contact.whatsappNumber;code=null;repair=f(null);loading=f(!0);error=f(null);async ngOnInit(){this.code=this.route.snapshot.paramMap.get("code"),this.code?await this.loadRepair():(this.error.set("C\xF3digo de seguimiento no v\xE1lido."),this.loading.set(!1))}async loadRepair(){let r=this.code;if(r)try{let{data:e,error:l}=await this.trackingService.getRepairByCode(r);if(l)this.logger.error("Error fetching repair:",l),this.error.set("Error al buscar la reparaci\xF3n. Por favor intente nuevamente.");else if(e&&Array.isArray(e)&&e.length>0){let d=e[0];this.repair.set(d),await this.updateSeo(d)}else if(e&&!Array.isArray(e)){let d=e;this.repair.set(d),await this.updateSeo(d)}else this.error.set("No se encontr\xF3 ninguna reparaci\xF3n con este c\xF3digo.")}catch(e){this.logger.error("TrackingPage: Unexpected error:",e),this.error.set("Ocurri\xF3 un error inesperado al procesar su solicitud.")}finally{this.loading.set(!1)}}async updateSeo(r){let e=this.getStatusLabel(r.current_status_id),l="assets/img/branding/og-services.jpg";try{let d=await this.companyService.getSettings();d?.logo_url&&(l=d.logo_url)}catch(d){this.logger.warn("Could not fetch company settings for SEO image",d)}this.seoService.setPageData({title:`${e} - Tu ${r.device_model}`,description:`Gracias por confiar en Arecofix. Tu equipo est\xE1 en etapa de ${e}.`,imageUrl:l,type:"article"})}getStatusLabel(r){return{1:"PENDIENTE DE DIAGN\xD3STICO",2:"GESTI\xD3N DE REPUESTOS",3:"EN REPARACI\xD3N",4:"CONTROL DE CALIDAD",5:"LISTO PARA RETIRAR",6:"ENTREGADO",7:"CANCELADO"}[r]||"PENDIENTE"}getStatusColor(r){return{1:"bg-amber-100 text-amber-800 border-amber-200",2:"bg-cyan-100 text-cyan-800 border-cyan-200",3:"bg-blue-100 text-blue-800 border-blue-200",4:"bg-indigo-100 text-indigo-800 border-indigo-200",5:"bg-green-100 text-green-800 border-green-200",6:"bg-slate-100 text-slate-800 border-slate-200",7:"bg-rose-100 text-rose-800 border-rose-200"}[r]||"bg-slate-100 text-slate-700"}printTicket(){typeof window<"u"&&window.print()}openImage(r){typeof window<"u"&&window.open(r,"_blank")}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=C({type:a,selectors:[["app-tracking-page"]],decls:17,vars:2,consts:[[1,"py-10","px-4","min-h-screen","bg-neutral-50","no-print"],[1,"max-w-xl","mx-auto"],[1,"mb-8","text-center"],[1,"text-2xl","font-black","text-neutral-800","tracking-tighter","uppercase","mb-1"],[1,"text-primary"],[1,"text-xs","text-neutral-400","font-medium","uppercase","tracking-widest"],[1,"bg-white","rounded-3xl","shadow-2xl","shadow-neutral-200/50","overflow-hidden","border","border-neutral-100"],[1,"p-12","flex","flex-col","items-center"],[1,"p-12","text-center"],[1,"mt-10","text-center"],[1,"text-[10px]","font-bold","text-neutral-300","uppercase","tracking-[0.3em]"],[1,"print-only","p-8","font-mono","text-xs","w-[80mm]","mx-auto"],[1,"loading","loading-ring","loading-lg","text-primary"],[1,"mt-4","text-xs","font-bold","text-neutral-400","uppercase","animate-pulse"],[1,"inline-flex","items-center","justify-center","w-16","h-16","bg-rose-50","text-rose-500","rounded-full","mb-6"],[1,"fas","fa-exclamation-triangle","text-2xl"],[1,"text-xl","font-black","text-neutral-800","mb-2"],[1,"text-sm","text-neutral-400","mb-8","font-medium"],[1,"flex","flex-col","gap-3"],["target","_blank",1,"btn","btn-success","text-white","rounded-2xl",3,"href"],[1,"fab","fa-whatsapp","text-lg"],["routerLink","/",1,"btn","btn-ghost","btn-sm","text-neutral-400"],[1,"p-6","transition-all","duration-500",3,"ngClass"],[1,"flex","justify-between","items-start","mb-4"],[1,"text-[10px]","font-black","uppercase","tracking-[0.2em]","opacity-60"],[1,"text-[10px]","font-mono","font-bold","opacity-60"],[1,"text-3xl","font-black","leading-tight","mb-2","tracking-tight"],[1,"text-sm","font-medium","opacity-80","leading-relaxed"],[1,"p-6","space-y-8"],[1,"relative","pt-4"],[1,"flex","justify-between","mb-4"],[1,"w-8","h-8","rounded-full","border-2","flex","items-center","justify-center","text-[10px]","font-black","transition-all","duration-500",3,"ngClass"],[1,"absolute","top-[36px]","left-0","right-0","h-0.5","bg-neutral-100","-z-10"],[1,"h-full","bg-primary","transition-all","duration-1000"],[1,"grid","grid-cols-1","gap-6"],[1,"bg-neutral-50","rounded-2xl","p-5","border","border-neutral-100"],[1,"flex","items-center","gap-4","mb-4"],[1,"w-10","h-10","bg-white","rounded-xl","flex","items-center","justify-center","shadow-sm","text-primary"],[1,"fas","fa-microchip"],[1,"text-[10px]","font-black","text-neutral-400","uppercase","tracking-widest","leading-none","mb-1"],[1,"text-sm","font-bold","text-neutral-800"],[1,"space-y-3"],[1,"flex","justify-between","text-xs"],[1,"text-neutral-400","font-medium"],[1,"text-neutral-800","font-bold","uppercase"],[1,"text-neutral-600","font-medium","wrap-break-word","text-right","max-w-[180px]"],[1,"bg-primary/5","rounded-2xl","p-5","border","border-primary/10"],[1,"bg-neutral-800","rounded-3xl","p-6","text-white","shadow-xl","shadow-neutral-900/20"],[1,"flex","justify-between","items-end","mb-6"],[1,"text-[10px]","font-black","opacity-40","uppercase","tracking-widest","mb-1"],[1,"text-3xl","font-black","tracking-tighter"],[1,"text-right"],[1,"badge","badge-success","text-[8px]","font-black","text-white","p-2"],[1,"flex","gap-2"],[1,"btn","btn-sm","grow","rounded-xl","bg-white/10","border-none","text-white","hover:bg-white/20","text-[10px]","font-black","uppercase",3,"click"],[1,"fas","fa-print"],["target","_blank",1,"btn","btn-sm","grow","rounded-xl","bg-green-500","border-none","text-white","hover:bg-green-600","text-[10px]","font-black","uppercase",3,"href"],[1,"fab","fa-whatsapp"],[1,"text-[10px]","font-black","text-primary","uppercase","tracking-widest","mb-3","flex","items-center","gap-2"],[1,"w-1.5","h-1.5","bg-primary","rounded-full","animate-ping"],[1,"text-xs","font-medium","text-neutral-700","leading-relaxed","italic"],[1,"text-center","mb-6","border-b","border-black","pb-4"],[1,"text-xl","font-black","uppercase"],[1,"text-[8px]","uppercase","tracking-tighter"],[1,"mt-2"],[1,"space-y-3","mb-6"],[1,"flex","justify-between"],[1,"font-bold"],[1,"flex","justify-between","border-t","border-black","pt-2"],[1,"font-bold","text-right","truncate","max-w-[120px]"],[1,"border-y","border-black","py-3","text-center","mb-6"],[1,"font-bold","uppercase","mb-1"],[1,"text-2xl","font-black"],[1,"text-[8px]","leading-tight","space-y-2","mb-8"],[1,"text-center"],[1,"w-32","h-px","bg-black","mx-auto","mb-1"],[1,"text-[8px]"]],template:function(e,l){if(e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),n(4,"Arecofix "),t(5,"span",4),n(6,"Tracking"),i()(),t(7,"p",5),n(8,"Estado T\xE9cnico en Tiempo Real"),i()(),t(9,"div",6),u(10,H,4,0,"div",7)(11,K,13,2,"div",8)(12,J,56,17),i(),t(13,"div",9)(14,"p",10),n(15,"ArecoFix \xA9 2024"),i()()()(),u(16,Z,46,9,"div",11)),e&2){let d,S;o(10),g(l.loading()?10:l.error()?11:(d=l.repair())?12:-1,d),o(6),g((S=l.repair())?16:-1,S)}},dependencies:[L,O,G,M],styles:["@media print{.no-print[_ngcontent-%COMP%]{display:none!important}.print-only[_ngcontent-%COMP%]{display:block!important}body[_ngcontent-%COMP%]{background:#fff}.ticket-container[_ngcontent-%COMP%]{border:1px dashed #000;padding:20px;width:100%;margin:0}}.print-only[_ngcontent-%COMP%]{display:none}"]})};export{B as TrackingPage};
